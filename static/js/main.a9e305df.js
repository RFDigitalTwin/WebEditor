/*! For license information please see main.a9e305df.js.LICENSE.txt */
(()=>{var e={16:(e,t,n)=>{"use strict";e.exports=n(958)},43:(e,t,n)=>{"use strict";e.exports=n(202)},67:(e,t,n)=>{"use strict";e.exports=n(612)},153:(e,t,n)=>{"use strict";var i=n(43),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,m(x,v.prototype),x.isPureReactComponent=!0;var _=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,i){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,r)&&!M.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function P(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return s=s(l=e),e=""===o?"."+A(l,0):o,_(s)?(r="",null!=e&&(r=e.replace(T,"$&/")+"/"),P(s,t,r,"",function(e){return e})):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(T,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",_(e))for(var c=0;c<e.length;c++){var u=o+A(a=e[c],c);l+=P(a,t,r,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=P(a=a.value,t,r,u=o+A(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function D(e,t,n){if(null==e)return e;var i=[],r=0;return P(e,i,"","",function(e){return t.call(n,e,r++)}),i}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},N={transition:null},I={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:N,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:D,forEach:function(e,t,n){D(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return D(e,function(){t++}),t},toArray:function(e){return D(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=s,t.PureComponent=b,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,t.act=L,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!M.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.3.1"},205:(e,t,n)=>{"use strict";e.exports=n(302)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,N(w);else{var t=i(u);null!==t&&I(_,t.startTime-e)}}function w(e,n){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var o=p;try{for(x(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!P());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===i(c)&&r(c),x(n)}else r(c);h=i(c)}if(null!==h)var l=!0;else{var d=i(u);null!==d&&I(_,d.startTime-n),l=!1}return l}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,E=null,C=-1,T=5,A=-1;function P(){return!(t.unstable_now()-A<T)}function D(){if(null!==E){var e=t.unstable_now();A=e;var n=!0;try{n=E(!0,e)}finally{n?S():(M=!1,E=null)}}else M=!1}if("function"===typeof b)S=function(){b(D)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,R=k.port2;k.port1.onmessage=D,S=function(){R.postMessage(null)}}else S=function(){v(D,0)};function N(e){E=e,M||(M=!0,S())}function I(e,n){C=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,N(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(y(C),C=-1):g=!0,I(_,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,N(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},302:(e,t)=>{"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},330:(e,t,n)=>{"use strict";var i=n(43);var r="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=i.useState,s=i.useEffect,a=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(i){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=o({inst:{value:n,getSnapshot:t}}),r=i[0].inst,u=i[1];return a(function(){r.value=n,r.getSnapshot=t,c(r)&&u({inst:r})},[e,n,t]),s(function(){return c(r)&&u({inst:r}),e(function(){c(r)&&u({inst:r})})},[e]),l(n),n};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},391:(e,t,n)=>{"use strict";var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},443:(e,t,n)=>{"use strict";e.exports=n(717)},461:(e,t,n)=>{"use strict";e.exports=n(330)},579:(e,t,n)=>{"use strict";e.exports=n(153)},612:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,N(w);else{var t=i(u);null!==t&&I(_,t.startTime-e)}}function w(e,n){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var o=p;try{for(x(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!P());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===i(c)&&r(c),x(n)}else r(c);h=i(c)}if(null!==h)var l=!0;else{var d=i(u);null!==d&&I(_,d.startTime-n),l=!1}return l}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,E=null,C=-1,T=5,A=-1;function P(){return!(t.unstable_now()-A<T)}function D(){if(null!==E){var e=t.unstable_now();A=e;var n=!0;try{n=E(!0,e)}finally{n?S():(M=!1,E=null)}}else M=!1}if("function"===typeof b)S=function(){b(D)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,R=k.port2;k.port1.onmessage=D,S=function(){R.postMessage(null)}}else S=function(){v(D,0)};function N(e){E=e,M||(M=!0,S())}function I(e,n){C=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,N(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(y(C),C=-1):g=!0,I(_,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,N(w))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},717:(e,t,n)=>{"use strict";var i=n(43),r=n(461);var o="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},s=r.useSyncExternalStore,a=i.useRef,l=i.useEffect,c=i.useMemo,u=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,i,r){var d=a(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=c(function(){function e(e){if(!l){if(l=!0,s=e,e=i(e),void 0!==r&&h.hasValue){var t=h.value;if(r(t,e))return a=t}return a=e}if(t=a,o(s,e))return t;var n=i(e);return void 0!==r&&r(t,n)?(s=e,t):(s=e,a=n)}var s,a,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,i,r]);var p=s(e,d[0],d[1]);return l(function(){h.hasValue=!0,h.value=p},[p]),u(p),p}},730:(e,t,n)=>{"use strict";var i=n(43),r=n(67);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var I=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var O,z=Object.assign;function U(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var F=!1;function j(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case E:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case D:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function $(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function q(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Z(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){K(e,t);var n=G(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&$(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function oe(e,t){var n=G(t.value),i=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ve=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Me=null;function Ee(e){if(e=br(e)){if("function"!==typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=_r(t),we(e.stateNode,e.type,t))}}function Ce(e){Se?Me?Me.push(e):Me=[e]:Se=e}function Te(){if(Se){var e=Se,t=Me;if(Me=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ae(e,t){return e(t)}function Pe(){}var De=!1;function ke(e,t,n){if(De)return e(t,n);De=!0;try{return Ae(e,t,n)}finally{De=!1,(null!==Se||null!==Me)&&(Pe(),Te())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var i=_r(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ne=!1;if(u)try{var Ie={};Object.defineProperty(Ie,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",Ie,Ie),window.removeEventListener("test",Ie,Ie)}catch(ue){Ne=!1}function Le(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,ze=null,Ue=!1,Fe=null,je={onError:function(e){Oe=!0,ze=e}};function Be(e,t,n,i,r,o,s,a,l){Oe=!1,ze=null,Le.apply(je,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(Ve(e)!==e)throw Error(o(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Ge(r),e;if(s===i)return Ge(r),t;s=s.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=s;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=s;break}if(l===i){a=!0,i=r,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,i=r;break}if(l===i){a=!0,i=s,n=r;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var Ye=r.unstable_scheduleCallback,$e=r.unstable_cancelCallback,qe=r.unstable_shouldYield,Ze=r.unstable_requestPaint,Ke=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,Qe=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=dt(a):0!==(o&=s)&&(i=dt(o))}else 0!==(s=n&~r)?i=dt(s):0!==o&&(i=dt(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-st(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-st(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,wt,St,Mt,Et,Ct=!1,Tt=[],At=null,Pt=null,Dt=null,kt=new Map,Rt=new Map,Nt=[],It="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Dt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Ot(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function zt(e){var t=yr(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void Et(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=br(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Ft(e,t,n){Ut(e)&&n.delete(t)}function jt(){Ct=!1,null!==At&&Ut(At)&&(At=null),null!==Pt&&Ut(Pt)&&(Pt=null),null!==Dt&&Ut(Dt)&&(Dt=null),kt.forEach(Ft),Rt.forEach(Ft)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,jt)))}function Vt(e){function t(t){return Bt(t,e)}if(0<Tt.length){Bt(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==At&&Bt(At,e),null!==Pt&&Bt(Pt,e),null!==Dt&&Bt(Dt,e),kt.forEach(t),Rt.forEach(t),n=0;n<Nt.length;n++)(i=Nt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Nt.length&&null===(n=Nt[0]).blockedOn;)zt(n),null===n.blockedOn&&Nt.shift()}var Ht=x.ReactCurrentBatchConfig,Gt=!0;function Wt(e,t,n,i){var r=bt,o=Ht.transition;Ht.transition=null;try{bt=1,Yt(e,t,n,i)}finally{bt=r,Ht.transition=o}}function Xt(e,t,n,i){var r=bt,o=Ht.transition;Ht.transition=null;try{bt=4,Yt(e,t,n,i)}finally{bt=r,Ht.transition=o}}function Yt(e,t,n,i){if(Gt){var r=qt(e,t,n,i);if(null===r)Gi(e,t,i,$t,n),Lt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return At=Ot(At,e,t,n,i,r),!0;case"dragenter":return Pt=Ot(Pt,e,t,n,i,r),!0;case"mouseover":return Dt=Ot(Dt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return kt.set(o,Ot(kt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Rt.set(o,Ot(Rt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Lt(e,i),4&t&&-1<It.indexOf(e)){for(;null!==r;){var o=br(r);if(null!==o&&_t(o),null===(o=qt(e,t,n,i))&&Gi(e,t,i,$t,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Gi(e,t,i,null,n)}}var $t=null;function qt(e,t,n,i){if($t=null,null!==(e=yr(e=_e(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $t=e,null}function Zt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Kt=null,Jt=null,Qt=null;function en(){if(Qt)return Qt;var e,t,n=Jt,i=n.length,r="value"in Kt?Kt.value:Kt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return Qt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=z({},cn,{view:0,detail:0}),hn=on(dn),pn=z({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(z({},pn,{dataTransfer:0})),gn=on(z({},dn,{relatedTarget:0})),vn=on(z({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=z({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(yn),xn=on(z({},cn,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function En(){return Mn}var Cn=z({},dn,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=on(Cn),An=on(z({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=on(z({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),Dn=on(z({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=z({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=on(kn),Nn=[9,13,27,32],In=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var On=u&&"TextEvent"in window&&!Ln,zn=u&&(!In||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Fn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,i){Ce(i),0<(t=Xi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Xn=null,Yn=null;function $n(e){Ui(e,0)}function qn(e){if(Y(xr(e)))return e}function Zn(e,t){if("change"===e)return t}var Kn=!1;if(u){var Jn;if(u){var Qn="oninput"in document;if(!Qn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Qn="function"===typeof ei.oninput}Jn=Qn}else Jn=!1;Kn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Xn&&(Xn.detachEvent("onpropertychange",ni),Yn=Xn=null)}function ni(e){if("value"===e.propertyName&&qn(Yn)){var t=[];Wn(t,Yn,e,_e(e)),ke($n,t)}}function ii(e,t,n){"focusin"===e?(ti(),Yn=n,(Xn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return qn(Yn)}function oi(e,t){if("click"===e)return qn(t)}function si(e,t){if("input"===e||"change"===e)return qn(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!ai(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=$();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=$((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=ui(n,o);var s=ui(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,bi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==$(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Xi(vi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function _i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionend:_i("Transition","TransitionEnd")},Si={},Mi={};function Ei(e){if(Si[e])return Si[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mi)return Si[e]=n[t];return e}u&&(Mi=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ci=Ei("animationend"),Ti=Ei("animationiteration"),Ai=Ei("animationstart"),Pi=Ei("transitionend"),Di=new Map,ki="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ri(e,t){Di.set(e,t),l(t,[e])}for(var Ni=0;Ni<ki.length;Ni++){var Ii=ki[Ni];Ri(Ii.toLowerCase(),"on"+(Ii[0].toUpperCase()+Ii.slice(1)))}Ri(Ci,"onAnimationEnd"),Ri(Ti,"onAnimationIteration"),Ri(Ai,"onAnimationStart"),Ri("dblclick","onDoubleClick"),Ri("focusin","onFocus"),Ri("focusout","onBlur"),Ri(Pi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Li="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Li));function zi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,s,a,l,c){if(Be.apply(this,arguments),Oe){if(!Oe)throw Error(o(198));var u=ze;Oe=!1,ze=null,Ue||(Ue=!0,Fe=u)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;zi(r,a,c),o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;zi(r,a,c),o=l}}}if(Ue)throw e=Fe,Ue=!1,Fe=null,e}function Fi(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}function ji(e,t,n){var i=0;t&&(i|=4),Hi(n,e,i,t)}var Bi="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Bi]){e[Bi]=!0,s.forEach(function(t){"selectionchange"!==t&&(Oi.has(t)||ji(t,!1,e),ji(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bi]||(t[Bi]=!0,ji("selectionchange",!1,t))}}function Hi(e,t,n,i){switch(Zt(t)){case 1:var r=Wt;break;case 4:r=Xt;break;default:r=Yt}n=r.bind(null,t,n,e),r=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Gi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=yr(a)))return;if(5===(l=s.tag)||6===l){i=o=s;continue e}a=a.parentNode}}i=i.return}ke(function(){var i=o,r=_e(n),s=[];e:{var a=Di.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ci:case Ti:case Ai:l=vn;break;case Pi:l=Dn;break;case"scroll":l=hn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=An}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Re(f,h))&&u.push(Wi(f,m,p)))),d)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[fr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=An,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?a:xr(l),p=null==c?a:xr(c),(a=new u(m,f+"leave",l,n,r)).target=d,a.relatedTarget=p,m=null,yr(r)===i&&((u=new u(h,f+"enter",c,n,r)).target=p,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Yi(p))f++;for(p=0,m=h;m;m=Yi(m))p++;for(;0<f-p;)u=Yi(u),f--;for(;0<p-f;)h=Yi(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Yi(u),h=Yi(h)}u=null}else u=null;null!==l&&$i(s,a,l,u,!1),null!==c&&null!==d&&$i(s,d,c,u,!0)}if("select"===(l=(a=i?xr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Zn;else if(Gn(a))if(Kn)g=si;else{g=ri;var v=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=oi);switch(g&&(g=g(e,i))?Wn(s,g,n,r):(v&&v(e,a,i),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ee(a,"number",a.value)),v=i?xr(i):window,e){case"focusin":(Gn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,xi(s,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(s,n,r)}var y;if(In)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(zn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):(Jt="value"in(Kt=r)?Kt.value:Kt.textContent,Vn=!0)),0<(v=Xi(i,b)).length&&(b=new xn(b,e,null,n,r),s.push({event:b,listeners:v}),y?b.data=y:null!==(y=Bn(n))&&(b.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!In&&jn(e,t)?(e=en(),Qt=Jt=Kt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Xi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=y))}Ui(s,t)})}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Xi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Re(e,n))&&i.unshift(Wi(e,o,r)),null!=(o=Re(e,t))&&i.push(Wi(e,o,r))),e=e.return}return i}function Yi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $i(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=Re(n,o))&&s.unshift(Wi(n,l,a)):r||null!=(l=Re(n,o))&&s.push(Wi(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var qi=/\r\n?/g,Zi=/\u0000|\uFFFD/g;function Ki(e){return("string"===typeof e?e:""+e).replace(qi,"\n").replace(Zi,"")}function Ji(e,t,n){if(t=Ki(t),Ki(e)!==t&&n)throw Error(o(425))}function Qi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,sr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(ar)}:ir;function ar(e){setTimeout(function(){throw e})}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,pr="__reactProps$"+dr,fr="__reactContainer$"+dr,mr="__reactEvents$"+dr,gr="__reactListeners$"+dr,vr="__reactHandles$"+dr;function yr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[hr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function br(e){return!(e=e[hr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function _r(e){return e[pr]||null}var wr=[],Sr=-1;function Mr(e){return{current:e}}function Er(e){0>Sr||(e.current=wr[Sr],wr[Sr]=null,Sr--)}function Cr(e,t){Sr++,wr[Sr]=e.current,e.current=t}var Tr={},Ar=Mr(Tr),Pr=Mr(!1),Dr=Tr;function kr(e,t){var n=e.type.contextTypes;if(!n)return Tr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Rr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Nr(){Er(Pr),Er(Ar)}function Ir(e,t,n){if(Ar.current!==Tr)throw Error(o(168));Cr(Ar,t),Cr(Pr,n)}function Lr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,H(e)||"Unknown",r));return z({},n,i)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr,Dr=Ar.current,Cr(Ar,e),Cr(Pr,Pr.current),!0}function zr(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=Lr(e,t,Dr),i.__reactInternalMemoizedMergedChildContext=e,Er(Pr),Er(Ar),Cr(Ar,e)):Er(Pr),Cr(Pr,n)}var Ur=null,Fr=!1,jr=!1;function Br(e){null===Ur?Ur=[e]:Ur.push(e)}function Vr(){if(!jr&&null!==Ur){jr=!0;var e=0,t=bt;try{var n=Ur;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Ur=null,Fr=!1}catch(r){throw null!==Ur&&(Ur=Ur.slice(e+1)),Ye(Qe,Vr),r}finally{bt=t,jr=!1}}return null}var Hr=[],Gr=0,Wr=null,Xr=0,Yr=[],$r=0,qr=null,Zr=1,Kr="";function Jr(e,t){Hr[Gr++]=Xr,Hr[Gr++]=Wr,Wr=e,Xr=t}function Qr(e,t,n){Yr[$r++]=Zr,Yr[$r++]=Kr,Yr[$r++]=qr,qr=e;var i=Zr;e=Kr;var r=32-st(i)-1;i&=~(1<<r),n+=1;var o=32-st(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Zr=1<<32-st(t)+r|n<<r|i,Kr=o+e}else Zr=1<<o|n<<r|i,Kr=e}function eo(e){null!==e.return&&(Jr(e,1),Qr(e,1,0))}function to(e){for(;e===Wr;)Wr=Hr[--Gr],Hr[Gr]=null,Xr=Hr[--Gr],Hr[Gr]=null;for(;e===qr;)qr=Yr[--$r],Yr[$r]=null,Kr=Yr[--$r],Yr[$r]=null,Zr=Yr[--$r],Yr[$r]=null}var no=null,io=null,ro=!1,oo=null;function so(e,t){var n=kc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==qr?{id:Zr,overflow:Kr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=kc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(ro){var t=io;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=cr(n.nextSibling);var i=no;t&&ao(e,t)?so(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(lo(e))throw po(),Error(o(418));for(;t;)so(e,t),t=cr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?cr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=cr(e.nextSibling)}function fo(){io=no=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=x.ReactCurrentBatchConfig;function vo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function yo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bo(e){return(0,e._init)(e._payload)}function xo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Nc(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=zc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===S?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===R&&bo(o)===t.type)?((i=r(t,n.props)).ref=vo(e,t,n),i.return=e,i):((i=Ic(n.type,n.key,n.props,null,e.mode,i)).ref=vo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,o){return null===t||7!==t.tag?((t=Lc(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=Ic(t.type,t.key,t.props,null,e.mode,n)).ref=vo(e,null,t),n.return=e,n;case w:return(t=Uc(t,e.mode,n)).return=e,t;case R:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;yo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===r?c(e,t,n,i):null;case w:return n.key===r?u(e,t,n,i):null;case R:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||L(n))return null!==r?null:d(e,t,n,i,null);yo(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case R:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||L(i))return d(t,e=e.get(n)||null,i,r,null);yo(t,i)}return null}function m(r,o,a,l){for(var c=null,u=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(r,d,a[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),o=s(v,o,m),null===u?c=v:u.sibling=v,u=v,d=g}if(m===a.length)return n(r,d),ro&&Jr(r,m),c;if(null===d){for(;m<a.length;m++)null!==(d=h(r,a[m],l))&&(o=s(d,o,m),null===u?c=d:u.sibling=d,u=d);return ro&&Jr(r,m),c}for(d=i(r,d);m<a.length;m++)null!==(g=f(d,r,m,a[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(r,e)}),ro&&Jr(r,m),c}function g(r,a,l,c){var u=L(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,m=a,g=a=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=p(r,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(r,m),a=s(b,a,g),null===d?u=b:d.sibling=b,d=b,m=v}if(y.done)return n(r,m),ro&&Jr(r,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=h(r,y.value,c))&&(a=s(y,a,g),null===d?u=y:d.sibling=y,d=y);return ro&&Jr(r,g),u}for(m=i(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=s(y,a,g),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach(function(e){return t(r,e)}),ro&&Jr(r,g),u}return function e(i,o,s,l){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case _:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){n(i,u.sibling),(o=r(u,s.props.children)).return=i,i=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&bo(c)===u.type){n(i,u.sibling),(o=r(u,s.props)).ref=vo(i,u,s),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}s.type===S?((o=Lc(s.props.children,i.mode,l,s.key)).return=i,i=o):((l=Ic(s.type,s.key,s.props,null,i.mode,l)).ref=vo(i,o,s),l.return=i,i=l)}return a(i);case w:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(i,o.sibling),(o=r(o,s.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Uc(s,i.mode,l)).return=i,i=o}return a(i);case R:return e(i,o,(u=s._init)(s._payload),l)}if(te(s))return m(i,o,s,l);if(L(s))return g(i,o,s,l);yo(i,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,s)).return=i,i=o):(n(i,o),(o=zc(s,i.mode,l)).return=i,i=o),a(i)):n(i,o)}}var _o=xo(!0),wo=xo(!1),So=Mr(null),Mo=null,Eo=null,Co=null;function To(){Co=Eo=Mo=null}function Ao(e){var t=So.current;Er(So),e._currentValue=t}function Po(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Do(e,t){Mo=e,Co=Eo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ba=!0),e.firstContext=null)}function ko(e){var t=e._currentValue;if(Co!==e)if(e={context:e,memoizedValue:t,next:null},null===Eo){if(null===Mo)throw Error(o(308));Eo=e,Mo.dependencies={lanes:0,firstContext:e}}else Eo=Eo.next=e;return t}var Ro=null;function No(e){null===Ro?Ro=[e]:Ro.push(e)}function Io(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,No(t)):(n.next=r.next,r.next=n),t.interleaved=n,Lo(e,i)}function Lo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oo=!1;function zo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function jo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Al)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Lo(e,n)}return null===(r=i.interleaved)?(t.next=t,No(i)):(t.next=r.next,r.next=t),i.interleaved=t,Lo(e,n)}function Bo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Vo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ho(e,t,n,i){var r=e.updateQueue;Oo=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=r.baseState;for(s=0,u=c=l=null,a=o;;){var h=a.lane,p=a.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=z({},d,h);break e;case 2:Oo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,s|=h;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(h=a).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Ol|=s,e.lanes=s,e.memoizedState=d}}function Go(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var Wo={},Xo=Mr(Wo),Yo=Mr(Wo),$o=Mr(Wo);function qo(e){if(e===Wo)throw Error(o(174));return e}function Zo(e,t){switch(Cr($o,t),Cr(Yo,e),Cr(Xo,Wo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(Xo),Cr(Xo,t)}function Ko(){Er(Xo),Er(Yo),Er($o)}function Jo(e){qo($o.current);var t=qo(Xo.current),n=le(t,e.type);t!==n&&(Cr(Yo,e),Cr(Xo,n))}function Qo(e){Yo.current===e&&(Er(Xo),Er(Yo))}var es=Mr(0);function ts(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ns=[];function is(){for(var e=0;e<ns.length;e++)ns[e]._workInProgressVersionPrimary=null;ns.length=0}var rs=x.ReactCurrentDispatcher,os=x.ReactCurrentBatchConfig,ss=0,as=null,ls=null,cs=null,us=!1,ds=!1,hs=0,ps=0;function fs(){throw Error(o(321))}function ms(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function gs(e,t,n,i,r,s){if(ss=s,as=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,rs.current=null===e||null===e.memoizedState?Qs:ea,e=n(i,r),ds){s=0;do{if(ds=!1,hs=0,25<=s)throw Error(o(301));s+=1,cs=ls=null,t.updateQueue=null,rs.current=ta,e=n(i,r)}while(ds)}if(rs.current=Js,t=null!==ls&&null!==ls.next,ss=0,cs=ls=as=null,us=!1,t)throw Error(o(300));return e}function vs(){var e=0!==hs;return hs=0,e}function ys(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===cs?as.memoizedState=cs=e:cs=cs.next=e,cs}function bs(){if(null===ls){var e=as.alternate;e=null!==e?e.memoizedState:null}else e=ls.next;var t=null===cs?as.memoizedState:cs.next;if(null!==t)cs=t,ls=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ls=e).memoizedState,baseState:ls.baseState,baseQueue:ls.baseQueue,queue:ls.queue,next:null},null===cs?as.memoizedState=cs=e:cs=cs.next=e}return cs}function xs(e,t){return"function"===typeof t?t(e):t}function _s(e){var t=bs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=ls,r=i.baseQueue,s=n.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,n.pending=null}if(null!==r){s=r.next,i=i.baseState;var l=a=null,c=null,u=s;do{var d=u.lane;if((ss&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=i):c=c.next=h,as.lanes|=d,Ol|=d}u=u.next}while(null!==u&&u!==s);null===c?a=i:c.next=l,ai(i,t.memoizedState)||(ba=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{s=r.lane,as.lanes|=s,Ol|=s,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ws(e){var t=bs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{s=e(s,a.action),a=a.next}while(a!==r);ai(s,t.memoizedState)||(ba=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Ss(){}function Ms(e,t){var n=as,i=bs(),r=t(),s=!ai(i.memoizedState,r);if(s&&(i.memoizedState=r,ba=!0),i=i.queue,Os(Ts.bind(null,n,i,e),[e]),i.getSnapshot!==t||s||null!==cs&&1&cs.memoizedState.tag){if(n.flags|=2048,ks(9,Cs.bind(null,n,i,r,t),void 0,null),null===Pl)throw Error(o(349));0!==(30&ss)||Es(n,t,r)}return r}function Es(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Cs(e,t,n,i){t.value=n,t.getSnapshot=i,As(t)&&Ps(e)}function Ts(e,t,n){return n(function(){As(t)&&Ps(e)})}function As(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(i){return!0}}function Ps(e){var t=Lo(e,1);null!==t&&nc(t,e,1,-1)}function Ds(e){var t=ys();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:e},t.queue=e,e=e.dispatch=$s.bind(null,as,e),[t.memoizedState,e]}function ks(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Rs(){return bs().memoizedState}function Ns(e,t,n,i){var r=ys();as.flags|=e,r.memoizedState=ks(1|t,n,void 0,void 0===i?null:i)}function Is(e,t,n,i){var r=bs();i=void 0===i?null:i;var o=void 0;if(null!==ls){var s=ls.memoizedState;if(o=s.destroy,null!==i&&ms(i,s.deps))return void(r.memoizedState=ks(t,n,o,i))}as.flags|=e,r.memoizedState=ks(1|t,n,o,i)}function Ls(e,t){return Ns(8390656,8,e,t)}function Os(e,t){return Is(2048,8,e,t)}function zs(e,t){return Is(4,2,e,t)}function Us(e,t){return Is(4,4,e,t)}function Fs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function js(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Is(4,4,Fs.bind(null,t,e),n)}function Bs(){}function Vs(e,t){var n=bs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ms(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Hs(e,t){var n=bs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ms(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Gs(e,t,n){return 0===(21&ss)?(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=n):(ai(n,t)||(n=mt(),as.lanes|=n,Ol|=n,e.baseState=!0),t)}function Ws(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=os.transition;os.transition={};try{e(!1),t()}finally{bt=n,os.transition=i}}function Xs(){return bs().memoizedState}function Ys(e,t,n){var i=tc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},qs(e))Zs(t,n);else if(null!==(n=Io(e,t,n,i))){nc(n,e,i,ec()),Ks(n,t,i)}}function $s(e,t,n){var i=tc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(qs(e))Zs(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,s)){var l=t.interleaved;return null===l?(r.next=r,No(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Io(e,t,r,i))&&(nc(n,e,i,r=ec()),Ks(n,t,i))}}function qs(e){var t=e.alternate;return e===as||null!==t&&t===as}function Zs(e,t){ds=us=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ks(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Js={readContext:ko,useCallback:fs,useContext:fs,useEffect:fs,useImperativeHandle:fs,useInsertionEffect:fs,useLayoutEffect:fs,useMemo:fs,useReducer:fs,useRef:fs,useState:fs,useDebugValue:fs,useDeferredValue:fs,useTransition:fs,useMutableSource:fs,useSyncExternalStore:fs,useId:fs,unstable_isNewReconciler:!1},Qs={readContext:ko,useCallback:function(e,t){return ys().memoizedState=[e,void 0===t?null:t],e},useContext:ko,useEffect:Ls,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ns(4194308,4,Fs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ns(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ns(4,2,e,t)},useMemo:function(e,t){var n=ys();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ys();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ys.bind(null,as,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ys().memoizedState=e},useState:Ds,useDebugValue:Bs,useDeferredValue:function(e){return ys().memoizedState=e},useTransition:function(){var e=Ds(!1),t=e[0];return e=Ws.bind(null,e[1]),ys().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=as,r=ys();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Pl)throw Error(o(349));0!==(30&ss)||Es(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Ls(Ts.bind(null,i,s,e),[e]),i.flags|=2048,ks(9,Cs.bind(null,i,s,n,t),void 0,null),n},useId:function(){var e=ys(),t=Pl.identifierPrefix;if(ro){var n=Kr;t=":"+t+"R"+(n=(Zr&~(1<<32-st(Zr)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ps++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ea={readContext:ko,useCallback:Vs,useContext:ko,useEffect:Os,useImperativeHandle:js,useInsertionEffect:zs,useLayoutEffect:Us,useMemo:Hs,useReducer:_s,useRef:Rs,useState:function(){return _s(xs)},useDebugValue:Bs,useDeferredValue:function(e){return Gs(bs(),ls.memoizedState,e)},useTransition:function(){return[_s(xs)[0],bs().memoizedState]},useMutableSource:Ss,useSyncExternalStore:Ms,useId:Xs,unstable_isNewReconciler:!1},ta={readContext:ko,useCallback:Vs,useContext:ko,useEffect:Os,useImperativeHandle:js,useInsertionEffect:zs,useLayoutEffect:Us,useMemo:Hs,useReducer:ws,useRef:Rs,useState:function(){return ws(xs)},useDebugValue:Bs,useDeferredValue:function(e){var t=bs();return null===ls?t.memoizedState=e:Gs(t,ls.memoizedState,e)},useTransition:function(){return[ws(xs)[0],bs().memoizedState]},useMutableSource:Ss,useSyncExternalStore:Ms,useId:Xs,unstable_isNewReconciler:!1};function na(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ia(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ra={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),o=Fo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=jo(e,o,r))&&(nc(t,e,r,i),Bo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),o=Fo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=jo(e,o,r))&&(nc(t,e,r,i),Bo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),i=tc(e),r=Fo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=jo(e,r,i))&&(nc(t,e,i,n),Bo(t,e,i))}};function oa(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,o))}function sa(e,t,n){var i=!1,r=Tr,o=t.contextType;return"object"===typeof o&&null!==o?o=ko(o):(r=Rr(t)?Dr:Ar.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?kr(e,r):Tr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ra,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function aa(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&ra.enqueueReplaceState(t,t.state,null)}function la(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},zo(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=ko(o):(o=Rr(t)?Dr:Ar.current,r.context=kr(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ia(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&ra.enqueueReplaceState(r,r.state,null),Ho(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function ca(e,t){try{var n="",i=t;do{n+=B(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function ua(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ha="function"===typeof WeakMap?WeakMap:Map;function pa(e,t,n){(n=Fo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Gl||(Gl=!0,Wl=i),da(0,t)},n}function fa(e,t,n){(n=Fo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof i&&(null===Xl?Xl=new Set([this]):Xl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ma(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ha;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Ec.bind(null,e,t,n),t.then(e,e))}function ga(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fo(-1,1)).tag=2,jo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ya=x.ReactCurrentOwner,ba=!1;function xa(e,t,n,i){t.child=null===e?wo(t,null,n,i):_o(t,e.child,n,i)}function _a(e,t,n,i,r){n=n.render;var o=t.ref;return Do(t,r),i=gs(e,t,n,i,o,r),n=vs(),null===e||ba?(ro&&n&&eo(t),t.flags|=1,xa(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ga(e,t,r))}function wa(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Rc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ic(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sa(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:li)(s,i)&&e.ref===t.ref)return Ga(e,t,r)}return t.flags|=1,(e=Nc(o,i)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(li(o,i)&&e.ref===t.ref){if(ba=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,Ga(e,t,r);0!==(131072&e.flags)&&(ba=!0)}}return Ca(e,t,n,i,r)}function Ma(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Nl,Rl),Rl|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Nl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Cr(Nl,Rl),Rl|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Cr(Nl,Rl),Rl|=i;return xa(e,t,r,n),t.child}function Ea(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ca(e,t,n,i,r){var o=Rr(n)?Dr:Ar.current;return o=kr(t,o),Do(t,r),n=gs(e,t,n,i,o,r),i=vs(),null===e||ba?(ro&&i&&eo(t),t.flags|=1,xa(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ga(e,t,r))}function Ta(e,t,n,i,r){if(Rr(n)){var o=!0;Or(t)}else o=!1;if(Do(t,r),null===t.stateNode)Ha(e,t),sa(t,n,i),la(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=ko(c):c=kr(t,c=Rr(n)?Dr:Ar.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&aa(t,s,i,c),Oo=!1;var h=t.memoizedState;s.state=h,Ho(t,i,s,r),l=t.memoizedState,a!==i||h!==l||Pr.current||Oo?("function"===typeof u&&(ia(t,n,u,i),l=t.memoizedState),(a=Oo||oa(t,n,a,i,h,l,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Uo(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:na(t.type,a),s.props=c,d=t.pendingProps,h=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=ko(l):l=kr(t,l=Rr(n)?Dr:Ar.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==l)&&aa(t,s,i,l),Oo=!1,h=t.memoizedState,s.state=h,Ho(t,i,s,r);var f=t.memoizedState;a!==d||h!==f||Pr.current||Oo?("function"===typeof p&&(ia(t,n,p,i),f=t.memoizedState),(c=Oo||oa(t,n,c,i,h,f,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Aa(e,t,n,i,o,r)}function Aa(e,t,n,i,r,o){Ea(e,t);var s=0!==(128&t.flags);if(!i&&!s)return r&&zr(t,n,!1),Ga(e,t,o);i=t.stateNode,ya.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=_o(t,e.child,null,o),t.child=_o(t,null,a,o)):xa(e,t,a,o),t.memoizedState=i.state,r&&zr(t,n,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Ir(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ir(0,t.context,!1),Zo(e,t.containerInfo)}function Da(e,t,n,i,r){return fo(),mo(r),t.flags|=256,xa(e,t,n,i),t.child}var ka,Ra,Na,Ia,La={dehydrated:null,treeContext:null,retryLane:0};function Oa(e){return{baseLanes:e,cachePool:null,transitions:null}}function za(e,t,n){var i,r=t.pendingProps,s=es.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&s)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Cr(es,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Oc(l,r,0,null),e=Lc(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Oa(n),t.memoizedState=La,e):Ua(t,l));if(null!==(s=e.memoizedState)&&null!==(i=s.dehydrated))return function(e,t,n,i,r,s,a){if(n)return 256&t.flags?(t.flags&=-257,Fa(e,t,a,i=ua(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=i.fallback,r=t.mode,i=Oc({mode:"visible",children:i.children},r,0,null),(s=Lc(s,r,a,null)).flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,0!==(1&t.mode)&&_o(t,e.child,null,a),t.child.memoizedState=Oa(a),t.memoizedState=La,s);if(0===(1&t.mode))return Fa(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Fa(e,t,a,i=ua(s=Error(o(419)),i,void 0))}if(l=0!==(a&e.childLanes),ba||l){if(null!==(i=Pl)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|a))?0:r)&&r!==s.retryLane&&(s.retryLane=r,Lo(e,r),nc(i,e,r,-1))}return mc(),Fa(e,t,a,i=ua(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Tc.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,io=cr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(Yr[$r++]=Zr,Yr[$r++]=Kr,Yr[$r++]=qr,Zr=e.id,Kr=e.overflow,qr=t),t=Ua(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,s,n);if(a){a=r.fallback,l=t.mode,i=(s=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Nc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==i?a=Nc(i,a):(a=Lc(a,l,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?Oa(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=La,r}return e=(a=e.child).sibling,r=Nc(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Ua(e,t){return(t=Oc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fa(e,t,n,i){return null!==i&&mo(i),_o(t,e.child,null,n),(e=Ua(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ja(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Po(e.return,t,n)}function Ba(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Va(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(xa(e,t,i.children,n),0!==(2&(i=es.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ja(e,n,t);else if(19===e.tag)ja(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Cr(es,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ts(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ba(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ts(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ba(t,!0,n,null,o);break;case"together":Ba(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ha(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ga(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ol|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Nc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Nc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Xa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ya(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xa(t),null;case 1:case 17:return Rr(t.type)&&Nr(),Xa(t),null;case 3:return i=t.stateNode,Ko(),Er(Pr),Er(Ar),is(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(sc(oo),oo=null))),Ra(e,t),Xa(t),null;case 5:Qo(t);var r=qo($o.current);if(n=t.type,null!==e&&null!=t.stateNode)Na(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Xa(t),null}if(e=qo(Xo.current),ho(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[hr]=t,i[pr]=s,e=0!==(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Li.length;r++)Fi(Li[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":Z(i,s),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Fi("invalid",i);break;case"textarea":re(i,s),Fi("invalid",i)}for(var l in ye(n,s),r=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==s.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Ji(i.textContent,c,e),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fi("scroll",i)}switch(n){case"input":X(i),Q(i,s,!0);break;case"textarea":X(i),se(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=Qi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hr]=t,e[pr]=i,ka(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Li.length;r++)Fi(Li[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":Z(e,i),r=q(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=z({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(s in ye(n,r),c=r)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Fi("scroll",e):null!=u&&b(e,s,u,l))}switch(n){case"input":X(e),Q(e,i,!1);break;case"textarea":X(e),se(e);break;case"option":null!=i.value&&e.setAttribute("value",""+G(i.value));break;case"select":e.multiple=!!i.multiple,null!=(s=i.value)?ne(e,!!i.multiple,s,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Qi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Xa(t),null;case 6:if(e&&null!=t.stateNode)Ia(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=qo($o.current),qo(Xo.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(s=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Xa(t),null;case 13:if(Er(es),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hr]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Xa(t),s=!1}else null!==oo&&(sc(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&es.current)?0===Il&&(Il=3):mc())),null!==t.updateQueue&&(t.flags|=4),Xa(t),null);case 4:return Ko(),Ra(e,t),null===e&&Vi(t.stateNode.containerInfo),Xa(t),null;case 10:return Ao(t.type._context),Xa(t),null;case 19:if(Er(es),null===(s=t.memoizedState))return Xa(t),null;if(i=0!==(128&t.flags),null===(l=s.rendering))if(i)Wa(s,!1);else{if(0!==Il||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ts(e))){for(t.flags|=128,Wa(s,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Cr(es,1&es.current|2),t.child}e=e.sibling}null!==s.tail&&Ke()>Vl&&(t.flags|=128,i=!0,Wa(s,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ts(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ro)return Xa(t),null}else 2*Ke()-s.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,i=!0,Wa(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ke(),t.sibling=null,n=es.current,Cr(es,i?1&n|2:1&n),t):(Xa(t),null);case 22:case 23:return dc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Xa(t),6&t.subtreeFlags&&(t.flags|=8192)):Xa(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function $a(e,t){switch(to(t),t.tag){case 1:return Rr(t.type)&&Nr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ko(),Er(Pr),Er(Ar),is(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qo(t),null;case 13:if(Er(es),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er(es),null;case 4:return Ko(),null;case 10:return Ao(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}ka=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ra=function(){},Na=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,qo(Xo.current);var o,s=null;switch(n){case"input":r=q(e,r),i=q(e,i),s=[];break;case"select":r=z({},r,{value:void 0}),i=z({},i,{value:void 0}),s=[];break;case"textarea":r=ie(e,r),i=ie(e,i),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Qi)}for(u in ye(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fi("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Ia=function(e,t,n,i){n!==i&&(t.flags|=4)};var qa=!1,Za=!1,Ka="function"===typeof WeakSet?WeakSet:Set,Ja=null;function Qa(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Mc(e,t,i)}else n.current=null}function el(e,t,n){try{n()}catch(i){Mc(e,t,i)}}var tl=!1;function nl(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&el(t,n,o)}r=r.next}while(r!==i)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[mr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function al(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Qi));else if(4!==i&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(a){}switch(n.tag){case 5:Za||Qa(n,t);case 6:var i=ul,r=dl;ul=null,hl(e,t,n),dl=r,null!==(ul=i)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Vt(e)):lr(ul,n.stateNode));break;case 4:i=ul,r=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=i,dl=r;break;case 0:case 11:case 14:case 15:if(!Za&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&el(n,t,s),r=r.next}while(r!==i)}hl(e,t,n);break;case 1:if(!Za&&(Qa(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Mc(n,t,a)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Za=(i=Za)||null!==n.memoizedState,hl(e,t,n),Za=i):hl(e,t,n);break;default:hl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ka),t.forEach(function(t){var i=Ac.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function ml(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(o(160));pl(s,a,r),ul=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Mc(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&i){try{nl(3,e,e.return),il(3,e)}catch(g){Mc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Mc(e,e.return,g)}}break;case 1:ml(t,e),vl(e),512&i&&null!==n&&Qa(n,n.return);break;case 5:if(ml(t,e),vl(e),512&i&&null!==n&&Qa(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){Mc(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&K(r,s),be(l,a);var u=be(l,s);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):b(r,d,h,u)}switch(l){case"input":J(r,s);break;case"textarea":oe(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(r,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(r,!!s.multiple,s.defaultValue,!0):ne(r,!!s.multiple,s.multiple?[]:"",!1))}r[pr]=s}catch(g){Mc(e,e.return,g)}}break;case 6:if(ml(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(g){Mc(e,e.return,g)}}break;case 3:if(ml(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){Mc(e,e.return,g)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,!s||null!==r.alternate&&null!==r.alternate.memoizedState||(Bl=Ke())),4&i&&fl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Za=(u=Za)||d,ml(t,e),Za=u):ml(t,e),vl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Ja=e,d=e.child;null!==d;){for(h=Ja=d;null!==Ja;){switch(f=(p=Ja).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Qa(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Mc(i,n,g)}}break;case 5:Qa(p,p.return);break;case 22:if(null!==p.memoizedState){_l(h);continue}}null!==f?(f.return=p,Ja=f):_l(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,a=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(g){Mc(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Mc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ml(t,e),vl(e),4&i&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),cl(e,al(e),r);break;case 3:case 4:var s=i.stateNode.containerInfo;ll(e,al(e),s);break;default:throw Error(o(161))}}catch(a){Mc(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Ja=e,bl(e,t,n)}function bl(e,t,n){for(var i=0!==(1&e.mode);null!==Ja;){var r=Ja,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||qa;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Za;a=qa;var c=Za;if(qa=s,(Za=l)&&!c)for(Ja=r;null!==Ja;)l=(s=Ja).child,22===s.tag&&null!==s.memoizedState?wl(r):null!==l?(l.return=s,Ja=l):wl(r);for(;null!==o;)Ja=o,bl(o,t,n),o=o.sibling;Ja=r,qa=a,Za=c}xl(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,Ja=o):xl(e)}}function xl(e){for(;null!==Ja;){var t=Ja;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Za||il(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Za)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:na(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Go(t,s,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Go(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(o(163))}Za||512&t.flags&&rl(t)}catch(p){Mc(t,t.return,p)}}if(t===e){Ja=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ja=n;break}Ja=t.return}}function _l(e){for(;null!==Ja;){var t=Ja;if(t===e){Ja=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ja=n;break}Ja=t.return}}function wl(e){for(;null!==Ja;){var t=Ja;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Mc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Mc(t,r,l)}}var o=t.return;try{rl(t)}catch(l){Mc(t,o,l)}break;case 5:var s=t.return;try{rl(t)}catch(l){Mc(t,s,l)}}}catch(l){Mc(t,t.return,l)}if(t===e){Ja=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Ja=a;break}Ja=t.return}}var Sl,Ml=Math.ceil,El=x.ReactCurrentDispatcher,Cl=x.ReactCurrentOwner,Tl=x.ReactCurrentBatchConfig,Al=0,Pl=null,Dl=null,kl=0,Rl=0,Nl=Mr(0),Il=0,Ll=null,Ol=0,zl=0,Ul=0,Fl=null,jl=null,Bl=0,Vl=1/0,Hl=null,Gl=!1,Wl=null,Xl=null,Yl=!1,$l=null,ql=0,Zl=0,Kl=null,Jl=-1,Ql=0;function ec(){return 0!==(6&Al)?Ke():-1!==Jl?Jl:Jl=Ke()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Al)&&0!==kl?kl&-kl:null!==go.transition?(0===Ql&&(Ql=mt()),Ql):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Zt(e.type)}function nc(e,t,n,i){if(50<Zl)throw Zl=0,Kl=null,Error(o(185));vt(e,n,i),0!==(2&Al)&&e===Pl||(e===Pl&&(0===(2&Al)&&(zl|=n),4===Il&&ac(e,kl)),ic(e,i),1===n&&0===Al&&0===(1&t.mode)&&(Vl=Ke()+500,Fr&&Vr()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=pt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=ht(e,e===Pl?kl:0);if(0===i)null!==n&&$e(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&$e(n),1===t)0===e.tag?function(e){Fr=!0,Br(e)}(lc.bind(null,e)):Br(lc.bind(null,e)),sr(function(){0===(6&Al)&&Vr()}),n=null;else{switch(xt(i)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Pc(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Jl=-1,Ql=0,0!==(6&Al))throw Error(o(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var i=ht(e,e===Pl?kl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gc(e,i);else{t=i;var r=Al;Al|=2;var s=fc();for(Pl===e&&kl===t||(Hl=null,Vl=Ke()+500,hc(e,t));;)try{yc();break}catch(l){pc(e,l)}To(),El.current=s,Al=r,null!==Dl?t=0:(Pl=null,kl=0,t=Il)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=oc(e,r))),1===t)throw n=Ll,hc(e,0),ac(e,i),ic(e,Ke()),n;if(6===t)ac(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!ai(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,i))&&(0!==(s=ft(e))&&(i=s,t=oc(e,s))),1===t))throw n=Ll,hc(e,0),ac(e,i),ic(e,Ke()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:_c(e,jl,Hl);break;case 3:if(ac(e,i),(130023424&i)===i&&10<(t=Bl+500-Ke())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(_c.bind(null,e,jl,Hl),t);break}_c(e,jl,Hl);break;case 4:if(ac(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-st(i);s=1<<a,(a=t[a])>r&&(r=a),i&=~s}if(i=r,10<(i=(120>(i=Ke()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ml(i/1960))-i)){e.timeoutHandle=ir(_c.bind(null,e,jl,Hl),i);break}_c(e,jl,Hl);break;default:throw Error(o(329))}}}return ic(e,Ke()),e.callbackNode===n?rc.bind(null,e):null}function oc(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=jl,jl=n,null!==t&&sc(t)),e}function sc(e){null===jl?jl=e:jl.push.apply(jl,e)}function ac(e,t){for(t&=~Ul,t&=~zl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),i=1<<n;e[n]=-1,t&=~i}}function lc(e){if(0!==(6&Al))throw Error(o(327));wc();var t=ht(e,0);if(0===(1&t))return ic(e,Ke()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=oc(e,i))}if(1===n)throw n=Ll,hc(e,0),ac(e,t),ic(e,Ke()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,jl,Hl),ic(e,Ke()),null}function cc(e,t){var n=Al;Al|=1;try{return e(t)}finally{0===(Al=n)&&(Vl=Ke()+500,Fr&&Vr())}}function uc(e){null!==$l&&0===$l.tag&&0===(6&Al)&&wc();var t=Al;Al|=1;var n=Tl.transition,i=bt;try{if(Tl.transition=null,bt=1,e)return e()}finally{bt=i,Tl.transition=n,0===(6&(Al=t))&&Vr()}}function dc(){Rl=Nl.current,Er(Nl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Dl)for(n=Dl.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Nr();break;case 3:Ko(),Er(Pr),Er(Ar),is();break;case 5:Qo(i);break;case 4:Ko();break;case 13:case 19:Er(es);break;case 10:Ao(i.type._context);break;case 22:case 23:dc()}n=n.return}if(Pl=e,Dl=e=Nc(e.current,null),kl=Rl=t,Il=0,Ll=null,Ul=zl=Ol=0,jl=Fl=null,null!==Ro){for(t=0;t<Ro.length;t++)if(null!==(i=(n=Ro[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}Ro=null}return e}function pc(e,t){for(;;){var n=Dl;try{if(To(),rs.current=Js,us){for(var i=as.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}us=!1}if(ss=0,cs=ls=as=null,ds=!1,hs=0,Cl.current=null,null===n||null===n.return){Il=1,Ll=t,Dl=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=kl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=ga(a);if(null!==f){f.flags&=-257,va(f,a,l,0,t),1&f.mode&&ma(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ma(s,u,t),mc();break e}c=Error(o(426))}else if(ro&&1&l.mode){var v=ga(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),va(v,a,l,0,t),mo(ca(c,l));break e}}s=c=ca(c,l),4!==Il&&(Il=2),null===Fl?Fl=[s]:Fl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Vo(s,pa(0,c,t));break e;case 1:l=c;var y=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Xl||!Xl.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,Vo(s,fa(s,l,t));break e}}s=s.return}while(null!==s)}xc(n)}catch(x){t=x,Dl===n&&null!==n&&(Dl=n=n.return);continue}break}}function fc(){var e=El.current;return El.current=Js,null===e?Js:e}function mc(){0!==Il&&3!==Il&&2!==Il||(Il=4),null===Pl||0===(268435455&Ol)&&0===(268435455&zl)||ac(Pl,kl)}function gc(e,t){var n=Al;Al|=2;var i=fc();for(Pl===e&&kl===t||(Hl=null,hc(e,t));;)try{vc();break}catch(r){pc(e,r)}if(To(),Al=n,El.current=i,null!==Dl)throw Error(o(261));return Pl=null,kl=0,Il}function vc(){for(;null!==Dl;)bc(Dl)}function yc(){for(;null!==Dl&&!qe();)bc(Dl)}function bc(e){var t=Sl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?xc(e):Dl=t,Cl.current=null}function xc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ya(n,t,Rl)))return void(Dl=n)}else{if(null!==(n=$a(n,t)))return n.flags&=32767,void(Dl=n);if(null===e)return Il=6,void(Dl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Dl=t);Dl=t=e}while(null!==t);0===Il&&(Il=5)}function _c(e,t,n){var i=bt,r=Tl.transition;try{Tl.transition=null,bt=1,function(e,t,n,i){do{wc()}while(null!==$l);if(0!==(6&Al))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-st(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,s),e===Pl&&(Dl=Pl=null,kl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,Pc(tt,function(){return wc(),null})),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Tl.transition,Tl.transition=null;var a=bt;bt=1;var l=Al;Al|=4,Cl.current=null,function(e,t){if(er=Gt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch(_){n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(l=a+r),h!==s||0!==i&&3!==h.nodeType||(c=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===r&&(l=a),p===s&&++d===i&&(c=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Gt=!1,Ja=t;null!==Ja;)if(e=(t=Ja).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ja=e;else for(;null!==Ja;){t=Ja;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:na(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(o(163))}}catch(_){Mc(t,t.return,_)}if(null!==(e=t.sibling)){e.return=t.return,Ja=e;break}Ja=t.return}m=tl,tl=!1}(e,n),gl(n,e),fi(tr),Gt=!!er,tr=er=null,e.current=n,yl(n,e,r),Ze(),Al=l,bt=a,Tl.transition=s}else e.current=n;if(Yl&&(Yl=!1,$l=e,ql=r),s=e.pendingLanes,0===s&&(Xl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Ke()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Gl)throw Gl=!1,e=Wl,Wl=null,e;0!==(1&ql)&&0!==e.tag&&wc(),s=e.pendingLanes,0!==(1&s)?e===Kl?Zl++:(Zl=0,Kl=e):Zl=0,Vr()}(e,t,n,i)}finally{Tl.transition=r,bt=i}return null}function wc(){if(null!==$l){var e=xt(ql),t=Tl.transition,n=bt;try{if(Tl.transition=null,bt=16>e?16:e,null===$l)var i=!1;else{if(e=$l,$l=null,ql=0,0!==(6&Al))throw Error(o(331));var r=Al;for(Al|=4,Ja=e.current;null!==Ja;){var s=Ja,a=s.child;if(0!==(16&Ja.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Ja=u;null!==Ja;){var d=Ja;switch(d.tag){case 0:case 11:case 15:nl(8,d,s)}var h=d.child;if(null!==h)h.return=d,Ja=h;else for(;null!==Ja;){var p=(d=Ja).sibling,f=d.return;if(ol(d),d===u){Ja=null;break}if(null!==p){p.return=f,Ja=p;break}Ja=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Ja=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Ja=a;else e:for(;null!==Ja;){if(0!==(2048&(s=Ja).flags))switch(s.tag){case 0:case 11:case 15:nl(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Ja=y;break e}Ja=s.return}}var b=e.current;for(Ja=b;null!==Ja;){var x=(a=Ja).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,Ja=x;else e:for(a=b;null!==Ja;){if(0!==(2048&(l=Ja).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(w){Mc(l,l.return,w)}if(l===a){Ja=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,Ja=_;break e}Ja=l.return}}if(Al=r,Vr(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{bt=n,Tl.transition=t}}return!1}function Sc(e,t,n){e=jo(e,t=pa(0,t=ca(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),ic(e,t))}function Mc(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Xl||!Xl.has(i))){t=jo(t,e=fa(t,e=ca(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),ic(t,e));break}}t=t.return}}function Ec(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(kl&n)===n&&(4===Il||3===Il&&(130023424&kl)===kl&&500>Ke()-Bl?hc(e,0):Ul|=n),ic(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Lo(e,t))&&(vt(e,t,n),ic(e,n))}function Tc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ac(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Cc(e,n)}function Pc(e,t){return Ye(e,t)}function Dc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kc(e,t,n,i){return new Dc(e,t,n,i)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Nc(e,t){var n=e.alternate;return null===n?((n=kc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ic(e,t,n,i,r,s){var a=2;if(i=e,"function"===typeof e)Rc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Lc(n.children,r,s,t);case M:a=8,r|=8;break;case E:return(e=kc(12,n,t,2|r)).elementType=E,e.lanes=s,e;case P:return(e=kc(13,n,t,r)).elementType=P,e.lanes=s,e;case D:return(e=kc(19,n,t,r)).elementType=D,e.lanes=s,e;case N:return Oc(n,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case T:a=9;break e;case A:a=11;break e;case k:a=14;break e;case R:a=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=kc(a,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function Lc(e,t,n,i){return(e=kc(7,e,i,t)).lanes=n,e}function Oc(e,t,n,i){return(e=kc(22,e,i,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=kc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=kc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,i,r,o,s,a,l){return e=new Fc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=kc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},zo(o),e}function Bc(e){if(!e)return Tr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Rr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Rr(n))return Lr(e,n,t)}return t}function Vc(e,t,n,i,r,o,s,a,l){return(e=jc(n,i,!0,e,0,o,0,a,l)).context=Bc(null),n=e.current,(o=Fo(i=ec(),r=tc(n))).callback=void 0!==t&&null!==t?t:null,jo(n,o,r),e.current.lanes=r,vt(e,r,i),ic(e,i),e}function Hc(e,t,n,i){var r=t.current,o=ec(),s=tc(r);return n=Bc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fo(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=jo(r,t,s))&&(nc(e,r,s,o),Bo(e,r,s)),s}function Gc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Xc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Sl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)ba=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ba=!1,function(e,t,n){switch(t.tag){case 3:Pa(t),fo();break;case 5:Jo(t);break;case 1:Rr(t.type)&&Or(t);break;case 4:Zo(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Cr(So,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Cr(es,1&es.current),t.flags|=128,null):0!==(n&t.child.childLanes)?za(e,t,n):(Cr(es,1&es.current),null!==(e=Ga(e,t,n))?e.sibling:null);Cr(es,1&es.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Va(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(es,es.current),i)break;return null;case 22:case 23:return t.lanes=0,Ma(e,t,n)}return Ga(e,t,n)}(e,t,n);ba=0!==(131072&e.flags)}else ba=!1,ro&&0!==(1048576&t.flags)&&Qr(t,Xr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ha(e,t),e=t.pendingProps;var r=kr(t,Ar.current);Do(t,n),r=gs(null,t,i,e,r,n);var s=vs();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Rr(i)?(s=!0,Or(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,zo(t),r.updater=ra,t.stateNode=r,r._reactInternals=t,la(t,i,e,n),t=Aa(null,t,i,!0,s,n)):(t.tag=0,ro&&s&&eo(t),xa(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===k)return 14}return 2}(i),e=na(i,e),r){case 0:t=Ca(null,t,i,e,n);break e;case 1:t=Ta(null,t,i,e,n);break e;case 11:t=_a(null,t,i,e,n);break e;case 14:t=wa(null,t,i,na(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ca(e,t,i,r=t.elementType===i?r:na(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ta(e,t,i,r=t.elementType===i?r:na(i,r),n);case 3:e:{if(Pa(t),null===e)throw Error(o(387));i=t.pendingProps,r=(s=t.memoizedState).element,Uo(e,t),Ho(t,i,null,n);var a=t.memoizedState;if(i=a.element,s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Da(e,t,i,n,r=ca(Error(o(423)),t));break e}if(i!==r){t=Da(e,t,i,n,r=ca(Error(o(424)),t));break e}for(io=cr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=wo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),i===r){t=Ga(e,t,n);break e}xa(e,t,i,n)}t=t.child}return t;case 5:return Jo(t),null===e&&co(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==s&&nr(i,s)&&(t.flags|=32),Ea(e,t),xa(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return za(e,t,n);case 4:return Zo(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=_o(t,null,i,n):xa(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,_a(e,t,i,r=t.elementType===i?r:na(i,r),n);case 7:return xa(e,t,t.pendingProps,n),t.child;case 8:case 12:return xa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value,Cr(So,i._currentValue),i._currentValue=a,null!==s)if(ai(s.value,a)){if(s.children===r.children&&!Pr.current){t=Ga(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===s.tag){(c=Fo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Po(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Po(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}xa(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Do(t,n),i=i(r=ko(r)),t.flags|=1,xa(e,t,i,n),t.child;case 14:return r=na(i=t.type,t.pendingProps),wa(e,t,i,r=na(i.type,r),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:na(i,r),Ha(e,t),t.tag=1,Rr(i)?(e=!0,Or(t)):e=!1,Do(t,n),sa(t,i,r),la(t,i,r,n),Aa(null,t,i,!0,e,n);case 19:return Va(e,t,n);case 22:return Ma(e,t,n)}throw Error(o(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function $c(e){this._internalRoot=e}function qc(e){this._internalRoot=e}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Qc(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof r){var a=r;r=function(){var e=Gc(s);a.call(e)}}Hc(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=Gc(s);o.call(e)}}var s=Vc(t,i,e,0,null,!1,0,"",Jc);return e._reactRootContainer=s,e[fr]=s.current,Vi(8===e.nodeType?e.parentNode:e),uc(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var a=i;i=function(){var e=Gc(l);a.call(e)}}var l=jc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fr]=l.current,Vi(8===e.nodeType?e.parentNode:e),uc(function(){Hc(t,l,n,i)}),l}(n,t,e,r,i);return Gc(s)}qc.prototype.render=$c.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Hc(e,t,null,null)},qc.prototype.unmount=$c.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Hc(null,e,null,null)}),t[fr]=null}},qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nt.length&&0!==t&&t<Nt[n].priority;n++);Nt.splice(n,0,e),0===n&&zt(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ic(t,Ke()),0===(6&Al)&&(Vl=Ke()+500,Vr()))}break;case 13:uc(function(){var t=Lo(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Xc(e,1)}},wt=function(e){if(13===e.tag){var t=Lo(e,134217728);if(null!==t)nc(t,e,134217728,ec());Xc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=Lo(e,t);if(null!==n)nc(n,e,t,ec());Xc(e,t)}},Mt=function(){return bt},Et=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=_r(i);if(!r)throw Error(o(90));Y(i),J(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=cc,Pe=uc;var eu={usingClientEntryPoint:!1,Events:[br,xr,_r,Ce,Te,cc]},tu={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{rt=iu.inject(nu),ot=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Zc(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Zc(e))throw Error(o(299));var n=!1,i="",r=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,Vi(8===e.nodeType?e.parentNode:e),new $c(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Kc(t))throw Error(o(200));return Qc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Zc(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,s="",a=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Vc(t,null,e,1,null!=n?n:null,r,0,s,a),e[fr]=t.current,Vi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new qc(t)},t.render=function(e,t,n){if(!Kc(t))throw Error(o(200));return Qc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Kc(e))throw Error(o(40));return!!e._reactRootContainer&&(uc(function(){Qc(null,null,e,!1,function(){e._reactRootContainer=null,e[fr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Kc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return Qc(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{"use strict";e.exports=n(234)},895:(e,t,n)=>{var i;!function(r,o,s,a){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],u=o.createElement("div"),d=Math.round,h=Math.abs,p=Date.now;function f(e,t,n){return setTimeout(_(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==a)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function v(e,t,n){var i="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=r.console&&(r.console.warn||r.console.log);return o&&o.call(r.console,i,n),e.apply(this,arguments)}}l="function"!==typeof Object.assign?function(e){if(e===a||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==a&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t}:Object.assign;var y=v(function(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;)(!n||n&&e[i[r]]===a)&&(e[i[r]]=t[i[r]]),r++;return e},"extend","Use `assign`."),b=v(function(e,t){return y(e,t,!0)},"merge","Use `assign`.");function x(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&l(i,n)}function _(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return"function"==typeof e?e.apply(t&&t[0]||a,t):e}function S(e,t){return e===a?t:e}function M(e,t,n){g(A(t),function(t){e.addEventListener(t,n,!1)})}function E(e,t,n){g(A(t),function(t){e.removeEventListener(t,n,!1)})}function C(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function T(e,t){return e.indexOf(t)>-1}function A(e){return e.trim().split(/\s+/g)}function P(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function D(e){return Array.prototype.slice.call(e,0)}function k(e,t,n){for(var i=[],r=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];P(r,s)<0&&i.push(e[o]),r[o]=s,o++}return n&&(i=t?i.sort(function(e,n){return e[t]>n[t]}):i.sort()),i}function R(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((i=(n=c[o])?n+r:t)in e)return i;o++}return a}var N=1;function I(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||r}var L="ontouchstart"in r,O=R(r,"PointerEvent")!==a,z=L&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U="touch",F="mouse",j=24,B=["x","y"],V=["clientX","clientY"];function H(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function G(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,o=1&t&&i-r===0,s=12&t&&i-r===0;n.isFirst=!!o,n.isFinal=!!s,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=W(t));r>1&&!n.firstMultiple?n.firstMultiple=W(t):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,l=s?s.center:o.center,c=t.center=X(i);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=Z(l,c),t.distance=q(l,c),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y});t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=$(t.deltaX,t.deltaY);var u=Y(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=h(u.x)>h(u.y)?u.x:u.y,t.scale=s?(d=s.pointers,f=i,q(f[0],f[1],V)/q(d[0],d[1],V)):1,t.rotation=s?function(e,t){return Z(t[1],t[0],V)+Z(e[1],e[0],V)}(s.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,r,o,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(8!=t.eventType&&(l>25||s.velocity===a)){var c=t.deltaX-s.deltaX,u=t.deltaY-s.deltaY,d=Y(l,c,u);i=d.x,r=d.y,n=h(d.x)>h(d.y)?d.x:d.y,o=$(c,u),e.lastInterval=t}else n=s.velocity,i=s.velocityX,r=s.velocityY,o=s.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=o}(n,t);var d,f;var m=e.element;C(t.srcEvent.target,m)&&(m=t.srcEvent.target);t.target=m}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function W(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:X(t),deltaX:e.deltaX,deltaY:e.deltaY}}function X(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:d(n/t),y:d(i/t)}}function Y(e,t,n){return{x:t/e||0,y:n/e||0}}function $(e,t){return e===t?1:h(e)>=h(t)?e<0?2:4:t<0?8:16}function q(e,t,n){n||(n=B);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function Z(e,t,n){n||(n=B);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(I(this.element),this.evWin,this.domHandler)}};var K={mousedown:1,mousemove:2,mouseup:4},J="mousedown",Q="mousemove mouseup";function ee(){this.evEl=J,this.evWin=Q,this.pressed=!1,H.apply(this,arguments)}x(ee,H,{handler:function(e){var t=K[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:F,srcEvent:e}))}});var te={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},ne={2:U,3:"pen",4:F,5:"kinect"},ie="pointerdown",re="pointermove pointerup pointercancel";function oe(){this.evEl=ie,this.evWin=re,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(ie="MSPointerDown",re="MSPointerMove MSPointerUp MSPointerCancel"),x(oe,H,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=te[i],o=ne[e.pointerType]||e.pointerType,s=o==U,a=P(t,e.pointerId,"pointerId");1&r&&(0===e.button||s)?a<0&&(t.push(e),a=t.length-1):12&r&&(n=!0),a<0||(t[a]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(a,1))}});var se={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ae(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,H.apply(this,arguments)}function le(e,t){var n=D(e.touches),i=D(e.changedTouches);return 12&t&&(n=k(n.concat(i),"identifier",!0)),[n,i]}x(ae,H,{handler:function(e){var t=se[e.type];if(1===t&&(this.started=!0),this.started){var n=le.call(this,e,t);12&t&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:e})}}});var ce={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ue="touchstart touchmove touchend touchcancel";function de(){this.evTarget=ue,this.targetIds={},H.apply(this,arguments)}function he(e,t){var n=D(e.touches),i=this.targetIds;if(3&t&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=D(e.changedTouches),a=[],l=this.target;if(o=n.filter(function(e){return C(e.target,l)}),1===t)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),12&t&&delete i[s[r].identifier],r++;return a.length?[k(o.concat(a),"identifier",!0),a]:void 0}x(de,H,{handler:function(e){var t=ce[e.type],n=he.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:U,srcEvent:e})}});function pe(){H.apply(this,arguments);var e=_(this.handler,this);this.touch=new de(this.manager,e),this.mouse=new ee(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function fe(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,me.call(this,t)):12&e&&me.call(this,t)}function me(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)},2500)}}function ge(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(t-r.x),s=Math.abs(n-r.y);if(o<=25&&s<=25)return!0}return!1}x(pe,H,{handler:function(e,t,n){var i=n.pointerType==U,r=n.pointerType==F;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)fe.call(this,t,n);else if(r&&ge.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ve=R(u.style,"touchAction"),ye=ve!==a,be="compute",xe="auto",_e="manipulation",we="none",Se="pan-x",Me="pan-y",Ee=function(){if(!ye)return!1;var e={},t=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!t||r.CSS.supports("touch-action",n)}),e}();function Ce(e,t){this.manager=e,this.set(t)}Ce.prototype={set:function(e){e==be&&(e=this.compute()),ye&&this.manager.element.style&&Ee[e]&&(this.manager.element.style[ve]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(T(e,we))return we;var t=T(e,Se),n=T(e,Me);if(t&&n)return we;if(t||n)return t?Se:Me;if(T(e,_e))return _e;return xe}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=T(i,we)&&!Ee[we],o=T(i,Me)&&!Ee[Me],s=T(i,Se)&&!Ee[Se];if(r){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!s||!o)return r||o&&6&n||s&&n&j?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Te=32;function Ae(e){this.options=l({},this.defaults,e||{}),this.id=N++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Pe(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function De(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ke(e,t){var n=t.manager;return n?n.get(e):e}function Re(){Ae.apply(this,arguments)}function Ne(){Re.apply(this,arguments),this.pX=null,this.pY=null}function Ie(){Re.apply(this,arguments)}function Le(){Ae.apply(this,arguments),this._timer=null,this._input=null}function Oe(){Re.apply(this,arguments)}function ze(){Re.apply(this,arguments)}function Ue(){Ae.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Fe(e,t){return(t=t||{}).recognizers=S(t.recognizers,Fe.defaults.preset),new je(e,t)}Ae.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ke(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=ke(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===P(t,e=ke(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=ke(e,this);var t=P(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function i(n){t.manager.emit(n,e)}n<8&&i(t.options.event+Pe(n)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),n>=8&&i(t.options.event+Pe(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Te},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=Te);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Re,Ae,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=6&t,r=this.attrTest(e);return i&&(8&n||!r)?16|t:i||r?4&n?8|t:2&t?4|t:2:Te}}),x(Ne,Re,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Me),e&j&&t.push(Se),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,o=e.deltaX,s=e.deltaY;return r&t.direction||(6&t.direction?(r=0===o?1:o<0?2:4,n=o!=this.pX,i=Math.abs(e.deltaX)):(r=0===s?1:s<0?8:16,n=s!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return Re.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=De(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Ie,Re,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[we]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Le,Ae,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[xe]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||12&e.eventType&&!r)this.reset();else if(1&e.eventType)this.reset(),this._timer=f(function(){this.state=8,this.tryEmit()},t.time,this);else if(4&e.eventType)return 8;return Te},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),x(Oe,Re,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[we]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(ze,Re,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ne.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:n&j&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=De(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Ue,Ae,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[_e]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||q(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=8,this.tryEmit()},t.interval,this),2):8}return Te},failTimeout:function(){return this._timer=f(function(){this.state=Te},this.options.interval,this),Te},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Fe.VERSION="2.0.7",Fe.defaults={domEvents:!1,touchAction:be,enable:!0,inputTarget:null,inputClass:null,preset:[[Oe,{enable:!1}],[Ie,{enable:!1},["rotate"]],[ze,{direction:6}],[Ne,{direction:6},["swipe"]],[Ue],[Ue,{event:"doubletap",taps:2},["tap"]],[Le]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function je(e,t){var n;this.options=l({},Fe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(O?oe:z?de:L?pe:ee))(n,G),this.touchAction=new Ce(this,this.options.touchAction),Be(this,!0),g(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Be(e,t){var n,i=e.element;i.style&&(g(e.options.cssProps,function(r,o){n=R(i.style,o),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={}))}je.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&8&r.state)&&(r=t.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&14&n.state&&(r=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Ae)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=P(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==a&&t!==a){var n=this.handlers;return g(A(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==a){var n=this.handlers;return g(A(e),function(e){t?n[e]&&n[e].splice(P(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=o.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&Be(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Fe,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Te,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:j,DIRECTION_ALL:30,Manager:je,Input:H,TouchAction:Ce,TouchInput:de,MouseInput:ee,PointerEventInput:oe,TouchMouseInput:pe,SingleTouchInput:ae,Recognizer:Ae,AttrRecognizer:Re,Tap:Ue,Pan:Ne,Swipe:ze,Pinch:Ie,Rotate:Oe,Press:Le,on:M,off:E,each:g,merge:b,extend:y,assign:l,inherit:x,bindFn:_,prefixed:R}),("undefined"!==typeof r?r:"undefined"!==typeof self?self:{}).Hammer=Fe,(i=function(){return Fe}.call(t,n,t,e))===a||(e.exports=i)}(window,document)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},958:(e,t,n)=>{e.exports=function(e){var t={},i=n(43),r=n(853),o=Object.assign;function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),b=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var x=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var _=Symbol.iterator;function w(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=_&&e[_]||e["@@iterator"])?e:null}function S(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case c:return"Portal";case h:return"Profiler";case d:return"StrictMode";case g:return"Suspense";case v:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case f:return(e.displayName||"Context")+".Consumer";case p:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:S(e.type)||"Memo";case b:t=e._payload,e=e._init;try{return S(e(t))}catch(n){}}return null}function M(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return S(t);case 8:return t===d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function E(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function C(e){if(E(e)!==e)throw Error(s(188))}function T(e){var t=e.alternate;if(!t){if(null===(t=E(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return C(r),e;if(o===i)return C(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}function A(e){return null!==(e=T(e))?P(e):null}function P(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=P(e);if(null!==t)return t;e=e.sibling}return null}function D(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=D(e);if(null!==t)return t}e=e.sibling}return null}var k,R=Array.isArray,N=e.getPublicInstance,I=e.getRootHostContext,L=e.getChildHostContext,O=e.prepareForCommit,z=e.resetAfterCommit,U=e.createInstance,F=e.appendInitialChild,j=e.finalizeInitialChildren,B=e.prepareUpdate,V=e.shouldSetTextContent,H=e.createTextInstance,G=e.scheduleTimeout,W=e.cancelTimeout,X=e.noTimeout,Y=e.isPrimaryRenderer,$=e.supportsMutation,q=e.supportsPersistence,Z=e.supportsHydration,K=e.getInstanceFromNode,J=e.preparePortalMount,Q=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,ie=e.supportsTestSelectors,re=e.findFiberRoot,oe=e.getBoundingRect,se=e.getTextContent,ae=e.isHiddenSubtree,le=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,ue=e.setupIntersectionObserver,de=e.appendChild,he=e.appendChildToContainer,pe=e.commitTextUpdate,fe=e.commitMount,me=e.commitUpdate,ge=e.insertBefore,ve=e.insertInContainerBefore,ye=e.removeChild,be=e.removeChildFromContainer,xe=e.resetTextContent,_e=e.hideInstance,we=e.hideTextInstance,Se=e.unhideInstance,Me=e.unhideTextInstance,Ee=e.clearContainer,Ce=e.cloneInstance,Te=e.createContainerChildSet,Ae=e.appendChildToContainerChildSet,Pe=e.finalizeContainerChildren,De=e.replaceContainerChildren,ke=e.cloneHiddenInstance,Re=e.cloneHiddenTextInstance,Ne=e.canHydrateInstance,Ie=e.canHydrateTextInstance,Le=e.canHydrateSuspenseInstance,Oe=e.isSuspenseInstancePending,ze=e.isSuspenseInstanceFallback,Ue=e.registerSuspenseInstanceRetry,Fe=e.getNextHydratableSibling,je=e.getFirstHydratableChild,Be=e.getFirstHydratableChildWithinContainer,Ve=e.getFirstHydratableChildWithinSuspenseInstance,He=e.hydrateInstance,Ge=e.hydrateTextInstance,We=e.hydrateSuspenseInstance,Xe=e.getNextHydratableInstanceAfterSuspenseInstance,Ye=e.commitHydratedContainer,$e=e.commitHydratedSuspenseInstance,qe=e.clearSuspenseBoundary,Ze=e.clearSuspenseBoundaryFromContainer,Ke=e.shouldDeleteUnhydratedTailInstances,Je=e.didNotMatchHydratedContainerTextInstance,Qe=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===k)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);k=t&&t[1]||""}return"\n"+k+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var it=Object.prototype.hasOwnProperty,rt=[],ot=-1;function st(e){return{current:e}}function at(e){0>ot||(e.current=rt[ot],rt[ot]=null,ot--)}function lt(e,t){ot++,rt[ot]=e.current,e.current=t}var ct={},ut=st(ct),dt=st(!1),ht=ct;function pt(e,t){var n=e.type.contextTypes;if(!n)return ct;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function ft(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mt(){at(dt),at(ut)}function gt(e,t,n){if(ut.current!==ct)throw Error(s(168));lt(ut,t),lt(dt,n)}function vt(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,M(e)||"Unknown",r));return o({},n,i)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,ht=ut.current,lt(ut,e),lt(dt,dt.current),!0}function bt(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=vt(e,t,ht),i.__reactInternalMemoizedMergedChildContext=e,at(dt),at(ut),lt(ut,e)):at(dt),lt(dt,n)}var xt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(_t(e)/wt|0)|0},_t=Math.log,wt=Math.LN2;var St=64,Mt=4194304;function Et(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ct(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=Et(a):0!==(o&=s)&&(i=Et(o))}else 0!==(s=n&~r)?i=Et(s):0!==o&&(i=Et(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-xt(t)),i|=e[n],t&=~r;return i}function Tt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function At(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Pt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Dt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-xt(t)]=n}function kt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-xt(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var Rt=0;function Nt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var It=r.unstable_scheduleCallback,Lt=r.unstable_cancelCallback,Ot=r.unstable_shouldYield,zt=r.unstable_requestPaint,Ut=r.unstable_now,Ft=r.unstable_ImmediatePriority,jt=r.unstable_UserBlockingPriority,Bt=r.unstable_NormalPriority,Vt=r.unstable_IdlePriority,Ht=null,Gt=null;var Wt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Xt=null,Yt=!1,$t=!1;function qt(e){null===Xt?Xt=[e]:Xt.push(e)}function Zt(){if(!$t&&null!==Xt){$t=!0;var e=0,t=Rt;try{var n=Xt;for(Rt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Xt=null,Yt=!1}catch(r){throw null!==Xt&&(Xt=Xt.slice(e+1)),It(Ft,Zt),r}finally{Rt=t,$t=!1}}return null}var Kt=a.ReactCurrentBatchConfig;function Jt(e,t){if(Wt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!it.call(t,r)||!Wt(e[r],t[r]))return!1}return!0}function Qt(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=st(null),nn=null,rn=null,on=null;function sn(){on=rn=nn=null}function an(e,t,n){Y?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;at(tn),Y?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function un(e,t){nn=e,on=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Or=!0),e.firstContext=null)}function dn(e){var t=Y?e._currentValue:e._currentValue2;if(on!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(s(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var hn=null,pn=!1;function fn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function gn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function vn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==qo&&0!==(1&e.mode)&&0===(2&$o)?(null===(e=n.interleaved)?(t.next=t,null===hn?hn=[n]:hn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,kt(e,n)}}function bn(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xn(e,t,n,i){var r=e.updateQueue;pn=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var c=l,u=c.next;c.next=null,null===a?s=u:a.next=u,a=c;var d=e.alternate;null!==d&&((l=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===l?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(null!==s){var h=r.baseState;for(a=0,d=u=c=null,l=s;;){var p=l.lane,f=l.eventTime;if((i&p)===p){null!==d&&(d=d.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,g=l;switch(p=t,f=n,g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(f,h,p);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(p="function"===typeof(m=g.payload)?m.call(f,h,p):m)||void 0===p)break e;h=o({},h,p);break e;case 2:pn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(p=r.effects)?r.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===d?(u=d=f,c=h):d=d.next=f,a|=p;if(null===(l=l.next)){if(null===(l=r.shared.pending))break;l=(p=l).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}if(null===d&&(c=h),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);ns|=a,e.lanes=a,e.memoizedState=h}}function _n(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var wn=(new i.Component).refs;function Sn(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:o({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Mn={isMounted:function(e){return!!(e=e._reactInternals)&&E(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=_s(),r=ws(e),o=gn(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),vn(e,o),null!==(t=Ss(e,r,i))&&yn(t,e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=_s(),r=ws(e),o=gn(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),vn(e,o),null!==(t=Ss(e,r,i))&&yn(t,e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=_s(),i=ws(e),r=gn(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),vn(e,r),null!==(t=Ss(e,i,n))&&yn(t,e,i)}};function En(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!Jt(n,i)||!Jt(r,o))}function Cn(e,t,n){var i=!1,r=ct,o=t.contextType;return"object"===typeof o&&null!==o?o=dn(o):(r=ft(t)?ht:ut.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?pt(e,r):ct),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Mn,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Tn(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Mn.enqueueReplaceState(t,t.state,null)}function An(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=wn,fn(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=dn(o):(o=ft(t)?ht:ut.current,r.context=pt(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Sn(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Mn.enqueueReplaceState(r,r.state,null),xn(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}var Pn=[],Dn=0,kn=null,Rn=0,Nn=[],In=0,Ln=null,On=1,zn="";function Un(e,t){Pn[Dn++]=Rn,Pn[Dn++]=kn,kn=e,Rn=t}function Fn(e,t,n){Nn[In++]=On,Nn[In++]=zn,Nn[In++]=Ln,Ln=e;var i=On;e=zn;var r=32-xt(i)-1;i&=~(1<<r),n+=1;var o=32-xt(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,On=1<<32-xt(t)+r|n<<r|i,zn=o+e}else On=1<<o|n<<r|i,zn=e}function jn(e){null!==e.return&&(Un(e,1),Fn(e,1,0))}function Bn(e){for(;e===kn;)kn=Pn[--Dn],Pn[Dn]=null,Rn=Pn[--Dn],Pn[Dn]=null;for(;e===Ln;)Ln=Nn[--In],Nn[In]=null,zn=Nn[--In],Nn[In]=null,On=Nn[--In],Nn[In]=null}var Vn=null,Hn=null,Gn=!1,Wn=!1,Xn=null;function Yn(e,t){var n=Js(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function $n(e,t){switch(e.tag){case 5:return null!==(t=Ne(t,e.type,e.pendingProps))&&(e.stateNode=t,Vn=e,Hn=je(t),!0);case 6:return null!==(t=Ie(t,e.pendingProps))&&(e.stateNode=t,Vn=e,Hn=null,!0);case 13:if(null!==(t=Le(t))){var n=null!==Ln?{id:On,overflow:zn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Js(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Vn=e,Hn=null,!0}return!1;default:return!1}}function qn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Zn(e){if(Gn){var t=Hn;if(t){var n=t;if(!$n(e,t)){if(qn(e))throw Error(s(418));t=Fe(n);var i=Vn;t&&$n(e,t)?Yn(i,n):(e.flags=-4097&e.flags|2,Gn=!1,Vn=e)}}else{if(qn(e))throw Error(s(418));e.flags=-4097&e.flags|2,Gn=!1,Vn=e}}}function Kn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Vn=e}function Jn(e){if(!Z||e!==Vn)return!1;if(!Gn)return Kn(e),Gn=!0,!1;if(3!==e.tag&&(5!==e.tag||Ke(e.type)&&!V(e.type,e.memoizedProps))){var t=Hn;if(t){if(qn(e)){for(e=Hn;e;)e=Fe(e);throw Error(s(418))}for(;t;)Yn(e,t),t=Fe(t)}}if(Kn(e),13===e.tag){if(!Z)throw Error(s(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));Hn=Xe(e)}else Hn=Vn?Fe(e.stateNode):null;return!0}function Qn(){Z&&(Hn=Vn=null,Wn=Gn=!1)}function ei(e){null===Xn?Xn=[e]:Xn.push(e)}function ti(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===wn&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function ni(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ii(e){return(0,e._init)(e._payload)}function ri(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=ea(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function d(e,t,n,i){return null===t||6!==t.tag?((t=ra(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n,i){var o=n.type;return o===u?f(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===b&&ii(o)===t.type)?((i=r(t,n.props)).ref=ti(e,t,n),i.return=e,i):((i=ta(n.type,n.key,n.props,null,e.mode,i)).ref=ti(e,t,n),i.return=e,i)}function p(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=oa(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function f(e,t,n,i,o){return null===t||7!==t.tag?((t=na(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function m(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=ra(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return(n=ta(t.type,t.key,t.props,null,e.mode,n)).ref=ti(e,null,t),n.return=e,n;case c:return(t=oa(t,e.mode,n)).return=e,t;case b:return m(e,(0,t._init)(t._payload),n)}if(R(t)||w(t))return(t=na(t,e.mode,n,null)).return=e,t;ni(e,t)}return null}function g(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:d(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===r?h(e,t,n,i):null;case c:return n.key===r?p(e,t,n,i):null;case b:return g(e,t,(r=n._init)(n._payload),i)}if(R(n)||w(n))return null!==r?null:f(e,t,n,i,null);ni(e,n)}return null}function v(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return d(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case l:return h(t,e=e.get(null===i.key?n:i.key)||null,i,r);case c:return p(t,e=e.get(null===i.key?n:i.key)||null,i,r);case b:return v(e,t,n,(0,i._init)(i._payload),r)}if(R(i)||w(i))return f(t,e=e.get(n)||null,i,r,null);ni(t,i)}return null}function y(r,s,a,l){for(var c=null,u=null,d=s,h=s=0,p=null;null!==d&&h<a.length;h++){d.index>h?(p=d,d=null):p=d.sibling;var f=g(r,d,a[h],l);if(null===f){null===d&&(d=p);break}e&&d&&null===f.alternate&&t(r,d),s=o(f,s,h),null===u?c=f:u.sibling=f,u=f,d=p}if(h===a.length)return n(r,d),Gn&&Un(r,h),c;if(null===d){for(;h<a.length;h++)null!==(d=m(r,a[h],l))&&(s=o(d,s,h),null===u?c=d:u.sibling=d,u=d);return Gn&&Un(r,h),c}for(d=i(r,d);h<a.length;h++)null!==(p=v(d,r,h,a[h],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?h:p.key),s=o(p,s,h),null===u?c=p:u.sibling=p,u=p);return e&&d.forEach(function(e){return t(r,e)}),Gn&&Un(r,h),c}function x(r,a,l,c){var u=w(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,h=a,p=a=0,f=null,y=l.next();null!==h&&!y.done;p++,y=l.next()){h.index>p?(f=h,h=null):f=h.sibling;var b=g(r,h,y.value,c);if(null===b){null===h&&(h=f);break}e&&h&&null===b.alternate&&t(r,h),a=o(b,a,p),null===d?u=b:d.sibling=b,d=b,h=f}if(y.done)return n(r,h),Gn&&Un(r,p),u;if(null===h){for(;!y.done;p++,y=l.next())null!==(y=m(r,y.value,c))&&(a=o(y,a,p),null===d?u=y:d.sibling=y,d=y);return Gn&&Un(r,p),u}for(h=i(r,h);!y.done;p++,y=l.next())null!==(y=v(h,r,p,y.value,c))&&(e&&null!==y.alternate&&h.delete(null===y.key?p:y.key),a=o(y,a,p),null===d?u=y:d.sibling=y,d=y);return e&&h.forEach(function(e){return t(r,e)}),Gn&&Un(r,p),u}return function e(i,o,s,d){if("object"===typeof s&&null!==s&&s.type===u&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case l:e:{for(var h=s.key,p=o;null!==p;){if(p.key===h){if((h=s.type)===u){if(7===p.tag){n(i,p.sibling),(o=r(p,s.props.children)).return=i,i=o;break e}}else if(p.elementType===h||"object"===typeof h&&null!==h&&h.$$typeof===b&&ii(h)===p.type){n(i,p.sibling),(o=r(p,s.props)).ref=ti(i,p,s),o.return=i,i=o;break e}n(i,p);break}t(i,p),p=p.sibling}s.type===u?((o=na(s.props.children,i.mode,d,s.key)).return=i,i=o):((d=ta(s.type,s.key,s.props,null,i.mode,d)).ref=ti(i,o,s),d.return=i,i=d)}return a(i);case c:e:{for(p=s.key;null!==o;){if(o.key===p){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(i,o.sibling),(o=r(o,s.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=oa(s,i.mode,d)).return=i,i=o}return a(i);case b:return e(i,o,(p=s._init)(s._payload),d)}if(R(s))return y(i,o,s,d);if(w(s))return x(i,o,s,d);ni(i,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,s)).return=i,i=o):(n(i,o),(o=ra(s,i.mode,d)).return=i,i=o),a(i)):n(i,o)}}var oi=ri(!0),si=ri(!1),ai={},li=st(ai),ci=st(ai),ui=st(ai);function di(e){if(e===ai)throw Error(s(174));return e}function hi(e,t){lt(ui,t),lt(ci,e),lt(li,ai),e=I(t),at(li),lt(li,e)}function pi(){at(li),at(ci),at(ui)}function fi(e){var t=di(ui.current),n=di(li.current);n!==(t=L(n,e.type,t))&&(lt(ci,e),lt(li,t))}function mi(e){ci.current===e&&(at(li),at(ci))}var gi=st(0);function vi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Oe(n)||ze(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yi=[];function bi(){for(var e=0;e<yi.length;e++){var t=yi[e];Y?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yi.length=0}var xi=a.ReactCurrentDispatcher,_i=a.ReactCurrentBatchConfig,wi=0,Si=null,Mi=null,Ei=null,Ci=!1,Ti=!1,Ai=0,Pi=0;function Di(){throw Error(s(321))}function ki(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wt(e[n],t[n]))return!1;return!0}function Ri(e,t,n,i,r,o){if(wi=o,Si=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xi.current=null===e||null===e.memoizedState?fr:mr,e=n(i,r),Ti){o=0;do{if(Ti=!1,Ai=0,25<=o)throw Error(s(301));o+=1,Ei=Mi=null,t.updateQueue=null,xi.current=gr,e=n(i,r)}while(Ti)}if(xi.current=pr,t=null!==Mi&&null!==Mi.next,wi=0,Ei=Mi=Si=null,Ci=!1,t)throw Error(s(300));return e}function Ni(){var e=0!==Ai;return Ai=0,e}function Ii(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ei?Si.memoizedState=Ei=e:Ei=Ei.next=e,Ei}function Li(){if(null===Mi){var e=Si.alternate;e=null!==e?e.memoizedState:null}else e=Mi.next;var t=null===Ei?Si.memoizedState:Ei.next;if(null!==t)Ei=t,Mi=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Mi=e).memoizedState,baseState:Mi.baseState,baseQueue:Mi.baseQueue,queue:Mi.queue,next:null},null===Ei?Si.memoizedState=Ei=e:Ei=Ei.next=e}return Ei}function Oi(e,t){return"function"===typeof t?t(e):t}function zi(e){var t=Li(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=Mi,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=a=null,c=null,u=o;do{var d=u.lane;if((wi&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=i):c=c.next=h,Si.lanes|=d,ns|=d}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,Wt(i,t.memoizedState)||(Or=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,Si.lanes|=o,ns|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ui(e){var t=Li(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);Wt(o,t.memoizedState)||(Or=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Fi(){}function ji(e,t){var n=Si,i=Li(),r=t(),o=!Wt(i.memoizedState,r);if(o&&(i.memoizedState=r,Or=!0),i=i.queue,Ki(Hi.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==Ei&&1&Ei.memoizedState.tag){if(n.flags|=2048,Xi(9,Vi.bind(null,n,i,r,t),void 0,null),null===qo)throw Error(s(349));0!==(30&wi)||Bi(n,t,r)}return r}function Bi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Si.updateQueue)?(t={lastEffect:null,stores:null},Si.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Vi(e,t,n,i){t.value=n,t.getSnapshot=i,Gi(t)&&Ss(e,1,-1)}function Hi(e,t,n){return n(function(){Gi(t)&&Ss(e,1,-1)})}function Gi(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wt(e,n)}catch(i){return!0}}function Wi(e){var t=Ii();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:e},t.queue=e,e=e.dispatch=lr.bind(null,Si,e),[t.memoizedState,e]}function Xi(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Si.updateQueue)?(t={lastEffect:null,stores:null},Si.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Yi(){return Li().memoizedState}function $i(e,t,n,i){var r=Ii();Si.flags|=e,r.memoizedState=Xi(1|t,n,void 0,void 0===i?null:i)}function qi(e,t,n,i){var r=Li();i=void 0===i?null:i;var o=void 0;if(null!==Mi){var s=Mi.memoizedState;if(o=s.destroy,null!==i&&ki(i,s.deps))return void(r.memoizedState=Xi(t,n,o,i))}Si.flags|=e,r.memoizedState=Xi(1|t,n,o,i)}function Zi(e,t){return $i(8390656,8,e,t)}function Ki(e,t){return qi(2048,8,e,t)}function Ji(e,t){return qi(4,2,e,t)}function Qi(e,t){return qi(4,4,e,t)}function er(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function tr(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,qi(4,4,er.bind(null,t,e),n)}function nr(){}function ir(e,t){var n=Li();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ki(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function rr(e,t){var n=Li();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ki(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function or(e,t){var n=Rt;Rt=0!==n&&4>n?n:4,e(!0);var i=_i.transition;_i.transition={};try{e(!1),t()}finally{Rt=n,_i.transition=i}}function sr(){return Li().memoizedState}function ar(e,t,n){var i=ws(e);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},cr(e)?ur(t,n):(dr(e,t,n),null!==(e=Ss(e,i,n=_s()))&&hr(e,t,i))}function lr(e,t,n){var i=ws(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(cr(e))ur(t,r);else{dr(e,t,r);var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,Wt(a,s))return}catch(l){}null!==(e=Ss(e,i,n=_s()))&&hr(e,t,i)}}function cr(e){var t=e.alternate;return e===Si||null!==t&&t===Si}function ur(e,t){Ti=Ci=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function dr(e,t,n){null!==qo&&0!==(1&e.mode)&&0===(2&$o)?(null===(e=t.interleaved)?(n.next=n,null===hn?hn=[t]:hn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function hr(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,kt(e,n)}}var pr={readContext:dn,useCallback:Di,useContext:Di,useEffect:Di,useImperativeHandle:Di,useInsertionEffect:Di,useLayoutEffect:Di,useMemo:Di,useReducer:Di,useRef:Di,useState:Di,useDebugValue:Di,useDeferredValue:Di,useTransition:Di,useMutableSource:Di,useSyncExternalStore:Di,useId:Di,unstable_isNewReconciler:!1},fr={readContext:dn,useCallback:function(e,t){return Ii().memoizedState=[e,void 0===t?null:t],e},useContext:dn,useEffect:Zi,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,$i(4194308,4,er.bind(null,t,e),n)},useLayoutEffect:function(e,t){return $i(4194308,4,e,t)},useInsertionEffect:function(e,t){return $i(4,2,e,t)},useMemo:function(e,t){var n=Ii();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Ii();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ar.bind(null,Si,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Ii().memoizedState=e},useState:Wi,useDebugValue:nr,useDeferredValue:function(e){var t=Wi(e),n=t[0],i=t[1];return Zi(function(){var t=_i.transition;_i.transition={};try{i(e)}finally{_i.transition=t}},[e]),n},useTransition:function(){var e=Wi(!1),t=e[0];return e=or.bind(null,e[1]),Ii().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=Si,r=Ii();if(Gn){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===qo)throw Error(s(349));0!==(30&wi)||Bi(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Zi(Hi.bind(null,i,o,e),[e]),i.flags|=2048,Xi(9,Vi.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Ii(),t=qo.identifierPrefix;if(Gn){var n=zn;t=":"+t+"R"+(n=(On&~(1<<32-xt(On)-1)).toString(32)+n),0<(n=Ai++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Pi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mr={readContext:dn,useCallback:ir,useContext:dn,useEffect:Ki,useImperativeHandle:tr,useInsertionEffect:Ji,useLayoutEffect:Qi,useMemo:rr,useReducer:zi,useRef:Yi,useState:function(){return zi(Oi)},useDebugValue:nr,useDeferredValue:function(e){var t=zi(Oi),n=t[0],i=t[1];return Ki(function(){var t=_i.transition;_i.transition={};try{i(e)}finally{_i.transition=t}},[e]),n},useTransition:function(){return[zi(Oi)[0],Li().memoizedState]},useMutableSource:Fi,useSyncExternalStore:ji,useId:sr,unstable_isNewReconciler:!1},gr={readContext:dn,useCallback:ir,useContext:dn,useEffect:Ki,useImperativeHandle:tr,useInsertionEffect:Ji,useLayoutEffect:Qi,useMemo:rr,useReducer:Ui,useRef:Yi,useState:function(){return Ui(Oi)},useDebugValue:nr,useDeferredValue:function(e){var t=Ui(Oi),n=t[0],i=t[1];return Ki(function(){var t=_i.transition;_i.transition={};try{i(e)}finally{_i.transition=t}},[e]),n},useTransition:function(){return[Ui(Oi)[0],Li().memoizedState]},useMutableSource:Fi,useSyncExternalStore:ji,useId:sr,unstable_isNewReconciler:!1};function vr(e,t){try{var n="",i=t;do{n+=Qt(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r}}function yr(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var br,xr,_r,wr,Sr="function"===typeof WeakMap?WeakMap:Map;function Mr(e,t,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ds||(ds=!0,hs=i),yr(0,t)},n}function Er(e,t,n){(n=gn(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){yr(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){yr(0,t),"function"!==typeof i&&(null===ps?ps=new Set([this]):ps.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Cr(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Sr;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Xs.bind(null,e,t,n),t.then(e,e))}function Tr(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ar(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=gn(-1,1)).tag=2,vn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}function Pr(e){e.flags|=4}function Dr(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if($)br=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)F(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},xr=function(){},_r=function(e,t,n,i,r){if((e=e.memoizedProps)!==i){var o=t.stateNode,s=di(li.current);n=B(o,n,e,i,r,s),(t.updateQueue=n)&&Pr(t)}},wr=function(e,t,n,i){n!==i&&Pr(t)};else if(q){br=function(e,t,n,i){for(var r=t.child;null!==r;){if(5===r.tag){var o=r.stateNode;n&&i&&(o=ke(o,r.type,r.memoizedProps,r)),F(e,o)}else if(6===r.tag)o=r.stateNode,n&&i&&(o=Re(o,r.memoizedProps,r)),F(e,o);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(o=r.child)&&(o.return=r),br(e,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};var kr=function(e,t,n,i){for(var r=t.child;null!==r;){if(5===r.tag){var o=r.stateNode;n&&i&&(o=ke(o,r.type,r.memoizedProps,r)),Ae(e,o)}else if(6===r.tag)o=r.stateNode,n&&i&&(o=Re(o,r.memoizedProps,r)),Ae(e,o);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(o=r.child)&&(o.return=r),kr(e,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};xr=function(e,t){var n=t.stateNode;if(!Dr(e,t)){e=n.containerInfo;var i=Te(e);kr(i,t,!1,!1),n.pendingChildren=i,Pr(t),Pe(e,i)}},_r=function(e,t,n,i,r){var o=e.stateNode,s=e.memoizedProps;if((e=Dr(e,t))&&s===i)t.stateNode=o;else{var a=t.stateNode,l=di(li.current),c=null;s!==i&&(c=B(a,n,s,i,r,l)),e&&null===c?t.stateNode=o:(o=Ce(o,c,n,s,i,t,e,a),j(o,n,i,r,l)&&Pr(t),t.stateNode=o,e?Pr(t):br(o,t,!1,!1))}},wr=function(e,t,n,i){n!==i?(e=di(ui.current),n=di(li.current),t.stateNode=H(i,e,n,t),Pr(t)):t.stateNode=e.stateNode}}else xr=function(){},_r=function(){},wr=function(){};function Rr(e,t){if(!Gn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Nr(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ir(e,t,n){var i=t.pendingProps;switch(Bn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nr(t),null;case 1:case 17:return ft(t.type)&&mt(),Nr(t),null;case 3:return i=t.stateNode,pi(),at(dt),at(ut),bi(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Jn(t)?Pr(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Xn&&(As(Xn),Xn=null))),xr(e,t),Nr(t),null;case 5:mi(t),n=di(ui.current);var r=t.type;if(null!==e&&null!=t.stateNode)_r(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return Nr(t),null}if(e=di(li.current),Jn(t)){if(!Z)throw Error(s(175));e=He(t.stateNode,t.type,t.memoizedProps,n,e,t,!Wn),t.updateQueue=e,null!==e&&Pr(t)}else{var o=U(r,i,n,e,t);br(o,t,!1,!1),t.stateNode=o,j(o,r,i,n,e)&&Pr(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Nr(t),null;case 6:if(e&&null!=t.stateNode)wr(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(e=di(ui.current),n=di(li.current),Jn(t)){if(!Z)throw Error(s(176));if(e=t.stateNode,i=t.memoizedProps,(n=Ge(e,i,t,!Wn))&&null!==(r=Vn))switch(o=0!==(1&r.mode),r.tag){case 3:Je(r.stateNode.containerInfo,e,i,o);break;case 5:Qe(r.type,r.memoizedProps,r.stateNode,e,i,o)}n&&Pr(t)}else t.stateNode=H(i,e,n,t)}return Nr(t),null;case 13:if(at(gi),i=t.memoizedState,Gn&&null!==Hn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Hn;e;)e=Fe(e);return Qn(),t.flags|=98560,t}if(null!==i&&null!==i.dehydrated){if(i=Jn(t),null===e){if(!i)throw Error(s(318));if(!Z)throw Error(s(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(s(317));We(e,t)}else Qn(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Nr(t),null}return null!==Xn&&(As(Xn),Xn=null),0!==(128&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?Jn(t):n=null!==e.memoizedState,i&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&gi.current)?0===es&&(es=3):Os())),null!==t.updateQueue&&(t.flags|=4),Nr(t),null);case 4:return pi(),xr(e,t),null===e&&J(t.stateNode.containerInfo),Nr(t),null;case 10:return ln(t.type._context),Nr(t),null;case 19:if(at(gi),null===(r=t.memoizedState))return Nr(t),null;if(i=0!==(128&t.flags),null===(o=r.rendering))if(i)Rr(r,!1);else{if(0!==es||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=vi(e))){for(t.flags|=128,Rr(r,!1),null!==(e=o.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,i=t.child;null!==i;)r=e,(n=i).flags&=14680066,null===(o=n.alternate)?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,r=o.dependencies,n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),i=i.sibling;return lt(gi,1&gi.current|2),t.child}e=e.sibling}null!==r.tail&&Ut()>ls&&(t.flags|=128,i=!0,Rr(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=vi(o))){if(t.flags|=128,i=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Rr(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!Gn)return Nr(t),null}else 2*Ut()-r.renderingStartTime>ls&&1073741824!==n&&(t.flags|=128,i=!0,Rr(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=Ut(),t.sibling=null,e=gi.current,lt(gi,i?1&e|2:1&e),t):(Nr(t),null);case 22:case 23:return Rs(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Jo)&&(Nr(t),$&&6&t.subtreeFlags&&(t.flags|=8192)):Nr(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}var Lr=a.ReactCurrentOwner,Or=!1;function zr(e,t,n,i){t.child=null===e?si(t,null,n,i):oi(t,e.child,n,i)}function Ur(e,t,n,i,r){n=n.render;var o=t.ref;return un(t,r),i=Ri(e,t,n,i,o,r),n=Ni(),null===e||Or?(Gn&&n&&jn(t),t.flags|=1,zr(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ro(e,t,r))}function Fr(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Qs(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ta(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,jr(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:Jt)(s,i)&&e.ref===t.ref)return ro(e,t,r)}return t.flags|=1,(e=ea(o,i)).ref=t.ref,e.return=t,t.child=e}function jr(e,t,n,i,r){if(null!==e&&Jt(e.memoizedProps,i)&&e.ref===t.ref){if(Or=!1,0===(e.lanes&r))return t.lanes=e.lanes,ro(e,t,r);0!==(131072&e.flags)&&(Or=!0)}return Hr(e,t,n,i,r)}function Br(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},lt(Qo,Jo),Jo|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt(Qo,Jo),Jo|=e,null;t.memoizedState={baseLanes:0,cachePool:null},i=null!==o?o.baseLanes:n,lt(Qo,Jo),Jo|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,lt(Qo,Jo),Jo|=i;return zr(e,t,r,n),t.child}function Vr(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Hr(e,t,n,i,r){var o=ft(n)?ht:ut.current;return o=pt(t,o),un(t,r),n=Ri(e,t,n,i,o,r),i=Ni(),null===e||Or?(Gn&&i&&jn(t),t.flags|=1,zr(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ro(e,t,r))}function Gr(e,t,n,i,r){if(ft(n)){var o=!0;yt(t)}else o=!1;if(un(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Cn(t,n,i),An(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=dn(c):c=pt(t,c=ft(n)?ht:ut.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&Tn(t,s,i,c),pn=!1;var h=t.memoizedState;s.state=h,xn(t,i,s,r),l=t.memoizedState,a!==i||h!==l||dt.current||pn?("function"===typeof u&&(Sn(t,n,u,i),l=t.memoizedState),(a=pn||En(t,n,a,i,h,l,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,mn(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:en(t.type,a),s.props=c,d=t.pendingProps,h=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=dn(l):l=pt(t,l=ft(n)?ht:ut.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==l)&&Tn(t,s,i,l),pn=!1,h=t.memoizedState,s.state=h,xn(t,i,s,r);var f=t.memoizedState;a!==d||h!==f||dt.current||pn?("function"===typeof p&&(Sn(t,n,p,i),f=t.memoizedState),(c=pn||En(t,n,c,i,h,f,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Wr(e,t,n,i,o,r)}function Wr(e,t,n,i,r,o){Vr(e,t);var s=0!==(128&t.flags);if(!i&&!s)return r&&bt(t,n,!1),ro(e,t,o);i=t.stateNode,Lr.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=oi(t,e.child,null,o),t.child=oi(t,null,a,o)):zr(e,t,a,o),t.memoizedState=i.state,r&&bt(t,n,!0),t.child}function Xr(e){var t=e.stateNode;t.pendingContext?gt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gt(0,t.context,!1),hi(e,t.containerInfo)}function Yr(e,t,n,i,r){return Qn(),ei(r),t.flags|=256,zr(e,t,n,i),t.child}var $r={dehydrated:null,treeContext:null,retryLane:0};function qr(e){return{baseLanes:e,cachePool:null}}function Zr(e,t,n){var i,r=t.pendingProps,o=gi.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),lt(gi,1&o),null===e)return Zn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:ze(e)?t.lanes=8:t.lanes=1073741824,null):(o=r.children,e=r.fallback,a?(r=t.mode,a=t.child,o={mode:"hidden",children:o},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=o):a=ia(o,r,0,null),e=na(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=qr(n),t.memoizedState=$r,e):Kr(t,o));if(null!==(o=e.memoizedState)){if(null!==(i=o.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,eo(e,t,n,Error(s(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,o=t.mode,r=ia({mode:"visible",children:r.children},o,0,null),(a=na(a,o,n,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&oi(t,e.child,null,n),t.child.memoizedState=qr(n),t.memoizedState=$r,a);if(0===(1&t.mode))t=eo(e,t,n,null);else if(ze(i))t=eo(e,t,n,Error(s(419)));else if(r=0!==(n&e.childLanes),Or||r){if(null!==(r=qo)){switch(n&-n){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(r=0!==(a&(r.suspendedLanes|n))?0:a)&&r!==o.retryLane&&(o.retryLane=r,Ss(e,r,-1))}Os(),t=eo(e,t,n,Error(s(421)))}else Oe(i)?(t.flags|=128,t.child=e.child,t=$s.bind(null,e),Ue(i,t),t=null):(n=o.treeContext,Z&&(Hn=Ve(i),Vn=t,Gn=!0,Xn=null,Wn=!1,null!==n&&(Nn[In++]=On,Nn[In++]=zn,Nn[In++]=Ln,On=n.id,zn=n.overflow,Ln=t)),(t=Kr(t,t.pendingProps.children)).flags|=4096);return t}return a?(r=Qr(e,t,r.children,r.fallback,n),a=t.child,o=e.child.memoizedState,a.memoizedState=null===o?qr(n):{baseLanes:o.baseLanes|n,cachePool:null},a.childLanes=e.childLanes&~n,t.memoizedState=$r,r):(n=Jr(e,t,r.children,n),t.memoizedState=null,n)}return a?(r=Qr(e,t,r.children,r.fallback,n),a=t.child,o=e.child.memoizedState,a.memoizedState=null===o?qr(n):{baseLanes:o.baseLanes|n,cachePool:null},a.childLanes=e.childLanes&~n,t.memoizedState=$r,r):(n=Jr(e,t,r.children,n),t.memoizedState=null,n)}function Kr(e,t){return(t=ia({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Jr(e,t,n,i){var r=e.child;return e=r.sibling,n=ea(r,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n}function Qr(e,t,n,i,r){var o=t.mode,s=(e=e.child).sibling,a={mode:"hidden",children:n};return 0===(1&o)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=a,t.deletions=null):(n=ea(e,a)).subtreeFlags=14680064&e.subtreeFlags,null!==s?i=ea(s,i):(i=na(i,o,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function eo(e,t,n,i){return null!==i&&ei(i),oi(t,e.child,null,n),(e=Kr(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function to(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),cn(e.return,t,n)}function no(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function io(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(zr(e,t,i.children,n),0!==(2&(i=gi.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&to(e,n,t);else if(19===e.tag)to(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(lt(gi,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===vi(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),no(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===vi(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}no(t,!0,n,null,o);break;case"together":no(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ro(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ns|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=ea(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=ea(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function oo(e,t){switch(Bn(t),t.tag){case 1:return ft(t.type)&&mt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return pi(),at(dt),at(ut),bi(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return mi(t),null;case 13:if(at(gi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));Qn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return at(gi),null;case 4:return pi(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Rs(),null;default:return null}}var so=!1,ao=!1,lo="function"===typeof WeakSet?WeakSet:Set,co=null;function uo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Ws(e,t,i)}else n.current=null}function ho(e,t,n){try{n()}catch(i){Ws(e,t,i)}}var po=!1;function fo(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&ho(t,n,o)}r=r.next}while(r!==i)}}function mo(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function go(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=N(n);else e=n;"function"===typeof t?t(e):t.current=e}}function vo(e,t,n){if(Gt&&"function"===typeof Gt.onCommitFiberUnmount)try{Gt.onCommitFiberUnmount(Ht,t)}catch(s){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var r=i,o=r.destroy;r=r.tag,void 0!==o&&(0!==(2&r)||0!==(4&r))&&ho(t,n,o),i=i.next}while(i!==e)}break;case 1:if(uo(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(s){Ws(t,n,s)}break;case 5:uo(t,n);break;case 4:$?Eo(e,t,n):q&&q&&(t=t.stateNode.containerInfo,n=Te(t),De(t,n))}}function yo(e,t,n){for(var i=t;;)if(vo(e,i,n),null===i.child||$&&4===i.tag){if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function bo(e){var t=e.alternate;null!==t&&(e.alternate=null,bo(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function xo(e){return 5===e.tag||3===e.tag||4===e.tag}function _o(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||xo(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function wo(e){if($){e:{for(var t=e.return;null!==t;){if(xo(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(xe(t),n.flags&=-33),Mo(e,n=_o(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,So(e,n=_o(e),t);break;default:throw Error(s(161))}}}function So(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?ve(n,e,t):he(n,e);else if(4!==i&&null!==(e=e.child))for(So(e,t,n),e=e.sibling;null!==e;)So(e,t,n),e=e.sibling}function Mo(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?ge(n,e,t):de(n,e);else if(4!==i&&null!==(e=e.child))for(Mo(e,t,n),e=e.sibling;null!==e;)Mo(e,t,n),e=e.sibling}function Eo(e,t,n){for(var i,r,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(s(160));switch(i=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:i=i.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag)yo(e,o,n),r?be(i,o.stateNode):ye(i,o.stateNode);else if(18===o.tag)r?Ze(i,o.stateNode):qe(i,o.stateNode);else if(4===o.tag){if(null!==o.child){i=o.stateNode.containerInfo,r=!0,o.child.return=o,o=o.child;continue}}else if(vo(e,o,n),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function Co(e,t){if($){switch(t.tag){case 0:case 11:case 14:case 15:return fo(3,t,t.return),mo(3,t),void fo(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var r=t.type,o=t.updateQueue;t.updateQueue=null,null!==o&&me(n,o,r,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(s(162));return n=t.memoizedProps,void pe(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(Z&&null!==e&&e.memoizedState.isDehydrated&&Ye(t.stateNode.containerInfo));case 13:case 19:return void To(t)}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:return fo(3,t,t.return),mo(3,t),void fo(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void To(t);case 3:Z&&null!==e&&e.memoizedState.isDehydrated&&Ye(t.stateNode.containerInfo)}e:if(q){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,De(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function To(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new lo),t.forEach(function(t){var i=qs.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function Ao(e,t,n){co=e,Po(e,t,n)}function Po(e,t,n){for(var i=0!==(1&e.mode);null!==co;){var r=co,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||so;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||ao;a=so;var c=ao;if(so=s,(ao=l)&&!c)for(co=r;null!==co;)l=(s=co).child,22===s.tag&&null!==s.memoizedState?Ro(r):null!==l?(l.return=s,co=l):Ro(r);for(;null!==o;)co=o,Po(o,t,n),o=o.sibling;co=r,so=a,ao=c}Do(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,co=o):Do(e)}}function Do(e){for(;null!==co;){var t=co;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:ao||mo(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!ao)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&_n(t,o,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=N(t.child.stateNode);break;case 1:n=t.child.stateNode}_n(t,a,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&fe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(Z&&null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&$e(d)}}}break;default:throw Error(s(163))}ao||512&t.flags&&go(t)}catch(h){Ws(t,t.return,h)}}if(t===e){co=null;break}if(null!==(n=t.sibling)){n.return=t.return,co=n;break}co=t.return}}function ko(e){for(;null!==co;){var t=co;if(t===e){co=null;break}var n=t.sibling;if(null!==n){n.return=t.return,co=n;break}co=t.return}}function Ro(e){for(;null!==co;){var t=co;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{mo(4,t)}catch(l){Ws(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Ws(t,r,l)}}var o=t.return;try{go(t)}catch(l){Ws(t,o,l)}break;case 5:var s=t.return;try{go(t)}catch(l){Ws(t,s,l)}}}catch(l){Ws(t,t.return,l)}if(t===e){co=null;break}var a=t.sibling;if(null!==a){a.return=t.return,co=a;break}co=t.return}}var No=0,Io=1,Lo=2,Oo=3,zo=4;if("function"===typeof Symbol&&Symbol.for){var Uo=Symbol.for;No=Uo("selector.component"),Io=Uo("selector.has_pseudo_class"),Lo=Uo("selector.role"),Oo=Uo("selector.test_id"),zo=Uo("selector.text")}function Fo(e){var t=K(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(s(364));return t}if(null===(e=re(e)))throw Error(s(362));return e.stateNode.current}function jo(e,t){switch(t.$$typeof){case No:if(e.type===t.value)return!0;break;case Io:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var i=e[n++],r=e[n++],o=t[r];if(5!==i.tag||!ae(i)){for(;null!=o&&jo(i,o);)o=t[++r];if(r===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,r),i=i.sibling}}t=!1}return t;case Lo:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case zo:if((5===e.tag||6===e.tag)&&(null!==(e=se(e))&&0<=e.indexOf(t.value)))return!0;break;case Oo:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Bo(e){switch(e.$$typeof){case No:return"<"+(S(e.value)||"Unknown")+">";case Io:return":has("+(Bo(e)||"")+")";case Lo:return'[role="'+e.value+'"]';case zo:return'"'+e.value+'"';case Oo:return'[data-testname="'+e.value+'"]';default:throw Error(s(365))}}function Vo(e,t){var n=[];e=[e,0];for(var i=0;i<e.length;){var r=e[i++],o=e[i++],s=t[o];if(5!==r.tag||!ae(r)){for(;null!=s&&jo(r,s);)s=t[++o];if(o===t.length)n.push(r);else for(r=r.child;null!==r;)e.push(r,o),r=r.sibling}}return n}function Ho(e,t){if(!ie)throw Error(s(363));e=Vo(e=Fo(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++];if(5===i.tag)ae(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var Go=Math.ceil,Wo=a.ReactCurrentDispatcher,Xo=a.ReactCurrentOwner,Yo=a.ReactCurrentBatchConfig,$o=0,qo=null,Zo=null,Ko=0,Jo=0,Qo=st(0),es=0,ts=null,ns=0,is=0,rs=0,os=null,ss=null,as=0,ls=1/0;function cs(){ls=Ut()+500}var us,ds=!1,hs=null,ps=null,fs=!1,ms=null,gs=0,vs=0,ys=null,bs=-1,xs=0;function _s(){return 0!==(6&$o)?Ut():-1!==bs?bs:bs=Ut()}function ws(e){return 0===(1&e.mode)?1:0!==(2&$o)&&0!==Ko?Ko&-Ko:null!==Kt.transition?(0===xs&&(e=St,0===(4194240&(St<<=1))&&(St=64),xs=e),xs):0!==(e=Rt)?e:Q()}function Ss(e,t,n){if(50<vs)throw vs=0,ys=null,Error(s(185));var i=Ms(e,t);return null===i?null:(Dt(i,t,n),0!==(2&$o)&&i===qo||(i===qo&&(0===(2&$o)&&(is|=t),4===es&&Ps(i,Ko)),Es(i,n),1===t&&0===$o&&0===(1&e.mode)&&(cs(),Yt&&Zt())),i)}function Ms(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Es(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-xt(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=Tt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=Ct(e,e===qo?Ko:0);if(0===i)null!==n&&Lt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Lt(n),1===t)0===e.tag?function(e){Yt=!0,qt(e)}(Ds.bind(null,e)):qt(Ds.bind(null,e)),te?ne(function(){0===$o&&Zt()}):It(Ft,Zt),n=null;else{switch(Nt(i)){case 1:n=Ft;break;case 4:n=jt;break;case 16:default:n=Bt;break;case 536870912:n=Vt}n=Zs(n,Cs.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Cs(e,t){if(bs=-1,xs=0,0!==(6&$o))throw Error(s(327));var n=e.callbackNode;if(Hs()&&e.callbackNode!==n)return null;var i=Ct(e,e===qo?Ko:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=zs(e,i);else{t=i;var r=$o;$o|=2;var o=Ls();for(qo===e&&Ko===t||(cs(),Ns(e,t));;)try{Fs();break}catch(l){Is(e,l)}sn(),Wo.current=o,$o=r,null!==Zo?t=0:(qo=null,Ko=0,t=es)}if(0!==t){if(2===t&&(0!==(r=At(e))&&(i=r,t=Ts(e,r))),1===t)throw n=ts,Ns(e,0),Ps(e,i),Es(e,Ut()),n;if(6===t)Ps(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!Wt(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=zs(e,i))&&(0!==(o=At(e))&&(i=o,t=Ts(e,o))),1===t))throw n=ts,Ns(e,0),Ps(e,i),Es(e,Ut()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:Vs(e,ss);break;case 3:if(Ps(e,i),(130023424&i)===i&&10<(t=as+500-Ut())){if(0!==Ct(e,0))break;if(((r=e.suspendedLanes)&i)!==i){_s(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=G(Vs.bind(null,e,ss),t);break}Vs(e,ss);break;case 4:if(Ps(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-xt(i);o=1<<a,(a=t[a])>r&&(r=a),i&=~o}if(i=r,10<(i=(120>(i=Ut()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Go(i/1960))-i)){e.timeoutHandle=G(Vs.bind(null,e,ss),i);break}Vs(e,ss);break;default:throw Error(s(329))}}}return Es(e,Ut()),e.callbackNode===n?Cs.bind(null,e):null}function Ts(e,t){var n=os;return e.current.memoizedState.isDehydrated&&(Ns(e,t).flags|=256),2!==(e=zs(e,t))&&(t=ss,ss=n,null!==t&&As(t)),e}function As(e){null===ss?ss=e:ss.push.apply(ss,e)}function Ps(e,t){for(t&=~rs,t&=~is,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xt(t),i=1<<n;e[n]=-1,t&=~i}}function Ds(e){if(0!==(6&$o))throw Error(s(327));Hs();var t=Ct(e,0);if(0===(1&t))return Es(e,Ut()),null;var n=zs(e,t);if(0!==e.tag&&2===n){var i=At(e);0!==i&&(t=i,n=Ts(e,i))}if(1===n)throw n=ts,Ns(e,0),Ps(e,t),Es(e,Ut()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Vs(e,ss),Es(e,Ut()),null}function ks(e){null!==ms&&0===ms.tag&&0===(6&$o)&&Hs();var t=$o;$o|=1;var n=Yo.transition,i=Rt;try{if(Yo.transition=null,Rt=1,e)return e()}finally{Rt=i,Yo.transition=n,0===(6&($o=t))&&Zt()}}function Rs(){Jo=Qo.current,at(Qo)}function Ns(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==X&&(e.timeoutHandle=X,W(n)),null!==Zo)for(n=Zo.return;null!==n;){var i=n;switch(Bn(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&mt();break;case 3:pi(),at(dt),at(ut),bi();break;case 5:mi(i);break;case 4:pi();break;case 13:case 19:at(gi);break;case 10:ln(i.type._context);break;case 22:case 23:Rs()}n=n.return}if(qo=e,Zo=e=ea(e.current,null),Ko=Jo=t,es=0,ts=null,rs=is=ns=0,ss=os=null,null!==hn){for(t=0;t<hn.length;t++)if(null!==(i=(n=hn[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}hn=null}return e}function Is(e,t){for(;;){var n=Zo;try{if(sn(),xi.current=pr,Ci){for(var i=Si.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Ci=!1}if(wi=0,Ei=Mi=Si=null,Ti=!1,Ai=0,Xo.current=null,null===n||null===n.return){es=1,ts=t,Zo=null;break}e:{var o=e,a=n.return,l=n,c=t;if(t=Ko,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=Tr(a);if(null!==f){f.flags&=-257,Ar(f,a,l,0,t),1&f.mode&&Cr(o,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){Cr(o,u,t),Os();break e}c=Error(s(426))}else if(Gn&&1&l.mode){var v=Tr(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),Ar(v,a,l,0,t),ei(c);break e}}o=c,4!==es&&(es=2),null===os?os=[o]:os.push(o),c=vr(c,l),l=a;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,bn(l,Mr(0,c,t));break e;case 1:o=c;var y=l.type,b=l.stateNode;if(0===(128&l.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===ps||!ps.has(b)))){l.flags|=65536,t&=-t,l.lanes|=t,bn(l,Er(l,o,t));break e}}l=l.return}while(null!==l)}Bs(n)}catch(x){t=x,Zo===n&&null!==n&&(Zo=n=n.return);continue}break}}function Ls(){var e=Wo.current;return Wo.current=pr,null===e?pr:e}function Os(){0!==es&&3!==es&&2!==es||(es=4),null===qo||0===(268435455&ns)&&0===(268435455&is)||Ps(qo,Ko)}function zs(e,t){var n=$o;$o|=2;var i=Ls();for(qo===e&&Ko===t||Ns(e,t);;)try{Us();break}catch(r){Is(e,r)}if(sn(),$o=n,Wo.current=i,null!==Zo)throw Error(s(261));return qo=null,Ko=0,es}function Us(){for(;null!==Zo;)js(Zo)}function Fs(){for(;null!==Zo&&!Ot();)js(Zo)}function js(e){var t=us(e.alternate,e,Jo);e.memoizedProps=e.pendingProps,null===t?Bs(e):Zo=t,Xo.current=null}function Bs(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ir(n,t,Jo)))return void(Zo=n)}else{if(null!==(n=oo(n,t)))return n.flags&=32767,void(Zo=n);if(null===e)return es=6,void(Zo=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Zo=t);Zo=t=e}while(null!==t);0===es&&(es=5)}function Vs(e,t){var n=Rt,i=Yo.transition;try{Yo.transition=null,Rt=1,function(e,t,n){do{Hs()}while(null!==ms);if(0!==(6&$o))throw Error(s(327));var i=e.finishedWork,r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=i.lanes|i.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-xt(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,o),e===qo&&(Zo=qo=null,Ko=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||fs||(fs=!0,Zs(Bt,function(){return Hs(),null})),o=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||o){o=Yo.transition,Yo.transition=null;var a=Rt;Rt=1;var l=$o;$o|=4,Xo.current=null,function(e,t){for(O(e.containerInfo),co=t;null!==co;)if(t=(e=co).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,co=t;else for(;null!==co;){e=co;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var i=n.memoizedProps,r=n.memoizedState,o=e.stateNode,a=o.getSnapshotBeforeUpdate(e.elementType===e.type?i:en(e.type,i),r);o.__reactInternalSnapshotBeforeUpdate=a}break;case 3:$&&Ee(e.stateNode.containerInfo);break;default:throw Error(s(163))}}catch(l){Ws(e,e.return,l)}if(null!==(t=e.sibling)){t.return=e.return,co=t;break}co=e.return}n=po,po=!1}(e,i),function(e,t){for(co=t;null!==co;){var n=(t=co).deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e;$?Eo(o,r,t):yo(o,r,t);var s=r.alternate;null!==s&&(s.return=null),r.return=null}catch(_){Ws(r,t,_)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,co=n;else for(;null!==co;){t=co;try{var a=t.flags;if(32&a&&$&&xe(t.stateNode),512&a){var l=t.alternate;if(null!==l){var c=l.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&a)switch(t.tag){case 13:if(null!==t.memoizedState){var u=t.alternate;null!==u&&null!==u.memoizedState||(as=Ut())}break;case 22:var d=null!==t.memoizedState,h=t.alternate,p=null!==h&&null!==h.memoizedState;if(n=t,$)e:if(i=n,r=d,o=null,$)for(var f=i;;){if(5===f.tag){if(null===o){o=f;var m=f.stateNode;r?_e(m):Se(f.stateNode,f.memoizedProps)}}else if(6===f.tag){if(null===o){var g=f.stateNode;r?we(g):Me(g,f.memoizedProps)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===i)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===i)break;for(;null===f.sibling;){if(null===f.return||f.return===i)break e;o===f&&(o=null),f=f.return}o===f&&(o=null),f.sibling.return=f.return,f=f.sibling}if(d&&!p&&0!==(1&n.mode)){co=n;for(var v=n.child;null!==v;){for(n=co=v;null!==co;){var y=(i=co).child;switch(i.tag){case 0:case 11:case 14:case 15:fo(4,i,i.return);break;case 1:uo(i,i.return);var b=i.stateNode;if("function"===typeof b.componentWillUnmount){var x=i.return;try{b.props=i.memoizedProps,b.state=i.memoizedState,b.componentWillUnmount()}catch(_){Ws(i,x,_)}}break;case 5:uo(i,i.return);break;case 22:if(null!==i.memoizedState){ko(n);continue}}null!==y?(y.return=i,co=y):ko(n)}v=v.sibling}}}switch(4102&a){case 2:wo(t),t.flags&=-3;break;case 6:wo(t),t.flags&=-3,Co(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Co(t.alternate,t);break;case 4:Co(t.alternate,t)}}catch(_){Ws(t,t.return,_)}if(null!==(n=t.sibling)){n.return=t.return,co=n;break}co=t.return}}}(e,i),z(e.containerInfo),e.current=i,Ao(i,e,r),zt(),$o=l,Rt=a,Yo.transition=o}else e.current=i;if(fs&&(fs=!1,ms=e,gs=r),o=e.pendingLanes,0===o&&(ps=null),function(e){if(Gt&&"function"===typeof Gt.onCommitFiberRoot)try{Gt.onCommitFiberRoot(Ht,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),Es(e,Ut()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)n(t[i]);if(ds)throw ds=!1,e=hs,hs=null,e;0!==(1&gs)&&0!==e.tag&&Hs(),o=e.pendingLanes,0!==(1&o)?e===ys?vs++:(vs=0,ys=e):vs=0,Zt()}(e,t,n)}finally{Yo.transition=i,Rt=n}return null}function Hs(){if(null!==ms){var e=Nt(gs),t=Yo.transition,n=Rt;try{if(Yo.transition=null,Rt=16>e?16:e,null===ms)var i=!1;else{if(e=ms,ms=null,gs=0,0!==(6&$o))throw Error(s(331));var r=$o;for($o|=4,co=e.current;null!==co;){var o=co,a=o.child;if(0!==(16&co.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(co=u;null!==co;){var d=co;switch(d.tag){case 0:case 11:case 15:fo(8,d,o)}var h=d.child;if(null!==h)h.return=d,co=h;else for(;null!==co;){var p=(d=co).sibling,f=d.return;if(bo(d),d===u){co=null;break}if(null!==p){p.return=f,co=p;break}co=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}co=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,co=a;else e:for(;null!==co;){if(0!==(2048&(o=co).flags))switch(o.tag){case 0:case 11:case 15:fo(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,co=y;break e}co=o.return}}var b=e.current;for(co=b;null!==co;){var x=(a=co).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,co=x;else e:for(a=b;null!==co;){if(0!==(2048&(l=co).flags))try{switch(l.tag){case 0:case 11:case 15:mo(9,l)}}catch(w){Ws(l,l.return,w)}if(l===a){co=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,co=_;break e}co=l.return}}if($o=r,Zt(),Gt&&"function"===typeof Gt.onPostCommitFiberRoot)try{Gt.onPostCommitFiberRoot(Ht,e)}catch(w){}i=!0}return i}finally{Rt=n,Yo.transition=t}}return!1}function Gs(e,t,n){vn(e,t=Mr(0,t=vr(n,t),1)),t=_s(),null!==(e=Ms(e,1))&&(Dt(e,1,t),Es(e,t))}function Ws(e,t,n){if(3===e.tag)Gs(e,e,n);else for(;null!==t;){if(3===t.tag){Gs(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===ps||!ps.has(i))){vn(t,e=Er(t,e=vr(n,e),1)),e=_s(),null!==(t=Ms(t,1))&&(Dt(t,1,e),Es(t,e));break}}t=t.return}}function Xs(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=_s(),e.pingedLanes|=e.suspendedLanes&n,qo===e&&(Ko&n)===n&&(4===es||3===es&&(130023424&Ko)===Ko&&500>Ut()-as?Ns(e,0):rs|=n),Es(e,t)}function Ys(e,t){0===t&&(0===(1&e.mode)?t=1:(t=Mt,0===(130023424&(Mt<<=1))&&(Mt=4194304)));var n=_s();null!==(e=Ms(e,t))&&(Dt(e,t,n),Es(e,n))}function $s(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ys(e,n)}function qs(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),Ys(e,n)}function Zs(e,t){return It(e,t)}function Ks(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Js(e,t,n,i){return new Ks(e,t,n,i)}function Qs(e){return!(!(e=e.prototype)||!e.isReactComponent)}function ea(e,t){var n=e.alternate;return null===n?((n=Js(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ta(e,t,n,i,r,o){var a=2;if(i=e,"function"===typeof e)Qs(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case u:return na(n.children,r,o,t);case d:a=8,r|=8;break;case h:return(e=Js(12,n,t,2|r)).elementType=h,e.lanes=o,e;case g:return(e=Js(13,n,t,r)).elementType=g,e.lanes=o,e;case v:return(e=Js(19,n,t,r)).elementType=v,e.lanes=o,e;case x:return ia(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case p:a=10;break e;case f:a=9;break e;case m:a=11;break e;case y:a=14;break e;case b:a=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Js(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function na(e,t,n,i){return(e=Js(7,e,i,t)).lanes=n,e}function ia(e,t,n,i){return(e=Js(22,e,i,t)).elementType=x,e.lanes=n,e.stateNode={},e}function ra(e,t,n){return(e=Js(6,e,null,t)).lanes=n,e}function oa(e,t,n){return(t=Js(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function sa(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=X,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pt(0),this.expirationTimes=Pt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pt(0),this.identifierPrefix=i,this.onRecoverableError=r,Z&&(this.mutableSourceEagerHydrationData=null)}function aa(e,t,n,i,r,o,s,a,l){return e=new sa(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Js(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null},fn(o),e}function la(e){if(!e)return ct;e:{if(E(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ft(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(ft(n))return vt(e,n,t)}return t}function ca(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return null===(e=A(t))?null:e.stateNode}function ua(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function da(e,t){ua(e,t),(e=e.alternate)&&ua(e,t)}function ha(e){return null===(e=A(e))?null:e.stateNode}function pa(){return null}return us=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||dt.current)Or=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Or=!1,function(e,t,n){switch(t.tag){case 3:Xr(t),Qn();break;case 5:fi(t);break;case 1:ft(t.type)&&yt(t);break;case 4:hi(t,t.stateNode.containerInfo);break;case 10:an(0,t.type._context,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(lt(gi,1&gi.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Zr(e,t,n):(lt(gi,1&gi.current),null!==(e=ro(e,t,n))?e.sibling:null);lt(gi,1&gi.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return io(e,t,n);t.flags|=128}var r=t.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),lt(gi,gi.current),i)break;return null;case 22:case 23:return t.lanes=0,Br(e,t,n)}return ro(e,t,n)}(e,t,n);Or=0!==(131072&e.flags)}else Or=!1,Gn&&0!==(1048576&t.flags)&&Fn(t,Rn,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var r=pt(t,ut.current);un(t,n),r=Ri(null,t,i,e,r,n);var o=Ni();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ft(i)?(o=!0,yt(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,fn(t),r.updater=Mn,t.stateNode=r,r._reactInternals=t,An(t,i,e,n),t=Wr(null,t,i,!0,o,n)):(t.tag=0,Gn&&o&&jn(t),zr(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Qs(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===m)return 11;if(e===y)return 14}return 2}(i),e=en(i,e),r){case 0:t=Hr(null,t,i,e,n);break e;case 1:t=Gr(null,t,i,e,n);break e;case 11:t=Ur(null,t,i,e,n);break e;case 14:t=Fr(null,t,i,en(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Hr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 1:return i=t.type,r=t.pendingProps,Gr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 3:e:{if(Xr(t),null===e)throw Error(s(387));i=t.pendingProps,r=(o=t.memoizedState).element,mn(e,t),xn(t,i,null,n);var a=t.memoizedState;if(i=a.element,Z&&o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Yr(e,t,i,n,r=Error(s(423)));break e}if(i!==r){t=Yr(e,t,i,n,r=Error(s(424)));break e}for(Z&&(Hn=Be(t.stateNode.containerInfo),Vn=t,Gn=!0,Xn=null,Wn=!1),n=si(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Qn(),i===r){t=ro(e,t,n);break e}zr(e,t,i,n)}t=t.child}return t;case 5:return fi(t),null===e&&Zn(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,V(i,r)?a=null:null!==o&&V(i,o)&&(t.flags|=32),Vr(e,t),zr(e,t,a,n),t.child;case 6:return null===e&&Zn(t),null;case 13:return Zr(e,t,n);case 4:return hi(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=oi(t,null,i,n):zr(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ur(e,t,i,r=t.elementType===i?r:en(i,r),n);case 7:return zr(e,t,t.pendingProps,n),t.child;case 8:case 12:return zr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,an(0,i,a=r.value),null!==o)if(Wt(o.value,a)){if(o.children===r.children&&!dt.current){t=ro(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=gn(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),cn(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),cn(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}zr(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,un(t,n),i=i(r=dn(r)),t.flags|=1,zr(e,t,i,n),t.child;case 14:return r=en(i=t.type,t.pendingProps),Fr(e,t,i,r=en(i.type,r),n);case 15:return jr(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:en(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,ft(i)?(e=!0,yt(t)):e=!1,un(t,n),Cn(t,i,r),An(t,i,r,n),Wr(null,t,i,!0,e,n);case 19:return io(e,t,n);case 22:return Br(e,t,n)}throw Error(s(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(Ss(e,134217728,_s()),da(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=_s(),n=ws(e);Ss(e,n,t),da(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Et(t.pendingLanes);0!==n&&(kt(t,1|n),Es(t,Ut()),0===(6&$o)&&(cs(),Zt()))}break;case 13:var i=_s();ks(function(){return Ss(e,1,i)}),da(e,1)}},t.batchedUpdates=function(e,t){var n=$o;$o|=1;try{return e(t)}finally{0===($o=n)&&(cs(),Yt&&Zt())}},t.createComponentSelector=function(e){return{$$typeof:No,value:e}},t.createContainer=function(e,t,n,i,r,o,s){return aa(e,t,!1,null,0,i,0,o,s)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Io,value:e}},t.createHydrationContainer=function(e,t,n,i,r,o,s,a,l){return(e=aa(n,i,!0,e,0,o,0,a,l)).context=la(null),n=e.current,(o=gn(i=_s(),r=ws(n))).callback=void 0!==t&&null!==t?t:null,vn(n,o),e.current.lanes=r,Dt(e,r,i),Es(e,i),e},t.createPortal=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Lo,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Oo,value:e}},t.createTextSelector=function(e){return{$$typeof:zo,value:e}},t.deferredUpdates=function(e){var t=Rt,n=Yo.transition;try{return Yo.transition=null,Rt=16,e()}finally{Rt=t,Yo.transition=n}},t.discreteUpdates=function(e,t,n,i,r){var o=Rt,s=Yo.transition;try{return Yo.transition=null,Rt=1,e(t,n,i,r)}finally{Rt=o,Yo.transition=s,0===$o&&cs()}},t.findAllNodes=Ho,t.findBoundingRects=function(e,t){if(!ie)throw Error(s(363));t=Ho(e,t),e=[];for(var n=0;n<t.length;n++)e.push(oe(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,r=i+n.width,o=n.y,a=o+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,d=u+c.width,h=c.y,p=h+c.height;if(i>=u&&o>=h&&r<=d&&a<=p){e.splice(t,1);break}if(!(i!==u||n.width!==c.width||p<o||h>a)){h>o&&(c.height+=h-o,c.y=o),p<a&&(c.height=a-h),e.splice(t,1);break}if(!(o!==h||n.height!==c.height||d<i||u>r)){u>i&&(c.width+=u-i,c.x=i),d<r&&(c.width=r-u),e.splice(t,1);break}}return e},t.findHostInstance=ca,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=T(e))?D(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return ca(e)},t.flushControlled=function(e){var t=$o;$o|=1;var n=Yo.transition,i=Rt;try{Yo.transition=null,Rt=1,e()}finally{Rt=i,Yo.transition=n,0===($o=t)&&(cs(),Zt())}},t.flushPassiveEffects=Hs,t.flushSync=ks,t.focusWithin=function(e,t){if(!ie)throw Error(s(363));for(t=Vo(e=Fo(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!ae(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Rt},t.getFindAllNodesFailureDescription=function(e,t){if(!ie)throw Error(s(363));var n=0,i=[];e=[Fo(e),0];for(var r=0;r<e.length;){var o=e[r++],a=e[r++],l=t[a];if((5!==o.tag||!ae(o))&&(jo(o,l)&&(i.push(Bo(l)),++a>n&&(n=a)),a<t.length))for(o=o.child;null!==o;)e.push(o,a),o=o.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Bo(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?N(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:ha,findFiberByHostInstance:e.findFiberByHostInstance||pa,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Ht=t.inject(e),Gt=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,i){if(!ie)throw Error(s(363));e=Ho(e,t);var r=ue(e,n,i).disconnect;return{disconnect:function(){r()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Rt;try{return Rt=e,t()}finally{Rt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,i){var r=t.current,o=_s(),s=ws(r);return n=la(n),null===t.context?t.context=n:t.pendingContext=n,(t=gn(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),vn(r,t),null!==(e=Ss(r,s,o))&&yn(e,r,s),s},t}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0,(()=>{"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>ti,AddEquation:()=>xn,AddOperation:()=>Zn,AdditiveAnimationBlendMode:()=>Lr,AdditiveBlending:()=>gn,AgXToneMapping:()=>ii,AlphaFormat:()=>Oi,AlwaysCompare:()=>Mo,AlwaysDepth:()=>Bn,AlwaysStencilFunc:()=>go,AmbientLight:()=>og,AnimationAction:()=>$g,AnimationClip:()=>Pm,AnimationLoader:()=>Um,AnimationMixer:()=>Zg,AnimationObjectGroup:()=>Yg,AnimationUtils:()=>gm,ArcCurve:()=>Np,ArrayCamera:()=>jd,ArrowHelper:()=>Bv,AttachedBindMode:()=>ri,Audio:()=>Rg,AudioAnalyser:()=>Ug,AudioContext:()=>bg,AudioListener:()=>kg,AudioLoader:()=>xg,AxesHelper:()=>Vv,BackSide:()=>dn,BasicDepthPacking:()=>Br,BasicShadowMap:()=>sn,BatchedMesh:()=>sp,Bone:()=>Dh,BooleanKeyframeTrack:()=>wm,Box2:()=>lv,Box3:()=>Ls,Box3Helper:()=>Ov,BoxGeometry:()=>Xl,BoxHelper:()=>Lv,BufferAttribute:()=>ll,BufferGeometry:()=>Cl,BufferGeometryLoader:()=>hg,ByteType:()=>Ci,Cache:()=>km,Camera:()=>Jl,CameraHelper:()=>Rv,CanvasTexture:()=>Dp,CapsuleGeometry:()=>ef,CatmullRomCurve3:()=>Fp,CineonToneMapping:()=>ei,CircleGeometry:()=>tf,ClampToEdgeWrapping:()=>pi,Clock:()=>Eg,Color:()=>Za,ColorKeyframeTrack:()=>Sm,ColorManagement:()=>ps,CompressedArrayTexture:()=>Ap,CompressedCubeTexture:()=>Pp,CompressedTexture:()=>Tp,CompressedTextureLoader:()=>Fm,ConeGeometry:()=>rf,ConstantAlphaFactor:()=>Un,ConstantColorFactor:()=>On,CubeCamera:()=>tc,CubeReflectionMapping:()=>ai,CubeRefractionMapping:()=>li,CubeTexture:()=>nc,CubeTextureLoader:()=>Bm,CubeUVReflectionMapping:()=>di,CubicBezierCurve:()=>Hp,CubicBezierCurve3:()=>Gp,CubicInterpolant:()=>ym,CullFaceBack:()=>nn,CullFaceFront:()=>rn,CullFaceFrontBack:()=>on,CullFaceNone:()=>tn,Curve:()=>kp,CurvePath:()=>Kp,CustomBlending:()=>bn,CustomToneMapping:()=>ni,CylinderGeometry:()=>nf,Cylindrical:()=>sv,Data3DTexture:()=>As,DataArrayTexture:()=>Cs,DataTexture:()=>kh,DataTextureLoader:()=>Vm,DataUtils:()=>ol,DecrementStencilOp:()=>ro,DecrementWrapStencilOp:()=>so,DefaultLoadingManager:()=>Nm,DepthFormat:()=>ji,DepthStencilFormat:()=>Bi,DepthTexture:()=>Zc,DetachedBindMode:()=>oi,DirectionalLight:()=>rg,DirectionalLightHelper:()=>Pv,DiscreteInterpolant:()=>xm,DisplayP3ColorSpace:()=>$r,DodecahedronGeometry:()=>sf,DoubleSide:()=>hn,DstAlphaFactor:()=>kn,DstColorFactor:()=>Nn,DynamicCopyUsage:()=>Ro,DynamicDrawUsage:()=>Co,DynamicReadUsage:()=>Po,EdgesGeometry:()=>df,EllipseCurve:()=>Rp,EqualCompare:()=>bo,EqualDepth:()=>Gn,EqualStencilFunc:()=>uo,EquirectangularReflectionMapping:()=>ci,EquirectangularRefractionMapping:()=>ui,Euler:()=>ya,EventDispatcher:()=>Fo,ExtrudeGeometry:()=>Bf,FileLoader:()=>zm,Float16BufferAttribute:()=>gl,Float32BufferAttribute:()=>vl,Float64BufferAttribute:()=>yl,FloatType:()=>ki,Fog:()=>Zd,FogExp2:()=>qd,FramebufferTexture:()=>Cp,FrontSide:()=>un,Frustum:()=>uc,GLBufferAttribute:()=>tv,GLSL1:()=>Io,GLSL3:()=>Lo,GreaterCompare:()=>_o,GreaterDepth:()=>Xn,GreaterEqualCompare:()=>So,GreaterEqualDepth:()=>Wn,GreaterEqualStencilFunc:()=>mo,GreaterStencilFunc:()=>po,GridHelper:()=>Mv,Group:()=>Bd,HalfFloatType:()=>Ri,HemisphereLight:()=>Wm,HemisphereLightHelper:()=>Sv,IcosahedronGeometry:()=>Hf,ImageBitmapLoader:()=>vg,ImageLoader:()=>jm,ImageUtils:()=>vs,IncrementStencilOp:()=>io,IncrementWrapStencilOp:()=>oo,InstancedBufferAttribute:()=>Lh,InstancedBufferGeometry:()=>dg,InstancedInterleavedBuffer:()=>ev,InstancedMesh:()=>Hh,Int16BufferAttribute:()=>hl,Int32BufferAttribute:()=>fl,Int8BufferAttribute:()=>cl,IntType:()=>Pi,InterleavedBuffer:()=>Jd,InterleavedBufferAttribute:()=>eh,Interpolant:()=>vm,InterpolateDiscrete:()=>Ar,InterpolateLinear:()=>Pr,InterpolateSmooth:()=>Dr,InvertStencilOp:()=>ao,KeepStencilOp:()=>to,KeyframeTrack:()=>_m,LOD:()=>bh,LatheGeometry:()=>Qp,Layers:()=>ba,LessCompare:()=>yo,LessDepth:()=>Vn,LessEqualCompare:()=>xo,LessEqualDepth:()=>Hn,LessEqualStencilFunc:()=>ho,LessStencilFunc:()=>co,Light:()=>Gm,LightProbe:()=>lg,Line:()=>pp,Line3:()=>dv,LineBasicMaterial:()=>ap,LineCurve:()=>Wp,LineCurve3:()=>Xp,LineDashedMaterial:()=>um,LineLoop:()=>vp,LineSegments:()=>gp,LinearDisplayP3ColorSpace:()=>qr,LinearEncoding:()=>Fr,LinearFilter:()=>xi,LinearInterpolant:()=>bm,LinearMipMapLinearFilter:()=>Mi,LinearMipMapNearestFilter:()=>wi,LinearMipmapLinearFilter:()=>Si,LinearMipmapNearestFilter:()=>_i,LinearSRGBColorSpace:()=>Yr,LinearToneMapping:()=>Jn,LinearTransfer:()=>Zr,Loader:()=>Im,LoaderUtils:()=>ug,LoadingManager:()=>Rm,LoopOnce:()=>Er,LoopPingPong:()=>Tr,LoopRepeat:()=>Cr,LuminanceAlphaFormat:()=>Fi,LuminanceFormat:()=>Ui,MOUSE:()=>Qt,Material:()=>Qa,MaterialLoader:()=>cg,MathUtils:()=>Jo,Matrix3:()=>es,Matrix4:()=>la,MaxEquation:()=>Mn,Mesh:()=>Gl,MeshBasicMaterial:()=>el,MeshDepthMaterial:()=>Id,MeshDistanceMaterial:()=>Ld,MeshLambertMaterial:()=>lm,MeshMatcapMaterial:()=>cm,MeshNormalMaterial:()=>am,MeshPhongMaterial:()=>om,MeshPhysicalMaterial:()=>rm,MeshStandardMaterial:()=>im,MeshToonMaterial:()=>sm,MinEquation:()=>Sn,MirroredRepeatWrapping:()=>fi,MixOperation:()=>qn,MultiplyBlending:()=>yn,MultiplyOperation:()=>$n,NearestFilter:()=>mi,NearestMipMapLinearFilter:()=>bi,NearestMipMapNearestFilter:()=>vi,NearestMipmapLinearFilter:()=>yi,NearestMipmapNearestFilter:()=>gi,NeverCompare:()=>vo,NeverDepth:()=>jn,NeverStencilFunc:()=>lo,NoBlending:()=>fn,NoColorSpace:()=>Wr,NoToneMapping:()=>Kn,NormalAnimationBlendMode:()=>Ir,NormalBlending:()=>mn,NotEqualCompare:()=>wo,NotEqualDepth:()=>Yn,NotEqualStencilFunc:()=>fo,NumberKeyframeTrack:()=>Mm,Object3D:()=>Na,ObjectLoader:()=>pg,ObjectSpaceNormalMap:()=>Gr,OctahedronGeometry:()=>Gf,OneFactor:()=>Cn,OneMinusConstantAlphaFactor:()=>Fn,OneMinusConstantColorFactor:()=>zn,OneMinusDstAlphaFactor:()=>Rn,OneMinusDstColorFactor:()=>In,OneMinusSrcAlphaFactor:()=>Dn,OneMinusSrcColorFactor:()=>An,OrthographicCamera:()=>Mc,P3Primaries:()=>Qr,PCFShadowMap:()=>an,PCFSoftShadowMap:()=>ln,PMREMGenerator:()=>Lc,Path:()=>Jp,PerspectiveCamera:()=>Ql,Plane:()=>ac,PlaneGeometry:()=>pc,PlaneHelper:()=>zv,PointLight:()=>ng,PointLightHelper:()=>bv,Points:()=>Sp,PointsMaterial:()=>yp,PolarGridHelper:()=>Ev,PolyhedronGeometry:()=>of,PositionalAudio:()=>zg,PropertyBinding:()=>Xg,PropertyMixer:()=>Fg,QuadraticBezierCurve:()=>Yp,QuadraticBezierCurve3:()=>$p,Quaternion:()=>ks,QuaternionKeyframeTrack:()=>Cm,QuaternionLinearInterpolant:()=>Em,RED_GREEN_RGTC2_Format:()=>Sr,RED_RGTC1_Format:()=>_r,REVISION:()=>Jt,RGBADepthPacking:()=>Vr,RGBAFormat:()=>zi,RGBAIntegerFormat:()=>Xi,RGBA_ASTC_10x10_Format:()=>mr,RGBA_ASTC_10x5_Format:()=>hr,RGBA_ASTC_10x6_Format:()=>pr,RGBA_ASTC_10x8_Format:()=>fr,RGBA_ASTC_12x10_Format:()=>gr,RGBA_ASTC_12x12_Format:()=>vr,RGBA_ASTC_4x4_Format:()=>rr,RGBA_ASTC_5x4_Format:()=>or,RGBA_ASTC_5x5_Format:()=>sr,RGBA_ASTC_6x5_Format:()=>ar,RGBA_ASTC_6x6_Format:()=>lr,RGBA_ASTC_8x5_Format:()=>cr,RGBA_ASTC_8x6_Format:()=>ur,RGBA_ASTC_8x8_Format:()=>dr,RGBA_BPTC_Format:()=>yr,RGBA_ETC2_EAC_Format:()=>ir,RGBA_PVRTC_2BPPV1_Format:()=>er,RGBA_PVRTC_4BPPV1_Format:()=>Qi,RGBA_S3TC_DXT1_Format:()=>$i,RGBA_S3TC_DXT3_Format:()=>qi,RGBA_S3TC_DXT5_Format:()=>Zi,RGB_BPTC_SIGNED_Format:()=>br,RGB_BPTC_UNSIGNED_Format:()=>xr,RGB_ETC1_Format:()=>tr,RGB_ETC2_Format:()=>nr,RGB_PVRTC_2BPPV1_Format:()=>Ji,RGB_PVRTC_4BPPV1_Format:()=>Ki,RGB_S3TC_DXT1_Format:()=>Yi,RGFormat:()=>Gi,RGIntegerFormat:()=>Wi,RawShaderMaterial:()=>nm,Ray:()=>aa,Raycaster:()=>nv,Rec709Primaries:()=>Jr,RectAreaLight:()=>sg,RedFormat:()=>Vi,RedIntegerFormat:()=>Hi,ReinhardToneMapping:()=>Qn,RenderTarget:()=>Ms,RepeatWrapping:()=>hi,ReplaceStencilOp:()=>no,ReverseSubtractEquation:()=>wn,RingGeometry:()=>Wf,SIGNED_RED_GREEN_RGTC2_Format:()=>Mr,SIGNED_RED_RGTC1_Format:()=>wr,SRGBColorSpace:()=>Xr,SRGBTransfer:()=>Kr,Scene:()=>Kd,ShaderChunk:()=>fc,ShaderLib:()=>gc,ShaderMaterial:()=>Kl,ShadowMaterial:()=>tm,Shape:()=>hf,ShapeGeometry:()=>Xf,ShapePath:()=>Hv,ShapeUtils:()=>Uf,ShortType:()=>Ti,Skeleton:()=>Ih,SkeletonHelper:()=>vv,SkinnedMesh:()=>Ph,Source:()=>bs,Sphere:()=>Qs,SphereGeometry:()=>Yf,Spherical:()=>ov,SphericalHarmonics3:()=>ag,SplineCurve:()=>qp,SpotLight:()=>Km,SpotLightHelper:()=>pv,Sprite:()=>mh,SpriteMaterial:()=>th,SrcAlphaFactor:()=>Pn,SrcAlphaSaturateFactor:()=>Ln,SrcColorFactor:()=>Tn,StaticCopyUsage:()=>ko,StaticDrawUsage:()=>Eo,StaticReadUsage:()=>Ao,StereoCamera:()=>Mg,StreamCopyUsage:()=>No,StreamDrawUsage:()=>To,StreamReadUsage:()=>Do,StringKeyframeTrack:()=>Tm,SubtractEquation:()=>_n,SubtractiveBlending:()=>vn,TOUCH:()=>en,TangentSpaceNormalMap:()=>Hr,TetrahedronGeometry:()=>$f,Texture:()=>ws,TextureLoader:()=>Hm,TorusGeometry:()=>qf,TorusKnotGeometry:()=>Zf,Triangle:()=>Wa,TriangleFanDrawMode:()=>Ur,TriangleStripDrawMode:()=>zr,TrianglesDrawMode:()=>Or,TubeGeometry:()=>Kf,TwoPassDoubleSide:()=>pn,UVMapping:()=>si,Uint16BufferAttribute:()=>pl,Uint32BufferAttribute:()=>ml,Uint8BufferAttribute:()=>ul,Uint8ClampedBufferAttribute:()=>dl,Uniform:()=>Kg,UniformsGroup:()=>Qg,UniformsLib:()=>mc,UniformsUtils:()=>Zl,UnsignedByteType:()=>Ei,UnsignedInt248Type:()=>Li,UnsignedIntType:()=>Di,UnsignedShort4444Type:()=>Ni,UnsignedShort5551Type:()=>Ii,UnsignedShortType:()=>Ai,VSMShadowMap:()=>cn,Vector2:()=>Qo,Vector3:()=>Rs,Vector4:()=>Ss,VectorKeyframeTrack:()=>Am,VideoTexture:()=>Ep,WebGL1Renderer:()=>$d,WebGL3DRenderTarget:()=>Ps,WebGLArrayRenderTarget:()=>Ts,WebGLCoordinateSystem:()=>zo,WebGLCubeRenderTarget:()=>ic,WebGLMultipleRenderTargets:()=>Ds,WebGLRenderTarget:()=>Es,WebGLRenderer:()=>Yd,WebGLUtils:()=>Fd,WebGPUCoordinateSystem:()=>Uo,WireframeGeometry:()=>Jf,WrapAroundEnding:()=>Nr,ZeroCurvatureEnding:()=>kr,ZeroFactor:()=>En,ZeroSlopeEnding:()=>Rr,ZeroStencilOp:()=>eo,_SRGBAFormat:()=>Oo,createCanvasElement:()=>ss,sRGBEncoding:()=>jr});var t=n(43),i=n(391),r=n(579);const o=e=>{let{connectionStatus:n="Local Server",onTraceClick:i,onConnectionClick:o,onSaveClick:s,isDarkTheme:a=!0,onThemeToggle:l,showObjectNames:c=!1,onToggleObjectNames:u,onOpenPanel:d,onResetLayout:h,availablePanels:p=[]}=e;const[f,m]=(0,t.useState)(null),[g,v]=(0,t.useState)(!1),y=(0,t.useRef)(null),b=(0,t.useRef)(null);(0,t.useEffect)(()=>{const e=e=>{y.current&&!y.current.contains(e.target)&&(m(null),v(!1))};return(g||f)&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[g,f]);const x=e=>{m(f===e?null:e),"Window"!==e&&v(!1)},_=e=>{e&&e(),m(null),v(!1)};return(0,r.jsxs)("div",{className:"top-bar",children:[(0,r.jsxs)("div",{className:"top-bar-left",children:[(0,r.jsx)("h1",{className:"app-title",children:(0,r.jsx)("a",{href:"https://rfdigitaltwin.github.io/",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit"},children:"RF Digital Twin"})}),(0,r.jsxs)("div",{className:"menu-bar",ref:y,children:[(0,r.jsxs)("div",{className:"menu-container",children:[(0,r.jsx)("button",{className:"menu-button "+("File"===f?"active":""),onClick:()=>x("File"),onMouseEnter:()=>{f&&(m("File"),v(!1))},children:"File"}),"File"===f&&(0,r.jsxs)("div",{className:"menu-dropdown",children:[(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("New Scene")),children:[(0,r.jsx)("span",{children:"New Scene"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+N"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Open")),children:[(0,r.jsx)("span",{children:"Open..."}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+O"})]}),(0,r.jsx)("div",{className:"menu-divider"}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(s),children:[(0,r.jsx)("span",{children:"Save"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+S"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Save As")),children:[(0,r.jsx)("span",{children:"Save As..."}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+Shift+S"})]}),(0,r.jsx)("div",{className:"menu-divider"}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Exit")),children:[(0,r.jsx)("span",{children:"Exit"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Alt+F4"})]})]})]}),(0,r.jsxs)("div",{className:"menu-container",children:[(0,r.jsx)("button",{className:"menu-button "+("Edit"===f?"active":""),onClick:()=>x("Edit"),onMouseEnter:()=>{f&&(m("Edit"),v(!1))},children:"Edit"}),"Edit"===f&&(0,r.jsxs)("div",{className:"menu-dropdown",children:[(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Undo")),children:[(0,r.jsx)("span",{children:"Undo"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+Z"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Redo")),children:[(0,r.jsx)("span",{children:"Redo"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+Y"})]}),(0,r.jsx)("div",{className:"menu-divider"}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Cut")),children:[(0,r.jsx)("span",{children:"Cut"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+X"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Copy")),children:[(0,r.jsx)("span",{children:"Copy"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+C"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Paste")),children:[(0,r.jsx)("span",{children:"Paste"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+V"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Duplicate")),children:[(0,r.jsx)("span",{children:"Duplicate"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+D"})]}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Delete")),children:[(0,r.jsx)("span",{children:"Delete"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Delete"})]})]})]}),(0,r.jsxs)("div",{className:"windows-menu-container menu-container",ref:b,children:[(0,r.jsx)("button",{className:"menu-button windows-menu-button "+("Window"===f||g?"active":""),onClick:()=>{x("Window"),v(!g)},onMouseEnter:()=>{f&&"Window"!==f&&(m("Window"),v(!0))},children:"Window"}),("Window"===f||g)&&(0,r.jsxs)("div",{className:"menu-dropdown windows-dropdown",children:[p.map(e=>(0,r.jsxs)("div",{className:"menu-item windows-menu-item",onClick:()=>{null===d||void 0===d||d(e.id),_()},children:[(0,r.jsx)("span",{className:"menu-item-check "+(e.isOpen?"visible":""),children:"\u2713"}),(0,r.jsx)("span",{children:e.title})]},e.id)),(0,r.jsx)("div",{className:"menu-divider"}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(h),children:(0,r.jsx)("span",{children:"Reset Layout"})}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(l),children:[(0,r.jsx)("span",{children:"Toggle Theme"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+Shift+T"})]})]})]}),(0,r.jsxs)("div",{className:"menu-container",children:[(0,r.jsx)("button",{className:"menu-button "+("Tools"===f?"active":""),onClick:()=>x("Tools"),onMouseEnter:()=>{f&&(m("Tools"),v(!1))},children:"Tools"}),"Tools"===f&&(0,r.jsxs)("div",{className:"menu-dropdown",children:[(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Create Cube")),children:(0,r.jsx)("span",{children:"Create Cube"})}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Create Sphere")),children:(0,r.jsx)("span",{children:"Create Sphere"})}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Create Cylinder")),children:(0,r.jsx)("span",{children:"Create Cylinder"})}),(0,r.jsx)("div",{className:"menu-divider"}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Grid Settings")),children:(0,r.jsx)("span",{children:"Grid Settings..."})}),(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Preferences")),children:[(0,r.jsx)("span",{children:"Preferences..."}),(0,r.jsx)("span",{className:"menu-shortcut",children:"Ctrl+,"})]})]})]}),(0,r.jsxs)("div",{className:"menu-container",children:[(0,r.jsx)("button",{className:"menu-button "+("Help"===f?"active":""),onClick:()=>x("Help"),onMouseEnter:()=>{f&&(m("Help"),v(!1))},children:"Help"}),"Help"===f&&(0,r.jsxs)("div",{className:"menu-dropdown",children:[(0,r.jsxs)("div",{className:"menu-item",onClick:()=>_(()=>window.open("https://github.com/RFDigitalTwin/Editor","_blank")),children:[(0,r.jsx)("span",{children:"Documentation"}),(0,r.jsx)("span",{className:"menu-shortcut",children:"F1"})]}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>console.log("Keyboard Shortcuts")),children:(0,r.jsx)("span",{children:"Keyboard Shortcuts"})}),(0,r.jsx)("div",{className:"menu-divider"}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>window.open("https://github.com/RFDigitalTwin/Editor/issues","_blank")),children:(0,r.jsx)("span",{children:"Report Issue"})}),(0,r.jsx)("div",{className:"menu-item",onClick:()=>_(()=>console.log("About")),children:(0,r.jsx)("span",{children:"About WiTwin"})})]})]})]})]}),(0,r.jsxs)("div",{className:"top-bar-right",children:[(0,r.jsx)("button",{className:"icon-button save-button",onClick:s,title:"Save Scene (Ctrl+S)",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,r.jsx)("path",{d:"M2 1a1 1 0 00-1 1v12a1 1 0 001 1h12a1 1 0 001-1V4.414a1 1 0 00-.293-.707l-2.414-2.414A1 1 0 0011.586 1H2zm1 1h8v3.5A1.5 1.5 0 019.5 7h-5A1.5 1.5 0 013 5.5V2zm7 0h1.586L13 3.414V4h-3V2zM3 9h10v5H3V9z"})})}),(0,r.jsx)("button",{className:"icon-button name-toggle "+(c?"active":""),onClick:u,title:c?"Hide Object Names":"Show Object Names",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,r.jsx)("path",{d:"M2 2.5A.5.5 0 012.5 2h3a.5.5 0 010 1h-3a.5.5 0 01-.5-.5zM7 2.5a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h6a.5.5 0 010 1h-6a.5.5 0 01-.5-.5zM2 6.5A.5.5 0 012.5 6h3a.5.5 0 010 1h-3a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h3a.5.5 0 010 1h-3a.5.5 0 01-.5-.5zm0 4a.5.5 0 01.5-.5h3a.5.5 0 010 1h-3a.5.5 0 01-.5-.5z"})})}),(0,r.jsx)("button",{className:"icon-button theme-toggle",onClick:l,title:a?"Switch to Light Theme":"Switch to Dark Theme",children:a?(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"})}):(0,r.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),(0,r.jsxs)("div",{className:"connection-status "+(n.includes("Disconnected")?"disconnected":n.includes("Connecting")?"connecting":"connected"),onClick:o,style:{cursor:o?"pointer":"default"},children:[(0,r.jsx)("div",{className:"status-indicator"}),(0,r.jsx)("span",{children:n.includes("Disconnected")?"Disconnected":n.includes("Connecting")?"Connecting...":`Connected to ${n}`})]})]})]})};class s{}class a extends s{constructor(e,t,n){super(),this.viewId=e,this.groupId=t,this.panelId=n}}class l extends s{constructor(e,t){super(),this.viewId=e,this.paneId=t}}class c{constructor(){}static getInstance(){return c.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,t){t&&(this.data=e,this.proto=t)}}function u(){const e=c.getInstance();if(e.hasData(a.prototype))return e.getData(a.prototype)[0]}function d(){const e=c.getInstance();if(e.hasData(l.prototype))return e.getData(l.prototype)[0]}var h,p;c.INSTANCE=new c,function(e){e.any=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{const n=t.map(t=>t(e));return{dispose:()=>{n.forEach(e=>{e.dispose()})}}}}}(h||(h={}));class f{constructor(){this._defaultPrevented=!1}get defaultPrevented(){return this._defaultPrevented}preventDefault(){this._defaultPrevented=!0}}class m{constructor(){this._isAccepted=!1}get isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}}class g{static create(){var e;return new g(null!==(e=(new Error).stack)&&void 0!==e?e:"")}constructor(e){this.value=e}print(){console.warn("dockview: stacktrace",this.value)}}class v{constructor(e,t){this.callback=e,this.stacktrace=t}}class y{static setLeakageMonitorEnabled(e){e!==y.ENABLE_TRACKING&&y.MEMORY_LEAK_WATCHER.clear(),y.ENABLE_TRACKING=e}get value(){return this._last}constructor(e){this.options=e,this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>{var t;(null===(t=this.options)||void 0===t?void 0:t.replay)&&void 0!==this._last&&e(this._last);const n=new v(e,y.ENABLE_TRACKING?g.create():void 0);return this._listeners.push(n),{dispose:()=>{const e=this._listeners.indexOf(n);e>-1?this._listeners.splice(e,1):y.ENABLE_TRACKING}}},y.ENABLE_TRACKING&&y.MEMORY_LEAK_WATCHER.add(this._event,g.create())),this._event}fire(e){var t;(null===(t=this.options)||void 0===t?void 0:t.replay)&&(this._last=e);for(const n of this._listeners)n.callback(e)}dispose(){this._disposed||(this._disposed=!0,this._listeners.length>0&&(y.ENABLE_TRACKING&&queueMicrotask(()=>{var e;for(const t of this._listeners)console.warn("dockview: stacktrace",null===(e=t.stacktrace)||void 0===e?void 0:e.print())}),this._listeners=[]),y.ENABLE_TRACKING&&this._event&&y.MEMORY_LEAK_WATCHER.delete(this._event))}}function b(e,t,n,i){return e.addEventListener(t,n,i),{dispose:()=>{e.removeEventListener(t,n,i)}}}y.ENABLE_TRACKING=!1,y.MEMORY_LEAK_WATCHER=new class{constructor(){this.events=new Map}get size(){return this.events.size}add(e,t){this.events.set(e,t)}delete(e){this.events.delete(e)}clear(){this.events.clear()}};class x{constructor(){this._onFired=new y,this._currentFireCount=0,this._queued=!1,this.onEvent=e=>{const t=this._currentFireCount;return this._onFired.event(()=>{this._currentFireCount>t&&e()})}}fire(){this._currentFireCount++,this._queued||(this._queued=!0,queueMicrotask(()=>{this._queued=!1,this._onFired.fire()}))}dispose(){this._onFired.dispose()}}!function(e){e.NONE={dispose:()=>{}},e.from=function(e){return{dispose:()=>{e()}}}}(p||(p={}));class _{get isDisposed(){return this._isDisposed}constructor(){this._isDisposed=!1;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._disposables=t}addDisposables(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(e=>this._disposables.push(e))}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach(e=>e.dispose()),this._disposables=[])}}class w{constructor(){this._disposable=p.NONE}set value(e){this._disposable&&this._disposable.dispose(),this._disposable=e}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=p.NONE)}}class S extends _{constructor(e){super(),this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._value=null,this.addDisposables(this._onDidChange,M(e,e=>{const t=e.target.scrollWidth>e.target.clientWidth,n=e.target.scrollHeight>e.target.clientHeight;this._value={hasScrollX:t,hasScrollY:n},this._onDidChange.fire(this._value)}))}}function M(e,t){const n=new ResizeObserver(e=>{requestAnimationFrame(()=>{const n=e[0];t(n)})});return n.observe(e),{dispose:()=>{n.unobserve(e),n.disconnect()}}}const E=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)e.classList.contains(r)&&e.classList.remove(r)},C=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)e.classList.contains(r)||e.classList.add(r)},T=(e,t,n)=>{const i=e.classList.contains(t);n&&!i&&e.classList.add(t),!n&&i&&e.classList.remove(t)};function A(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function P(e){return new D(e)}class D extends _{constructor(e){super(),this._onDidFocus=new y,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new y,this.onDidBlur=this._onDidBlur.event,this.addDisposables(this._onDidFocus,this._onDidBlur);let t=A(document.activeElement,e),n=!1;const i=()=>{n=!1,t||(t=!0,this._onDidFocus.fire())},r=()=>{t&&(n=!0,window.setTimeout(()=>{n&&(n=!1,t=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{A(document.activeElement,e)!==t&&(t?r():i())},this.addDisposables(b(e,"focus",i,!0)),this.addDisposables(b(e,"blur",r,!0))}refreshState(){this._refreshStateHandler()}}const k="dv-quasiPreventDefault";function R(e){return e[k]}function N(e){const{left:t,top:n,width:i,height:r}=e.getBoundingClientRect();return{left:t+window.scrollX,top:n+window.scrollY,width:i,height:r}}function I(){arguments.length>0&&void 0!==arguments[0]||document;const e=function(e){const t=[];return function n(i){if(i.nodeType===Node.ELEMENT_NODE){e.includes(i.tagName)&&t.push(i),i.shadowRoot&&n(i.shadowRoot);for(const e of i.children)n(e)}}(document.documentElement),t}(["IFRAME","WEBVIEW"]),t=new WeakMap;for(const n of e)t.set(n,n.style.pointerEvents),n.style.pointerEvents="none";return{release:()=>{var n;for(const i of e)i.style.pointerEvents=null!==(n=t.get(i))&&void 0!==n?n:"auto";e.splice(0,e.length)}}}class L{constructor(e){this.element=e,this._classNames=[]}setClassNames(e){for(const t of this._classNames)T(this.element,t,!1);this._classNames=e.split(" ").filter(e=>e.trim().length>0);for(const t of this._classNames)T(this.element,t,!0)}}function O(e){if(0===e.length)throw new Error("Invalid tail call");return[e.slice(0,e.length-1),e[e.length-1]]}function z(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function U(e,t){const n=e.indexOf(t);n>-1&&(e.splice(n,1),e.unshift(t))}function F(e,t){const n=e.indexOf(t);n>-1&&(e.splice(n,1),e.push(t))}function j(e,t){const n=e.findIndex(e=>e===t);return n>-1&&(e.splice(n,1),!0)}const B=(e,t,n)=>t>n?t:Math.min(n,Math.max(e,t)),V=()=>{let e=1;return{next:()=>(e++).toString()}},H=(e,t)=>{const n=[];if("number"!==typeof t&&(t=e,e=0),e<=t)for(let i=e;i<t;i++)n.push(i);else for(let i=e;i>t;i--)n.push(i);return n};class G{set size(e){this._size=e}get size(){return this._size}get cachedVisibleSize(){return this._cachedVisibleSize}get visible(){return"undefined"===typeof this._cachedVisibleSize}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,t,n,i){this.container=e,this.view=t,this.disposable=i,this._cachedVisibleSize=void 0,"number"===typeof n?(this._size=n,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=n.cachedVisibleSize)}setVisible(e,t){var n;e!==this.visible&&(e?(this.size=B(null!==(n=this._cachedVisibleSize)&&void 0!==n?n:0,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize="number"===typeof t?t:this.size,this.size=0),this.container.classList.toggle("visible",e),this.view.setVisible&&this.view.setVisible(e))}dispose(){return this.disposable.dispose(),this.view}}var W,X,Y,$;!function(e){e.HORIZONTAL="HORIZONTAL",e.VERTICAL="VERTICAL"}(W||(W={})),function(e){e[e.MAXIMUM=0]="MAXIMUM",e[e.MINIMUM=1]="MINIMUM",e[e.DISABLED=2]="DISABLED",e[e.ENABLED=3]="ENABLED"}(X||(X={})),function(e){e.Low="low",e.High="high",e.Normal="normal"}(Y||(Y={})),function(e){e.Distribute={type:"distribute"},e.Split=function(e){return{type:"split",index:e}},e.Invisible=function(e){return{type:"invisible",cachedVisibleSize:e}}}($||($={}));class q{get contentSize(){return this._contentSize}get size(){return this._size}set size(e){this._size=e}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get length(){return this.viewItems.length}get proportions(){return this._proportions?[...this._proportions]:void 0}get orientation(){return this._orientation}set orientation(e){this._orientation=e;const t=this.size;this.size=this.orthogonalSize,this.orthogonalSize=t,E(this.element,"dv-horizontal","dv-vertical"),this.element.classList.add(this.orientation==W.HORIZONTAL?"dv-horizontal":"dv-vertical")}get minimumSize(){return this.viewItems.reduce((e,t)=>e+t.minimumSize,0)}get maximumSize(){return 0===this.length?Number.POSITIVE_INFINITY:this.viewItems.reduce((e,t)=>e+t.maximumSize,0)}get startSnappingEnabled(){return this._startSnappingEnabled}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}get endSnappingEnabled(){return this._endSnappingEnabled}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}get disabled(){return this._disabled}set disabled(e){this._disabled=e,T(this.element,"dv-splitview-disabled",e)}get margin(){return this._margin}set margin(e){this._margin=e,T(this.element,"dv-splitview-has-margin",0!==e)}constructor(e,t){var n,i,r=this;this.container=e,this.viewItems=[],this.sashes=[],this._size=0,this._orthogonalSize=0,this._contentSize=0,this._proportions=void 0,this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this._disabled=!1,this._margin=0,this._onDidSashEnd=new y,this.onDidSashEnd=this._onDidSashEnd.event,this._onDidAddView=new y,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new y,this.onDidRemoveView=this._onDidRemoveView.event,this.resize=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.viewItems.map(e=>e.size),i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Number.NEGATIVE_INFINITY,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Number.POSITIVE_INFINITY,l=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0;if(e<0||e>r.viewItems.length)return 0;const u=H(e,-1),d=H(e+1,r.viewItems.length);if(o)for(const r of o)U(u,r),U(d,r);if(i)for(const r of i)F(u,r),F(d,r);const h=u.map(e=>r.viewItems[e]),p=u.map(e=>n[e]),f=d.map(e=>r.viewItems[e]),m=d.map(e=>n[e]),g=u.reduce((e,t)=>e+r.viewItems[t].minimumSize-n[t],0),v=u.reduce((e,t)=>e+r.viewItems[t].maximumSize-n[t],0),y=0===d.length?Number.POSITIVE_INFINITY:d.reduce((e,t)=>e+n[t]-r.viewItems[t].minimumSize,0),b=0===d.length?Number.NEGATIVE_INFINITY:d.reduce((e,t)=>e+n[t]-r.viewItems[t].maximumSize,0),x=Math.max(g,b),_=Math.min(y,v);let w=!1;if(l){const e=r.viewItems[l.index],n=t>=l.limitDelta;w=n!==e.visible,e.setVisible(n,l.size)}if(!w&&c){const e=r.viewItems[c.index],n=t<c.limitDelta;w=n!==e.visible,e.setVisible(n,c.size)}if(w)return r.resize(e,t,n,i,o,s,a);let S=0,M=B(t,x,_);for(let r=0;r<h.length;r++){const e=h[r],t=B(p[r]+M,e.minimumSize,e.maximumSize),n=t-p[r];S+=n,M-=n,e.size=t}let E=S;for(let r=0;r<f.length;r++){const e=f[r],t=B(m[r]-E,e.minimumSize,e.maximumSize);E+=t-m[r],e.size=t}return t},this._orientation=null!==(n=t.orientation)&&void 0!==n?n:W.VERTICAL,this.element=this.createContainer(),this.margin=null!==(i=t.margin)&&void 0!==i?i:0,this.proportionalLayout=void 0===t.proportionalLayout||!!t.proportionalLayout,this.viewContainer=this.createViewContainer(),this.sashContainer=this.createSashContainer(),this.element.appendChild(this.sashContainer),this.element.appendChild(this.viewContainer),this.container.appendChild(this.element),this.style(t.styles),t.descriptor&&(this._size=t.descriptor.size,t.descriptor.views.forEach((e,t)=>{const n=void 0===e.visible||e.visible?e.size:{type:"invisible",cachedVisibleSize:e.size},i=e.view;this.addView(i,n,t,!0)}),this._contentSize=this.viewItems.reduce((e,t)=>e+t.size,0),this.saveProportions())}style(e){"transparent"===(null===e||void 0===e?void 0:e.separatorBorder)?(E(this.element,"dv-separator-border"),this.element.style.removeProperty("--dv-separator-border")):(C(this.element,"dv-separator-border"),(null===e||void 0===e?void 0:e.separatorBorder)&&this.element.style.setProperty("--dv-separator-border",e.separatorBorder))}isViewVisible(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].visible}setViewVisible(e,t){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");const n=this.viewItems[e];n.setVisible(t,n.size),this.distributeEmptySpace(e),this.layoutViews(),this.saveProportions()}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}resizeView(e,t){if(e<0||e>=this.viewItems.length)return;const n=H(this.viewItems.length).filter(t=>t!==e),i=[...n.filter(e=>this.viewItems[e].priority===Y.Low),e],r=n.filter(e=>this.viewItems[e].priority===Y.High),o=this.viewItems[e];t=Math.round(t),t=B(t,o.minimumSize,Math.min(o.maximumSize,this._size)),o.size=t,this.relayout(i,r)}getViews(){return this.viewItems.map(e=>e.view)}onDidChange(e,t){const n=this.viewItems.indexOf(e);if(n<0||n>=this.viewItems.length)return;t="number"===typeof t?t:e.size,t=B(t,e.minimumSize,e.maximumSize),e.size=t;const i=H(this.viewItems.length).filter(e=>e!==n),r=[...i.filter(e=>this.viewItems[e].priority===Y.Low),n],o=i.filter(e=>this.viewItems[e].priority===Y.High);this.relayout([...r,n],o)}addView(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"distribute"},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.viewItems.length,i=arguments.length>3?arguments[3]:void 0;const r=document.createElement("div");let o;r.className="dv-view",r.appendChild(e.element),o="number"===typeof t?t:"split"===t.type?this.getViewSize(t.index)/2:"invisible"===t.type?{cachedVisibleSize:t.cachedVisibleSize}:e.minimumSize;const s=e.onDidChange(e=>this.onDidChange(a,e.size)),a=new G(r,e,o,{dispose:()=>{s.dispose(),this.viewContainer.removeChild(r)}});if(n===this.viewItems.length?this.viewContainer.appendChild(r):this.viewContainer.insertBefore(r,this.viewContainer.children.item(n)),this.viewItems.splice(n,0,a),this.viewItems.length>1){const e=document.createElement("div");e.className="dv-sash";const t=t=>{for(const e of this.viewItems)e.enabled=!1;const n=I(),i=this._orientation===W.HORIZONTAL?t.clientX:t.clientY,r=function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return-1}(this.sashes,t=>t.container===e),o=this.viewItems.map(e=>e.size);let s,a;const l=H(r,-1),c=H(r+1,this.viewItems.length),u=l.reduce((e,t)=>e+(this.viewItems[t].minimumSize-o[t]),0),d=l.reduce((e,t)=>e+(this.viewItems[t].viewMaximumSize-o[t]),0),h=0===c.length?Number.POSITIVE_INFINITY:c.reduce((e,t)=>e+(o[t]-this.viewItems[t].minimumSize),0),p=0===c.length?Number.NEGATIVE_INFINITY:c.reduce((e,t)=>e+(o[t]-this.viewItems[t].viewMaximumSize),0),f=Math.max(u,p),m=Math.min(h,d),g=this.findFirstSnapIndex(l),v=this.findFirstSnapIndex(c);if("number"===typeof g){const e=this.viewItems[g],t=Math.floor(e.viewMinimumSize/2);s={index:g,limitDelta:e.visible?f-t:f+t,size:e.size}}if("number"===typeof v){const e=this.viewItems[v],t=Math.floor(e.viewMinimumSize/2);a={index:v,limitDelta:e.visible?m+t:m-t,size:e.size}}const y=e=>{const t=(this._orientation===W.HORIZONTAL?e.clientX:e.clientY)-i;this.resize(r,t,o,void 0,void 0,f,m,s,a),this.distributeEmptySpace(),this.layoutViews()},b=()=>{for(const e of this.viewItems)e.enabled=!0;n.release(),this.saveProportions(),document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",b),document.removeEventListener("pointercancel",b),this._onDidSashEnd.fire(void 0)};document.addEventListener("pointermove",y),document.addEventListener("pointerup",b),document.addEventListener("pointercancel",b)};e.addEventListener("pointerdown",t);const n={container:e,disposable:()=>{e.removeEventListener("pointerdown",t),this.sashContainer.removeChild(e)}};this.sashContainer.appendChild(e),this.sashes.push(n)}i||this.relayout([n]),i||"number"===typeof t||"distribute"!==t.type||this.distributeViewSizes(),this._onDidAddView.fire(e)}distributeViewSizes(){const e=[];let t=0;for(const s of this.viewItems)s.maximumSize-s.minimumSize>0&&(e.push(s),t+=s.size);const n=Math.floor(t/e.length);for(const s of e)s.size=B(n,s.minimumSize,s.maximumSize);const i=H(this.viewItems.length),r=i.filter(e=>this.viewItems[e].priority===Y.Low),o=i.filter(e=>this.viewItems[e].priority===Y.High);this.relayout(r,o)}removeView(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.viewItems.splice(e,1)[0];if(i.dispose(),this.viewItems.length>=1){const t=Math.max(e-1,0);this.sashes.splice(t,1)[0].disposable()}return n||this.relayout(),t&&"distribute"===t.type&&this.distributeViewSizes(),this._onDidRemoveView.fire(i.view),i.view}getViewCachedVisibleSize(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].cachedVisibleSize}moveView(e,t){const n=this.getViewCachedVisibleSize(e),i="undefined"===typeof n?this.getViewSize(e):$.Invisible(n),r=this.removeView(e,void 0,!0);this.addView(r,i,t)}layout(e,t){const n=Math.max(this.size,this._contentSize);if(this.size=e,this.orthogonalSize=t,this.proportions){let t=0;for(let n=0;n<this.viewItems.length;n++){const i=this.viewItems[n],r=this.proportions[n];"number"===typeof r?t+=r:e-=i.size}for(let n=0;n<this.viewItems.length;n++){const i=this.viewItems[n],r=this.proportions[n];"number"===typeof r&&t>0&&(i.size=B(Math.round(r*e/t),i.minimumSize,i.maximumSize))}}else{const t=H(this.viewItems.length),i=t.filter(e=>this.viewItems[e].priority===Y.Low),r=t.filter(e=>this.viewItems[e].priority===Y.High);this.resize(this.viewItems.length-1,e-n,void 0,i,r)}this.distributeEmptySpace(),this.layoutViews()}relayout(e,t){const n=this.viewItems.reduce((e,t)=>e+t.size,0);this.resize(this.viewItems.length-1,this._size-n,void 0,e,t),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}distributeEmptySpace(e){const t=this.viewItems.reduce((e,t)=>e+t.size,0);let n=this.size-t;const i=H(this.viewItems.length-1,-1),r=i.filter(e=>this.viewItems[e].priority===Y.Low),o=i.filter(e=>this.viewItems[e].priority===Y.High);for(const s of o)U(i,s);for(const s of r)F(i,s);"number"===typeof e&&F(i,e);for(let s=0;0!==n&&s<i.length;s++){const e=this.viewItems[i[s]],t=B(e.size+n,e.minimumSize,e.maximumSize);n-=t-e.size,e.size=t}}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this._proportions=this.viewItems.map(e=>e.visible?e.size/this._contentSize:void 0))}layoutViews(){if(this._contentSize=this.viewItems.reduce((e,t)=>e+t.size,0),this.updateSashEnablement(),0===this.viewItems.length)return;const e=this.viewItems.filter(e=>e.visible),t=Math.max(0,e.length-1),n=this.margin*t/Math.max(1,e.length);let i=0;const r=[],o=this.viewItems.reduce((e,t,n)=>{const i=t.visible?1:0;return 0===n?e.push(i):e.push(e[n-1]+i),e},[]);this.viewItems.forEach((e,s)=>{i+=this.viewItems[s].size,r.push(i);const a=e.visible?e.size-n:0,l=Math.max(0,o[s]-1),c=0===s||0===l?0:r[s-1]+l/t*n;if(s<this.viewItems.length-1){const t=e.visible?c+a-2+this.margin/2:c;this._orientation===W.HORIZONTAL&&(this.sashes[s].container.style.left=`${t}px`,this.sashes[s].container.style.top="0px"),this._orientation===W.VERTICAL&&(this.sashes[s].container.style.left="0px",this.sashes[s].container.style.top=`${t}px`)}this._orientation===W.HORIZONTAL&&(e.container.style.width=`${a}px`,e.container.style.left=`${c}px`,e.container.style.top="",e.container.style.height=""),this._orientation===W.VERTICAL&&(e.container.style.height=`${a}px`,e.container.style.top=`${c}px`,e.container.style.width="",e.container.style.left=""),e.view.layout(e.size-n,this._orthogonalSize)})}findFirstSnapIndex(e){for(const t of e){const e=this.viewItems[t];if(e.visible&&e.snap)return t}for(const t of e){const e=this.viewItems[t];if(e.visible&&e.maximumSize-e.minimumSize>0)return;if(!e.visible&&e.snap)return t}}updateSashEnablement(){let e=!1;const t=this.viewItems.map(t=>e=t.size-t.minimumSize>0||e);e=!1;const n=this.viewItems.map(t=>e=t.maximumSize-t.size>0||e),i=[...this.viewItems].reverse();e=!1;const r=i.map(t=>e=t.size-t.minimumSize>0||e).reverse();e=!1;const o=i.map(t=>e=t.maximumSize-t.size>0||e).reverse();let s=0;for(let a=0;a<this.sashes.length;a++){const e=this.sashes[a];s+=this.viewItems[a].size;const i=!(t[a]&&o[a+1]),l=!(n[a]&&r[a+1]);if(i&&l){const n=H(a,-1),i=H(a+1,this.viewItems.length),o=this.findFirstSnapIndex(n),l=this.findFirstSnapIndex(i),c="number"===typeof o&&!this.viewItems[o].visible,u="number"===typeof l&&!this.viewItems[l].visible;c&&r[a]&&(s>0||this.startSnappingEnabled)?this.updateSash(e,X.MINIMUM):u&&t[a]&&(s<this._contentSize||this.endSnappingEnabled)?this.updateSash(e,X.MAXIMUM):this.updateSash(e,X.DISABLED)}else i&&!l?this.updateSash(e,X.MINIMUM):!i&&l?this.updateSash(e,X.MAXIMUM):this.updateSash(e,X.ENABLED)}}updateSash(e,t){T(e.container,"dv-disabled",t===X.DISABLED),T(e.container,"dv-enabled",t===X.ENABLED),T(e.container,"dv-maximum",t===X.MAXIMUM),T(e.container,"dv-minimum",t===X.MINIMUM)}createViewContainer(){const e=document.createElement("div");return e.className="dv-view-container",e}createSashContainer(){const e=document.createElement("div");return e.className="dv-sash-container",e}createContainer(){const e=document.createElement("div"),t=this._orientation===W.HORIZONTAL?"dv-horizontal":"dv-vertical";return e.className=`dv-split-view-container ${t}`,e}dispose(){this._onDidSashEnd.dispose(),this._onDidAddView.dispose(),this._onDidRemoveView.dispose();for(let e=0;e<this.element.children.length;e++)if(this.element.children.item(e)===this.element){this.element.removeChild(this.element);break}for(const e of this.viewItems)e.dispose();this.element.remove()}}const Z=(()=>{const e={orientation:void 0,descriptor:void 0,proportionalLayout:void 0,styles:void 0,margin:void 0,disableAutoResizing:void 0,className:void 0};return Object.keys(e)})();class K extends _{get onDidAddView(){return this.splitview.onDidAddView}get onDidRemoveView(){return this.splitview.onDidRemoveView}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get orientation(){return this.splitview.orientation}get size(){return this.splitview.size}get orthogonalSize(){return this.splitview.orthogonalSize}constructor(e,t){var n;super(),this.paneItems=[],this.skipAnimation=!1,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._orientation=null!==(n=t.orientation)&&void 0!==n?n:W.VERTICAL,this.element=document.createElement("div"),this.element.className="dv-pane-container",e.appendChild(this.element),this.splitview=new q(this.element,{orientation:this._orientation,proportionalLayout:!1,descriptor:t.descriptor}),this.getPanes().forEach(e=>{const t=new _(e.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)})),n={pane:e,disposable:{dispose:()=>{t.dispose()}}};this.paneItems.push(n),e.orthogonalSize=this.splitview.orthogonalSize}),this.addDisposables(this._onDidChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire(void 0)}),this.splitview.onDidAddView(()=>{this._onDidChange.fire()}),this.splitview.onDidRemoveView(()=>{this._onDidChange.fire()}))}setViewVisible(e,t){this.splitview.setViewVisible(e,t)}addPane(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.splitview.length,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)}),o={pane:e,disposable:{dispose:()=>{r.dispose()}}};this.paneItems.splice(n,0,o),e.orthogonalSize=this.splitview.orthogonalSize,this.splitview.addView(e,t,n,i)}getViewSize(e){return this.splitview.getViewSize(e)}getPanes(){return this.splitview.getViews()}removePane(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipDispose:!1};const n=this.paneItems.splice(e,1)[0];return this.splitview.removeView(e),t.skipDispose||(n.disposable.dispose(),n.pane.dispose()),n}moveView(e,t){if(e===t)return;const n=this.removePane(e,{skipDispose:!0});this.skipAnimation=!0;try{this.addPane(n.pane,n.pane.size,t,!1)}finally{this.skipAnimation=!1}}layout(e,t){this.splitview.layout(e,t)}setupAnimation(){this.skipAnimation||(this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),C(this.element,"dv-animated"),this.animationTimer=setTimeout(()=>{this.animationTimer=void 0,E(this.element,"dv-animated")},200))}dispose(){super.dispose(),this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),this.paneItems.forEach(e=>{e.disposable.dispose(),e.pane.dispose()}),this.paneItems=[],this.splitview.dispose(),this.element.remove()}}class J{get minimumWidth(){return this.view.minimumWidth}get maximumWidth(){return this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get priority(){return this.view.priority}get snap(){return this.view.snap}get minimumSize(){return this.orientation===W.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===W.HORIZONTAL?this.maximumHeight:this.maximumWidth}get minimumOrthogonalSize(){return this.orientation===W.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===W.HORIZONTAL?this.maximumWidth:this.maximumHeight}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get element(){return this.view.element}get width(){return this.orientation===W.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===W.HORIZONTAL?this.size:this.orthogonalSize}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.view=e,this.orientation=t,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._orthogonalSize=n,this._size=i,this._disposable=this.view.onDidChange(e=>{e?this._onDidChange.fire({size:this.orientation===W.VERTICAL?e.width:e.height,orthogonalSize:this.orientation===W.VERTICAL?e.height:e.width}):this._onDidChange.fire({})})}setVisible(e){this.view.setVisible&&this.view.setVisible(e)}layout(e,t){this._size=e,this._orthogonalSize=t,this.view.layout(this.width,this.height)}dispose(){this._onDidChange.dispose(),this._disposable.dispose()}}class Q extends _{get width(){return this.orientation===W.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===W.HORIZONTAL?this.orthogonalSize:this.size}get minimumSize(){return 0===this.children.length?0:Math.max(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get minimumWidth(){return this.orientation===W.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===W.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===W.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===W.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get priority(){if(0===this.children.length)return Y.Normal;const e=this.children.map(e=>"undefined"===typeof e.priority?Y.Normal:e.priority);return e.some(e=>e===Y.High)?Y.High:e.some(e=>e===Y.Low)?Y.Low:Y.Normal}get disabled(){return this.splitview.disabled}set disabled(e){this.splitview.disabled=e}get margin(){return this.splitview.margin}set margin(e){this.splitview.margin=e,this.children.forEach(t=>{t instanceof Q&&(t.margin=e)})}constructor(e,t,n,i,r,o,s,a){if(super(),this.orientation=e,this.proportionalLayout=t,this.styles=n,this._childrenDisposable=p.NONE,this.children=[],this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new y,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._orthogonalSize=r,this._size=i,this.element=document.createElement("div"),this.element.className="dv-branch-node",a){const e={views:a.map(e=>({view:e.node,size:e.node.size,visible:!(e.node instanceof J&&void 0!==e.visible)||e.visible})),size:this.orthogonalSize};this.children=a.map(e=>e.node),this.splitview=new q(this.element,{orientation:this.orientation,descriptor:e,proportionalLayout:t,styles:n,margin:s})}else this.splitview=new q(this.element,{orientation:this.orientation,proportionalLayout:t,styles:n,margin:s}),this.splitview.layout(this.size,this.orthogonalSize);this.disabled=o,this.addDisposables(this._onDidChange,this._onDidVisibilityChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire({})})),this.setupChildrenEvents()}setVisible(e){}isChildVisible(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.isViewVisible(e)}setChildVisible(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");if(this.splitview.isViewVisible(e)===t)return;const n=0===this.splitview.contentSize;this.splitview.setViewVisible(e,t);const i=0===this.splitview.contentSize;(t&&n||!t&&i)&&this._onDidVisibilityChange.fire({visible:t})}moveChild(e,t){if(e===t)return;if(e<0||e>=this.children.length)throw new Error("Invalid from index");e<t&&t--,this.splitview.moveView(e,t);const n=this._removeChild(e);this._addChild(n,t)}getChildSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewSize(e)}resizeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");this.splitview.resizeView(e,t)}layout(e,t){this._size=t,this._orthogonalSize=e,this.splitview.layout(t,e)}addChild(e,t,n,i){if(n<0||n>this.children.length)throw new Error("Invalid index");this.splitview.addView(e,t,n,i),this._addChild(e,n)}getChildCachedVisibleSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewCachedVisibleSize(e)}removeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.removeView(e,t),this._removeChild(e)}_addChild(e,t){this.children.splice(t,0,e),this.setupChildrenEvents()}_removeChild(e){const[t]=this.children.splice(e,1);return this.setupChildrenEvents(),t}setupChildrenEvents(){this._childrenDisposable.dispose(),this._childrenDisposable=new _(h.any(...this.children.map(e=>e.onDidChange))(e=>{this._onDidChange.fire({size:e.orthogonalSize})}),...this.children.map((e,t)=>e instanceof Q?e.onDidVisibilityChange(e=>{let{visible:n}=e;this.setChildVisible(t,n)}):p.NONE))}dispose(){this._childrenDisposable.dispose(),this.splitview.dispose(),this.children.forEach(e=>e.dispose()),super.dispose()}}function ee(e,t){if(e instanceof J)return e;if(e instanceof Q)return ee(e.children[t?e.children.length-1:0],t);throw new Error("invalid node")}function te(e,t,n){if(e instanceof Q){const i=new Q(e.orientation,e.proportionalLayout,e.styles,t,n,e.disabled,e.margin);for(let t=e.children.length-1;t>=0;t--){const n=e.children[t];i.addChild(te(n,n.size,n.orthogonalSize),n.size,0,!0)}return i}return new J(e.view,e.orientation,n)}function ne(e,t,n){if(e instanceof Q){const i=new Q(oe(e.orientation),e.proportionalLayout,e.styles,t,n,e.disabled,e.margin);let r=0;for(let o=e.children.length-1;o>=0;o--){const s=e.children[o],a=s instanceof Q?s.orthogonalSize:s.size;let l=0===e.size?0:Math.round(t*a/e.size);r+=l,0===o&&(l+=t-r),i.addChild(ne(s,n,l),l,0,!0)}return i}return new J(e.view,oe(e.orientation),n)}function ie(e){const t=e.parentElement;if(!t)throw new Error("Invalid grid element");if(/\bdv-grid-view\b/.test(t.className))return[];const n=function(e){const t=e.parentElement;if(!t)throw new Error("Invalid grid element");let n=t.firstElementChild,i=0;for(;n!==e&&n!==t.lastElementChild&&n;)n=n.nextElementSibling,i++;return i}(t);return[...ie(t.parentElement.parentElement.parentElement),n]}function re(e,t,n){const i=function(e,t){return t.length%2===0?oe(e):e}(e,t),r=function(e){return"top"===e||"bottom"===e?W.VERTICAL:W.HORIZONTAL}(n);if(i===r){const[e,i]=O(t);let r=i;return"right"!==n&&"bottom"!==n||(r+=1),[...e,r]}{const e="right"===n||"bottom"===n?1:0;return[...t,e]}}const oe=e=>e===W.HORIZONTAL?W.VERTICAL:W.HORIZONTAL;const se=(e,t)=>{const n=t===W.VERTICAL?e.box.width:e.box.height;return function(e){return!!e.children}(e)?{type:"branch",data:e.children.map(e=>se(e,oe(t))),size:n}:"number"===typeof e.cachedVisibleSize?{type:"leaf",data:e.view.toJSON(),size:e.cachedVisibleSize,visible:!1}:{type:"leaf",data:e.view.toJSON(),size:n}};class ae{get length(){return this._root?this._root.children.length:0}get orientation(){return this.root.orientation}set orientation(e){if(this.root.orientation===e)return;const{size:t,orthogonalSize:n}=this.root;this.root=ne(this.root,n,t),this.root.layout(t,n)}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get locked(){return this._locked}set locked(e){this._locked=e;const t=[this.root];for(;t.length>0;){const n=t.pop();n instanceof Q&&(n.disabled=e,t.push(...n.children))}}get margin(){return this._margin}set margin(e){this._margin=e,this.root.margin=e}maximizedView(){var e;return null===(e=this._maximizedNode)||void 0===e?void 0:e.leaf.view}hasMaximizedView(){return void 0!==this._maximizedNode}maximizeView(e){var t;const n=ie(e.element),[i,r]=this.getNode(n);if(!(r instanceof J))return;if((null===(t=this._maximizedNode)||void 0===t?void 0:t.leaf)===r)return;this.hasMaximizedView()&&this.exitMaximizedView(),se(this.getView(),this.orientation);const o=[];!function e(t,n){for(let i=0;i<t.children.length;i++){const r=t.children[i];r instanceof J?r!==n&&(t.isChildVisible(i)?t.setChildVisible(i,!1):o.push(r)):e(r,n)}}(this.root,r),this._maximizedNode={leaf:r,hiddenOnMaximize:o},this._onDidMaximizedNodeChange.fire({view:r.view,isMaximized:!0})}exitMaximizedView(){if(!this._maximizedNode)return;const e=this._maximizedNode.hiddenOnMaximize;!function t(n){for(let i=n.children.length-1;i>=0;i--){const r=n.children[i];r instanceof J?e.includes(r)||n.setChildVisible(i,!0):t(r)}}(this.root);const t=this._maximizedNode.leaf;this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire({view:t.view,isMaximized:!1})}serialize(){const e=this.maximizedView();let t;e&&(t=ie(e.element)),this.hasMaximizedView()&&this.exitMaximizedView();const n={root:se(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation};return t&&(n.maximizedNode={location:t}),e&&this.maximizeView(e),n}dispose(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()}clear(){const e=this.root.orientation;this.root=new Q(e,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)}deserialize(e,t){const n=e.orientation,i=n===W.VERTICAL?e.height:e.width;if(this._deserialize(e.root,n,t,i),this.layout(e.width,e.height),e.maximizedNode){const t=e.maximizedNode.location,[n,i]=this.getNode(t);if(!(i instanceof J))return;this.maximizeView(i.view)}}_deserialize(e,t,n,i){this.root=this._deserializeNode(e,t,n,i)}_deserializeNode(e,t,n,i){var r;let o;if("branch"===e.type){const r=e.data.map(i=>({node:this._deserializeNode(i,oe(t),n,e.size),visible:i.visible}));o=new Q(t,this.proportionalLayout,this.styles,e.size,i,this.locked,this.margin,r)}else{const s=n.fromJSON(e);"boolean"===typeof e.visible&&(null===(r=s.setVisible)||void 0===r||r.call(s,e.visible)),o=new J(s,t,i,e.size)}return o}get root(){return this._root}set root(e){const t=this._root;t&&(t.dispose(),this._maximizedNode=void 0,this.element.removeChild(t.element)),this._root=e,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(e=>{this._onDidChange.fire(e)})}normalize(){if(!this._root)return;if(1!==this._root.children.length)return;const e=this.root,t=e.children[0];if(t instanceof J)return;e.element.remove();const n=e.removeChild(0);e.dispose(),n.dispose(),this._root=te(t,t.size,t.orthogonalSize),this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(e=>{this._onDidChange.fire(e)})}insertOrthogonalSplitviewAtRoot(){if(!this._root)return;const e=this.root;if(e.element.remove(),this._root=new Q(oe(e.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),0===e.children.length);else if(1===e.children.length){const t=e.children[0];e.removeChild(0).dispose(),e.dispose(),this._root.addChild(ne(t,t.orthogonalSize,t.size),$.Distribute,0)}else this._root.addChild(e,$.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(e=>{this._onDidChange.fire(e)})}next(e){return this.progmaticSelect(e)}previous(e){return this.progmaticSelect(e,!0)}getView(e){const t=e?this.getNode(e)[1]:this.root;return this._getViews(t,this.orientation)}_getViews(e,t,n){const i={height:e.height,width:e.width};if(e instanceof J)return{box:i,view:e.view,cachedVisibleSize:n};const r=[];for(let o=0;o<e.children.length;o++){const n=e.children[o],i=e.getChildCachedVisibleSize(o);r.push(this._getViews(n,oe(t),i))}return{box:i,children:r}}progmaticSelect(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,i]=this.getNode(e);if(!(i instanceof J))throw new Error("invalid location");for(let r=n.length-1;r>-1;r--){const i=n[r],o=e[r]||0;if(t?o-1>-1:o+1<i.children.length)return ee(i.children[t?o-1:o+1],t)}return ee(this.root,t)}constructor(e,t,n,i,r){this.proportionalLayout=e,this.styles=t,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new w,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new y,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new y,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="dv-grid-view",this._locked=null!==i&&void 0!==i&&i,this._margin=null!==r&&void 0!==r?r:0,this.root=new Q(n,e,t,0,0,this.locked,this.margin)}isViewVisible(e){const[t,n]=O(e),[,i]=this.getNode(t);if(!(i instanceof Q))throw new Error("Invalid from location");return i.isChildVisible(n)}setViewVisible(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[n,i]=O(e),[,r]=this.getNode(n);if(!(r instanceof Q))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),r.setChildVisible(i,t)}moveView(e,t,n){this.hasMaximizedView()&&this.exitMaximizedView();const[,i]=this.getNode(e);if(!(i instanceof Q))throw new Error("Invalid location");i.moveChild(t,n)}addView(e,t,n){this.hasMaximizedView()&&this.exitMaximizedView();const[i,r]=O(n),[o,s]=this.getNode(i);if(s instanceof Q){const n=new J(e,oe(s.orientation),s.orthogonalSize);s.addChild(n,t,r)}else{const[n,...a]=[...o].reverse(),[l,...c]=[...i].reverse();let u=0;const d=n.getChildCachedVisibleSize(l);"number"===typeof d&&(u=$.Invisible(d));n.removeChild(l).dispose();const h=new Q(s.orientation,this.proportionalLayout,this.styles,s.size,s.orthogonalSize,this.locked,this.margin);n.addChild(h,s.size,l);const p=new J(s.view,n.orientation,s.size);h.addChild(p,u,0),"number"!==typeof t&&"split"===t.type&&(t={type:"split",index:0});const f=new J(e,n.orientation,s.size);h.addChild(f,t,r)}}remove(e,t){const n=ie(e.element);return this.removeView(n,t)}removeView(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[n,i]=O(e),[r,o]=this.getNode(n);if(!(o instanceof Q))throw new Error("Invalid location");const s=o.children[i];if(!(s instanceof J))throw new Error("Invalid location");if(o.removeChild(i,t),s.dispose(),1!==o.children.length)return s.view;const a=o.children[0];if(0===r.length)return a instanceof J||(o.removeChild(0,t),this.root=a),s.view;const[l,...c]=[...r].reverse(),[u,...d]=[...n].reverse(),h=o.isChildVisible(0);o.removeChild(0,t);const p=l.children.map((e,t)=>l.getChildSize(t));if(l.removeChild(u,t).dispose(),a instanceof Q){p.splice(u,1,...a.children.map(e=>e.size));for(let e=0;e<a.children.length;e++){const t=a.children[e];l.addChild(t,t.size,u+e)}for(;a.children.length>0;)a.removeChild(0)}else{const e=new J(a.view,oe(a.orientation),a.size),t=h?a.orthogonalSize:$.Invisible(a.orthogonalSize);l.addChild(e,t,u)}a.dispose();for(let f=0;f<p.length;f++)l.resizeChild(f,p[f]);return s.view}layout(e,t){const[n,i]=this.root.orientation===W.HORIZONTAL?[t,e]:[e,t];this.root.layout(n,i)}getNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(0===e.length)return[n,t];if(!(t instanceof Q))throw new Error("Invalid location");const[i,...r]=e;if(i<0||i>=t.children.length)throw new Error("Invalid location");const o=t.children[i];return n.push(t),this.getNode(r,o,n)}}const le=(()=>{const e={disableAutoResizing:void 0,proportionalLayout:void 0,orientation:void 0,hideBorders:void 0,className:void 0};return Object.keys(e)})();class ce extends _{get element(){return this._element}get disableResizing(){return this._disableResizing}set disableResizing(e){this._disableResizing=e}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this._disableResizing=t,this._element=e,this.addDisposables(M(this._element,e=>{if(this.isDisposed)return;if(this.disableResizing)return;if(!this._element.offsetParent)return;if(!function(e){let t=e;for(;null===t||void 0===t?void 0:t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof DocumentFragment?t.parentNode.host:t.parentNode}return!1}(this._element))return;const{width:t,height:n}=e.contentRect;this.layout(t,n)}))}}const ue=V();function de(e){switch(e){case"left":return"left";case"right":return"right";case"above":return"top";case"below":return"bottom";default:return"center"}}class he extends ce{get id(){return this._id}get size(){return this._groups.size}get groups(){return Array.from(this._groups.values()).map(e=>e.value)}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumHeight(){return this.gridview.minimumHeight}get maximumHeight(){return this.gridview.maximumHeight}get minimumWidth(){return this.gridview.minimumWidth}get maximumWidth(){return this.gridview.maximumWidth}get activeGroup(){return this._activeGroup}get locked(){return this.gridview.locked}set locked(e){this.gridview.locked=e}constructor(e,t){var n;super(document.createElement("div"),t.disableAutoResizing),this._id=ue.next(),this._groups=new Map,this._onDidRemove=new y,this.onDidRemove=this._onDidRemove.event,this._onDidAdd=new y,this.onDidAdd=this._onDidAdd.event,this._onDidMaximizedChange=new y,this.onDidMaximizedChange=this._onDidMaximizedChange.event,this._onDidActiveChange=new y,this.onDidActiveChange=this._onDidActiveChange.event,this._bufferOnDidLayoutChange=new x,this.onDidLayoutChange=this._bufferOnDidLayoutChange.onEvent,this._onDidViewVisibilityChangeMicroTaskQueue=new x,this.onDidViewVisibilityChangeMicroTaskQueue=this._onDidViewVisibilityChangeMicroTaskQueue.onEvent,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new L(this.element),this._classNames.setClassNames(null!==(n=t.className)&&void 0!==n?n:""),e.appendChild(this.element),this.gridview=new ae(!!t.proportionalLayout,t.styles,t.orientation,t.locked,t.margin),this.gridview.locked=!!t.locked,this.element.appendChild(this.gridview.element),this.layout(0,0,!0),this.addDisposables(this.gridview.onDidMaximizedNodeChange(e=>{this._onDidMaximizedChange.fire({panel:e.view,isMaximized:e.isMaximized})}),this.gridview.onDidViewVisibilityChange(()=>this._onDidViewVisibilityChangeMicroTaskQueue.fire()),this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.layout(this.width,this.height,!0)}),p.from(()=>{var e;null===(e=this.element.parentElement)||void 0===e||e.removeChild(this.element)}),this.gridview.onDidChange(()=>{this._bufferOnDidLayoutChange.fire()}),h.any(this.onDidAdd,this.onDidRemove,this.onDidActiveChange)(()=>{this._bufferOnDidLayoutChange.fire()}),this._onDidMaximizedChange,this._onDidViewVisibilityChangeMicroTaskQueue,this._bufferOnDidLayoutChange)}setVisible(e,t){this.gridview.setViewVisible(ie(e.element),t),this._bufferOnDidLayoutChange.fire()}isVisible(e){return this.gridview.isViewVisible(ie(e.element))}updateOptions(e){var t,n,i,r;e.proportionalLayout,e.orientation&&(this.gridview.orientation=e.orientation),"disableResizing"in e&&(this.disableResizing=null!==(t=e.disableAutoResizing)&&void 0!==t&&t),"locked"in e&&(this.locked=null!==(n=e.locked)&&void 0!==n&&n),"margin"in e&&(this.gridview.margin=null!==(i=e.margin)&&void 0!==i?i:0),"className"in e&&this._classNames.setClassNames(null!==(r=e.className)&&void 0!==r?r:"")}maximizeGroup(e){this.gridview.maximizeView(e),this.doSetGroupActive(e)}isMaximizedGroup(e){return this.gridview.maximizedView()===e}exitMaximizedGroup(){this.gridview.exitMaximizedView()}hasMaximizedGroup(){return this.gridview.hasMaximizedView()}doAddGroup(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0],n=arguments.length>2?arguments[2]:void 0;this.gridview.addView(e,null!==n&&void 0!==n?n:$.Distribute,t),this._onDidAdd.fire(e)}doRemoveGroup(e,t){if(!this._groups.has(e.id))throw new Error("invalid operation");const n=this._groups.get(e.id),i=this.gridview.remove(e,$.Distribute);if(n&&!(null===t||void 0===t?void 0:t.skipDispose)&&(n.disposable.dispose(),n.value.dispose(),this._groups.delete(e.id),this._onDidRemove.fire(e)),!(null===t||void 0===t?void 0:t.skipActive)&&this._activeGroup===e){const e=Array.from(this._groups.values());this.doSetGroupActive(e.length>0?e[0].value:void 0)}return i}getPanel(e){var t;return null===(t=this._groups.get(e))||void 0===t?void 0:t.value}doSetGroupActive(e){this._activeGroup!==e&&(this._activeGroup&&this._activeGroup.setActive(!1),e&&e.setActive(!0),this._activeGroup=e,this._onDidActiveChange.fire(e))}removeGroup(e){this.doRemoveGroup(e)}moveToNext(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const n=ie(e.group.element),i=null===(t=this.gridview.next(n))||void 0===t?void 0:t.view;this.doSetGroupActive(i)}moveToPrevious(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const n=ie(e.group.element),i=null===(t=this.gridview.previous(n))||void 0===t?void 0:t.view;this.doSetGroupActive(i)}layout(e,t,n){(n||e!==this.width||t!==this.height)&&(this.gridview.element.style.height=`${t}px`,this.gridview.element.style.width=`${e}px`,this.gridview.layout(e,t))}dispose(){this._onDidActiveChange.dispose(),this._onDidAdd.dispose(),this._onDidRemove.dispose();for(const e of this.groups)e.dispose();this.gridview.dispose(),super.dispose()}}class pe{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get length(){return this.component.length}get orientation(){return this.component.orientation}get panels(){return this.component.panels}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}constructor(e){this.component=e}removePanel(e,t){this.component.removePanel(e,t)}focus(){this.component.focus()}getPanel(e){return this.component.getPanel(e)}layout(e,t){return this.component.layout(e,t)}addPanel(e){return this.component.addPanel(e)}movePanel(e,t){this.component.movePanel(e,t)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class fe{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get panels(){return this.component.panels}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}get onDidDrop(){return this.component.onDidDrop}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}constructor(e){this.component=e}removePanel(e){this.component.removePanel(e)}getPanel(e){return this.component.getPanel(e)}movePanel(e,t){this.component.movePanel(e,t)}focus(){this.component.focus()}layout(e,t){this.component.layout(e,t)}addPanel(e){return this.component.addPanel(e)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class me{get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddPanel(){return this.component.onDidAddGroup}get onDidRemovePanel(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActiveGroupChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get panels(){return this.component.groups}get orientation(){return this.component.orientation}set orientation(e){this.component.updateOptions({orientation:e})}constructor(e){this.component=e}focus(){this.component.focus()}layout(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.component.layout(e,t,n)}addPanel(e){return this.component.addPanel(e)}removePanel(e,t){this.component.removePanel(e,t)}movePanel(e,t){this.component.movePanel(e,t)}getPanel(e){return this.component.getPanel(e)}fromJSON(e){return this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class ge{get id(){return this.component.id}get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get size(){return this.component.size}get totalPanels(){return this.component.totalPanels}get onDidActiveGroupChange(){return this.component.onDidActiveGroupChange}get onDidAddGroup(){return this.component.onDidAddGroup}get onDidRemoveGroup(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActivePanelChange}get onDidAddPanel(){return this.component.onDidAddPanel}get onDidRemovePanel(){return this.component.onDidRemovePanel}get onDidMovePanel(){return this.component.onDidMovePanel}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidDrop(){return this.component.onDidDrop}get onWillDrop(){return this.component.onWillDrop}get onWillShowOverlay(){return this.component.onWillShowOverlay}get onWillDragGroup(){return this.component.onWillDragGroup}get onWillDragPanel(){return this.component.onWillDragPanel}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}get onDidPopoutGroupSizeChange(){return this.component.onDidPopoutGroupSizeChange}get onDidPopoutGroupPositionChange(){return this.component.onDidPopoutGroupPositionChange}get onDidOpenPopoutWindowFail(){return this.component.onDidOpenPopoutWindowFail}get panels(){return this.component.panels}get groups(){return this.component.groups}get activePanel(){return this.component.activePanel}get activeGroup(){return this.component.activeGroup}constructor(e){this.component=e}focus(){this.component.focus()}getPanel(e){return this.component.getGroupPanel(e)}layout(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.component.layout(e,t,n)}addPanel(e){return this.component.addPanel(e)}removePanel(e){this.component.removePanel(e)}addGroup(e){return this.component.addGroup(e)}closeAllGroups(){return this.component.closeAllGroups()}removeGroup(e){this.component.removeGroup(e)}getGroup(e){return this.component.getPanel(e)}addFloatingGroup(e,t){return this.component.addFloatingGroup(e,t)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}moveToNext(e){this.component.moveToNext(e)}moveToPrevious(e){this.component.moveToPrevious(e)}maximizeGroup(e){this.component.maximizeGroup(e.group)}hasMaximizedGroup(){return this.component.hasMaximizedGroup()}exitMaximizedGroup(){this.component.exitMaximizedGroup()}get onDidMaximizedGroupChange(){return this.component.onDidMaximizedGroupChange}addPopoutGroup(e,t){return this.component.addPopoutGroup(e,t)}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class ve extends _{constructor(e,t){super(),this.el=e,this.disabled=t,this.dataDisposable=new w,this.pointerEventsDisposable=new w,this._onDragStart=new y,this.onDragStart=this._onDragStart.event,this.addDisposables(this._onDragStart,this.dataDisposable,this.pointerEventsDisposable),this.configure()}setDisabled(e){this.disabled=e}isCancelled(e){return!1}configure(){this.addDisposables(this._onDragStart,b(this.el,"dragstart",e=>{if(e.defaultPrevented||this.isCancelled(e)||this.disabled)return void e.preventDefault();const t=I();if(this.pointerEventsDisposable.value={dispose:()=>{t.release()}},this.el.classList.add("dv-dragged"),setTimeout(()=>this.el.classList.remove("dv-dragged"),0),this.dataDisposable.value=this.getData(e),this._onDragStart.fire(e),e.dataTransfer){e.dataTransfer.effectAllowed="move";e.dataTransfer.items.length>0||e.dataTransfer.setData("text/plain","")}}),b(this.el,"dragend",()=>{this.pointerEventsDisposable.dispose(),setTimeout(()=>{this.dataDisposable.dispose()},0)}))}}class ye extends _{constructor(e,t){super(),this.element=e,this.callbacks=t,this.target=null,this.registerListeners()}onDragEnter(e){this.target=e.target,this.callbacks.onDragEnter(e)}onDragOver(e){e.preventDefault(),this.callbacks.onDragOver&&this.callbacks.onDragOver(e)}onDragLeave(e){this.target===e.target&&(this.target=null,this.callbacks.onDragLeave(e))}onDragEnd(e){this.target=null,this.callbacks.onDragEnd(e)}onDrop(e){this.callbacks.onDrop(e)}registerListeners(){this.addDisposables(b(this.element,"dragenter",e=>{this.onDragEnter(e)},!0)),this.addDisposables(b(this.element,"dragover",e=>{this.onDragOver(e)},!0)),this.addDisposables(b(this.element,"dragleave",e=>{this.onDragLeave(e)})),this.addDisposables(b(this.element,"dragend",e=>{this.onDragEnd(e)})),this.addDisposables(b(this.element,"drop",e=>{this.onDrop(e)}))}}class be extends f{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}constructor(e){super(),this.options=e}}function xe(e){switch(e){case"above":return"top";case"below":return"bottom";case"left":return"left";case"right":return"right";case"within":return"center";default:throw new Error(`invalid direction '${e}'`)}}function _e(e){switch(e){case"top":return"above";case"bottom":return"below";case"left":return"left";case"right":return"right";case"center":return"within";default:throw new Error(`invalid position '${e}'`)}}const we={value:20,type:"percentage"},Se={value:50,type:"percentage"};class Me extends _{get disabled(){return this._disabled}set disabled(e){this._disabled=e}get state(){return this._state}constructor(e,t){super(),this.element=e,this.options=t,this._onDrop=new y,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new y,this.onWillShowOverlay=this._onWillShowOverlay.event,this._disabled=!1,this._acceptedTargetZonesSet=new Set(this.options.acceptedTargetZones),this.dnd=new ye(this.element,{onDragEnter:()=>{var e,t,n;null===(n=null===(t=(e=this.options).getOverrideTarget)||void 0===t?void 0:t.call(e))||void 0===n||n.getElements()},onDragOver:e=>{var t,n,i,r,o,s,a;Me.ACTUAL_TARGET=this;const l=null===(n=(t=this.options).getOverrideTarget)||void 0===n?void 0:n.call(t);if(0===this._acceptedTargetZonesSet.size){if(l)return;return void this.removeDropTarget()}const c=null!==(o=null===(r=(i=this.options).getOverlayOutline)||void 0===r?void 0:r.call(i))&&void 0!==o?o:this.element,u=c.offsetWidth,d=c.offsetHeight;if(0===u||0===d)return;const h=e.currentTarget.getBoundingClientRect(),p=(null!==(s=e.clientX)&&void 0!==s?s:0)-h.left,f=(null!==(a=e.clientY)&&void 0!==a?a:0)-h.top,m=this.calculateQuadrant(this._acceptedTargetZonesSet,p,f,u,d);if(this.isAlreadyUsed(e)||null===m)return void this.removeDropTarget();if(!this.options.canDisplayOverlay(e,m)){if(l)return;return void this.removeDropTarget()}const g=new be({nativeEvent:e,position:m});this._onWillShowOverlay.fire(g),g.defaultPrevented?this.removeDropTarget():(this.markAsUsed(e),l||this.targetElement||(this.targetElement=document.createElement("div"),this.targetElement.className="dv-drop-target-dropzone",this.overlayElement=document.createElement("div"),this.overlayElement.className="dv-drop-target-selection",this._state="center",this.targetElement.appendChild(this.overlayElement),c.classList.add("dv-drop-target"),c.append(this.targetElement)),this.toggleClasses(m,u,d),this._state=m)},onDragLeave:()=>{var e,t;(null===(t=(e=this.options).getOverrideTarget)||void 0===t?void 0:t.call(e))||this.removeDropTarget()},onDragEnd:e=>{var t,n;const i=null===(n=(t=this.options).getOverrideTarget)||void 0===n?void 0:n.call(t);i&&Me.ACTUAL_TARGET===this&&this._state&&(e.stopPropagation(),this._onDrop.fire({position:this._state,nativeEvent:e})),this.removeDropTarget(),null===i||void 0===i||i.clear()},onDrop:e=>{var t,n,i;e.preventDefault();const r=this._state;this.removeDropTarget(),null===(i=null===(n=(t=this.options).getOverrideTarget)||void 0===n?void 0:n.call(t))||void 0===i||i.clear(),r&&(e.stopPropagation(),this._onDrop.fire({position:r,nativeEvent:e}))}}),this.addDisposables(this._onDrop,this._onWillShowOverlay,this.dnd)}setTargetZones(e){this._acceptedTargetZonesSet=new Set(e)}setOverlayModel(e){this.options.overlayModel=e}dispose(){this.removeDropTarget(),super.dispose()}markAsUsed(e){e[Me.USED_EVENT_ID]=!0}isAlreadyUsed(e){const t=e[Me.USED_EVENT_ID];return"boolean"===typeof t&&t}toggleClasses(e,t,n){var i,r,o,s,a,l,c;const u=null===(r=(i=this.options).getOverrideTarget)||void 0===r?void 0:r.call(i);if(!u&&!this.overlayElement)return;const d=t<100,h=n<100,p="left"===e,f="right"===e,m="top"===e,g="bottom"===e,v=!d&&f,y=!d&&p,b=!h&&m,x=!h&&g;let _=1;const w=null!==(s=null===(o=this.options.overlayModel)||void 0===o?void 0:o.size)&&void 0!==s?s:Se;if("percentage"===w.type?_=B(w.value,0,100)/100:((v||y)&&(_=B(0,w.value,t)/t),(b||x)&&(_=B(0,w.value,n)/n)),u){const i=null!==(c=null===(l=(a=this.options).getOverlayOutline)||void 0===l?void 0:l.call(a))&&void 0!==c?c:this.element,r=i.getBoundingClientRect(),o=u.getElements(void 0,i),s=o.root,h=o.overlay,w=s.getBoundingClientRect(),S=r.top-w.top,M=r.left-w.left,E={top:S,left:M,width:t,height:n};if(v?(E.left=M+t*(1-_),E.width=t*_):y?E.width=t*_:b?E.height=n*_:x&&(E.top=S+n*(1-_),E.height=n*_),d&&p&&(E.width=4),d&&f&&(E.left=M+t-4,E.width=4),!function(e,t){const{top:n,left:i,width:r,height:o}=t,s=`${Math.round(n)}px`,a=`${Math.round(i)}px`,l=`${Math.round(r)}px`,c=`${Math.round(o)}px`;return e.style.top!==s||e.style.left!==a||e.style.width!==l||e.style.height!==c}(h,E))return;return function(e,t){const{top:n,left:i,width:r,height:o}=t,s=`${Math.round(n)}px`,a=`${Math.round(i)}px`,l=`${Math.round(r)}px`,c=`${Math.round(o)}px`;e.style.top=s,e.style.left=a,e.style.width=l,e.style.height=c,e.style.visibility="visible",e.style.transform&&""!==e.style.transform||(e.style.transform="translate3d(0, 0, 0)")}(h,E),h.className="dv-drop-target-anchor"+(this.options.className?` ${this.options.className}`:""),T(h,"dv-drop-target-left",p),T(h,"dv-drop-target-right",f),T(h,"dv-drop-target-top",m),T(h,"dv-drop-target-bottom",g),T(h,"dv-drop-target-center","center"===e),void(o.changed&&(T(h,"dv-drop-target-anchor-container-changed",!0),setTimeout(()=>{T(h,"dv-drop-target-anchor-container-changed",!1)},10)))}if(!this.overlayElement)return;const S={top:"0px",left:"0px",width:"100%",height:"100%"};v?(S.left=100*(1-_)+"%",S.width=100*_+"%"):y?S.width=100*_+"%":b?S.height=100*_+"%":x&&(S.top=100*(1-_)+"%",S.height=100*_+"%"),function(e,t){const{top:n,left:i,width:r,height:o}=t;e.style.top=n,e.style.left=i,e.style.width=r,e.style.height=o,e.style.visibility="visible",e.style.transform&&""!==e.style.transform||(e.style.transform="translate3d(0, 0, 0)")}(this.overlayElement,S),T(this.overlayElement,"dv-drop-target-small-vertical",h),T(this.overlayElement,"dv-drop-target-small-horizontal",d),T(this.overlayElement,"dv-drop-target-left",p),T(this.overlayElement,"dv-drop-target-right",f),T(this.overlayElement,"dv-drop-target-top",m),T(this.overlayElement,"dv-drop-target-bottom",g),T(this.overlayElement,"dv-drop-target-center","center"===e)}calculateQuadrant(e,t,n,i,r){var o,s;const a=null!==(s=null===(o=this.options.overlayModel)||void 0===o?void 0:o.activationSize)&&void 0!==s?s:we;return"percentage"===a.type?function(e,t,n,i,r,o){const s=100*t/i,a=100*n/r;if(e.has("left")&&s<o)return"left";if(e.has("right")&&s>100-o)return"right";if(e.has("top")&&a<o)return"top";if(e.has("bottom")&&a>100-o)return"bottom";if(!e.has("center"))return null;return"center"}(e,t,n,i,r,a.value):function(e,t,n,i,r,o){if(e.has("left")&&t<o)return"left";if(e.has("right")&&t>i-o)return"right";if(e.has("top")&&n<o)return"top";if(e.has("bottom")&&n>r-o)return"bottom";if(!e.has("center"))return null;return"center"}(e,t,n,i,r,a.value)}removeDropTarget(){var e;this.targetElement&&(this._state=void 0,null===(e=this.targetElement.parentElement)||void 0===e||e.classList.remove("dv-drop-target"),this.targetElement.remove(),this.targetElement=void 0,this.overlayElement=void 0)}}Me.USED_EVENT_ID="__dockview_droptarget_event_is_used__";const Ee=(()=>{const e={disableAutoResizing:void 0,disableDnd:void 0,className:void 0};return Object.keys(e)})();class Ce extends m{constructor(e,t,n,i){super(),this.nativeEvent=e,this.position=t,this.getData=n,this.panel=i}}class Te extends f{constructor(){super()}}class Ae extends _{get isFocused(){return this._isFocused}get isActive(){return this._isActive}get isVisible(){return this._isVisible}get width(){return this._width}get height(){return this._height}constructor(e,t){super(),this.id=e,this.component=t,this._isFocused=!1,this._isActive=!1,this._isVisible=!0,this._width=0,this._height=0,this._parameters={},this.panelUpdatesDisposable=new w,this._onDidDimensionChange=new y,this.onDidDimensionsChange=this._onDidDimensionChange.event,this._onDidChangeFocus=new y,this.onDidFocusChange=this._onDidChangeFocus.event,this._onWillFocus=new y,this.onWillFocus=this._onWillFocus.event,this._onDidVisibilityChange=new y,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onWillVisibilityChange=new y,this.onWillVisibilityChange=this._onWillVisibilityChange.event,this._onDidActiveChange=new y,this.onDidActiveChange=this._onDidActiveChange.event,this._onActiveChange=new y,this.onActiveChange=this._onActiveChange.event,this._onDidParametersChange=new y,this.onDidParametersChange=this._onDidParametersChange.event,this.addDisposables(this.onDidFocusChange(e=>{this._isFocused=e.isFocused}),this.onDidActiveChange(e=>{this._isActive=e.isActive}),this.onDidVisibilityChange(e=>{this._isVisible=e.isVisible}),this.onDidDimensionsChange(e=>{this._width=e.width,this._height=e.height}),this.panelUpdatesDisposable,this._onDidDimensionChange,this._onDidChangeFocus,this._onDidVisibilityChange,this._onDidActiveChange,this._onWillFocus,this._onActiveChange,this._onWillFocus,this._onWillVisibilityChange,this._onDidParametersChange)}getParameters(){return this._parameters}initialize(e){this.panelUpdatesDisposable.value=this._onDidParametersChange.event(t=>{this._parameters=t,e.update({params:t})})}setVisible(e){this._onWillVisibilityChange.fire({isVisible:e})}setActive(){this._onActiveChange.fire()}updateParameters(e){this._onDidParametersChange.fire(e)}}class Pe extends Ae{constructor(e,t){super(e,t),this._onDidConstraintsChangeInternal=new y,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new y({replay:!0}),this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new y,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class De extends Pe{set pane(e){this._pane=e}constructor(e,t){super(e,t),this._onDidExpansionChange=new y({replay:!0}),this.onDidExpansionChange=this._onDidExpansionChange.event,this._onMouseEnter=new y({}),this.onMouseEnter=this._onMouseEnter.event,this._onMouseLeave=new y({}),this.onMouseLeave=this._onMouseLeave.event,this.addDisposables(this._onDidExpansionChange,this._onMouseEnter,this._onMouseLeave)}setExpanded(e){var t;null===(t=this._pane)||void 0===t||t.setExpanded(e)}get isExpanded(){var e;return!!(null===(e=this._pane)||void 0===e?void 0:e.isExpanded())}}class ke extends _{get element(){return this._element}get width(){return this._width}get height(){return this._height}get params(){var e;return null===(e=this._params)||void 0===e?void 0:e.params}constructor(e,t,n){super(),this.id=e,this.component=t,this.api=n,this._height=0,this._width=0,this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.style.outline="none",this._element.style.height="100%",this._element.style.width="100%",this._element.style.overflow="hidden";const i=P(this._element);this.addDisposables(this.api,i.onDidFocus(()=>{this.api._onDidChangeFocus.fire({isFocused:!0})}),i.onDidBlur(()=>{this.api._onDidChangeFocus.fire({isFocused:!1})}),i)}focus(){const e=new Te;this.api._onWillFocus.fire(e),e.defaultPrevented||this._element.focus()}layout(e,t){this._width=e,this._height=t,this.api._onDidDimensionChange.fire({width:e,height:t}),this.part&&this._params&&this.part.update(this._params.params)}init(e){this._params=e,this.part=this.getComponent()}update(e){var t,n;this._params=Object.assign(Object.assign({},this._params),{params:Object.assign(Object.assign({},null===(t=this._params)||void 0===t?void 0:t.params),e.params)});for(const i of Object.keys(e.params))void 0===e.params[i]&&delete this._params.params[i];null===(n=this.part)||void 0===n||n.update({params:this._params.params})}toJSON(){var e,t;const n=null!==(t=null===(e=this._params)||void 0===e?void 0:e.params)&&void 0!==t?t:{};return{id:this.id,component:this.component,params:Object.keys(n).length>0?n:void 0}}dispose(){var e;this.api.dispose(),null===(e=this.part)||void 0===e||e.dispose(),super.dispose()}}class Re extends ke{set orientation(e){this._orientation=e}get orientation(){return this._orientation}get minimumSize(){return this.headerSize+(this.isExpanded()?this._minimumBodySize:0)}get maximumSize(){return this.headerSize+(this.isExpanded()?this._maximumBodySize:0)}get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(e){this._minimumBodySize="number"===typeof e?e:0}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(e){this._maximumBodySize="number"===typeof e?e:Number.POSITIVE_INFINITY}get headerVisible(){return this._headerVisible}set headerVisible(e){this._headerVisible=e,this.header.style.display=e?"":"none"}constructor(e){super(e.id,e.component,new De(e.id,e.component)),this._onDidChangeExpansionState=new y({replay:!0}),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._orthogonalSize=0,this._size=0,this._isExpanded=!1,this.api.pane=this,this.api.initialize(this),this.headerSize=e.headerSize,this.headerComponent=e.headerComponent,this._minimumBodySize=e.minimumBodySize,this._maximumBodySize=e.maximumBodySize,this._isExpanded=e.isExpanded,this._headerVisible=e.isHeaderVisible,this._onDidChangeExpansionState.fire(this.isExpanded()),this._orientation=e.orientation,this.element.classList.add("dv-pane"),this.addDisposables(this.api.onWillVisibilityChange(e=>{const{isVisible:t}=e,{accessor:n}=this._params;n.setVisible(this,t)}),this.api.onDidSizeChange(e=>{this._onDidChange.fire({size:e.size})}),b(this.element,"mouseenter",e=>{this.api._onMouseEnter.fire(e)}),b(this.element,"mouseleave",e=>{this.api._onMouseLeave.fire(e)})),this.addDisposables(this._onDidChangeExpansionState,this.onDidChangeExpansionState(e=>{this.api._onDidExpansionChange.fire({isExpanded:e})}),this.api.onDidFocusChange(e=>{this.header&&(e.isFocused?C(this.header,"focused"):E(this.header,"focused"))})),this.renderOnce()}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}isExpanded(){return this._isExpanded}setExpanded(e){this._isExpanded!==e&&(this._isExpanded=e,e?(this.animationTimer&&clearTimeout(this.animationTimer),this.body&&this.element.appendChild(this.body)):this.animationTimer=setTimeout(()=>{var e;null===(e=this.body)||void 0===e||e.remove()},200),this._onDidChange.fire(e?{size:this.width}:{}),this._onDidChangeExpansionState.fire(e))}layout(e,t){this._size=e,this._orthogonalSize=t;const[n,i]=this.orientation===W.HORIZONTAL?[e,t]:[t,e];super.layout(n,i)}init(e){var t,n;super.init(e),"number"===typeof e.minimumBodySize&&(this.minimumBodySize=e.minimumBodySize),"number"===typeof e.maximumBodySize&&(this.maximumBodySize=e.maximumBodySize),this.bodyPart=this.getBodyComponent(),this.headerPart=this.getHeaderComponent(),this.bodyPart.init(Object.assign(Object.assign({},e),{api:this.api})),this.headerPart.init(Object.assign(Object.assign({},e),{api:this.api})),null===(t=this.body)||void 0===t||t.append(this.bodyPart.element),null===(n=this.header)||void 0===n||n.append(this.headerPart.element),"boolean"===typeof e.isExpanded&&this.setExpanded(e.isExpanded)}toJSON(){const e=this._params;return Object.assign(Object.assign({},super.toJSON()),{headerComponent:this.headerComponent,title:e.title})}renderOnce(){this.header=document.createElement("div"),this.header.tabIndex=0,this.header.className="dv-pane-header",this.header.style.height=`${this.headerSize}px`,this.header.style.lineHeight=`${this.headerSize}px`,this.header.style.minHeight=`${this.headerSize}px`,this.header.style.maxHeight=`${this.headerSize}px`,this.element.appendChild(this.header),this.body=document.createElement("div"),this.body.className="dv-pane-body",this.element.appendChild(this.body)}getComponent(){return{update:e=>{var t,n;null===(t=this.bodyPart)||void 0===t||t.update({params:e}),null===(n=this.headerPart)||void 0===n||n.update({params:e})},dispose:()=>{var e,t;null===(e=this.bodyPart)||void 0===e||e.dispose(),null===(t=this.headerPart)||void 0===t||t.dispose()}}}}class Ne extends Re{constructor(e){super({id:e.id,component:e.component,headerComponent:e.headerComponent,orientation:e.orientation,isExpanded:e.isExpanded,isHeaderVisible:!0,headerSize:e.headerSize,minimumBodySize:e.minimumBodySize,maximumBodySize:e.maximumBodySize}),this._onDidDrop=new y,this.onDidDrop=this._onDidDrop.event,this._onUnhandledDragOverEvent=new y,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this.accessor=e.accessor,this.addDisposables(this._onDidDrop,this._onUnhandledDragOverEvent),e.disableDnd||this.initDragFeatures()}initDragFeatures(){if(!this.header)return;const e=this.id,t=this.accessor.id;this.header.draggable=!0,this.handler=new class extends ve{getData(){return c.getInstance().setData([new l(t,e)],l.prototype),{dispose:()=>{c.getInstance().clearData(l.prototype)}}}}(this.header),this.target=new Me(this.element,{acceptedTargetZones:["top","bottom"],overlayModel:{activationSize:{type:"percentage",value:50}},canDisplayOverlay:(e,t)=>{const n=d();if(n&&n.paneId!==this.id&&n.viewId===this.accessor.id)return!0;const i=new Ce(e,t,d,this);return this._onUnhandledDragOverEvent.fire(i),i.isAccepted}}),this.addDisposables(this._onDidDrop,this.handler,this.target,this.target.onDrop(e=>{this.onDrop(e)}))}onDrop(e){const t=d();if(!t||t.viewId!==this.accessor.id)return void this._onDidDrop.fire(Object.assign(Object.assign({},e),{panel:this,api:new fe(this.accessor),getData:d}));const n=this._params.containerApi,i=t.paneId,r=n.getPanel(i);if(!r)return void this._onDidDrop.fire(Object.assign(Object.assign({},e),{panel:this,getData:d,api:new fe(this.accessor)}));const o=n.panels,s=o.indexOf(r);let a=n.panels.indexOf(this);"left"!==e.position&&"top"!==e.position||(a=Math.max(0,a-1)),"right"!==e.position&&"bottom"!==e.position||(s>a&&a++,a=Math.min(o.length-1,a)),n.movePanel(s,a)}}class Ie extends _{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this.disposable=new w,this._onDidFocus=new y,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new y,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dv-content-container",this._element.tabIndex=-1,this.addDisposables(this._onDidFocus,this._onDidBlur);const n=t.dropTargetContainer;this.dropTarget=new Me(this.element,{getOverlayOutline:()=>{var t;return"group"===(null===(t=e.options.theme)||void 0===t?void 0:t.dndPanelOverlay)?this.element.parentElement:null},className:"dv-drop-target-content",acceptedTargetZones:["top","bottom","left","right","center"],canDisplayOverlay:(e,t)=>{if("no-drop-target"===this.group.locked||this.group.locked&&"center"===t)return!1;const n=u();return!(!n&&e.shiftKey&&"floating"!==this.group.location.type)&&(!(!n||n.viewId!==this.accessor.id)||this.group.canDisplayOverlay(e,t,"content"))},getOverrideTarget:n?()=>n.model:void 0}),this.addDisposables(this.dropTarget)}show(){this.element.style.display=""}hide(){this.element.style.display="none"}renderPanel(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{asActive:!0}).asActive||this.panel&&this.group.isPanelActive(this.panel);let n;switch(this.panel&&this.panel.view.content.element.parentElement===this._element&&this._element.removeChild(this.panel.view.content.element),this.panel=e,e.api.renderer){case"onlyWhenVisible":this.group.renderContainer.detatch(e),this.panel&&t&&this._element.appendChild(this.panel.view.content.element),n=this._element;break;case"always":e.view.content.element.parentElement===this._element&&this._element.removeChild(e.view.content.element),n=this.group.renderContainer.attach({panel:e,referenceContainer:this});break;default:throw new Error(`dockview: invalid renderer type '${e.api.renderer}'`)}if(t){const e=P(n),t=new _;t.addDisposables(e,e.onDidFocus(()=>this._onDidFocus.fire()),e.onDidBlur(()=>this._onDidBlur.fire())),this.disposable.value=t}}openPanel(e){this.panel!==e&&this.renderPanel(e)}layout(e,t){}closePanel(){var e;this.panel&&"onlyWhenVisible"===this.panel.api.renderer&&(null===(e=this.panel.view.content.element.parentElement)||void 0===e||e.removeChild(this.panel.view.content.element)),this.panel=void 0}dispose(){this.disposable.dispose(),super.dispose()}}function Le(e,t,n){var i,r;C(t,"dv-dragged"),t.style.top="-9999px",document.body.appendChild(t),e.setDragImage(t,null!==(i=null===n||void 0===n?void 0:n.x)&&void 0!==i?i:0,null!==(r=null===n||void 0===n?void 0:n.y)&&void 0!==r?r:0),setTimeout(()=>{E(t,"dv-dragged"),t.remove()},0)}class Oe extends ve{constructor(e,t,n,i,r){super(e,r),this.accessor=t,this.group=n,this.panel=i,this.panelTransfer=c.getInstance()}getData(e){return this.panelTransfer.setData([new a(this.accessor.id,this.group.id,this.panel.id)],a.prototype),{dispose:()=>{this.panelTransfer.clearData(a.prototype)}}}}class ze extends _{get element(){return this._element}constructor(e,t,n){super(),this.panel=e,this.accessor=t,this.group=n,this.content=void 0,this._onPointDown=new y,this.onPointerDown=this._onPointDown.event,this._onDropped=new y,this.onDrop=this._onDropped.event,this._onDragStart=new y,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-tab",this._element.tabIndex=0,this._element.draggable=!this.accessor.options.disableDnd,T(this.element,"dv-inactive-tab",!0),this.dragHandler=new Oe(this._element,this.accessor,this.group,this.panel,!!this.accessor.options.disableDnd),this.dropTarget=new Me(this._element,{acceptedTargetZones:["left","right"],overlayModel:{activationSize:{value:50,type:"percentage"}},canDisplayOverlay:(e,t)=>{if(this.group.locked)return!1;const n=u();return!(!n||this.accessor.id!==n.viewId)||this.group.model.canDisplayOverlay(e,t,"tab")},getOverrideTarget:()=>{var e;return null===(e=n.model.dropTargetContainer)||void 0===e?void 0:e.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this._onPointDown,this._onDropped,this._onDragStart,this.dragHandler.onDragStart(e=>{if(e.dataTransfer){const t=getComputedStyle(this.element),n=this.element.cloneNode(!0);Array.from(t).forEach(e=>n.style.setProperty(e,t.getPropertyValue(e),t.getPropertyPriority(e))),n.style.position="absolute",Le(e.dataTransfer,n,{y:-10,x:30})}this._onDragStart.fire(e)}),this.dragHandler,b(this._element,"pointerdown",e=>{this._onPointDown.fire(e)}),this.dropTarget.onDrop(e=>{this._onDropped.fire(e)}),this.dropTarget)}setActive(e){T(this.element,"dv-active-tab",e),T(this.element,"dv-inactive-tab",!e)}setContent(e){this.content&&this._element.removeChild(this.content.element),this.content=e,this._element.appendChild(this.content.element)}updateDragAndDropState(){this._element.draggable=!this.accessor.options.disableDnd,this.dragHandler.setDisabled(!!this.accessor.options.disableDnd)}dispose(){super.dispose()}}class Ue{get kind(){return this.options.kind}get nativeEvent(){return this.event.nativeEvent}get position(){return this.event.position}get defaultPrevented(){return this.event.defaultPrevented}get panel(){return this.options.panel}get api(){return this.options.api}get group(){return this.options.group}preventDefault(){this.event.preventDefault()}getData(){return this.options.getData()}constructor(e,t){this.event=e,this.options=t}}class Fe extends ve{constructor(e,t,n,i){super(e,i),this.accessor=t,this.group=n,this.panelTransfer=c.getInstance(),this.addDisposables(b(e,"pointerdown",e=>{e.shiftKey&&(e[k]=!0)},!0))}isCancelled(e){return"floating"===this.group.api.location.type&&!e.shiftKey}getData(e){const t=e.dataTransfer;this.panelTransfer.setData([new a(this.accessor.id,this.group.id,null)],a.prototype);const n=window.getComputedStyle(this.el),i=n.getPropertyValue("--dv-activegroup-visiblepanel-tab-background-color"),r=n.getPropertyValue("--dv-activegroup-visiblepanel-tab-color");if(t){const e=document.createElement("div");e.style.backgroundColor=i,e.style.color=r,e.style.padding="2px 8px",e.style.height="24px",e.style.fontSize="11px",e.style.lineHeight="20px",e.style.borderRadius="12px",e.style.position="absolute",e.style.pointerEvents="none",e.style.top="-9999px",e.textContent=`Multiple Panels (${this.group.size})`,Le(t,e,{y:-10,x:30})}return{dispose:()=>{this.panelTransfer.clearData(a.prototype)}}}}class je extends _{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._onDrop=new y,this.onDrop=this._onDrop.event,this._onDragStart=new y,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-void-container",this._element.draggable=!this.accessor.options.disableDnd,T(this._element,"dv-draggable",!this.accessor.options.disableDnd),this.addDisposables(this._onDrop,this._onDragStart,b(this._element,"pointerdown",()=>{this.accessor.doSetGroupActive(this.group)})),this.handler=new Fe(this._element,e,t,!!this.accessor.options.disableDnd),this.dropTarget=new Me(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(e,n)=>{const i=u();return!(!i||this.accessor.id!==i.viewId)||t.model.canDisplayOverlay(e,n,"header_space")},getOverrideTarget:()=>{var e;return null===(e=t.model.dropTargetContainer)||void 0===e?void 0:e.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this.handler,this.handler.onDragStart(e=>{this._onDragStart.fire(e)}),this.dropTarget.onDrop(e=>{this._onDrop.fire(e)}),this.dropTarget)}updateDragAndDropState(){this._element.draggable=!this.accessor.options.disableDnd,T(this._element,"dv-draggable",!this.accessor.options.disableDnd),this.handler.setDisabled(!!this.accessor.options.disableDnd)}}class Be extends _{get element(){return this._element}constructor(e){super(),this.scrollableElement=e,this._scrollLeft=0,this._element=document.createElement("div"),this._element.className="dv-scrollable",this._horizontalScrollbar=document.createElement("div"),this._horizontalScrollbar.className="dv-scrollbar-horizontal",this.element.appendChild(e),this.element.appendChild(this._horizontalScrollbar),this.addDisposables(b(this.element,"wheel",e=>{this._scrollLeft+=e.deltaY*Be.MouseWheelSpeed,this.calculateScrollbarStyles()}),b(this._horizontalScrollbar,"pointerdown",e=>{e.preventDefault(),T(this.element,"dv-scrollable-scrolling",!0);const t=e.clientX,n=this._scrollLeft,i=e=>{const i=e.clientX-t,{clientWidth:r}=this.element,{scrollWidth:o}=this.scrollableElement,s=r/o;this._scrollLeft=n+i/s,this.calculateScrollbarStyles()},r=()=>{T(this.element,"dv-scrollable-scrolling",!1),document.removeEventListener("pointermove",i),document.removeEventListener("pointerup",r),document.removeEventListener("pointercancel",r)};document.addEventListener("pointermove",i),document.addEventListener("pointerup",r),document.addEventListener("pointercancel",r)}),b(this.element,"scroll",()=>{this.calculateScrollbarStyles()}),b(this.scrollableElement,"scroll",()=>{this._scrollLeft=this.scrollableElement.scrollLeft,this.calculateScrollbarStyles()}),M(this.element,()=>{T(this.element,"dv-scrollable-resizing",!0),this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(()=>{clearTimeout(this._animationTimer),T(this.element,"dv-scrollable-resizing",!1)},500),this.calculateScrollbarStyles()}))}calculateScrollbarStyles(){const{clientWidth:e}=this.element,{scrollWidth:t}=this.scrollableElement;if(t>e){const n=e*(e/t);this._horizontalScrollbar.style.width=`${n}px`,this._scrollLeft=B(this._scrollLeft,0,this.scrollableElement.scrollWidth-e),this.scrollableElement.scrollLeft=this._scrollLeft;const i=this._scrollLeft/(t-e);this._horizontalScrollbar.style.left=(e-n)*i+"px"}else this._horizontalScrollbar.style.width="0px",this._horizontalScrollbar.style.left="0px",this._scrollLeft=0}}Be.MouseWheelSpeed=1;class Ve extends _{get showTabsOverflowControl(){return this._showTabsOverflowControl}set showTabsOverflowControl(e){if(this._showTabsOverflowControl!=e&&(this._showTabsOverflowControl=e,e)){const e=new S(this._tabsList);this._observerDisposable.value=new _(e,e.onDidChange(e=>{const t=e.hasScrollX||e.hasScrollY;this.toggleDropdown({reset:!t})}),b(this._tabsList,"scroll",()=>{this.toggleDropdown({reset:!1})}))}}get element(){return this._element}get panels(){return this._tabs.map(e=>e.value.panel.id)}get size(){return this._tabs.length}get tabs(){return this._tabs.map(e=>e.value)}constructor(e,t,n){if(super(),this.group=e,this.accessor=t,this._observerDisposable=new w,this._tabs=[],this.selectedIndex=-1,this._showTabsOverflowControl=!1,this._onTabDragStart=new y,this.onTabDragStart=this._onTabDragStart.event,this._onDrop=new y,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new y,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onOverflowTabsChange=new y,this.onOverflowTabsChange=this._onOverflowTabsChange.event,this._tabsList=document.createElement("div"),this._tabsList.className="dv-tabs-container dv-horizontal",this.showTabsOverflowControl=n.showTabsOverflowControl,"native"===t.options.scrollbars)this._element=this._tabsList;else{const e=new Be(this._tabsList);this._element=e.element,this.addDisposables(e)}this.addDisposables(this._onOverflowTabsChange,this._observerDisposable,this._onWillShowOverlay,this._onDrop,this._onTabDragStart,b(this.element,"pointerdown",e=>{if(e.defaultPrevented)return;0===e.button&&this.accessor.doSetGroupActive(this.group)}),p.from(()=>{for(const{value:e,disposable:t}of this._tabs)t.dispose(),e.dispose();this._tabs=[]}))}indexOf(e){return this._tabs.findIndex(t=>t.value.panel.id===e)}isActive(e){return this.selectedIndex>-1&&this._tabs[this.selectedIndex].value===e}setActivePanel(e){let t=0;for(const n of this._tabs){const i=e.id===n.value.panel.id;if(n.value.setActive(i),i){const e=n.value.element,i=e.parentElement;(t<i.scrollLeft||t+e.clientWidth>i.scrollLeft+i.clientWidth)&&(i.scrollLeft=t)}t+=n.value.element.clientWidth}}openPanel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._tabs.length;if(this._tabs.find(t=>t.value.panel.id===e.id))return;const n=new ze(e,this.accessor,this.group);n.setContent(e.view.tab);const i=new _(n.onDragStart(t=>{this._onTabDragStart.fire({nativeEvent:t,panel:e})}),n.onPointerDown(t=>{if(t.defaultPrevented)return;const i=!this.accessor.options.disableFloatingGroups,r="floating"===this.group.api.location.type&&1===this.size;if(i&&!r&&t.shiftKey){t.preventDefault();const e=this.accessor.getGroupPanel(n.panel.id),{top:i,left:r}=n.element.getBoundingClientRect(),{top:o,left:s}=this.accessor.element.getBoundingClientRect();return void this.accessor.addFloatingGroup(e,{x:r-s,y:i-o,inDragMode:!0})}if(0===t.button)this.group.activePanel!==e&&this.group.model.openPanel(e)}),n.onDrop(e=>{this._onDrop.fire({event:e.nativeEvent,index:this._tabs.findIndex(e=>e.value===n)})}),n.onWillShowOverlay(e=>{this._onWillShowOverlay.fire(new Ue(e,{kind:"tab",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:u}))})),r={value:n,disposable:i};this.addTab(r,t)}delete(e){const t=this.indexOf(e),n=this._tabs.splice(t,1)[0],{value:i,disposable:r}=n;r.dispose(),i.dispose(),i.element.remove()}addTab(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._tabs.length;if(t<0||t>this._tabs.length)throw new Error("invalid location");this._tabsList.insertBefore(e.value.element,this._tabsList.children[t]),this._tabs=[...this._tabs.slice(0,t),e,...this._tabs.slice(t)],this.selectedIndex<0&&(this.selectedIndex=t)}toggleDropdown(e){const t=e.reset?[]:this._tabs.filter(e=>!function(e,t){const n=N(e),i=N(t);return!(n.left<i.left)&&!(n.left+n.width>i.left+i.width)}(e.value.element,this._tabsList)).map(e=>e.value.panel.id);this._onOverflowTabsChange.fire({tabs:t,reset:e.reset})}updateDragAndDropState(){for(const e of this._tabs)e.value.updateDragAndDropState()}}const He=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS(null,"height",e.height),t.setAttributeNS(null,"width",e.width),t.setAttributeNS(null,"viewBox",e.viewbox),t.setAttributeNS(null,"aria-hidden","false"),t.setAttributeNS(null,"focusable","false"),t.classList.add("dv-svg");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttributeNS(null,"d",e.path),t.appendChild(n),t},Ge=()=>He({width:"11",height:"11",viewbox:"0 0 15 25",path:"M2.15 24.1L0 21.95L9.9 12.05L0 2.15L2.15 0L14.2 12.05L2.15 24.1Z"});class We extends _{get onTabDragStart(){return this.tabs.onTabDragStart}get panels(){return this.tabs.panels}get size(){return this.tabs.size}get hidden(){return this._hidden}set hidden(e){this._hidden=e,this.element.style.display=e?"none":""}get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._hidden=!1,this.dropdownPart=null,this._overflowTabs=[],this._dropdownDisposable=new w,this._onDrop=new y,this.onDrop=this._onDrop.event,this._onGroupDragStart=new y,this.onGroupDragStart=this._onGroupDragStart.event,this._onWillShowOverlay=new y,this.onWillShowOverlay=this._onWillShowOverlay.event,this._element=document.createElement("div"),this._element.className="dv-tabs-and-actions-container",T(this._element,"dv-full-width-single-tab","fullwidth"===this.accessor.options.singleTabMode),this.rightActionsContainer=document.createElement("div"),this.rightActionsContainer.className="dv-right-actions-container",this.leftActionsContainer=document.createElement("div"),this.leftActionsContainer.className="dv-left-actions-container",this.preActionsContainer=document.createElement("div"),this.preActionsContainer.className="dv-pre-actions-container",this.tabs=new Ve(t,e,{showTabsOverflowControl:!e.options.disableTabsOverflowList}),this.voidContainer=new je(this.accessor,this.group),this._element.appendChild(this.preActionsContainer),this._element.appendChild(this.tabs.element),this._element.appendChild(this.leftActionsContainer),this._element.appendChild(this.voidContainer.element),this._element.appendChild(this.rightActionsContainer),this.addDisposables(this.tabs.onDrop(e=>this._onDrop.fire(e)),this.tabs.onWillShowOverlay(e=>this._onWillShowOverlay.fire(e)),e.onDidOptionsChange(()=>{this.tabs.showTabsOverflowControl=!e.options.disableTabsOverflowList}),this.tabs.onOverflowTabsChange(e=>{this.toggleDropdown(e)}),this.tabs,this._onWillShowOverlay,this._onDrop,this._onGroupDragStart,this.voidContainer,this.voidContainer.onDragStart(e=>{this._onGroupDragStart.fire({nativeEvent:e,group:this.group})}),this.voidContainer.onDrop(e=>{this._onDrop.fire({event:e.nativeEvent,index:this.tabs.size})}),this.voidContainer.onWillShowOverlay(e=>{this._onWillShowOverlay.fire(new Ue(e,{kind:"header_space",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:u}))}),b(this.voidContainer.element,"pointerdown",e=>{if(e.defaultPrevented)return;if(!this.accessor.options.disableFloatingGroups&&e.shiftKey&&"floating"!==this.group.api.location.type){e.preventDefault();const{top:t,left:n}=this.element.getBoundingClientRect(),{top:i,left:r}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(this.group,{x:n-r+20,y:t-i+20,inDragMode:!0})}}))}show(){this.hidden||(this.element.style.display="")}hide(){this._element.style.display="none"}setRightActionsElement(e){this.rightActions!==e&&(this.rightActions&&(this.rightActions.remove(),this.rightActions=void 0),e&&(this.rightActionsContainer.appendChild(e),this.rightActions=e))}setLeftActionsElement(e){this.leftActions!==e&&(this.leftActions&&(this.leftActions.remove(),this.leftActions=void 0),e&&(this.leftActionsContainer.appendChild(e),this.leftActions=e))}setPrefixActionsElement(e){this.preActions!==e&&(this.preActions&&(this.preActions.remove(),this.preActions=void 0),e&&(this.preActionsContainer.appendChild(e),this.preActions=e))}isActive(e){return this.tabs.isActive(e)}indexOf(e){return this.tabs.indexOf(e)}setActive(e){}delete(e){this.tabs.delete(e),this.updateClassnames()}setActivePanel(e){this.tabs.setActivePanel(e)}openPanel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tabs.size;this.tabs.openPanel(e,t),this.updateClassnames()}closePanel(e){this.delete(e.id)}updateClassnames(){T(this._element,"dv-single-tab",1===this.size)}toggleDropdown(e){const t=e.reset?[]:e.tabs;if(this._overflowTabs=t,this._overflowTabs.length>0&&this.dropdownPart)return void this.dropdownPart.update({tabs:t.length});if(0===this._overflowTabs.length)return void this._dropdownDisposable.dispose();const n=document.createElement("div");n.className="dv-tabs-overflow-dropdown-root";const i=function(){const e=document.createElement("div");e.className="dv-tabs-overflow-dropdown-default";const t=document.createElement("span");t.textContent="";const n=Ge();return e.appendChild(n),e.appendChild(t),{element:e,update:e=>{t.textContent=`${e.tabs}`}}}();i.update({tabs:t.length}),this.dropdownPart=i,n.appendChild(i.element),this.rightActionsContainer.prepend(n),this._dropdownDisposable.value=new _(p.from(()=>{var e,t;n.remove(),null===(t=null===(e=this.dropdownPart)||void 0===e?void 0:e.dispose)||void 0===t||t.call(e),this.dropdownPart=null}),b(n,"pointerdown",e=>{e.preventDefault()},{capture:!0}),b(n,"click",e=>{const t=document.createElement("div");t.style.overflow="auto",t.className="dv-tabs-overflow-container";for(const n of this.tabs.tabs.filter(e=>this._overflowTabs.includes(e.panel.id))){const e=this.group.panels.find(e=>e===n.panel),i=e.view.createTabRenderer("headerOverflow").element,r=document.createElement("div");T(r,"dv-tab",!0),T(r,"dv-active-tab",e.api.isActive),T(r,"dv-inactive-tab",!e.api.isActive),r.addEventListener("click",e=>{this.accessor.popupService.close(),e.defaultPrevented||(n.element.scrollIntoView(),n.panel.api.setActive())}),r.appendChild(i),t.appendChild(r)}const i=function(e){let t=e;for(;t&&("auto"===t.style.zIndex||""===t.style.zIndex);)t=t.parentElement;return t}(n);this.accessor.popupService.openPopover(t,{x:e.clientX,y:e.clientY,zIndex:(null===i||void 0===i?void 0:i.style.zIndex)?`calc(${i.style.zIndex} * 2)`:void 0})}))}updateDragAndDropState(){this.tabs.updateDragAndDropState(),this.voidContainer.updateDragAndDropState()}}class Xe extends m{constructor(e,t,n,i,r){super(),this.nativeEvent=e,this.target=t,this.position=n,this.getData=i,this.group=r}}const Ye=(()=>{const e={disableAutoResizing:void 0,hideBorders:void 0,singleTabMode:void 0,disableFloatingGroups:void 0,floatingGroupBounds:void 0,popoutUrl:void 0,defaultRenderer:void 0,debug:void 0,rootOverlayModel:void 0,locked:void 0,disableDnd:void 0,className:void 0,noPanelsOverlay:void 0,dndEdges:void 0,theme:void 0,disableTabsOverflowList:void 0,scrollbars:void 0};return Object.keys(e)})();class $e extends f{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}get panel(){return this.options.panel}get group(){return this.options.group}get api(){return this.options.api}constructor(e){super(),this.options=e}getData(){return this.options.getData()}}class qe extends $e{get kind(){return this._kind}constructor(e){super(e),this._kind=e.kind}}class Ze extends _{get element(){throw new Error("dockview: not supported")}get activePanel(){return this._activePanel}get locked(){return this._locked}set locked(e){this._locked=e,T(this.container,"dv-locked-groupview","no-drop-target"===e||e)}get isActive(){return this._isGroupActive}get panels(){return this._panels}get size(){return this._panels.length}get isEmpty(){return 0===this._panels.length}get hasWatermark(){return!(!this.watermark||!this.container.contains(this.watermark.element))}get header(){return this.tabsContainer}get isContentFocused(){return!!document.activeElement&&A(document.activeElement,this.contentContainer.element)}get location(){return this._location}set location(e){switch(this._location=e,T(this.container,"dv-groupview-floating",!1),T(this.container,"dv-groupview-popout",!1),e.type){case"grid":this.contentContainer.dropTarget.setTargetZones(["top","bottom","left","right","center"]);break;case"floating":this.contentContainer.dropTarget.setTargetZones(["center"]),this.contentContainer.dropTarget.setTargetZones(e?["center"]:["top","bottom","left","right","center"]),T(this.container,"dv-groupview-floating",!0);break;case"popout":this.contentContainer.dropTarget.setTargetZones(["center"]),T(this.container,"dv-groupview-popout",!0)}this.groupPanel.api._onDidLocationChange.fire({location:this.location})}constructor(e,t,n,i,r){var o;super(),this.container=e,this.accessor=t,this.id=n,this.options=i,this.groupPanel=r,this._isGroupActive=!1,this._locked=!1,this._location={type:"grid"},this.mostRecentlyUsed=[],this._overwriteRenderContainer=null,this._overwriteDropTargetContainer=null,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._width=0,this._height=0,this._panels=[],this._panelDisposables=new Map,this._onMove=new y,this.onMove=this._onMove.event,this._onDidDrop=new y,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new y,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new y,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onTabDragStart=new y,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new y,this.onGroupDragStart=this._onGroupDragStart.event,this._onDidAddPanel=new y,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPanelTitleChange=new y,this.onDidPanelTitleChange=this._onDidPanelTitleChange.event,this._onDidPanelParametersChange=new y,this.onDidPanelParametersChange=this._onDidPanelParametersChange.event,this._onDidRemovePanel=new y,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidActivePanelChange=new y,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onUnhandledDragOverEvent=new y,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,T(this.container,"dv-groupview",!0),this._api=new ge(this.accessor),this.tabsContainer=new We(this.accessor,this.groupPanel),this.contentContainer=new Ie(this.accessor,this),e.append(this.tabsContainer.element,this.contentContainer.element),this.header.hidden=!!i.hideHeader,this.locked=null!==(o=i.locked)&&void 0!==o&&o,this.addDisposables(this._onTabDragStart,this._onGroupDragStart,this._onWillShowOverlay,this.tabsContainer.onTabDragStart(e=>{this._onTabDragStart.fire(e)}),this.tabsContainer.onGroupDragStart(e=>{this._onGroupDragStart.fire(e)}),this.tabsContainer.onDrop(e=>{this.handleDropEvent("header",e.event,"center",e.index)}),this.contentContainer.onDidFocus(()=>{this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.onDidBlur(()=>{}),this.contentContainer.dropTarget.onDrop(e=>{this.handleDropEvent("content",e.nativeEvent,e.position)}),this.tabsContainer.onWillShowOverlay(e=>{this._onWillShowOverlay.fire(e)}),this.contentContainer.dropTarget.onWillShowOverlay(e=>{this._onWillShowOverlay.fire(new Ue(e,{kind:"content",panel:this.activePanel,api:this._api,group:this.groupPanel,getData:u}))}),this._onMove,this._onDidChange,this._onDidDrop,this._onWillDrop,this._onDidAddPanel,this._onDidRemovePanel,this._onDidActivePanelChange,this._onUnhandledDragOverEvent,this._onDidPanelTitleChange,this._onDidPanelParametersChange)}focusContent(){this.contentContainer.element.focus()}set renderContainer(e){this.panels.forEach(e=>{this.renderContainer.detatch(e)}),this._overwriteRenderContainer=e,this.panels.forEach(e=>{this.rerender(e)})}get renderContainer(){var e;return null!==(e=this._overwriteRenderContainer)&&void 0!==e?e:this.accessor.overlayRenderContainer}set dropTargetContainer(e){this._overwriteDropTargetContainer=e}get dropTargetContainer(){var e;return null!==(e=this._overwriteDropTargetContainer)&&void 0!==e?e:this.accessor.rootDropTargetContainer}initialize(){this.options.panels&&this.options.panels.forEach(e=>{this.doAddPanel(e)}),this.options.activePanel&&this.openPanel(this.options.activePanel),this.setActive(this.isActive,!0),this.updateContainer(),this.accessor.options.createRightHeaderActionComponent&&(this._rightHeaderActions=this.accessor.options.createRightHeaderActionComponent(this.groupPanel),this.addDisposables(this._rightHeaderActions),this._rightHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setRightActionsElement(this._rightHeaderActions.element)),this.accessor.options.createLeftHeaderActionComponent&&(this._leftHeaderActions=this.accessor.options.createLeftHeaderActionComponent(this.groupPanel),this.addDisposables(this._leftHeaderActions),this._leftHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setLeftActionsElement(this._leftHeaderActions.element)),this.accessor.options.createPrefixHeaderActionComponent&&(this._prefixHeaderActions=this.accessor.options.createPrefixHeaderActionComponent(this.groupPanel),this.addDisposables(this._prefixHeaderActions),this._prefixHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setPrefixActionsElement(this._prefixHeaderActions.element))}rerender(e){this.contentContainer.renderPanel(e,{asActive:!1})}indexOf(e){return this.tabsContainer.indexOf(e.id)}toJSON(){var e;const t={views:this.tabsContainer.panels,activeView:null===(e=this._activePanel)||void 0===e?void 0:e.id,id:this.id};return!1!==this.locked&&(t.locked=this.locked),this.header.hidden&&(t.hideHeader=!0),t}moveToNext(e){e||(e={}),e.panel||(e.panel=this.activePanel);const t=e.panel?this.panels.indexOf(e.panel):-1;let n;if(t<this.panels.length-1)n=t+1;else{if(e.suppressRoll)return;n=0}this.openPanel(this.panels[n])}moveToPrevious(e){if(e||(e={}),e.panel||(e.panel=this.activePanel),!e.panel)return;const t=this.panels.indexOf(e.panel);let n;if(t>0)n=t-1;else{if(e.suppressRoll)return;n=this.panels.length-1}this.openPanel(this.panels[n])}containsPanel(e){return this.panels.includes(e)}init(e){}update(e){}focus(){var e;null===(e=this._activePanel)||void 0===e||e.focus()}openPanel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};("number"!==typeof t.index||t.index>this.panels.length)&&(t.index=this.panels.length);const n=!!t.skipSetActive;e.updateParentGroup(this.groupPanel,{skipSetActive:t.skipSetActive}),this.doAddPanel(e,t.index,{skipSetActive:n}),this._activePanel!==e?(n||this.doSetActivePanel(e),t.skipSetGroupActive||this.accessor.doSetGroupActive(this.groupPanel),t.skipSetActive||this.updateContainer()):this.contentContainer.renderPanel(e,{asActive:!0})}removePanel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipSetActive:!1};const n="string"===typeof e?e:e.id,i=this._panels.find(e=>e.id===n);if(!i)throw new Error("invalid operation");return this._removePanel(i,t)}closeAllPanels(){if(this.panels.length>0){const e=[...this.panels];for(const t of e)this.doClose(t)}else this.accessor.removeGroup(this.groupPanel)}closePanel(e){this.doClose(e)}doClose(e){const t=1===this.panels.length&&1===this.accessor.groups.length;this.accessor.removePanel(e,t&&"emptyGroup"===this.accessor.options.noPanelsOverlay?{removeEmptyGroup:!1}:void 0)}isPanelActive(e){return this._activePanel===e}updateActions(e){this.tabsContainer.setRightActionsElement(e)}setActive(e){(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.isActive!==e)&&(this._isGroupActive=e,T(this.container,"dv-active-group",e),T(this.container,"dv-inactive-group",!e),this.tabsContainer.setActive(this.isActive),!this._activePanel&&this.panels.length>0&&this.doSetActivePanel(this.panels[0]),this.updateContainer())}layout(e,t){var n;this._width=e,this._height=t,this.contentContainer.layout(this._width,this._height),(null===(n=this._activePanel)||void 0===n?void 0:n.layout)&&this._activePanel.layout(this._width,this._height)}_removePanel(e,t){const n=this._activePanel===e;if(this.doRemovePanel(e),n&&this.panels.length>0){const e=this.mostRecentlyUsed[0];this.openPanel(e,{skipSetActive:t.skipSetActive,skipSetGroupActive:t.skipSetActiveGroup})}return this._activePanel&&0===this.panels.length&&this.doSetActivePanel(void 0),t.skipSetActive||this.updateContainer(),e}doRemovePanel(e){const t=this.panels.indexOf(e);if(this._activePanel===e&&this.contentContainer.closePanel(),this.tabsContainer.delete(e.id),this._panels.splice(t,1),this.mostRecentlyUsed.includes(e)){const t=this.mostRecentlyUsed.indexOf(e);this.mostRecentlyUsed.splice(t,1)}const n=this._panelDisposables.get(e.id);n&&(n.dispose(),this._panelDisposables.delete(e.id)),this._onDidRemovePanel.fire({panel:e})}doAddPanel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.panels.length,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipSetActive:!1};const i=this._panels.indexOf(e)>-1;this.tabsContainer.show(),this.contentContainer.show(),this.tabsContainer.openPanel(e,t),n.skipSetActive||this.contentContainer.openPanel(e),i||(this.updateMru(e),this.panels.splice(t,0,e),this._panelDisposables.set(e.id,new _(e.api.onDidTitleChange(e=>this._onDidPanelTitleChange.fire(e)),e.api.onDidParametersChange(e=>this._onDidPanelParametersChange.fire(e)))),this._onDidAddPanel.fire({panel:e}))}doSetActivePanel(e){this._activePanel!==e&&(this._activePanel=e,e&&(this.tabsContainer.setActivePanel(e),e.layout(this._width,this._height),this.updateMru(e),this._onDidActivePanelChange.fire({panel:e})))}updateMru(e){this.mostRecentlyUsed.includes(e)&&this.mostRecentlyUsed.splice(this.mostRecentlyUsed.indexOf(e),1),this.mostRecentlyUsed=[e,...this.mostRecentlyUsed]}updateContainer(){var e,t;if(this.panels.forEach(e=>e.runEvents()),this.isEmpty&&!this.watermark){const e=this.accessor.createWatermarkComponent();e.init({containerApi:this._api,group:this.groupPanel}),this.watermark=e,b(this.watermark.element,"pointerdown",()=>{this.isActive||this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.element.appendChild(this.watermark.element)}!this.isEmpty&&this.watermark&&(this.watermark.element.remove(),null===(t=(e=this.watermark).dispose)||void 0===t||t.call(e),this.watermark=void 0)}canDisplayOverlay(e,t,n){const i=new Xe(e,n,t,u,this.accessor.getPanel(this.id));return this._onUnhandledDragOverEvent.fire(i),i.isAccepted}handleDropEvent(e,t,n,i){if("no-drop-target"===this.locked)return;const r="number"===typeof i?this.panels[i]:void 0,o=new qe({nativeEvent:t,position:n,panel:r,getData:()=>u(),kind:function(){switch(e){case"header":return"number"===typeof i?"tab":"header_space";case"content":return"content"}}(),group:this.groupPanel,api:this._api});if(this._onWillDrop.fire(o),o.defaultPrevented)return;const s=u();if(s&&s.viewId===this.accessor.id){if("content"===e&&s.groupId===this.id){if("center"===n)return;if(null===s.panelId)return}if("header"===e&&s.groupId===this.id&&null===s.panelId)return;if(null===s.panelId){const{groupId:e}=s;return void this._onMove.fire({target:n,groupId:e,index:i})}if(-1!==this.tabsContainer.indexOf(s.panelId)&&1===this.tabsContainer.size)return;const{groupId:t,panelId:r}=s;if(this.id===t&&!n){if(this.tabsContainer.indexOf(r)===i)return}this._onMove.fire({target:n,groupId:s.groupId,itemId:s.panelId,index:i})}else this._onDidDrop.fire(new $e({nativeEvent:t,position:n,panel:r,getData:()=>u(),group:this.groupPanel,api:this._api}))}updateDragAndDropState(){this.tabsContainer.updateDragAndDropState()}dispose(){var e,t,n;super.dispose(),null===(e=this.watermark)||void 0===e||e.element.remove(),null===(n=null===(t=this.watermark)||void 0===t?void 0:t.dispose)||void 0===n||n.call(t),this.watermark=void 0;for(const i of this.panels)i.dispose();this.tabsContainer.dispose(),this.contentContainer.dispose()}}class Ke extends Ae{constructor(e,t,n){super(e,t),this._onDidConstraintsChangeInternal=new y,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new y,this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new y,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange),n&&this.initialize(n)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class Je extends ke{get priority(){return this._priority}get snap(){return this._snap}get minimumWidth(){return this.__minimumWidth()}get minimumHeight(){return this.__minimumHeight()}get maximumHeight(){return this.__maximumHeight()}get maximumWidth(){return this.__maximumWidth()}__minimumWidth(){const e="function"===typeof this._minimumWidth?this._minimumWidth():this._minimumWidth;return e!==this._evaluatedMinimumWidth&&(this._evaluatedMinimumWidth=e,this.updateConstraints()),e}__maximumWidth(){const e="function"===typeof this._maximumWidth?this._maximumWidth():this._maximumWidth;return e!==this._evaluatedMaximumWidth&&(this._evaluatedMaximumWidth=e,this.updateConstraints()),e}__minimumHeight(){const e="function"===typeof this._minimumHeight?this._minimumHeight():this._minimumHeight;return e!==this._evaluatedMinimumHeight&&(this._evaluatedMinimumHeight=e,this.updateConstraints()),e}__maximumHeight(){const e="function"===typeof this._maximumHeight?this._maximumHeight():this._maximumHeight;return e!==this._evaluatedMaximumHeight&&(this._evaluatedMaximumHeight=e,this.updateConstraints()),e}get isActive(){return this.api.isActive}get isVisible(){return this.api.isVisible}constructor(e,t,n,i){super(e,t,null!==i&&void 0!==i?i:new Ke(e,t)),this._evaluatedMinimumWidth=0,this._evaluatedMaximumWidth=Number.MAX_SAFE_INTEGER,this._evaluatedMinimumHeight=0,this._evaluatedMaximumHeight=Number.MAX_SAFE_INTEGER,this._minimumWidth=0,this._minimumHeight=0,this._maximumWidth=Number.MAX_SAFE_INTEGER,this._maximumHeight=Number.MAX_SAFE_INTEGER,this._snap=!1,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,"number"===typeof(null===n||void 0===n?void 0:n.minimumWidth)&&(this._minimumWidth=n.minimumWidth),"number"===typeof(null===n||void 0===n?void 0:n.maximumWidth)&&(this._maximumWidth=n.maximumWidth),"number"===typeof(null===n||void 0===n?void 0:n.minimumHeight)&&(this._minimumHeight=n.minimumHeight),"number"===typeof(null===n||void 0===n?void 0:n.maximumHeight)&&(this._maximumHeight=n.maximumHeight),this.api.initialize(this),this.addDisposables(this.api.onWillVisibilityChange(e=>{const{isVisible:t}=e,{accessor:n}=this._params;n.setVisible(this,t)}),this.api.onActiveChange(()=>{const{accessor:e}=this._params;e.doSetGroupActive(this)}),this.api.onDidConstraintsChangeInternal(e=>{"number"!==typeof e.minimumWidth&&"function"!==typeof e.minimumWidth||(this._minimumWidth=e.minimumWidth),"number"!==typeof e.minimumHeight&&"function"!==typeof e.minimumHeight||(this._minimumHeight=e.minimumHeight),"number"!==typeof e.maximumWidth&&"function"!==typeof e.maximumWidth||(this._maximumWidth=e.maximumWidth),"number"!==typeof e.maximumHeight&&"function"!==typeof e.maximumHeight||(this._maximumHeight=e.maximumHeight)}),this.api.onDidSizeChange(e=>{this._onDidChange.fire({height:e.height,width:e.width})}),this._onDidChange)}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}init(e){e.maximumHeight&&(this._maximumHeight=e.maximumHeight),e.minimumHeight&&(this._minimumHeight=e.minimumHeight),e.maximumWidth&&(this._maximumWidth=e.maximumWidth),e.minimumWidth&&(this._minimumWidth=e.minimumWidth),this._priority=e.priority,this._snap=!!e.snap,super.init(e),"boolean"===typeof e.isVisible&&this.setVisible(e.isVisible)}updateConstraints(){this.api._onDidConstraintsChange.fire({minimumWidth:this._evaluatedMinimumWidth,maximumWidth:this._evaluatedMaximumWidth,minimumHeight:this._evaluatedMinimumHeight,maximumHeight:this._evaluatedMaximumHeight})}toJSON(){const e=super.toJSON(),t=e=>e===Number.MAX_SAFE_INTEGER?void 0:e,n=e=>e<=0?void 0:e;return Object.assign(Object.assign({},e),{minimumHeight:n(this.minimumHeight),maximumHeight:t(this.maximumHeight),minimumWidth:n(this.minimumWidth),maximumWidth:t(this.maximumWidth),snap:this.snap,priority:this.priority})}}const Qe="dockview: DockviewGroupPanelApiImpl not initialized";class et extends Ke{get location(){if(!this._group)throw new Error(Qe);return this._group.model.location}constructor(e,t){super(e,"__dockviewgroup__"),this.accessor=t,this._onDidLocationChange=new y,this.onDidLocationChange=this._onDidLocationChange.event,this._onDidActivePanelChange=new y,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this.addDisposables(this._onDidLocationChange,this._onDidActivePanelChange)}close(){if(this._group)return this.accessor.removeGroup(this._group)}getWindow(){return"popout"===this.location.type?this.location.getWindow():window}moveTo(e){var t,n,i,r;if(!this._group)throw new Error(Qe);const o=null!==(t=e.group)&&void 0!==t?t:this.accessor.addGroup({direction:_e(null!==(n=e.position)&&void 0!==n?n:"right"),skipSetActive:null!==(i=e.skipSetActive)&&void 0!==i&&i});this.accessor.moveGroupOrPanel({from:{groupId:this._group.id},to:{group:o,position:e.group&&null!==(r=e.position)&&void 0!==r?r:"center",index:e.index},skipSetActive:e.skipSetActive})}maximize(){if(!this._group)throw new Error(Qe);"grid"===this.location.type&&this.accessor.maximizeGroup(this._group)}isMaximized(){if(!this._group)throw new Error(Qe);return this.accessor.isMaximizedGroup(this._group)}exitMaximized(){if(!this._group)throw new Error(Qe);this.isMaximized()&&this.accessor.exitMaximizedGroup()}initialize(e){this._group=e}}class tt extends Je{get minimumWidth(){var e;const t=null===(e=this.activePanel)||void 0===e?void 0:e.minimumWidth;return"number"===typeof t?t:super.__minimumWidth()}get minimumHeight(){var e;const t=null===(e=this.activePanel)||void 0===e?void 0:e.minimumHeight;return"number"===typeof t?t:super.__minimumHeight()}get maximumWidth(){var e;const t=null===(e=this.activePanel)||void 0===e?void 0:e.maximumWidth;return"number"===typeof t?t:super.__maximumWidth()}get maximumHeight(){var e;const t=null===(e=this.activePanel)||void 0===e?void 0:e.maximumHeight;return"number"===typeof t?t:super.__maximumHeight()}get panels(){return this._model.panels}get activePanel(){return this._model.activePanel}get size(){return this._model.size}get model(){return this._model}get locked(){return this._model.locked}set locked(e){this._model.locked=e}get header(){return this._model.header}constructor(e,t,n){var i,r,o,s,a,l;super(t,"groupview_default",{minimumHeight:null!==(r=null===(i=n.constraints)||void 0===i?void 0:i.minimumHeight)&&void 0!==r?r:100,minimumWidth:null!==(s=null===(o=n.constraints)||void 0===o?void 0:o.maximumHeight)&&void 0!==s?s:100,maximumHeight:null===(a=n.constraints)||void 0===a?void 0:a.maximumHeight,maximumWidth:null===(l=n.constraints)||void 0===l?void 0:l.maximumWidth},new et(t,e)),this.api.initialize(this),this._model=new Ze(this.element,e,t,n,this),this.addDisposables(this.model.onDidActivePanelChange(e=>{this.api._onDidActivePanelChange.fire(e)}))}focus(){this.api.isActive||this.api.setActive(),super.focus()}initialize(){this._model.initialize()}setActive(e){super.setActive(e),this.model.setActive(e)}layout(e,t){super.layout(e,t),this.model.layout(e,t)}getComponent(){return this._model}toJSON(){return this.model.toJSON()}}const nt={name:"abyss",className:"dockview-theme-abyss"};class it extends Ke{get location(){return this.group.api.location}get title(){return this.panel.title}get isGroupActive(){return this.group.isActive}get renderer(){return this.panel.renderer}set group(e){const t=this._group;this._group!==e&&(this._group=e,this._onDidGroupChange.fire({}),this.setupGroupEventListeners(t),this._onDidLocationChange.fire({location:this.group.api.location}))}get group(){return this._group}get tabComponent(){return this._tabComponent}constructor(e,t,n,i,r){super(e.id,i),this.panel=e,this.accessor=n,this._onDidTitleChange=new y,this.onDidTitleChange=this._onDidTitleChange.event,this._onDidActiveGroupChange=new y,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._onDidGroupChange=new y,this.onDidGroupChange=this._onDidGroupChange.event,this._onDidRendererChange=new y,this.onDidRendererChange=this._onDidRendererChange.event,this._onDidLocationChange=new y,this.onDidLocationChange=this._onDidLocationChange.event,this.groupEventsDisposable=new w,this._tabComponent=r,this.initialize(e),this._group=t,this.setupGroupEventListeners(),this.addDisposables(this.groupEventsDisposable,this._onDidRendererChange,this._onDidTitleChange,this._onDidGroupChange,this._onDidActiveGroupChange,this._onDidLocationChange)}getWindow(){return this.group.api.getWindow()}moveTo(e){var t,n;this.accessor.moveGroupOrPanel({from:{groupId:this._group.id,panelId:this.panel.id},to:{group:null!==(t=e.group)&&void 0!==t?t:this._group,position:e.group&&null!==(n=e.position)&&void 0!==n?n:"center",index:e.index},skipSetActive:e.skipSetActive})}setTitle(e){this.panel.setTitle(e)}setRenderer(e){this.panel.setRenderer(e)}close(){this.group.model.closePanel(this.panel)}maximize(){this.group.api.maximize()}isMaximized(){return this.group.api.isMaximized()}exitMaximized(){this.group.api.exitMaximized()}setupGroupEventListeners(e){var t;let n=null!==(t=null===e||void 0===e?void 0:e.isActive)&&void 0!==t&&t;this.groupEventsDisposable.value=new _(this.group.api.onDidVisibilityChange(e=>{const t=!e.isVisible&&this.isVisible,n=e.isVisible&&!this.isVisible,i=this.group.model.isPanelActive(this.panel);(t||n&&i)&&this._onDidVisibilityChange.fire(e)}),this.group.api.onDidLocationChange(e=>{this.group===this.panel.group&&this._onDidLocationChange.fire(e)}),this.group.api.onDidActiveChange(()=>{this.group===this.panel.group&&n!==this.isGroupActive&&(n=this.isGroupActive,this._onDidActiveGroupChange.fire({isActive:this.isGroupActive}))}))}}class rt extends _{get params(){return this._params}get title(){return this._title}get group(){return this._group}get renderer(){var e;return null!==(e=this._renderer)&&void 0!==e?e:this.accessor.renderer}get minimumWidth(){return this._minimumWidth}get minimumHeight(){return this._minimumHeight}get maximumWidth(){return this._maximumWidth}get maximumHeight(){return this._maximumHeight}constructor(e,t,n,i,r,o,s,a){super(),this.id=e,this.accessor=i,this.containerApi=r,this.view=s,this._renderer=a.renderer,this._group=o,this._minimumWidth=a.minimumWidth,this._minimumHeight=a.minimumHeight,this._maximumWidth=a.maximumWidth,this._maximumHeight=a.maximumHeight,this.api=new it(this,this._group,i,t,n),this.addDisposables(this.api.onActiveChange(()=>{i.setActivePanel(this)}),this.api.onDidSizeChange(e=>{this.group.api.setSize(e)}),this.api.onDidRendererChange(()=>{this.group.model.rerender(this)}))}init(e){this._params=e.params,this.view.init(Object.assign(Object.assign({},e),{api:this.api,containerApi:this.containerApi})),this.setTitle(e.title)}focus(){const e=new Te;this.api._onWillFocus.fire(e),e.defaultPrevented||this.api.isActive||this.api.setActive()}toJSON(){return{id:this.id,contentComponent:this.view.contentComponent,tabComponent:this.view.tabComponent,params:Object.keys(this._params||{}).length>0?this._params:void 0,title:this.title,renderer:this._renderer,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,minimumWidth:this._minimumWidth,maximumWidth:this._maximumWidth}}setTitle(e){e!==this.title&&(this._title=e,this.api._onDidTitleChange.fire({title:e}))}setRenderer(e){e!==this.renderer&&(this._renderer=e,this.api._onDidRendererChange.fire({renderer:e}))}update(e){var t;this._params=Object.assign(Object.assign({},null!==(t=this._params)&&void 0!==t?t:{}),e.params);for(const n of Object.keys(e.params))void 0===e.params[n]&&delete this._params[n];this.view.update({params:this._params})}updateParentGroup(e,t){this._group=e,this.api.group=this._group;const n=this._group.model.isPanelActive(this),i=this.group.api.isActive&&n;(null===t||void 0===t?void 0:t.skipSetActive)||this.api.isActive!==i&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&n}),this.api.isVisible!==n&&this.api._onDidVisibilityChange.fire({isVisible:n})}runEvents(){const e=this._group.model.isPanelActive(this),t=this.group.api.isActive&&e;this.api.isActive!==t&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&e}),this.api.isVisible!==e&&this.api._onDidVisibilityChange.fire({isVisible:e})}layout(e,t){this.api._onDidDimensionChange.fire({width:e,height:t}),this.view.layout(e,t)}dispose(){this.api.dispose(),this.view.dispose()}}class ot extends _{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-default-tab",this._content=document.createElement("div"),this._content.className="dv-default-tab-content",this.action=document.createElement("div"),this.action.className="dv-default-tab-action",this.action.appendChild(He({width:"11",height:"11",viewbox:"0 0 28 28",path:"M2.1 27.3L0 25.2L11.55 13.65L0 2.1L2.1 0L13.65 11.55L25.2 0L27.3 2.1L15.75 13.65L27.3 25.2L25.2 27.3L13.65 15.75L2.1 27.3Z"})),this._element.appendChild(this._content),this._element.appendChild(this.action),this.render()}init(e){this._title=e.title,this.addDisposables(e.api.onDidTitleChange(e=>{this._title=e.title,this.render()}),b(this.action,"pointerdown",e=>{e.preventDefault()}),b(this.action,"click",t=>{t.defaultPrevented||(t.preventDefault(),e.api.close())})),this.render()}render(){var e;this._content.textContent!==this._title&&(this._content.textContent=null!==(e=this._title)&&void 0!==e?e:"")}}class st{get content(){return this._content}get tab(){return this._tab}constructor(e,t,n,i){this.accessor=e,this.id=t,this.contentComponent=n,this.tabComponent=i,this._content=this.createContentComponent(this.id,n),this._tab=this.createTabComponent(this.id,i)}createTabRenderer(e){var t;const n=this.createTabComponent(this.id,this.tabComponent);return this._params&&n.init(Object.assign(Object.assign({},this._params),{tabLocation:e})),this._updateEvent&&(null===(t=n.update)||void 0===t||t.call(n,this._updateEvent)),n}init(e){this._params=e,this.content.init(e),this.tab.init(Object.assign(Object.assign({},e),{tabLocation:"header"}))}layout(e,t){var n,i;null===(i=(n=this.content).layout)||void 0===i||i.call(n,e,t)}update(e){var t,n,i,r;this._updateEvent=e,null===(n=(t=this.content).update)||void 0===n||n.call(t,e),null===(r=(i=this.tab).update)||void 0===r||r.call(i,e)}dispose(){var e,t,n,i;null===(t=(e=this.content).dispose)||void 0===t||t.call(e),null===(i=(n=this.tab).dispose)||void 0===i||i.call(n)}createContentComponent(e,t){return this.accessor.options.createComponent({id:e,name:t})}createTabComponent(e,t){const n=null!==t&&void 0!==t?t:this.accessor.options.defaultTabComponent;if(n){if(this.accessor.options.createTabComponent){const t=this.accessor.options.createTabComponent({id:e,name:n});return t||new ot}console.warn(`dockview: tabComponent '${t}' was not found. falling back to the default tab.`)}return new ot}}class at{constructor(e){this.accessor=e}fromJSON(e,t){var n,i;const r=e.id,o=e.params,s=e.title,a=e.view,l=a?a.content.id:null!==(n=e.contentComponent)&&void 0!==n?n:"unknown",c=a?null===(i=a.tab)||void 0===i?void 0:i.id:e.tabComponent,u=new st(this.accessor,r,l,c),d=new rt(r,l,c,this.accessor,new ge(this.accessor),t,u,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return d.init({title:null!==s&&void 0!==s?s:r,params:null!==o&&void 0!==o?o:{}}),d}}class lt extends _{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-watermark"}init(e){}}const ct=new class{constructor(){this._orderedList=[]}push(e){this._orderedList=[...this._orderedList.filter(t=>t!==e),e],this.update()}destroy(e){this._orderedList=this._orderedList.filter(t=>t!==e),this.update()}update(){for(let e=0;e<this._orderedList.length;e++)this._orderedList[e].setAttribute("aria-level",`${e}`),this._orderedList[e].style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${2*e})`}};class ut extends _{set minimumInViewportWidth(e){this.options.minimumInViewportWidth=e}set minimumInViewportHeight(e){this.options.minimumInViewportHeight=e}get element(){return this._element}get isVisible(){return this._isVisible}constructor(e){super(),this.options=e,this._element=document.createElement("div"),this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this._onDidChangeEnd=new y,this.onDidChangeEnd=this._onDidChangeEnd.event,this.addDisposables(this._onDidChange,this._onDidChangeEnd),this._element.className="dv-resize-container",this._isVisible=!0,this.setupResize("top"),this.setupResize("bottom"),this.setupResize("left"),this.setupResize("right"),this.setupResize("topleft"),this.setupResize("topright"),this.setupResize("bottomleft"),this.setupResize("bottomright"),this._element.appendChild(this.options.content),this.options.container.appendChild(this._element),this.setBounds(Object.assign(Object.assign(Object.assign(Object.assign({height:this.options.height,width:this.options.width},"top"in this.options&&{top:this.options.top}),"bottom"in this.options&&{bottom:this.options.bottom}),"left"in this.options&&{left:this.options.left}),"right"in this.options&&{right:this.options.right})),ct.push(this._element)}setVisible(e){e!==this.isVisible&&(this._isVisible=e,T(this.element,"dv-hidden",!this.isVisible))}bringToFront(){ct.push(this._element)}setBounds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"number"===typeof e.height&&(this._element.style.height=`${e.height}px`),"number"===typeof e.width&&(this._element.style.width=`${e.width}px`),"top"in e&&"number"===typeof e.top&&(this._element.style.top=`${e.top}px`,this._element.style.bottom="auto",this.verticalAlignment="top"),"bottom"in e&&"number"===typeof e.bottom&&(this._element.style.bottom=`${e.bottom}px`,this._element.style.top="auto",this.verticalAlignment="bottom"),"left"in e&&"number"===typeof e.left&&(this._element.style.left=`${e.left}px`,this._element.style.right="auto",this.horiziontalAlignment="left"),"right"in e&&"number"===typeof e.right&&(this._element.style.right=`${e.right}px`,this._element.style.left="auto",this.horiziontalAlignment="right");const t=this.options.container.getBoundingClientRect(),n=this._element.getBoundingClientRect(),i=Math.max(0,this.getMinimumWidth(n.width)),r=Math.max(0,this.getMinimumHeight(n.height));if("top"===this.verticalAlignment){const e=B(n.top-t.top,-r,Math.max(0,t.height-n.height+r));this._element.style.top=`${e}px`,this._element.style.bottom="auto"}if("bottom"===this.verticalAlignment){const e=B(t.bottom-n.bottom,-r,Math.max(0,t.height-n.height+r));this._element.style.bottom=`${e}px`,this._element.style.top="auto"}if("left"===this.horiziontalAlignment){const e=B(n.left-t.left,-i,Math.max(0,t.width-n.width+i));this._element.style.left=`${e}px`,this._element.style.right="auto"}if("right"===this.horiziontalAlignment){const e=B(t.right-n.right,-i,Math.max(0,t.width-n.width+i));this._element.style.right=`${e}px`,this._element.style.left="auto"}this._onDidChange.fire()}toJSON(){const e=this.options.container.getBoundingClientRect(),t=this._element.getBoundingClientRect(),n={};return"top"===this.verticalAlignment?n.top=parseFloat(this._element.style.top):"bottom"===this.verticalAlignment?n.bottom=parseFloat(this._element.style.bottom):n.top=t.top-e.top,"left"===this.horiziontalAlignment?n.left=parseFloat(this._element.style.left):"right"===this.horiziontalAlignment?n.right=parseFloat(this._element.style.right):n.left=t.left-e.left,n.width=t.width,n.height=t.height,n}setupDrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{inDragMode:!1};const n=new w,i=()=>{let e=null;const t=I();n.value=new _({dispose:()=>{t.release()}},b(window,"pointermove",t=>{const n=this.options.container.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top;T(this._element,"dv-resize-container-dragging",!0);const o=this._element.getBoundingClientRect();null===e&&(e={x:t.clientX-o.left,y:t.clientY-o.top});const s=Math.max(0,this.getMinimumWidth(o.width)),a=Math.max(0,this.getMinimumHeight(o.height)),l=B(r-e.y,-a,Math.max(0,n.height-o.height+a)),c=B(e.y-r+n.height-o.height,-a,Math.max(0,n.height-o.height+a)),u=B(i-e.x,-s,Math.max(0,n.width-o.width+s)),d=B(e.x-i+n.width-o.width,-s,Math.max(0,n.width-o.width+s)),h={};l<=c?h.top=l:h.bottom=c,u<=d?h.left=u:h.right=d,this.setBounds(h)}),b(window,"pointerup",()=>{T(this._element,"dv-resize-container-dragging",!1),n.dispose(),this._onDidChangeEnd.fire()}))};this.addDisposables(n,b(e,"pointerdown",e=>{e.defaultPrevented?e.preventDefault():R(e)||i()}),b(this.options.content,"pointerdown",e=>{e.defaultPrevented||R(e)||e.shiftKey&&i()}),b(this.options.content,"pointerdown",()=>{ct.push(this._element)},!0)),t.inDragMode&&i()}setupResize(e){const t=document.createElement("div");t.className=`dv-resize-handle-${e}`,this._element.appendChild(t);const n=new w;this.addDisposables(n,b(t,"pointerdown",t=>{t.preventDefault();let i=null;const r=I();n.value=new _(b(window,"pointermove",t=>{const n=this.options.container.getBoundingClientRect(),r=this._element.getBoundingClientRect(),o=t.clientY-n.top,s=t.clientX-n.left;let a,l,c,u,d,h;null===i&&(i={originalY:o,originalHeight:r.height,originalX:s,originalWidth:r.width});const p=()=>{a=B(o,-Number.MAX_VALUE,i.originalY+i.originalHeight>n.height?this.getMinimumHeight(n.height):Math.max(0,i.originalY+i.originalHeight-ut.MINIMUM_HEIGHT)),c=i.originalY+i.originalHeight-a,l=n.height-a-c},f=()=>{a=i.originalY-i.originalHeight,c=B(o-a,a<0&&"number"===typeof this.options.minimumInViewportHeight?-a+this.options.minimumInViewportHeight:ut.MINIMUM_HEIGHT,Number.MAX_VALUE),l=n.height-a-c},m=()=>{u=B(s,-Number.MAX_VALUE,i.originalX+i.originalWidth>n.width?this.getMinimumWidth(n.width):Math.max(0,i.originalX+i.originalWidth-ut.MINIMUM_WIDTH)),h=i.originalX+i.originalWidth-u,d=n.width-u-h},g=()=>{u=i.originalX-i.originalWidth,h=B(s-u,u<0&&"number"===typeof this.options.minimumInViewportWidth?-u+this.options.minimumInViewportWidth:ut.MINIMUM_WIDTH,Number.MAX_VALUE),d=n.width-u-h};switch(e){case"top":p();break;case"bottom":f();break;case"left":m();break;case"right":g();break;case"topleft":p(),m();break;case"topright":p(),g();break;case"bottomleft":f(),m();break;case"bottomright":f(),g()}const v={};a<=l?v.top=a:v.bottom=l,u<=d?v.left=u:v.right=d,v.height=c,v.width=h,this.setBounds(v)}),{dispose:()=>{r.release()}},b(window,"pointerup",()=>{n.dispose(),this._onDidChangeEnd.fire()}))}))}getMinimumWidth(e){return"number"===typeof this.options.minimumInViewportWidth?e-this.options.minimumInViewportWidth:0}getMinimumHeight(e){return"number"===typeof this.options.minimumInViewportHeight?e-this.options.minimumInViewportHeight:0}dispose(){ct.destroy(this._element),this._element.remove(),super.dispose()}}ut.MINIMUM_HEIGHT=20,ut.MINIMUM_WIDTH=20;class dt extends _{constructor(e,t){super(),this.group=e,this.overlay=t,this.addDisposables(t)}position(e){this.overlay.setBounds(e)}}const ht=100,pt=100,ft=100,mt=300,gt=300;class vt{constructor(){this.cache=new Map,this.currentFrameId=0,this.rafId=null}getPosition(e){const t=this.cache.get(e);if(t&&t.frameId===this.currentFrameId)return t.rect;this.scheduleFrameUpdate();const n=N(e);return this.cache.set(e,{rect:n,frameId:this.currentFrameId}),n}invalidate(){this.currentFrameId++}scheduleFrameUpdate(){this.rafId||(this.rafId=requestAnimationFrame(()=>{this.currentFrameId++,this.rafId=null}))}}class yt extends _{constructor(e,t){super(),this.element=e,this.accessor=t,this.map={},this._disposed=!1,this.positionCache=new vt,this.pendingUpdates=new Set,this.addDisposables(p.from(()=>{for(const e of Object.values(this.map))e.disposable.dispose(),e.destroy.dispose();this._disposed=!0}))}updateAllPositions(){if(!this._disposed){this.positionCache.invalidate();for(const e of Object.values(this.map))e.panel.api.isVisible&&e.resize&&e.resize()}}detatch(e){if(this.map[e.api.id]){const{disposable:t,destroy:n}=this.map[e.api.id];return t.dispose(),n.dispose(),delete this.map[e.api.id],!0}return!1}attach(e){const{panel:t,referenceContainer:n}=e;if(!this.map[t.api.id]){const e=function(){const e=document.createElement("div");return e.tabIndex=-1,e}();e.className="dv-render-overlay",this.map[t.api.id]={panel:t,disposable:p.NONE,destroy:p.NONE,element:e}}const i=this.map[t.api.id].element;t.view.content.element.parentElement!==i&&i.appendChild(t.view.content.element),i.parentElement!==this.element&&this.element.appendChild(i);const r=()=>{const e=t.api.id;this.pendingUpdates.has(e)||(this.pendingUpdates.add(e),requestAnimationFrame(()=>{if(this.pendingUpdates.delete(e),this.isDisposed||!this.map[e])return;const r=this.positionCache.getPosition(n.element),o=this.positionCache.getPosition(this.element),s=r.left-o.left,a=r.top-o.top,l=r.width,c=r.height;i.style.left=`${s}px`,i.style.top=`${a}px`,i.style.width=`${l}px`,i.style.height=`${c}px`,T(i,"dv-render-overlay-float","floating"===t.group.api.location.type)}))},o=()=>{t.api.isVisible&&(this.positionCache.invalidate(),r()),i.style.display=t.api.isVisible?"":"none"},s=new w,a=()=>{"floating"===t.api.location.type?queueMicrotask(()=>{const e=this.accessor.floatingGroups.find(e=>e.group===t.api.group);if(!e)return;const n=e.overlay.element,r=()=>{const e=Number(n.getAttribute("aria-level"));i.style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${2*e+1})`},o=new MutationObserver(()=>{r()});s.value=p.from(()=>o.disconnect()),o.observe(n,{attributeFilter:["aria-level"],attributes:!0}),r()}):i.style.zIndex=""},l=new _(s,new ye(i,{onDragEnd:e=>{n.dropTarget.dnd.onDragEnd(e)},onDragEnter:e=>{n.dropTarget.dnd.onDragEnter(e)},onDragLeave:e=>{n.dropTarget.dnd.onDragLeave(e)},onDrop:e=>{n.dropTarget.dnd.onDrop(e)},onDragOver:e=>{n.dropTarget.dnd.onDragOver(e)}}),t.api.onDidVisibilityChange(()=>{o()}),t.api.onDidDimensionsChange(()=>{t.api.isVisible&&r()}),t.api.onDidLocationChange(()=>{a()}));return this.map[t.api.id].destroy=p.from(()=>{var e;t.view.content.element.parentElement===i&&i.removeChild(t.view.content.element),null===(e=i.parentElement)||void 0===e||e.removeChild(i)}),a(),queueMicrotask(()=>{this.isDisposed||o()}),this.map[t.api.id].disposable.dispose(),this.map[t.api.id].disposable=l,this.map[t.api.id].resize=r,i}}var bt=function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(t){o(t)}}function a(e){try{l(i.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})};class xt extends _{get window(){var e,t;return null!==(t=null===(e=this._window)||void 0===e?void 0:e.value)&&void 0!==t?t:null}constructor(e,t,n){super(),this.target=e,this.className=t,this.options=n,this._onWillClose=new y,this.onWillClose=this._onWillClose.event,this._onDidClose=new y,this.onDidClose=this._onDidClose.event,this._window=null,this.addDisposables(this._onWillClose,this._onDidClose,{dispose:()=>{this.close()}})}dimensions(){if(!this._window)return null;const e=this._window.value.screenX;return{top:this._window.value.screenY,left:e,width:this._window.value.innerWidth,height:this._window.value.innerHeight}}close(){var e,t;this._window&&(this._onWillClose.fire(),null===(t=(e=this.options).onWillClose)||void 0===t||t.call(e,{id:this.target,window:this._window.value}),this._window.disposable.dispose(),this._window=null,this._onDidClose.fire())}open(){var e,t;return bt(this,void 0,void 0,function*(){if(this._window)throw new Error("instance of popout window is already open");const n=`${this.options.url}`,i=Object.entries({top:this.options.top,left:this.options.left,width:this.options.width,height:this.options.height}).map(e=>{let[t,n]=e;return`${t}=${n}`}).join(","),r=window.open(n,this.target,i);if(!r)return null;const o=new _;this._window={value:r,disposable:o},o.addDisposables(p.from(()=>{r.close()}),b(window,"beforeunload",()=>{this.close()}));const s=this.createPopoutWindowContainer();return this.className&&s.classList.add(this.className),null===(t=(e=this.options).onDidOpen)||void 0===t||t.call(e,{id:this.target,window:r}),new Promise((e,t)=>{r.addEventListener("unload",e=>{}),r.addEventListener("load",()=>{try{const t=r.document;t.title=document.title,t.body.appendChild(s),function(e,t){const n=Array.from(t);for(const r of n){if(r.href){const t=e.createElement("link");t.href=r.href,t.type=r.type,t.rel="stylesheet",e.head.appendChild(t)}let t=[];try{r.cssRules&&(t=Array.from(r.cssRules).map(e=>e.cssText))}catch(i){}for(const n of t){const t=e.createElement("style");t.appendChild(e.createTextNode(n)),e.head.appendChild(t)}}}(t,window.document.styleSheets),b(r,"beforeunload",()=>{this.close()}),e(s)}catch(n){t(n)}})})})}createPopoutWindowContainer(){const e=document.createElement("div");return e.classList.add("dv-popout-window"),e.id="dv-popout-window",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0px",e.style.left="0px",e}}class _t extends _{constructor(e){super(),this.accessor=e,this.init()}init(){const e=new Set,t=new Set;this.addDisposables(this.accessor.onDidAddPanel(t=>{if(e.has(t.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddPanel] called for panel ${t.api.id} but panel already exists`);e.add(t.api.id)}),this.accessor.onDidRemovePanel(t=>{if(!e.has(t.api.id))throw new Error(`dockview: Invalid event sequence. [onDidRemovePanel] called for panel ${t.api.id} but panel does not exists`);e.delete(t.api.id)}),this.accessor.onDidAddGroup(e=>{if(t.has(e.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddGroup] called for group ${e.api.id} but group already exists`);t.add(e.api.id)}),this.accessor.onDidRemoveGroup(e=>{if(!t.has(e.api.id))throw new Error(`dockview: Invalid event sequence. [onDidRemoveGroup] called for group ${e.api.id} but group does not exists`);t.delete(e.api.id)}))}}class wt extends _{constructor(e){super(),this.root=e,this._active=null,this._activeDisposable=new w,this._element=document.createElement("div"),this._element.className="dv-popover-anchor",this._element.style.position="relative",this.root.prepend(this._element),this.addDisposables(p.from(()=>{this.close()}),this._activeDisposable)}openPopover(e,t){var n;this.close();const i=document.createElement("div");i.style.position="absolute",i.style.zIndex=null!==(n=t.zIndex)&&void 0!==n?n:"var(--dv-overlay-z-index)",i.appendChild(e);const r=this._element.getBoundingClientRect(),o=r.left,s=r.top;i.style.top=t.y-s+"px",i.style.left=t.x-o+"px",this._element.appendChild(i),this._active=i,this._activeDisposable.value=new _(b(window,"pointerdown",e=>{var t;const n=e.target;if(!(n instanceof HTMLElement))return;let r=n;for(;r&&r!==i;)r=null!==(t=null===r||void 0===r?void 0:r.parentElement)&&void 0!==t?t:null;r||this.close()})),requestAnimationFrame(()=>{!function(e,t){const n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{buffer:10}).buffer,i=e.getBoundingClientRect(),r=t.getBoundingClientRect();let o=0,s=0;const a=i.left-r.left,l=i.top-r.top,c=i.bottom-r.bottom,u=i.right-r.right;a<n?o=n-a:u>n&&(o=-n-u),l<n?s=n-l:c>n&&(s=-c-n),0===o&&0===s||(e.style.transform=`translate(${o}px, ${s}px)`)}(i,this.root)})}close(){this._active&&(this._active.remove(),this._activeDisposable.dispose(),this._active=null)}}class St extends _{get disabled(){return this._disabled}set disabled(e){var t;this.disabled!==e&&(this._disabled=e,e&&(null===(t=this.model)||void 0===t||t.clear()))}get model(){if(!this.disabled)return{clear:()=>{var e;this._model&&(null===(e=this._model.root.parentElement)||void 0===e||e.removeChild(this._model.root)),this._model=void 0},exists:()=>!!this._model,getElements:(e,t)=>{const n=this._outline!==t;if(this._outline=t,this._model)return this._model.changed=n,this._model;const i=this.createContainer(),r=this.createAnchor();if(this._model={root:i,overlay:r,changed:n},i.appendChild(r),this.element.appendChild(i),(null===e||void 0===e?void 0:e.target)instanceof HTMLElement){const t=e.target.getBoundingClientRect(),n=this.element.getBoundingClientRect();r.style.left=t.left-n.left+"px",r.style.top=t.top-n.top+"px"}return this._model}}}constructor(e,t){super(),this.element=e,this._disabled=!1,this._disabled=t.disabled,this.addDisposables(p.from(()=>{var e;null===(e=this.model)||void 0===e||e.clear()}))}createContainer(){const e=document.createElement("div");return e.className="dv-drop-target-container",e}createAnchor(){const e=document.createElement("div");return e.className="dv-drop-target-anchor",e.style.visibility="hidden",e}}const Mt={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function Et(e){const t=e.from.activePanel;[...e.from.panels].map(t=>{const n=e.from.model.removePanel(t);return e.from.model.renderContainer.detatch(t),n}).forEach(n=>{e.to.model.openPanel(n,{skipSetActive:t!==n,skipSetGroupActive:!0})})}class Ct extends he{get orientation(){return this.gridview.orientation}get totalPanels(){return this.panels.length}get panels(){return this.groups.flatMap(e=>e.panels)}get options(){return this._options}get activePanel(){const e=this.activeGroup;if(e)return e.activePanel}get renderer(){var e;return null!==(e=this.options.defaultRenderer)&&void 0!==e?e:"onlyWhenVisible"}get api(){return this._api}get floatingGroups(){return this._floatingGroups}get popoutRestorationPromise(){return this._popoutRestorationPromise}constructor(e,t){var n,i,r;super(e,{proportionalLayout:!0,orientation:W.HORIZONTAL,styles:t.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:t.disableAutoResizing,locked:t.locked,margin:null!==(i=null===(n=t.theme)||void 0===n?void 0:n.gap)&&void 0!==i?i:0,className:t.className}),this.nextGroupId=V(),this._deserializer=new at(this),this._watermark=null,this._onWillDragPanel=new y,this.onWillDragPanel=this._onWillDragPanel.event,this._onWillDragGroup=new y,this.onWillDragGroup=this._onWillDragGroup.event,this._onDidDrop=new y,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new y,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new y,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onUnhandledDragOverEvent=new y,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._onDidRemovePanel=new y,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidAddPanel=new y,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPopoutGroupSizeChange=new y,this.onDidPopoutGroupSizeChange=this._onDidPopoutGroupSizeChange.event,this._onDidPopoutGroupPositionChange=new y,this.onDidPopoutGroupPositionChange=this._onDidPopoutGroupPositionChange.event,this._onDidOpenPopoutWindowFail=new y,this.onDidOpenPopoutWindowFail=this._onDidOpenPopoutWindowFail.event,this._onDidLayoutFromJSON=new y,this.onDidLayoutFromJSON=this._onDidLayoutFromJSON.event,this._onDidActivePanelChange=new y({replay:!0}),this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onDidMovePanel=new y,this.onDidMovePanel=this._onDidMovePanel.event,this._onDidMaximizedGroupChange=new y,this.onDidMaximizedGroupChange=this._onDidMaximizedGroupChange.event,this._floatingGroups=[],this._popoutGroups=[],this._popoutRestorationPromise=Promise.resolve(),this._onDidRemoveGroup=new y,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new y,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidOptionsChange=new y,this.onDidOptionsChange=this._onDidOptionsChange.event,this._onDidActiveGroupChange=new y,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._moving=!1,this._options=t,this.popupService=new wt(this.element),this._themeClassnames=new L(this.element),this._api=new ge(this),this.rootDropTargetContainer=new St(this.element,{disabled:!0}),this.overlayRenderContainer=new yt(this.gridview.element,this),this._rootDropTarget=new Me(this.element,{className:"dv-drop-target-edge",canDisplayOverlay:(e,t)=>{const n=u();if(n)return n.viewId===this.id&&("center"!==t||0===this.gridview.length);if("center"===t&&0!==this.gridview.length)return!1;const i=new Xe(e,"edge",t,u);return this._onUnhandledDragOverEvent.fire(i),i.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:null!==(r=t.rootOverlayModel)&&void 0!==r?r:Mt,getOverrideTarget:()=>{var e;return null===(e=this.rootDropTargetContainer)||void 0===e?void 0:e.model}}),this.updateDropTargetModel(t),T(this.gridview.element,"dv-dockview",!0),T(this.element,"dv-debug",!!t.debug),this.updateTheme(),this.updateWatermark(),t.debug&&this.addDisposables(new _t(this)),this.addDisposables(this.rootDropTargetContainer,this.overlayRenderContainer,this._onWillDragPanel,this._onWillDragGroup,this._onWillShowOverlay,this._onDidActivePanelChange,this._onDidAddPanel,this._onDidRemovePanel,this._onDidLayoutFromJSON,this._onDidDrop,this._onWillDrop,this._onDidMovePanel,this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this._onUnhandledDragOverEvent,this._onDidMaximizedGroupChange,this._onDidOptionsChange,this._onDidPopoutGroupSizeChange,this._onDidPopoutGroupPositionChange,this._onDidOpenPopoutWindowFail,this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.updateWatermark()}),this.onDidAdd(e=>{this._moving||this._onDidAddGroup.fire(e)}),this.onDidRemove(e=>{this._moving||this._onDidRemoveGroup.fire(e)}),this.onDidActiveChange(e=>{this._moving||this._onDidActiveGroupChange.fire(e)}),this.onDidMaximizedChange(e=>{this._onDidMaximizedGroupChange.fire({group:e.panel,isMaximized:e.isMaximized})}),h.any(this.onDidAdd,this.onDidRemove)(()=>{this.updateWatermark()}),h.any(this.onDidAddPanel,this.onDidRemovePanel,this.onDidAddGroup,this.onDidRemove,this.onDidMovePanel,this.onDidActivePanelChange,this.onDidPopoutGroupPositionChange,this.onDidPopoutGroupSizeChange)(()=>{this._bufferOnDidLayoutChange.fire()}),p.from(()=>{for(const e of[...this._floatingGroups])e.dispose();for(const e of[...this._popoutGroups])e.disposable.dispose()}),this._rootDropTarget,this._rootDropTarget.onWillShowOverlay(e=>{this.gridview.length>0&&"center"===e.position||this._onWillShowOverlay.fire(new Ue(e,{kind:"edge",panel:void 0,api:this._api,group:void 0,getData:u}))}),this._rootDropTarget.onDrop(e=>{var t;const n=new qe({nativeEvent:e.nativeEvent,position:e.position,panel:void 0,api:this._api,group:void 0,getData:u,kind:"edge"});if(this._onWillDrop.fire(n),n.defaultPrevented)return;const i=u();i?this.moveGroupOrPanel({from:{groupId:i.groupId,panelId:null!==(t=i.panelId)&&void 0!==t?t:void 0},to:{group:this.orthogonalize(e.position),position:"center"}}):this._onDidDrop.fire(new $e({nativeEvent:e.nativeEvent,position:e.position,panel:void 0,api:this._api,group:void 0,getData:u}))}),this._rootDropTarget)}setVisible(e,t){switch(e.api.location.type){case"grid":super.setVisible(e,t);break;case"floating":{const n=this.floatingGroups.find(t=>t.group===e);n&&(n.overlay.setVisible(t),e.api._onDidVisibilityChange.fire({isVisible:t}));break}case"popout":console.warn("dockview: You cannot hide a group that is in a popout window")}}addPopoutGroup(e,t){var n,i,r,o,s;if(e instanceof rt&&1===e.group.size)return this.addPopoutGroup(e.group,t);const a=function(e){function t(e){const t=[];for(let n=0;n<e.classList.length;n++)t.push(e.classList.item(n));return t}let n,i=e;for(;null!==i&&(n=t(i).find(e=>e.startsWith("dockview-theme-")),"string"!==typeof n);)i=i.parentElement;return n}(this.gridview.element),l=this.element;const c=(null===t||void 0===t?void 0:t.position)?t.position:e instanceof tt?e.element.getBoundingClientRect():e.group?e.group.element.getBoundingClientRect():l.getBoundingClientRect(),u=null!==(i=null===(n=null===t||void 0===t?void 0:t.overridePopoutGroup)||void 0===n?void 0:n.id)&&void 0!==i?i:this.getNextGroupId(),d=new xt(`${this.id}-${u}`,null!==a&&void 0!==a?a:"",{url:null!==(s=null!==(r=null===t||void 0===t?void 0:t.popoutUrl)&&void 0!==r?r:null===(o=this.options)||void 0===o?void 0:o.popoutUrl)&&void 0!==s?s:"/popout.html",left:window.screenX+c.left,top:window.screenY+c.top,width:c.width,height:c.height,onDidOpen:null===t||void 0===t?void 0:t.onDidOpen,onWillClose:null===t||void 0===t?void 0:t.onWillClose}),h=new _(d,d.onDidClose(()=>{h.dispose()}));return d.open().then(n=>{var i;if(d.isDisposed)return!1;const r=(null===t||void 0===t?void 0:t.referenceGroup)?t.referenceGroup:e instanceof rt?e.group:e,o=e.api.location.type,s=null!==r.element.parentElement;let a;if(s?(null===t||void 0===t?void 0:t.overridePopoutGroup)?a=t.overridePopoutGroup:(a=this.createGroup({id:u}),n&&this._onDidAddGroup.fire(a)):a=r,null===n)return console.error("dockview: failed to create popout. perhaps you need to allow pop-ups for this website"),h.dispose(),this._onDidOpenPopoutWindowFail.fire(),this.movingLock(()=>Et({from:a,to:r})),r.api.isVisible||r.api.setVisible(!0),!1;const l=document.createElement("div");l.className="dv-overlay-render-container";const c=new yt(l,this);let f;if(a.model.renderContainer=c,a.layout(d.window.innerWidth,d.window.innerHeight),!(null===t||void 0===t?void 0:t.overridePopoutGroup)&&s)if(e instanceof rt)this.movingLock(()=>{const t=r.model.removePanel(e);a.model.openPanel(t)});else switch(this.movingLock(()=>Et({from:r,to:a})),o){case"grid":r.api.setVisible(!1);break;case"floating":case"popout":f=null===(i=this._floatingGroups.find(t=>t.group.api.id===e.api.id))||void 0===i?void 0:i.overlay.toJSON(),this.removeGroup(r)}n.classList.add("dv-dockview"),n.style.overflow="hidden",n.appendChild(l),n.appendChild(a.element);const m=document.createElement("div"),g=new St(m,{disabled:this.rootDropTargetContainer.disabled});let v;n.appendChild(m),a.model.dropTargetContainer=g,a.model.location={type:"popout",getWindow:()=>d.window,popoutUrl:null===t||void 0===t?void 0:t.popoutUrl},s&&"grid"===e.api.location.type&&e.api.setVisible(!1),this.doSetGroupAndPanelActive(a),h.addDisposables(a.api.onDidActiveChange(e=>{var t;e.isActive&&(null===(t=d.window)||void 0===t||t.focus())}),a.api.onWillFocus(()=>{var e;null===(e=d.window)||void 0===e||e.focus()}));const x=s&&r&&this.getPanel(r.id),w={window:d,popoutGroup:a,referenceGroup:x?r.id:void 0,disposable:{dispose:()=>(h.dispose(),v)}},S=function(e){const t=new y;let n,i=e.screenX,r=e.screenY;const o=()=>{if(e.closed)return;const s=e.screenX,a=e.screenY;s===i&&a===r||(clearTimeout(n),n=setTimeout(()=>{t.fire()},100),i=s,r=a),requestAnimationFrame(o)};return o(),t}(d.window);return h.addDisposables(S,function(e,t){let n;return new _(b(e,"resize",()=>{clearTimeout(n),n=setTimeout(()=>{t()},100)}))}(d.window,()=>{this._onDidPopoutGroupSizeChange.fire({width:d.window.innerWidth,height:d.window.innerHeight,group:a})}),S.event(()=>{this._onDidPopoutGroupPositionChange.fire({screenX:d.window.screenX,screenY:d.window.screenX,group:a})}),b(d.window,"resize",()=>{a.layout(d.window.innerWidth,d.window.innerHeight)}),c,p.from(()=>{if(!this.isDisposed)if(s&&this.getPanel(r.id))this.movingLock(()=>Et({from:a,to:r})),r.api.isVisible||r.api.setVisible(!0),this.getPanel(a.id)&&this.doRemoveGroup(a,{skipPopoutAssociated:!0});else if(this.getPanel(a.id)){a.model.renderContainer=this.overlayRenderContainer,a.model.dropTargetContainer=this.rootDropTargetContainer,v=a;const e=!this._popoutGroups.find(e=>e.popoutGroup===a);if(e)return;f?this.addFloatingGroup(a,{height:f.height,width:f.width,position:f}):(this.doRemoveGroup(a,{skipDispose:!0,skipActive:!0,skipPopoutReturn:!0}),a.model.location={type:"grid"},this.movingLock(()=>{this.doAddGroup(a,[0])})),this.doSetGroupAndPanelActive(a)}})),this._popoutGroups.push(w),this.updateWatermark(),!0}).catch(e=>(console.error("dockview: failed to create popout.",e),!1))}addFloatingGroup(e,t){var n,i,r,o,s;let a;if(e instanceof rt)a=this.createGroup(),this._onDidAddGroup.fire(a),this.movingLock(()=>this.removePanel(e,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})),this.movingLock(()=>a.model.openPanel(e,{skipSetGroupActive:!0}));else{a=e;const i=null===(n=this._popoutGroups.find(e=>e.popoutGroup===a))||void 0===n?void 0:n.referenceGroup,r=i?this.getPanel(i):void 0;"boolean"===typeof(null===t||void 0===t?void 0:t.skipRemoveGroup)&&t.skipRemoveGroup||(r?(this.movingLock(()=>Et({from:e,to:r})),this.doRemoveGroup(e,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(r,{skipDispose:!0}),a=r):this.doRemoveGroup(e,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}const l=function(){if(null===t||void 0===t?void 0:t.position){const e={};return"left"in t.position?e.left=Math.max(t.position.left,0):"right"in t.position?e.right=Math.max(t.position.right,0):e.left=pt,"top"in t.position?e.top=Math.max(t.position.top,0):"bottom"in t.position?e.bottom=Math.max(t.position.bottom,0):e.top=ft,"number"===typeof t.width?e.width=Math.max(t.width,0):e.width=mt,"number"===typeof t.height?e.height=Math.max(t.height,0):e.height=gt,e}return{left:"number"===typeof(null===t||void 0===t?void 0:t.x)?Math.max(t.x,0):pt,top:"number"===typeof(null===t||void 0===t?void 0:t.y)?Math.max(t.y,0):ft,width:"number"===typeof(null===t||void 0===t?void 0:t.width)?Math.max(t.width,0):mt,height:"number"===typeof(null===t||void 0===t?void 0:t.height)?Math.max(t.height,0):gt}}(),c=new ut(Object.assign(Object.assign({container:this.gridview.element,content:a.element},l),{minimumInViewportWidth:"boundedWithinViewport"===this.options.floatingGroupBounds?void 0:null!==(r=null===(i=this.options.floatingGroupBounds)||void 0===i?void 0:i.minimumWidthWithinViewport)&&void 0!==r?r:ht,minimumInViewportHeight:"boundedWithinViewport"===this.options.floatingGroupBounds?void 0:null!==(s=null===(o=this.options.floatingGroupBounds)||void 0===o?void 0:o.minimumHeightWithinViewport)&&void 0!==s?s:ht})),u=a.element.querySelector(".dv-void-container");if(!u)throw new Error("failed to find drag handle");c.setupDrag(u,{inDragMode:"boolean"===typeof(null===t||void 0===t?void 0:t.inDragMode)&&t.inDragMode});const d=new dt(a,c),h=new _(a.api.onDidActiveChange(e=>{e.isActive&&c.bringToFront()}),M(a.element,e=>{const{width:t,height:n}=e.contentRect;a.layout(t,n)}));d.addDisposables(c.onDidChange(()=>{a.layout(a.width,a.height)}),c.onDidChangeEnd(()=>{this._bufferOnDidLayoutChange.fire()}),a.onDidChange(e=>{c.setBounds({height:null===e||void 0===e?void 0:e.height,width:null===e||void 0===e?void 0:e.width})}),{dispose:()=>{h.dispose(),j(this._floatingGroups,d),a.model.location={type:"grid"},this.updateWatermark()}}),this._floatingGroups.push(d),a.model.location={type:"floating"},(null===t||void 0===t?void 0:t.skipActiveGroup)||this.doSetGroupAndPanelActive(a),this.updateWatermark()}orthogonalize(e,t){switch(this.gridview.normalize(),e){case"top":case"bottom":this.gridview.orientation===W.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===W.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot()}switch(e){case"top":case"left":case"center":return this.createGroupAtLocation([0],void 0,t);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length],void 0,t);default:throw new Error(`unsupported position ${e}`)}}updateOptions(e){var t,n;if(super.updateOptions(e),"floatingGroupBounds"in e)for(const r of this._floatingGroups){switch(e.floatingGroupBounds){case"boundedWithinViewport":r.overlay.minimumInViewportHeight=void 0,r.overlay.minimumInViewportWidth=void 0;break;case void 0:r.overlay.minimumInViewportHeight=ht,r.overlay.minimumInViewportWidth=ht;break;default:r.overlay.minimumInViewportHeight=null===(t=e.floatingGroupBounds)||void 0===t?void 0:t.minimumHeightWithinViewport,r.overlay.minimumInViewportWidth=null===(n=e.floatingGroupBounds)||void 0===n?void 0:n.minimumWidthWithinViewport}r.overlay.setBounds()}this.updateDropTargetModel(e);const i=this.options.disableDnd;this._options=Object.assign(Object.assign({},this.options),e);i!==this.options.disableDnd&&this.updateDragAndDropState(),"theme"in e&&this.updateTheme(),this.layout(this.gridview.width,this.gridview.height,!0)}layout(e,t,n){if(super.layout(e,t,n),this._floatingGroups)for(const i of this._floatingGroups)i.overlay.setBounds()}updateDragAndDropState(){for(const e of this.groups)e.model.updateDragAndDropState()}focus(){var e;null===(e=this.activeGroup)||void 0===e||e.focus()}getGroupPanel(e){return this.panels.find(t=>t.id===e)}setActivePanel(e){e.group.model.openPanel(e),this.doSetGroupAndPanelActive(e.group)}moveToNext(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[e.group.panels.length-1])return void e.group.model.moveToNext({suppressRoll:!0});const n=ie(e.group.element),i=null===(t=this.gridview.next(n))||void 0===t?void 0:t.view;this.doSetGroupAndPanelActive(i)}moveToPrevious(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[0])return void e.group.model.moveToPrevious({suppressRoll:!0});const n=ie(e.group.element),i=null===(t=this.gridview.previous(n))||void 0===t?void 0:t.view;i&&this.doSetGroupAndPanelActive(i)}toJSON(){var e;const t=this.gridview.serialize(),n=this.panels.reduce((e,t)=>(e[t.id]=t.toJSON(),e),{}),i=this._floatingGroups.map(e=>({data:e.group.toJSON(),position:e.overlay.toJSON()})),r=this._popoutGroups.map(e=>({data:e.popoutGroup.toJSON(),gridReferenceGroup:e.referenceGroup,position:e.window.dimensions(),url:"popout"===e.popoutGroup.api.location.type?e.popoutGroup.api.location.popoutUrl:void 0})),o={grid:t,panels:n,activeGroup:null===(e=this.activeGroup)||void 0===e?void 0:e.id};return i.length>0&&(o.floatingGroups=i),r.length>0&&(o.popoutGroups=r),o}fromJSON(e){var t,n;if(this.clear(),"object"!==typeof e||null===e)throw new Error("serialized layout must be a non-null object");const{grid:i,panels:r,activeGroup:o}=e;if("branch"!==i.root.type||!Array.isArray(i.root.data))throw new Error("root must be of type branch");try{const s=this.width,a=this.height,l=e=>{const{id:t,locked:n,hideHeader:i,views:o,activeView:s}=e;if("string"!==typeof t)throw new Error("group id must be of type string");const a=this.createGroup({id:t,locked:!!n,hideHeader:!!i});this._onDidAddGroup.fire(a);const l=[];for(const c of o){const e=this._deserializer.fromJSON(r[c],a);l.push(e)}for(let r=0;r<o.length;r++){const e=l[r],t="string"===typeof s&&s===e.id;a.model.openPanel(e,{skipSetActive:!t,skipSetGroupActive:!0})}return!a.activePanel&&a.panels.length>0&&a.model.openPanel(a.panels[a.panels.length-1],{skipSetGroupActive:!0}),a};this.gridview.deserialize(i,{fromJSON:e=>l(e.data)}),this.layout(s,a,!0);const c=null!==(t=e.floatingGroups)&&void 0!==t?t:[];for(const e of c){const{data:t,position:n}=e,i=l(t);this.addFloatingGroup(i,{position:n,width:n.width,height:n.height,skipRemoveGroup:!0,inDragMode:!1})}const u=null!==(n=e.popoutGroups)&&void 0!==n?n:[],d=[];u.forEach((e,t)=>{const{data:n,position:i,gridReferenceGroup:r,url:o}=e,s=l(n),a=new Promise(e=>{setTimeout(()=>{this.addPopoutGroup(s,{position:null!==i&&void 0!==i?i:void 0,overridePopoutGroup:r?s:void 0,referenceGroup:r?this.getPanel(r):void 0,popoutUrl:o}),e()},100*t)});d.push(a)}),this._popoutRestorationPromise=Promise.all(d).then(()=>{});for(const e of this._floatingGroups)e.overlay.setBounds();if("string"===typeof o){const e=this.getPanel(o);e&&this.doSetGroupAndPanelActive(e)}}catch(s){console.error("dockview: failed to deserialize layout. Reverting changes",s);for(const e of this.groups)for(const t of e.panels)this.removePanel(t,{removeEmptyGroup:!1,skipDispose:!1});for(const e of this.groups)e.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e);for(const e of[...this._floatingGroups])e.dispose();throw this.clear(),s}this.updateWatermark(),requestAnimationFrame(()=>{this.overlayRenderContainer.updateAllPositions()}),this._onDidLayoutFromJSON.fire()}clear(){const e=Array.from(this._groups.values()).map(e=>e.value),t=!!this.activeGroup;for(const n of e)this.removeGroup(n,{skipActive:!0});t&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()}closeAllGroups(){for(const e of this._groups.entries()){const[t,n]=e;n.value.model.closeAllPanels()}}addPanel(e){var t,n;if(this.panels.find(t=>t.id===e.id))throw new Error(`panel with id ${e.id} already exists`);let i;if(e.position&&e.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");const r={width:e.initialWidth,height:e.initialHeight};let o,s;if(e.position)if(function(e){return!!e.referencePanel}(e.position)){const t="string"===typeof e.position.referencePanel?this.getGroupPanel(e.position.referencePanel):e.position.referencePanel;if(o=e.position.index,!t)throw new Error(`referencePanel '${e.position.referencePanel}' does not exist`);i=this.findGroup(t)}else{if(!function(e){return!!e.referenceGroup}(e.position)){const t=this.orthogonalize(xe(e.position.direction)),n=this.createPanel(e,t);return t.model.openPanel(n,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),e.inactive||this.doSetGroupAndPanelActive(t),t.api.setSize({height:null===r||void 0===r?void 0:r.height,width:null===r||void 0===r?void 0:r.width}),n}if(i="string"===typeof e.position.referenceGroup?null===(t=this._groups.get(e.position.referenceGroup))||void 0===t?void 0:t.value:e.position.referenceGroup,o=e.position.index,!i)throw new Error(`referenceGroup '${e.position.referenceGroup}' does not exist`)}else i=this.activeGroup;if(i){const t=de((null===(n=e.position)||void 0===n?void 0:n.direction)||"within");if(e.floating){const t=this.createGroup();this._onDidAddGroup.fire(t);const n="object"===typeof e.floating&&null!==e.floating?e.floating:{};this.addFloatingGroup(t,Object.assign(Object.assign({},n),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),s=this.createPanel(e,t),t.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o})}else if("floating"===i.api.location.type||"center"===t)s=this.createPanel(e,i),i.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),i.api.setSize({width:null===r||void 0===r?void 0:r.width,height:null===r||void 0===r?void 0:r.height}),e.inactive||this.doSetGroupAndPanelActive(i);else{const n=ie(i.element),a=re(this.gridview.orientation,n,t),l=this.createGroupAtLocation(a,this.orientationAtLocation(a)===W.VERTICAL?null===r||void 0===r?void 0:r.height:null===r||void 0===r?void 0:r.width);s=this.createPanel(e,l),l.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),e.inactive||this.doSetGroupAndPanelActive(l)}}else if(e.floating){const t=this.createGroup();this._onDidAddGroup.fire(t);const n="object"===typeof e.floating&&null!==e.floating?e.floating:{};this.addFloatingGroup(t,Object.assign(Object.assign({},n),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),s=this.createPanel(e,t),t.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o})}else{const t=this.createGroupAtLocation([0],this.gridview.orientation===W.VERTICAL?null===r||void 0===r?void 0:r.height:null===r||void 0===r?void 0:r.width);s=this.createPanel(e,t),t.model.openPanel(s,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:o}),e.inactive||this.doSetGroupAndPanelActive(t)}return s}removePanel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{removeEmptyGroup:!0};const n=e.group;if(!n)throw new Error(`cannot remove panel ${e.id}. it's missing a group.`);n.model.removePanel(e,{skipSetActiveGroup:t.skipSetActiveGroup}),t.skipDispose||(e.group.model.renderContainer.detatch(e),e.dispose()),0===n.size&&t.removeEmptyGroup&&this.removeGroup(n,{skipActive:t.skipSetActiveGroup})}createWatermarkComponent(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new lt}updateWatermark(){var e,t;if(0===this.groups.filter(e=>"grid"===e.api.location.type&&e.api.isVisible).length){if(!this._watermark){this._watermark=this.createWatermarkComponent(),this._watermark.init({containerApi:new ge(this)});const e=document.createElement("div");e.className="dv-watermark-container",function(e,t){e.setAttribute("data-testid",t)}(e,"watermark-component"),e.appendChild(this._watermark.element),this.gridview.element.appendChild(e)}}else this._watermark&&(this._watermark.element.parentElement.remove(),null===(t=(e=this._watermark).dispose)||void 0===t||t.call(e),this._watermark=null)}addGroup(e){var t;if(e){let n;if(function(e){return!!e.referencePanel}(e)){const t="string"===typeof e.referencePanel?this.panels.find(t=>t.id===e.referencePanel):e.referencePanel;if(!t)throw new Error(`reference panel ${e.referencePanel} does not exist`);if(n=this.findGroup(t),!n)throw new Error(`reference group for reference panel ${e.referencePanel} does not exist`)}else{if(!function(e){return!!e.referenceGroup}(e)){const t=this.orthogonalize(xe(e.direction),e);return e.skipSetActive||this.doSetGroupAndPanelActive(t),t}if(n="string"===typeof e.referenceGroup?null===(t=this._groups.get(e.referenceGroup))||void 0===t?void 0:t.value:e.referenceGroup,!n)throw new Error(`reference group ${e.referenceGroup} does not exist`)}const i=de(e.direction||"within"),r=ie(n.element),o=re(this.gridview.orientation,r,i),s=this.createGroup(e),a=this.getLocationOrientation(o)===W.VERTICAL?e.initialHeight:e.initialWidth;return this.doAddGroup(s,o,a),e.skipSetActive||this.doSetGroupAndPanelActive(s),s}{const t=this.createGroup(e);return this.doAddGroup(t),this.doSetGroupAndPanelActive(t),t}}getLocationOrientation(e){return e.length%2==0&&this.gridview.orientation===W.HORIZONTAL?W.HORIZONTAL:W.VERTICAL}removeGroup(e,t){this.doRemoveGroup(e,t)}doRemoveGroup(e,t){var n;const i=[...e.panels];if(!(null===t||void 0===t?void 0:t.skipDispose))for(const s of i)this.removePanel(s,{removeEmptyGroup:!1,skipDispose:null!==(n=null===t||void 0===t?void 0:t.skipDispose)&&void 0!==n&&n});const r=this.activePanel;if("floating"===e.api.location.type){const n=this._floatingGroups.find(t=>t.group===e);if(n){if((null===t||void 0===t?void 0:t.skipDispose)||(n.group.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)),j(this._floatingGroups,n),n.dispose(),!(null===t||void 0===t?void 0:t.skipActive)&&this._activeGroup===e){const e=Array.from(this._groups.values());this.doSetGroupAndPanelActive(e.length>0?e[0].value:void 0)}return n.group}throw new Error("failed to find floating group")}if("popout"===e.api.location.type){const n=this._popoutGroups.find(t=>t.popoutGroup===e);if(n){if(!(null===t||void 0===t?void 0:t.skipDispose)){if(!(null===t||void 0===t?void 0:t.skipPopoutAssociated)){const e=n.referenceGroup?this.getPanel(n.referenceGroup):void 0;e&&0===e.panels.length&&this.removeGroup(e)}n.popoutGroup.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)}j(this._popoutGroups,n);const i=n.disposable.dispose();if(!(null===t||void 0===t?void 0:t.skipPopoutReturn)&&i&&(this.doAddGroup(i,[0]),this.doSetGroupAndPanelActive(i)),!(null===t||void 0===t?void 0:t.skipActive)&&this._activeGroup===e){const e=Array.from(this._groups.values());this.doSetGroupAndPanelActive(e.length>0?e[0].value:void 0)}return this.updateWatermark(),n.popoutGroup}throw new Error("failed to find popout group")}const o=super.doRemoveGroup(e,t);return(null===t||void 0===t?void 0:t.skipActive)||this.activePanel!==r&&this._onDidActivePanelChange.fire(this.activePanel),o}movingLock(e){const t=this._moving;try{return this._moving=!0,e()}finally{this._moving=t}}moveGroupOrPanel(e){var t;const n=e.to.group,i=e.from.groupId,r=e.from.panelId,o=e.to.position,s=e.to.index,a=i?null===(t=this._groups.get(i))||void 0===t?void 0:t.value:void 0;if(!a)throw new Error(`Failed to find group id ${i}`);if(void 0!==r)if(o&&"center"!==o){const e=ie(n.element),t=re(this.gridview.orientation,e,o);if(a.size<2){const[e,i]=O(t);if("grid"===a.api.location.type){const t=ie(a.element),[n,o]=O(t);if(z(n,e))return this.gridview.moveView(n,o,i),void this._onDidMovePanel.fire({panel:this.getGroupPanel(r),from:a})}if("popout"===a.api.location.type){const e=this._popoutGroups.find(e=>e.popoutGroup===a),n=this.movingLock(()=>e.popoutGroup.model.removePanel(e.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0}));this.doRemoveGroup(a,{skipActive:!0});const i=this.createGroupAtLocation(t);return this.movingLock(()=>i.model.openPanel(n)),this.doSetGroupAndPanelActive(i),void this._onDidMovePanel.fire({panel:this.getGroupPanel(r),from:a})}const s=this.movingLock(()=>this.doRemoveGroup(a,{skipActive:!0,skipDispose:!0})),l=ie(n.element),c=re(this.gridview.orientation,l,o);this.movingLock(()=>this.doAddGroup(s,c)),this.doSetGroupAndPanelActive(s),this._onDidMovePanel.fire({panel:this.getGroupPanel(r),from:a})}else{const t=this.movingLock(()=>a.model.removePanel(r,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!t)throw new Error(`No panel with id ${r}`);const n=re(this.gridview.orientation,e,o),i=this.createGroupAtLocation(n);this.movingLock(()=>i.model.openPanel(t,{skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(i),this._onDidMovePanel.fire({panel:t,from:a})}}else{const t=this.movingLock(()=>a.model.removePanel(r,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!t)throw new Error(`No panel with id ${r}`);0===a.model.size&&this.doRemoveGroup(a,{skipActive:!0});const i=0===n.model.size;this.movingLock(()=>{var r;return n.model.openPanel(t,{index:s,skipSetActive:null!==(r=e.skipSetActive)&&void 0!==r&&r&&!i,skipSetGroupActive:!0})}),e.skipSetActive||this.doSetGroupAndPanelActive(n),this._onDidMovePanel.fire({panel:t,from:a})}else this.moveGroup({from:{group:a},to:{group:n,position:o},skipSetActive:e.skipSetActive})}moveGroup(e){const t=e.from.group,n=e.to.group,i=e.to.position;if("center"===i){const i=t.activePanel,r=this.movingLock(()=>[...t.panels].map(e=>t.model.removePanel(e.id,{skipSetActive:!0})));0===(null===t||void 0===t?void 0:t.model.size)&&this.doRemoveGroup(t,{skipActive:!0}),this.movingLock(()=>{for(const e of r)n.model.openPanel(e,{skipSetActive:e!==i,skipSetGroupActive:!0})}),!0!==e.skipSetActive?this.doSetGroupAndPanelActive(n):this.activePanel||this.doSetGroupAndPanelActive(n)}else{switch(t.api.location.type){case"grid":this.gridview.removeView(ie(t.element));break;case"floating":{const e=this._floatingGroups.find(e=>e.group===t);if(!e)throw new Error("failed to find floating group");e.dispose();break}case"popout":{const e=this._popoutGroups.find(e=>e.popoutGroup===t);if(!e)throw new Error("failed to find popout group");const i=this._popoutGroups.indexOf(e);if(i>=0&&this._popoutGroups.splice(i,1),e.referenceGroup){const t=this.getPanel(e.referenceGroup);t&&!t.api.isVisible&&this.doRemoveGroup(t,{skipActive:!0})}e.window.dispose(),"grid"===n.api.location.type?(t.model.renderContainer=this.overlayRenderContainer,t.model.dropTargetContainer=this.rootDropTargetContainer,t.model.location={type:"grid"}):"floating"===n.api.location.type&&(t.model.renderContainer=this.overlayRenderContainer,t.model.dropTargetContainer=this.rootDropTargetContainer,t.model.location={type:"floating"});break}}if("grid"===n.api.location.type){const e=ie(n.element),r=re(this.gridview.orientation,e,i);let o;switch(this.gridview.orientation){case W.VERTICAL:o=e.length%2==0?t.api.width:t.api.height;break;case W.HORIZONTAL:o=e.length%2==0?t.api.height:t.api.width}this.gridview.addView(t,o,r)}else if("floating"===n.api.location.type){const e=this._floatingGroups.find(e=>e.group===n);if(e){const n=e.overlay.toJSON();let i,r;i="left"in n?n.left+50:"right"in n?Math.max(0,n.right-n.width-50):50,r="top"in n?n.top+50:"bottom"in n?Math.max(0,n.bottom-n.height-50):50,this.addFloatingGroup(t,{height:n.height,width:n.width,position:{left:i,top:r}})}}}if(t.panels.forEach(e=>{this._onDidMovePanel.fire({panel:e,from:t})}),!1===e.skipSetActive){const e=null!==n&&void 0!==n?n:t;this.doSetGroupAndPanelActive(e)}}doSetGroupActive(e){super.doSetGroupActive(e);const t=this.activePanel;this._moving||t===this._onDidActivePanelChange.value||this._onDidActivePanelChange.fire(t)}doSetGroupAndPanelActive(e){super.doSetGroupActive(e);const t=this.activePanel;e&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(e)&&this.exitMaximizedGroup(),this._moving||t===this._onDidActivePanelChange.value||this._onDidActivePanelChange.fire(t)}getNextGroupId(){let e=this.nextGroupId.next();for(;this._groups.has(e);)e=this.nextGroupId.next();return e}createGroup(e){e||(e={});let t=null===e||void 0===e?void 0:e.id;if(t&&this._groups.has(e.id)&&(console.warn(`dockview: Duplicate group id ${null===e||void 0===e?void 0:e.id}. reassigning group id to avoid errors`),t=void 0),!t)for(t=this.nextGroupId.next();this._groups.has(t);)t=this.nextGroupId.next();const n=new tt(this,t,e);if(n.init({params:{},accessor:this}),!this._groups.has(n.id)){const e=new _(n.model.onTabDragStart(e=>{this._onWillDragPanel.fire(e)}),n.model.onGroupDragStart(e=>{this._onWillDragGroup.fire(e)}),n.model.onMove(e=>{const{groupId:t,itemId:i,target:r,index:o}=e;this.moveGroupOrPanel({from:{groupId:t,panelId:i},to:{group:n,position:r,index:o}})}),n.model.onDidDrop(e=>{this._onDidDrop.fire(e)}),n.model.onWillDrop(e=>{this._onWillDrop.fire(e)}),n.model.onWillShowOverlay(e=>{this.options.disableDnd?e.preventDefault():this._onWillShowOverlay.fire(e)}),n.model.onUnhandledDragOverEvent(e=>{this._onUnhandledDragOverEvent.fire(e)}),n.model.onDidAddPanel(e=>{this._moving||this._onDidAddPanel.fire(e.panel)}),n.model.onDidRemovePanel(e=>{this._moving||this._onDidRemovePanel.fire(e.panel)}),n.model.onDidActivePanelChange(e=>{this._moving||e.panel===this.activePanel&&this._onDidActivePanelChange.value!==e.panel&&this._onDidActivePanelChange.fire(e.panel)}),h.any(n.model.onDidPanelTitleChange,n.model.onDidPanelParametersChange)(()=>{this._bufferOnDidLayoutChange.fire()}));this._groups.set(n.id,{value:n,disposable:e})}return n.initialize(),n}createPanel(e,t){var n,i,r;const o=e.component,s=null!==(n=e.tabComponent)&&void 0!==n?n:this.options.defaultTabComponent,a=new st(this,e.id,o,s),l=new rt(e.id,o,s,this,this._api,t,a,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return l.init({title:null!==(i=e.title)&&void 0!==i?i:e.id,params:null!==(r=null===e||void 0===e?void 0:e.params)&&void 0!==r?r:{}}),l}createGroupAtLocation(e,t,n){const i=this.createGroup(n);return this.doAddGroup(i,e,t),i}findGroup(e){var t;return null===(t=Array.from(this._groups.values()).find(t=>t.value.model.containsPanel(e)))||void 0===t?void 0:t.value}orientationAtLocation(e){const t=this.gridview.orientation;return e.length%2==1?t:oe(t)}updateDropTargetModel(e){"dndEdges"in e&&(this._rootDropTarget.disabled="boolean"===typeof e.dndEdges&&!1===e.dndEdges,"object"===typeof e.dndEdges&&null!==e.dndEdges?this._rootDropTarget.setOverlayModel(e.dndEdges):this._rootDropTarget.setOverlayModel(Mt)),"rootOverlayModel"in e&&this.updateDropTargetModel({dndEdges:e.dndEdges})}updateTheme(){var e,t;const n=null!==(e=this._options.theme)&&void 0!==e?e:nt;if(this._themeClassnames.setClassNames(n.className),this.gridview.margin=null!==(t=n.gap)&&void 0!==t?t:0,"absolute"===n.dndOverlayMounting)this.rootDropTargetContainer.disabled=!1;else this.rootDropTargetContainer.disabled=!0}}class Tt extends he{get orientation(){return this.gridview.orientation}set orientation(e){this.gridview.orientation=e}get options(){return this._options}get deserializer(){return this._deserializer}set deserializer(e){this._deserializer=e}constructor(e,t){var n;super(e,{proportionalLayout:null===(n=t.proportionalLayout)||void 0===n||n,orientation:t.orientation,styles:t.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:t.disableAutoResizing,className:t.className}),this._onDidLayoutfromJSON=new y,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidRemoveGroup=new y,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new y,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidActiveGroupChange=new y,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._options=t,this.addDisposables(this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this.onDidAdd(e=>{this._onDidAddGroup.fire(e)}),this.onDidRemove(e=>{this._onDidRemoveGroup.fire(e)}),this.onDidActiveChange(e=>{this._onDidActiveGroupChange.fire(e)}))}updateOptions(e){super.updateOptions(e);const t="string"===typeof e.orientation&&this.gridview.orientation!==e.orientation;this._options=Object.assign(Object.assign({},this.options),e),t&&(this.gridview.orientation=e.orientation),this.layout(this.gridview.width,this.gridview.height,!0)}removePanel(e){this.removeGroup(e)}toJSON(){var e;return{grid:this.gridview.serialize(),activePanel:null===(e=this.activeGroup)||void 0===e?void 0:e.id}}setVisible(e,t){this.gridview.setViewVisible(ie(e.element),t)}setActive(e){this._groups.forEach((t,n)=>{t.value.setActive(e===t.value)})}focus(){var e;null===(e=this.activeGroup)||void 0===e||e.focus()}fromJSON(e){this.clear();const{grid:t,activePanel:n}=e;try{const e=[],i=this.width,r=this.height;if(this.gridview.deserialize(t,{fromJSON:t=>{const{data:n}=t,i=this.options.createComponent({id:n.id,name:n.component});return e.push(()=>i.init({params:n.params,minimumWidth:n.minimumWidth,maximumWidth:n.maximumWidth,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,priority:n.priority,snap:!!n.snap,accessor:this,isVisible:t.visible})),this._onDidAddGroup.fire(i),this.registerPanel(i),i}}),this.layout(i,r,!0),e.forEach(e=>e()),"string"===typeof n){const e=this.getPanel(n);e&&this.doSetGroupActive(e)}}catch(i){for(const e of this.groups)e.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e);throw this.clear(),i}this._onDidLayoutfromJSON.fire()}clear(){const e=this.activeGroup,t=Array.from(this._groups.values());for(const n of t)n.disposable.dispose(),this.doRemoveGroup(n.value,{skipActive:!0});e&&this.doSetGroupActive(void 0),this.gridview.clear()}movePanel(e,t){var n;let i;const r=this.gridview.remove(e),o=null===(n=this._groups.get(t.reference))||void 0===n?void 0:n.value;if(!o)throw new Error(`reference group ${t.reference} does not exist`);const s=de(t.direction);if("center"===s)throw new Error(`${s} not supported as an option`);{const e=ie(o.element);i=re(this.gridview.orientation,e,s)}this.doAddGroup(r,i,t.size)}addPanel(e){var t,n,i,r;let o=null!==(t=e.location)&&void 0!==t?t:[0];if(null===(n=e.position)||void 0===n?void 0:n.referencePanel){const t=null===(i=this._groups.get(e.position.referencePanel))||void 0===i?void 0:i.value;if(!t)throw new Error(`reference group ${e.position.referencePanel} does not exist`);const n=de(e.position.direction);if("center"===n)throw new Error(`${n} not supported as an option`);{const e=ie(t.element);o=re(this.gridview.orientation,e,n)}}const s=this.options.createComponent({id:e.id,name:e.component});return s.init({params:null!==(r=e.params)&&void 0!==r?r:{},minimumWidth:e.minimumWidth,maximumWidth:e.maximumWidth,minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight,priority:e.priority,snap:!!e.snap,accessor:this,isVisible:!0}),this.registerPanel(s),this.doAddGroup(s,o,e.size),this.doSetGroupActive(s),s}registerPanel(e){const t=new _(e.api.onDidFocusChange(t=>{t.isFocused&&this._groups.forEach(t=>{const n=t.value;n!==e?n.setActive(!1):n.setActive(!0)})}));this._groups.set(e.id,{value:e,disposable:t})}moveGroup(e,t,n){const i=this.getPanel(t);if(!i)throw new Error("invalid operation");const r=ie(e.element),o=re(this.gridview.orientation,r,n),[s,a]=O(o),l=ie(i.element),[c,u]=O(l);if(z(c,s))return void this.gridview.moveView(c,u,a);const d=this.doRemoveGroup(i,{skipActive:!0,skipDispose:!0}),h=ie(e.element),p=re(this.gridview.orientation,h,n);this.doAddGroup(d,p)}removeGroup(e){super.removeGroup(e)}dispose(){super.dispose(),this._onDidLayoutfromJSON.dispose()}}class At extends ce{get panels(){return this.splitview.getViews()}get options(){return this._options}get length(){return this._panels.size}get orientation(){return this.splitview.orientation}get splitview(){return this._splitview}set splitview(e){this._splitview&&this._splitview.dispose(),this._splitview=e,this._splitviewChangeDisposable.value=new _(this._splitview.onDidSashEnd(()=>{this._onDidLayoutChange.fire(void 0)}),this._splitview.onDidAddView(e=>this._onDidAddView.fire(e)),this._splitview.onDidRemoveView(e=>this._onDidRemoveView.fire(e)))}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get height(){return this.splitview.orientation===W.HORIZONTAL?this.splitview.orthogonalSize:this.splitview.size}get width(){return this.splitview.orientation===W.HORIZONTAL?this.splitview.size:this.splitview.orthogonalSize}constructor(e,t){var n;super(document.createElement("div"),t.disableAutoResizing),this._splitviewChangeDisposable=new w,this._panels=new Map,this._onDidLayoutfromJSON=new y,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidAddView=new y,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new y,this.onDidRemoveView=this._onDidRemoveView.event,this._onDidLayoutChange=new y,this.onDidLayoutChange=this._onDidLayoutChange.event,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new L(this.element),this._classNames.setClassNames(null!==(n=t.className)&&void 0!==n?n:""),e.appendChild(this.element),this._options=t,this.splitview=new q(this.element,t),this.addDisposables(this._onDidAddView,this._onDidLayoutfromJSON,this._onDidRemoveView,this._onDidLayoutChange)}updateOptions(e){var t,n;"className"in e&&this._classNames.setClassNames(null!==(t=e.className)&&void 0!==t?t:""),"disableResizing"in e&&(this.disableResizing=null!==(n=e.disableAutoResizing)&&void 0!==n&&n),"string"===typeof e.orientation&&(this.splitview.orientation=e.orientation),this._options=Object.assign(Object.assign({},this.options),e),this.splitview.layout(this.splitview.size,this.splitview.orthogonalSize)}focus(){var e;null===(e=this._activePanel)||void 0===e||e.focus()}movePanel(e,t){this.splitview.moveView(e,t)}setVisible(e,t){const n=this.panels.indexOf(e);this.splitview.setViewVisible(n,t)}setActive(e,t){this._activePanel=e,this.panels.filter(t=>t!==e).forEach(e=>{e.api._onDidActiveChange.fire({isActive:!1}),t||e.focus()}),e.api._onDidActiveChange.fire({isActive:!0}),t||e.focus()}removePanel(e,t){const n=this._panels.get(e.id);if(!n)throw new Error(`unknown splitview panel ${e.id}`);n.dispose(),this._panels.delete(e.id);const i=this.panels.findIndex(t=>t===e);this.splitview.removeView(i,t).dispose();const r=this.panels;r.length>0&&this.setActive(r[r.length-1])}getPanel(e){return this.panels.find(t=>t.id===e)}addPanel(e){var t;if(this._panels.has(e.id))throw new Error(`panel ${e.id} already exists`);const n=this.options.createComponent({id:e.id,name:e.component});n.orientation=this.splitview.orientation,n.init({params:null!==(t=e.params)&&void 0!==t?t:{},minimumSize:e.minimumSize,maximumSize:e.maximumSize,snap:e.snap,priority:e.priority,accessor:this});const i="number"===typeof e.size?e.size:$.Distribute,r="number"===typeof e.index?e.index:void 0;return this.splitview.addView(n,i,r),this.doAddView(n),this.setActive(n),n}layout(e,t){const[n,i]=this.splitview.orientation===W.HORIZONTAL?[e,t]:[t,e];this.splitview.layout(n,i)}doAddView(e){const t=e.api.onDidFocusChange(t=>{t.isFocused&&this.setActive(e,!0)});this._panels.set(e.id,t)}toJSON(){var e;const t=this.splitview.getViews().map((e,t)=>({size:this.splitview.getViewSize(t),data:e.toJSON(),snap:!!e.snap,priority:e.priority}));return{views:t,activeView:null===(e=this._activePanel)||void 0===e?void 0:e.id,size:this.splitview.size,orientation:this.splitview.orientation}}fromJSON(e){this.clear();const{views:t,orientation:n,size:i,activeView:r}=e,o=[],s=this.width,a=this.height;if(this.splitview=new q(this.element,{orientation:n,proportionalLayout:this.options.proportionalLayout,descriptor:{size:i,views:t.map(e=>{const t=e.data;if(this._panels.has(t.id))throw new Error(`panel ${t.id} already exists`);const i=this.options.createComponent({id:t.id,name:t.component});return o.push(()=>{var n;i.init({params:null!==(n=t.params)&&void 0!==n?n:{},minimumSize:t.minimumSize,maximumSize:t.maximumSize,snap:e.snap,priority:e.priority,accessor:this})}),i.orientation=n,this.doAddView(i),setTimeout(()=>{this._onDidAddView.fire(i)},0),{size:e.size,view:i}})}}),this.layout(s,a),o.forEach(e=>e()),"string"===typeof r){const e=this.getPanel(r);e&&this.setActive(e)}this._onDidLayoutfromJSON.fire()}clear(){for(const e of this._panels.values())e.dispose();for(this._panels.clear();this.splitview.length>0;){this.splitview.removeView(0,$.Distribute,!0).dispose()}}dispose(){for(const t of this._panels.values())t.dispose();this._panels.clear();const e=this.splitview.getViews();this._splitviewChangeDisposable.dispose(),this.splitview.dispose();for(const t of e)t.dispose();this.element.remove(),super.dispose()}}class Pt extends _{get element(){return this._element}constructor(){super(),this._expandedIcon=He({width:"11",height:"11",viewbox:"0 0 24 15",path:"M12 14.15L0 2.15L2.15 0L12 9.9L21.85 0.0499992L24 2.2L12 14.15Z"}),this._collapsedIcon=Ge(),this.disposable=new w,this.apiRef={api:null},this._element=document.createElement("div"),this.element.className="dv-default-header",this._content=document.createElement("span"),this._expander=document.createElement("div"),this._expander.className="dv-pane-header-icon",this.element.appendChild(this._expander),this.element.appendChild(this._content),this.addDisposables(b(this._element,"click",()=>{var e;null===(e=this.apiRef.api)||void 0===e||e.setExpanded(!this.apiRef.api.isExpanded)}))}init(e){this.apiRef.api=e.api,this._content.textContent=e.title,this.updateIcon(),this.disposable.value=e.api.onDidExpansionChange(()=>{this.updateIcon()})}updateIcon(){var e;const t=!!(null===(e=this.apiRef.api)||void 0===e?void 0:e.isExpanded);T(this._expander,"collapsed",!t),t?(this._expander.contains(this._collapsedIcon)&&this._collapsedIcon.remove(),this._expander.contains(this._expandedIcon)||this._expander.appendChild(this._expandedIcon)):(this._expander.contains(this._expandedIcon)&&this._expandedIcon.remove(),this._expander.contains(this._collapsedIcon)||this._expander.appendChild(this._collapsedIcon))}update(e){}dispose(){this.disposable.dispose(),super.dispose()}}const Dt=V(),kt=Number.MAX_SAFE_INTEGER;class Rt extends Ne{constructor(e){super({accessor:e.accessor,id:e.id,component:e.component,headerComponent:e.headerComponent,orientation:e.orientation,isExpanded:e.isExpanded,disableDnd:e.disableDnd,headerSize:e.headerSize,minimumBodySize:e.minimumBodySize,maximumBodySize:e.maximumBodySize}),this.options=e}getBodyComponent(){return this.options.body}getHeaderComponent(){return this.options.header}}class Nt extends ce{get id(){return this._id}get panels(){return this.paneview.getPanes()}set paneview(e){this._paneview=e,this._disposable.value=new _(this._paneview.onDidChange(()=>{this._onDidLayoutChange.fire(void 0)}),this._paneview.onDidAddView(e=>this._onDidAddView.fire(e)),this._paneview.onDidRemoveView(e=>this._onDidRemoveView.fire(e)))}get paneview(){return this._paneview}get minimumSize(){return this.paneview.minimumSize}get maximumSize(){return this.paneview.maximumSize}get height(){return this.paneview.orientation===W.HORIZONTAL?this.paneview.orthogonalSize:this.paneview.size}get width(){return this.paneview.orientation===W.HORIZONTAL?this.paneview.size:this.paneview.orthogonalSize}get options(){return this._options}constructor(e,t){var n;super(document.createElement("div"),t.disableAutoResizing),this._id=Dt.next(),this._disposable=new w,this._viewDisposables=new Map,this._onDidLayoutfromJSON=new y,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidLayoutChange=new y,this.onDidLayoutChange=this._onDidLayoutChange.event,this._onDidDrop=new y,this.onDidDrop=this._onDidDrop.event,this._onDidAddView=new y,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new y,this.onDidRemoveView=this._onDidRemoveView.event,this._onUnhandledDragOverEvent=new y,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this.element.style.height="100%",this.element.style.width="100%",this.addDisposables(this._onDidLayoutChange,this._onDidLayoutfromJSON,this._onDidDrop,this._onDidAddView,this._onDidRemoveView,this._onUnhandledDragOverEvent),this._classNames=new L(this.element),this._classNames.setClassNames(null!==(n=t.className)&&void 0!==n?n:""),e.appendChild(this.element),this._options=t,this.paneview=new K(this.element,{orientation:W.VERTICAL}),this.addDisposables(this._disposable)}setVisible(e,t){const n=this.panels.indexOf(e);this.paneview.setViewVisible(n,t)}focus(){}updateOptions(e){var t,n;"className"in e&&this._classNames.setClassNames(null!==(t=e.className)&&void 0!==t?t:""),"disableResizing"in e&&(this.disableResizing=null!==(n=e.disableAutoResizing)&&void 0!==n&&n),this._options=Object.assign(Object.assign({},this.options),e)}addPanel(e){var t,n;const i=this.options.createComponent({id:e.id,name:e.component});let r;e.headerComponent&&this.options.createHeaderComponent&&(r=this.options.createHeaderComponent({id:e.id,name:e.headerComponent})),r||(r=new Pt);const o=new Rt({id:e.id,component:e.component,headerComponent:e.headerComponent,header:r,body:i,orientation:W.VERTICAL,isExpanded:!!e.isExpanded,disableDnd:!!this.options.disableDnd,accessor:this,headerSize:null!==(t=e.headerSize)&&void 0!==t?t:22,minimumBodySize:0,maximumBodySize:kt});this.doAddPanel(o);const s="number"===typeof e.size?e.size:$.Distribute,a="number"===typeof e.index?e.index:void 0;return o.init({params:null!==(n=e.params)&&void 0!==n?n:{},minimumBodySize:e.minimumBodySize,maximumBodySize:e.maximumBodySize,isExpanded:e.isExpanded,title:e.title,containerApi:new fe(this),accessor:this}),this.paneview.addPane(o,s,a),o.orientation=this.paneview.orientation,o}removePanel(e){const t=this.panels.findIndex(t=>t===e);this.paneview.removePane(t),this.doRemovePanel(e)}movePanel(e,t){this.paneview.moveView(e,t)}getPanel(e){return this.panels.find(t=>t.id===e)}layout(e,t){const[n,i]=this.paneview.orientation===W.HORIZONTAL?[e,t]:[t,e];this.paneview.layout(n,i)}toJSON(){const e=e=>e===Number.MAX_SAFE_INTEGER||e===Number.POSITIVE_INFINITY?void 0:e,t=this.paneview.getPanes().map((t,n)=>{return{size:this.paneview.getViewSize(n),data:t.toJSON(),minimumSize:(i=t.minimumBodySize,i<=0?void 0:i),maximumSize:e(t.maximumBodySize),headerSize:t.headerSize,expanded:t.isExpanded()};var i});return{views:t,size:this.paneview.size}}fromJSON(e){this.clear();const{views:t,size:n}=e,i=[],r=this.width,o=this.height;this.paneview=new K(this.element,{orientation:W.VERTICAL,descriptor:{size:n,views:t.map(e=>{var t,n,r;const o=e.data,s=this.options.createComponent({id:o.id,name:o.component});let a;o.headerComponent&&this.options.createHeaderComponent&&(a=this.options.createHeaderComponent({id:o.id,name:o.headerComponent})),a||(a=new Pt);const l=new Rt({id:o.id,component:o.component,headerComponent:o.headerComponent,header:a,body:s,orientation:W.VERTICAL,isExpanded:!!e.expanded,disableDnd:!!this.options.disableDnd,accessor:this,headerSize:null!==(t=e.headerSize)&&void 0!==t?t:22,minimumBodySize:null!==(n=e.minimumSize)&&void 0!==n?n:0,maximumBodySize:null!==(r=e.maximumSize)&&void 0!==r?r:kt});return this.doAddPanel(l),i.push(()=>{var t;l.init({params:null!==(t=o.params)&&void 0!==t?t:{},minimumBodySize:e.minimumSize,maximumBodySize:e.maximumSize,title:o.title,isExpanded:!!e.expanded,containerApi:new fe(this),accessor:this}),l.orientation=this.paneview.orientation}),setTimeout(()=>{this._onDidAddView.fire(l)},0),{size:e.size,view:l}})}}),this.layout(r,o),i.forEach(e=>e()),this._onDidLayoutfromJSON.fire()}clear(){for(const[e,t]of this._viewDisposables.entries())t.dispose();this._viewDisposables.clear(),this.paneview.dispose()}doAddPanel(e){const t=new _(e.onDidDrop(e=>{this._onDidDrop.fire(e)}),e.onUnhandledDragOverEvent(e=>{this._onUnhandledDragOverEvent.fire(e)}));this._viewDisposables.set(e.id,t)}doRemovePanel(e){const t=this._viewDisposables.get(e.id);t&&(t.dispose(),this._viewDisposables.delete(e.id))}dispose(){super.dispose();for(const[e,t]of this._viewDisposables.entries())t.dispose();this._viewDisposables.clear(),this.element.remove(),this.paneview.dispose()}}class It extends ke{get priority(){return this._priority}set orientation(e){this._orientation=e}get orientation(){return this._orientation}get minimumSize(){const e="function"===typeof this._minimumSize?this._minimumSize():this._minimumSize;return e!==this._evaluatedMinimumSize&&(this._evaluatedMinimumSize=e,this.updateConstraints()),e}get maximumSize(){const e="function"===typeof this._maximumSize?this._maximumSize():this._maximumSize;return e!==this._evaluatedMaximumSize&&(this._evaluatedMaximumSize=e,this.updateConstraints()),e}get snap(){return this._snap}constructor(e,t){super(e,t,new Pe(e,t)),this._evaluatedMinimumSize=0,this._evaluatedMaximumSize=Number.POSITIVE_INFINITY,this._minimumSize=0,this._maximumSize=Number.POSITIVE_INFINITY,this._snap=!1,this._onDidChange=new y,this.onDidChange=this._onDidChange.event,this.api.initialize(this),this.addDisposables(this._onDidChange,this.api.onWillVisibilityChange(e=>{const{isVisible:t}=e,{accessor:n}=this._params;n.setVisible(this,t)}),this.api.onActiveChange(()=>{const{accessor:e}=this._params;e.setActive(this)}),this.api.onDidConstraintsChangeInternal(e=>{"number"!==typeof e.minimumSize&&"function"!==typeof e.minimumSize||(this._minimumSize=e.minimumSize),"number"!==typeof e.maximumSize&&"function"!==typeof e.maximumSize||(this._maximumSize=e.maximumSize),this.updateConstraints()}),this.api.onDidSizeChange(e=>{this._onDidChange.fire({size:e.size})}))}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}layout(e,t){const[n,i]=this.orientation===W.HORIZONTAL?[e,t]:[t,e];super.layout(n,i)}init(e){super.init(e),this._priority=e.priority,e.minimumSize&&(this._minimumSize=e.minimumSize),e.maximumSize&&(this._maximumSize=e.maximumSize),e.snap&&(this._snap=e.snap)}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{minimumSize:(e=this.minimumSize,e<=0?void 0:e),maximumSize:(e=>e===Number.MAX_SAFE_INTEGER||e===Number.POSITIVE_INFINITY?void 0:e)(this.maximumSize)});var e}updateConstraints(){this.api._onDidConstraintsChange.fire({maximumSize:this._evaluatedMaximumSize,minimumSize:this._evaluatedMinimumSize})}}var Lt=n(950);const Ot=(e,n)=>{const[i,r]=t.useState(),o=t.useRef(e.componentProps);return t.useImperativeHandle(n,()=>({update:e=>{o.current=Object.assign(Object.assign({},o.current),e),r(Date.now())}}),[]),t.createElement(e.component,o.current)};Ot.displayName="DockviewReactJsBridge";const zt=(()=>{let e=1;return{next:()=>`dockview_react_portal_key_${(e++).toString()}`}})(),Ut=t.createContext({});class Ft{constructor(e,t,n,i,r){this.parent=e,this.portalStore=t,this.component=n,this.parameters=i,this.context=r,this._initialProps={},this.disposed=!1,this.createPortal()}update(e){if(this.disposed)throw new Error("invalid operation: resource is already disposed");this.componentInstance?this.componentInstance.update(e):this._initialProps=Object.assign(Object.assign({},this._initialProps),e)}createPortal(){if(this.disposed)throw new Error("invalid operation: resource is already disposed");if("function"!==typeof(e=this.component)&&!(null===e||void 0===e?void 0:e.$$typeof))throw new Error("Dockview: Only React.memo(...), React.ForwardRef(...) and functional components are accepted as components");var e;const n=t.createElement(t.forwardRef(Ot),{component:this.component,componentProps:this.parameters,ref:e=>{this.componentInstance=e,Object.keys(this._initialProps).length>0&&(this.componentInstance.update(this._initialProps),this._initialProps={})}}),i=this.context?t.createElement(Ut.Provider,{value:this.context},n):n,r=Lt.createPortal(i,this.parent,zt.next());this.ref={portal:r,disposable:this.portalStore.addPortal(r)}}dispose(){var e;null===(e=this.ref)||void 0===e||e.disposable.dispose(),this.disposed=!0}}const jt=()=>{const[e,n]=t.useState([]);t.useDebugValue(`Portal count: ${e.length}`);const i=t.useCallback(e=>{n(t=>[...t,e]);let t=!1;return p.from(()=>{if(t)throw new Error("invalid operation: resource already disposed");t=!0,n(t=>t.filter(t=>t!==e))})},[]);return[e,i]};class Bt{get element(){return this._element}constructor(e,t,n){this.id=e,this.component=t,this.reactPortalStore=n,this._onDidFocus=new y,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new y,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(e){this.part=new Ft(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,containerApi:e.containerApi})}update(e){var t;null===(t=this.part)||void 0===t||t.update({params:e.params})}layout(e,t){}dispose(){var e;this._onDidFocus.dispose(),this._onDidBlur.dispose(),null===(e=this.part)||void 0===e||e.dispose()}}class Vt{get element(){return this._element}constructor(e,t,n){this.id=e,this.component=t,this.reactPortalStore=n,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(e){this.part=new Ft(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,containerApi:e.containerApi,tabLocation:e.tabLocation})}update(e){var t;null===(t=this.part)||void 0===t||t.update({params:e.params})}layout(e,t){}dispose(){var e;null===(e=this.part)||void 0===e||e.dispose()}}class Ht{get element(){return this._element}constructor(e,t,n){this.id=e,this.component=t,this.reactPortalStore=n,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(e){this.part=new Ft(this.element,this.reactPortalStore,this.component,{group:e.group,containerApi:e.containerApi})}focus(){}update(e){var t,n,i;this.parameters&&(this.parameters.params=e.params),null===(t=this.part)||void 0===t||t.update({params:null!==(i=null===(n=this.parameters)||void 0===n?void 0:n.params)&&void 0!==i?i:{}})}layout(e,t){}dispose(){var e;null===(e=this.part)||void 0===e||e.dispose()}}class Gt{get element(){return this._element}get part(){return this._part}constructor(e,t,n){this.component=e,this.reactPortalStore=t,this._group=n,this.mutableDisposable=new w,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(e){this.mutableDisposable.value=new _(this._group.model.onDidAddPanel(()=>{this.updatePanels()}),this._group.model.onDidRemovePanel(()=>{this.updatePanels()}),this._group.model.onDidActivePanelChange(()=>{this.updateActivePanel()}),e.api.onDidActiveChange(()=>{this.updateGroupActive()})),this._part=new Ft(this.element,this.reactPortalStore,this.component,{api:e.api,containerApi:e.containerApi,panels:this._group.model.panels,activePanel:this._group.model.activePanel,isGroupActive:this._group.api.isActive,group:this._group})}dispose(){var e;this.mutableDisposable.dispose(),null===(e=this._part)||void 0===e||e.dispose()}update(e){var t;null===(t=this._part)||void 0===t||t.update(e.params)}updatePanels(){this.update({params:{panels:this._group.model.panels}})}updateActivePanel(){this.update({params:{activePanel:this._group.model.activePanel}})}updateGroupActive(){this.update({params:{isGroupActive:this._group.api.isActive}})}}function Wt(e,t){return e?n=>new Gt(e,t,n):void 0}const Xt="props.defaultTabComponent";const Yt=t.forwardRef((e,n)=>{const i=t.useRef(null),r=t.useRef(),[o,s]=jt();t.useImperativeHandle(n,()=>i.current,[]);const a=t.useRef({});return t.useEffect(()=>{const t={};Ye.forEach(n=>{const i=n,r=e[i];i in e&&r!==a.current[i]&&(t[i]=r)}),r.current&&r.current.updateOptions(t),a.current=e},Ye.map(t=>e[t])),t.useEffect(()=>{var t;if(!i.current)return;const n=null!==(t=e.tabComponents)&&void 0!==t?t:{};e.defaultTabComponent&&(n[Xt]=e.defaultTabComponent);const o={createLeftHeaderActionComponent:Wt(e.leftHeaderActionsComponent,{addPortal:s}),createRightHeaderActionComponent:Wt(e.rightHeaderActionsComponent,{addPortal:s}),createPrefixHeaderActionComponent:Wt(e.prefixHeaderActionsComponent,{addPortal:s}),createComponent:t=>new Bt(t.id,e.components[t.name],{addPortal:s}),createTabComponent:e=>new Vt(e.id,n[e.name],{addPortal:s}),createWatermarkComponent:e.watermarkComponent?()=>new Ht("watermark",e.watermarkComponent,{addPortal:s}):void 0,defaultTabComponent:e.defaultTabComponent?Xt:void 0},a=(l=i.current,c=Object.assign(Object.assign({},function(e){return Ye.reduce((t,n)=>(n in e&&(t[n]=e[n]),t),{})}(e)),o),new Ct(l,c).api);var l,c;const{clientWidth:u,clientHeight:d}=i.current;return a.layout(u,d),e.onReady&&e.onReady({api:a}),r.current=a,()=>{r.current=void 0,a.dispose()}},[]),t.useEffect(()=>{if(!r.current)return()=>{};const t=r.current.onDidDrop(t=>{e.onDidDrop&&e.onDidDrop(t)});return()=>{t.dispose()}},[e.onDidDrop]),t.useEffect(()=>{if(!r.current)return()=>{};const t=r.current.onWillDrop(t=>{e.onWillDrop&&e.onWillDrop(t)});return()=>{t.dispose()}},[e.onWillDrop]),t.useEffect(()=>{r.current&&r.current.updateOptions({createComponent:t=>new Bt(t.id,e.components[t.name],{addPortal:s})})},[e.components]),t.useEffect(()=>{var t;if(!r.current)return;const n=null!==(t=e.tabComponents)&&void 0!==t?t:{};e.defaultTabComponent&&(n[Xt]=e.defaultTabComponent),r.current.updateOptions({defaultTabComponent:e.defaultTabComponent?Xt:void 0,createTabComponent:e=>new Vt(e.id,n[e.name],{addPortal:s})})},[e.tabComponents,e.defaultTabComponent]),t.useEffect(()=>{r.current&&r.current.updateOptions({createWatermarkComponent:e.watermarkComponent?()=>new Ht("watermark",e.watermarkComponent,{addPortal:s}):void 0})},[e.watermarkComponent]),t.useEffect(()=>{r.current&&r.current.updateOptions({createRightHeaderActionComponent:Wt(e.rightHeaderActionsComponent,{addPortal:s})})},[e.rightHeaderActionsComponent]),t.useEffect(()=>{r.current&&r.current.updateOptions({createLeftHeaderActionComponent:Wt(e.leftHeaderActionsComponent,{addPortal:s})})},[e.leftHeaderActionsComponent]),t.useEffect(()=>{r.current&&r.current.updateOptions({createPrefixHeaderActionComponent:Wt(e.prefixHeaderActionsComponent,{addPortal:s})})},[e.prefixHeaderActionsComponent]),t.createElement("div",{style:{height:"100%",width:"100%"},ref:i},o)});Yt.displayName="DockviewComponent";class $t extends It{constructor(e,t,n,i){super(e,t),this.reactComponent=n,this.reactPortalStore=i}getComponent(){var e,t;return new Ft(this.element,this.reactPortalStore,this.reactComponent,{params:null!==(t=null===(e=this._params)||void 0===e?void 0:e.params)&&void 0!==t?t:{},api:this.api,containerApi:new pe(this._params.accessor)})}}t.forwardRef((e,n)=>{const i=t.useRef(null),r=t.useRef(),[o,s]=jt();t.useImperativeHandle(n,()=>i.current,[]);const a=t.useRef({});return t.useEffect(()=>{const t={};Z.forEach(n=>{const i=n,r=e[i];i in e&&r!==a.current[i]&&(t[i]=r)}),r.current&&r.current.updateOptions(t),a.current=e},Z.map(t=>e[t])),t.useEffect(()=>{if(!i.current)return()=>{};const t={createComponent:t=>new $t(t.id,t.name,e.components[t.name],{addPortal:s})},n=function(e,t){const n=new At(e,t);return new pe(n)}(i.current,Object.assign(Object.assign({},function(e){return Z.reduce((t,n)=>(n in e&&(t[n]=e[n]),t),{})}(e)),t)),{clientWidth:o,clientHeight:a}=i.current;return n.layout(o,a),e.onReady&&e.onReady({api:n}),r.current=n,()=>{r.current=void 0,n.dispose()}},[]),t.useEffect(()=>{r.current&&r.current.updateOptions({createComponent:t=>new $t(t.id,t.name,e.components[t.name],{addPortal:s})})},[e.components]),t.createElement("div",{style:{height:"100%",width:"100%"},ref:i},o)}).displayName="SplitviewComponent";class qt extends Je{constructor(e,t,n,i){super(e,t),this.reactComponent=n,this.reactPortalStore=i}getComponent(){var e,t;return new Ft(this.element,this.reactPortalStore,this.reactComponent,{params:null!==(t=null===(e=this._params)||void 0===e?void 0:e.params)&&void 0!==t?t:{},api:this.api,containerApi:new me(this._params.accessor)})}}t.forwardRef((e,n)=>{const i=t.useRef(null),r=t.useRef(),[o,s]=jt();t.useImperativeHandle(n,()=>i.current,[]);const a=t.useRef({});return t.useEffect(()=>{const t={};le.forEach(n=>{const i=n,r=e[i];i in e&&r!==a.current[i]&&(t[i]=r)}),r.current&&r.current.updateOptions(t),a.current=e},le.map(t=>e[t])),t.useEffect(()=>{if(!i.current)return()=>{};const t={createComponent:t=>new qt(t.id,t.name,e.components[t.name],{addPortal:s})},n=function(e,t){const n=new Tt(e,t);return new me(n)}(i.current,Object.assign(Object.assign({},function(e){return le.reduce((t,n)=>(n in e&&(t[n]=e[n]),t),{})}(e)),t)),{clientWidth:o,clientHeight:a}=i.current;return n.layout(o,a),e.onReady&&e.onReady({api:n}),r.current=n,()=>{r.current=void 0,n.dispose()}},[]),t.useEffect(()=>{r.current&&r.current.updateOptions({createComponent:t=>new qt(t.id,t.name,e.components[t.name],{addPortal:s})})},[e.components]),t.createElement("div",{style:{height:"100%",width:"100%"},ref:i},o)}).displayName="GridviewComponent";class Zt{get element(){return this._element}constructor(e,t,n){this.id=e,this.component=t,this.reactPortalStore=n,this._element=document.createElement("div"),this._element.style.height="100%",this._element.style.width="100%"}init(e){this.part=new Ft(this.element,this.reactPortalStore,this.component,{params:e.params,api:e.api,title:e.title,containerApi:e.containerApi})}toJSON(){return{id:this.id}}update(e){var t;null===(t=this.part)||void 0===t||t.update(e.params)}dispose(){var e;null===(e=this.part)||void 0===e||e.dispose()}}const Kt=t.forwardRef((e,n)=>{const i=t.useRef(null),r=t.useRef(),[o,s]=jt();t.useImperativeHandle(n,()=>i.current,[]);const a=t.useRef({});return t.useEffect(()=>{const t={};Ee.forEach(n=>{const i=n,r=e[i];i in e&&r!==a.current[i]&&(t[i]=r)}),r.current&&r.current.updateOptions(t),a.current=e},Ee.map(t=>e[t])),t.useEffect(()=>{var t;if(!i.current)return()=>{};const n=null!==(t=e.headerComponents)&&void 0!==t?t:{},o={createComponent:t=>new Zt(t.id,e.components[t.name],{addPortal:s}),createHeaderComponent:e=>new Zt(e.id,n[e.name],{addPortal:s})},a=function(e,t){const n=new Nt(e,t);return new fe(n)}(i.current,Object.assign(Object.assign({},function(e){return Ee.reduce((t,n)=>(n in e&&(t[n]=e[n]),t),{})}(e)),o)),{clientWidth:l,clientHeight:c}=i.current;return a.layout(l,c),e.onReady&&e.onReady({api:a}),r.current=a,()=>{r.current=void 0,a.dispose()}},[]),t.useEffect(()=>{r.current&&r.current.updateOptions({createComponent:t=>new Zt(t.id,e.components[t.name],{addPortal:s})})},[e.components]),t.useEffect(()=>{var t;if(!r.current)return;const n=null!==(t=e.headerComponents)&&void 0!==t?t:{};r.current.updateOptions({createHeaderComponent:e=>new Zt(e.id,n[e.name],{addPortal:s})})},[e.headerComponents]),t.useEffect(()=>{if(!r.current)return()=>{};const t=r.current.onDidDrop(t=>{e.onDidDrop&&e.onDidDrop(t)});return()=>{t.dispose()}},[e.onDidDrop]),t.createElement("div",{style:{height:"100%",width:"100%"},ref:i},o)});Kt.displayName="PaneviewComponent";const Jt="160",Qt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},en={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},tn=0,nn=1,rn=2,on=3,sn=0,an=1,ln=2,cn=3,un=0,dn=1,hn=2,pn=2,fn=0,mn=1,gn=2,vn=3,yn=4,bn=5,xn=100,_n=101,wn=102,Sn=103,Mn=104,En=200,Cn=201,Tn=202,An=203,Pn=204,Dn=205,kn=206,Rn=207,Nn=208,In=209,Ln=210,On=211,zn=212,Un=213,Fn=214,jn=0,Bn=1,Vn=2,Hn=3,Gn=4,Wn=5,Xn=6,Yn=7,$n=0,qn=1,Zn=2,Kn=0,Jn=1,Qn=2,ei=3,ti=4,ni=5,ii=6,ri="attached",oi="detached",si=300,ai=301,li=302,ci=303,ui=304,di=306,hi=1e3,pi=1001,fi=1002,mi=1003,gi=1004,vi=1004,yi=1005,bi=1005,xi=1006,_i=1007,wi=1007,Si=1008,Mi=1008,Ei=1009,Ci=1010,Ti=1011,Ai=1012,Pi=1013,Di=1014,ki=1015,Ri=1016,Ni=1017,Ii=1018,Li=1020,Oi=1021,zi=1023,Ui=1024,Fi=1025,ji=1026,Bi=1027,Vi=1028,Hi=1029,Gi=1030,Wi=1031,Xi=1033,Yi=33776,$i=33777,qi=33778,Zi=33779,Ki=35840,Ji=35841,Qi=35842,er=35843,tr=36196,nr=37492,ir=37496,rr=37808,or=37809,sr=37810,ar=37811,lr=37812,cr=37813,ur=37814,dr=37815,hr=37816,pr=37817,fr=37818,mr=37819,gr=37820,vr=37821,yr=36492,br=36494,xr=36495,_r=36283,wr=36284,Sr=36285,Mr=36286,Er=2200,Cr=2201,Tr=2202,Ar=2300,Pr=2301,Dr=2302,kr=2400,Rr=2401,Nr=2402,Ir=2500,Lr=2501,Or=0,zr=1,Ur=2,Fr=3e3,jr=3001,Br=3200,Vr=3201,Hr=0,Gr=1,Wr="",Xr="srgb",Yr="srgb-linear",$r="display-p3",qr="display-p3-linear",Zr="linear",Kr="srgb",Jr="rec709",Qr="p3",eo=0,to=7680,no=7681,io=7682,ro=7683,oo=34055,so=34056,ao=5386,lo=512,co=513,uo=514,ho=515,po=516,fo=517,mo=518,go=519,vo=512,yo=513,bo=514,xo=515,_o=516,wo=517,So=518,Mo=519,Eo=35044,Co=35048,To=35040,Ao=35045,Po=35049,Do=35041,ko=35046,Ro=35050,No=35042,Io="100",Lo="300 es",Oo=1035,zo=2e3,Uo=2001;class Fo{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const jo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Bo=1234567;const Vo=Math.PI/180,Ho=180/Math.PI;function Go(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(jo[255&e]+jo[e>>8&255]+jo[e>>16&255]+jo[e>>24&255]+"-"+jo[255&t]+jo[t>>8&255]+"-"+jo[t>>16&15|64]+jo[t>>24&255]+"-"+jo[63&n|128]+jo[n>>8&255]+"-"+jo[n>>16&255]+jo[n>>24&255]+jo[255&i]+jo[i>>8&255]+jo[i>>16&255]+jo[i>>24&255]).toLowerCase()}function Wo(e,t,n){return Math.max(t,Math.min(n,e))}function Xo(e,t){return(e%t+t)%t}function Yo(e,t,n){return(1-n)*e+n*t}function $o(e){return 0===(e&e-1)&&0!==e}function qo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Zo(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Ko(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const Jo={DEG2RAD:Vo,RAD2DEG:Ho,generateUUID:Go,clamp:Wo,euclideanModulo:Xo,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Yo,damp:function(e,t,n,i){return Yo(e,t,1-Math.exp(-n*i))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Xo(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Bo=e);let t=Bo+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Vo},radToDeg:function(e){return e*Ho},isPowerOfTwo:$o,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:qo,setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+i)/2),u=s((t+i)/2),d=o((t-i)/2),h=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case"XYX":e.set(a*u,l*d,l*h,a*c);break;case"YZY":e.set(l*h,a*u,l*d,a*c);break;case"ZXZ":e.set(l*d,l*h,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Ko,denormalize:Zo};class Qo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Qo.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Wo(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class es{constructor(e,t,n,i,r,o,s,a,l){es.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l)}set(e,t,n,i,r,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],_=i[5],w=i[8];return r[0]=o*f+s*v+a*x,r[3]=o*m+s*y+a*_,r[6]=o*g+s*b+a*w,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*_,r[7]=l*g+c*b+u*w,r[2]=d*f+h*v+p*x,r[5]=d*m+h*y+p*_,r[8]=d*g+h*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*r*c+n*s*a+i*r*l-i*o*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,d=s*a-c*r,h=l*r-o*a,p=t*u+n*d+i*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(s*n-i*o)*f,e[3]=d*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-s*t)*f,e[6]=h*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(ts.makeScale(e,t)),this}rotate(e){return this.premultiply(ts.makeRotation(-e)),this}translate(e,t){return this.premultiply(ts.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const ts=new es;function ns(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const is={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function rs(e,t){return new is[e](t)}function os(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ss(){const e=os("canvas");return e.style.display="block",e}const as={};function ls(e){e in as||(as[e]=!0,console.warn(e))}const cs=(new es).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),us=(new es).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ds={[Yr]:{transfer:Zr,primaries:Jr,toReference:e=>e,fromReference:e=>e},[Xr]:{transfer:Kr,primaries:Jr,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[qr]:{transfer:Zr,primaries:Qr,toReference:e=>e.applyMatrix3(us),fromReference:e=>e.applyMatrix3(cs)},[$r]:{transfer:Kr,primaries:Qr,toReference:e=>e.convertSRGBToLinear().applyMatrix3(us),fromReference:e=>e.applyMatrix3(cs).convertLinearToSRGB()}},hs=new Set([Yr,qr]),ps={enabled:!0,_workingColorSpace:Yr,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!hs.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=ds[t].toReference;return(0,ds[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return ds[e].primaries},getTransfer:function(e){return e===Wr?Zr:ds[e].transfer}};function fs(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ms(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let gs;class vs{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===gs&&(gs=os("canvas")),gs.width=e.width,gs.height=e.height;const n=gs.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=gs}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=os("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*fs(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*fs(t[e]/255)):t[e]=fs(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ys=0;class bs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:ys++}),this.uuid=Go(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(xs(i[t].image)):e.push(xs(i[t]))}else e=xs(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function xs(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?vs.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _s=0;class ws extends Fo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ws.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ws.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pi,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pi,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xi,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Si,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:zi,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Ei,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:ws.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Wr;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_s++}),this.uuid=Go(),this.name="",this.source=new bs(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Qo(0,0),this.repeat=new Qo(1,1),this.center=new Qo(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new es,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"===typeof c?this.colorSpace=c:(ls("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===jr?Xr:Wr),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==si)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case hi:e.x=e.x-Math.floor(e.x);break;case pi:e.x=e.x<0?0:1;break;case fi:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case hi:e.y=e.y-Math.floor(e.y);break;case pi:e.y=e.y<0?0:1;break;case fi:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ls("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Xr?jr:Fr}set encoding(e){ls("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===jr?Xr:Wr}}ws.DEFAULT_IMAGE=null,ws.DEFAULT_MAPPING=si,ws.DEFAULT_ANISOTROPY=1;class Ss{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Ss.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],d=a[1],h=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-d)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+d)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+h+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(h+1)/2,v=(g+1)/2,y=(c+d)/4,b=(u+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=b/n):a>v?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=x/i):v<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=b/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(d-c)/v,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ms extends Fo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ss(0,0,e,t),this.scissorTest=!1,this.viewport=new Ss(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==n.encoding&&(ls("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===jr?Xr:Wr),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:xi,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new ws(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new bs(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Es extends Ms{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Cs extends ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=mi,this.minFilter=mi,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ts extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Cs(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class As extends ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=mi,this.minFilter=mi,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ps extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new As(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Ds extends Es{constructor(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLMultipleRenderTargets=!0;const t=this.texture;this.texture=[];for(let n=0;n<e;n++)this.texture[n]=t.clone(),this.texture[n].isRenderTargetTexture=!0}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class ks{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const d=r[o+0],h=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==d||l!==h||c!==p){let e=1-s;const t=a*d+l*h+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+d*r,l=l*e+h*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[o],d=r[o+1],h=r[o+2],p=r[o+3];return e[t]=s*p+c*u+a*h-l*d,e[t+1]=a*p+c*d+l*u-s*h,e[t+2]=l*p+c*h+s*d-a*u,e[t+3]=c*p-s*u-a*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,i=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),d=a(n/2),h=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],d=n+s+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Wo(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+i*l-r*a,this._y=i*c+o*a+r*s-n*l,this._z=r*c+o*l+n*a-i*s,this._w=o*c-n*s-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Rs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Rs.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Is.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Is.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=2*(o*i-s*n),c=2*(s*t-r*i),u=2*(r*n-o*t);return this.x=t+a*l+o*u-s*c,this.y=n+a*c+s*l-r*u,this.z=i+a*u+r*c-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ns.copy(this).projectOnVector(e),this.sub(Ns)}reflect(e){return this.sub(Ns.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Wo(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ns=new Rs,Is=new ks;class Ls{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(zs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(zs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=zs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,zs):zs.fromBufferAttribute(i,t),zs.applyMatrix4(e.matrixWorld),this.expandByPoint(zs);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Us.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Us.copy(n.boundingBox)),Us.applyMatrix4(e.matrixWorld),this.union(Us)}const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,zs),zs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ws),Xs.subVectors(this.max,Ws),Fs.subVectors(e.a,Ws),js.subVectors(e.b,Ws),Bs.subVectors(e.c,Ws),Vs.subVectors(js,Fs),Hs.subVectors(Bs,js),Gs.subVectors(Fs,Bs);let t=[0,-Vs.z,Vs.y,0,-Hs.z,Hs.y,0,-Gs.z,Gs.y,Vs.z,0,-Vs.x,Hs.z,0,-Hs.x,Gs.z,0,-Gs.x,-Vs.y,Vs.x,0,-Hs.y,Hs.x,0,-Gs.y,Gs.x,0];return!!qs(t,Fs,js,Bs,Xs)&&(t=[1,0,0,0,1,0,0,0,1],!!qs(t,Fs,js,Bs,Xs)&&(Ys.crossVectors(Vs,Hs),t=[Ys.x,Ys.y,Ys.z],qs(t,Fs,js,Bs,Xs)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,zs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(zs).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Os[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Os[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Os[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Os[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Os[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Os[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Os[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Os[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Os)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Os=[new Rs,new Rs,new Rs,new Rs,new Rs,new Rs,new Rs,new Rs],zs=new Rs,Us=new Ls,Fs=new Rs,js=new Rs,Bs=new Rs,Vs=new Rs,Hs=new Rs,Gs=new Rs,Ws=new Rs,Xs=new Rs,Ys=new Rs,$s=new Rs;function qs(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){$s.fromArray(e,o);const s=r.x*Math.abs($s.x)+r.y*Math.abs($s.y)+r.z*Math.abs($s.z),a=t.dot($s),l=n.dot($s),c=i.dot($s);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const Zs=new Ls,Ks=new Rs,Js=new Rs;class Qs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Zs.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ks.subVectors(e,this.center);const t=Ks.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Ks,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Js.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ks.copy(e.center).add(Js)),this.expandByPoint(Ks.copy(e.center).sub(Js))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ea=new Rs,ta=new Rs,na=new Rs,ia=new Rs,ra=new Rs,oa=new Rs,sa=new Rs;class aa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ea)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ea.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ea.copy(this.origin).addScaledVector(this.direction,t),ea.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){ta.copy(e).add(t).multiplyScalar(.5),na.copy(t).sub(e).normalize(),ia.copy(this.origin).sub(ta);const r=.5*e.distanceTo(t),o=-this.direction.dot(na),s=ia.dot(this.direction),a=-ia.dot(na),l=ia.lengthSq(),c=Math.abs(1-o*o);let u,d,h,p;if(c>0)if(u=o*a-s,d=o*s-a,p=r*c,u>=0)if(d>=-p)if(d<=p){const e=1/c;u*=e,d*=e,h=u*(u+o*d+2*s)+d*(o*u+d+2*a)+l}else d=r,u=Math.max(0,-(o*d+s)),h=-u*u+d*(d+2*a)+l;else d=-r,u=Math.max(0,-(o*d+s)),h=-u*u+d*(d+2*a)+l;else d<=-p?(u=Math.max(0,-(-o*r+s)),d=u>0?-r:Math.min(Math.max(-r,-a),r),h=-u*u+d*(d+2*a)+l):d<=p?(u=0,d=Math.min(Math.max(-r,-a),r),h=d*(d+2*a)+l):(u=Math.max(0,-(o*r+s)),d=u>0?r:Math.min(Math.max(-r,-a),r),h=-u*u+d*(d+2*a)+l);else d=o>0?-r:r,u=Math.max(0,-(o*d+s)),h=-u*u+d*(d+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(ta).addScaledVector(na,d),h}intersectSphere(e,t){ea.subVectors(e.center,this.origin);const n=ea.dot(this.direction),i=ea.dot(ea)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),u>=0?(s=(e.min.z-d.z)*u,a=(e.max.z-d.z)*u):(s=(e.max.z-d.z)*u,a=(e.min.z-d.z)*u),n>a||s>i?null:((s>n||n!==n)&&(n=s),(a<i||i!==i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,ea)}intersectTriangle(e,t,n,i,r){ra.subVectors(t,e),oa.subVectors(n,e),sa.crossVectors(ra,oa);let o,s=this.direction.dot(sa);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}ia.subVectors(this.origin,e);const a=o*this.direction.dot(oa.crossVectors(ia,oa));if(a<0)return null;const l=o*this.direction.dot(ra.cross(ia));if(l<0)return null;if(a+l>s)return null;const c=-o*ia.dot(sa);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class la{constructor(e,t,n,i,r,o,s,a,l,c,u,d,h,p,f,m){la.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l,c,u,d,h,p,f,m)}set(e,t,n,i,r,o,s,a,l,c,u,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new la).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/ca.setFromMatrixColumn(e,0).length(),r=1/ca.setFromMatrixColumn(e,1).length(),o=1/ca.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-o*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*c,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(da,e,ha)}lookAt(e,t,n){const i=this.elements;return ma.subVectors(e,t),0===ma.lengthSq()&&(ma.z=1),ma.normalize(),pa.crossVectors(n,ma),0===pa.lengthSq()&&(1===Math.abs(n.z)?ma.x+=1e-4:ma.z+=1e-4,ma.normalize(),pa.crossVectors(n,ma)),pa.normalize(),fa.crossVectors(ma,pa),i[0]=pa.x,i[4]=fa.x,i[8]=ma.x,i[1]=pa.y,i[5]=fa.y,i[9]=ma.y,i[2]=pa.z,i[6]=fa.z,i[10]=ma.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=i[0],w=i[4],S=i[8],M=i[12],E=i[1],C=i[5],T=i[9],A=i[13],P=i[2],D=i[6],k=i[10],R=i[14],N=i[3],I=i[7],L=i[11],O=i[15];return r[0]=o*_+s*E+a*P+l*N,r[4]=o*w+s*C+a*D+l*I,r[8]=o*S+s*T+a*k+l*L,r[12]=o*M+s*A+a*R+l*O,r[1]=c*_+u*E+d*P+h*N,r[5]=c*w+u*C+d*D+h*I,r[9]=c*S+u*T+d*k+h*L,r[13]=c*M+u*A+d*R+h*O,r[2]=p*_+f*E+m*P+g*N,r[6]=p*w+f*C+m*D+g*I,r[10]=p*S+f*T+m*k+g*L,r[14]=p*M+f*A+m*R+g*O,r[3]=v*_+y*E+b*P+x*N,r[7]=v*w+y*C+b*D+x*I,r[11]=v*S+y*T+b*k+x*L,r[15]=v*M+y*A+b*R+x*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+r*a*u-i*l*u-r*s*d+n*l*d+i*s*h-n*a*h)+e[7]*(+t*a*h-t*l*d+r*o*d-i*o*h+i*l*c-r*a*c)+e[11]*(+t*l*u-t*s*h-r*o*u+n*o*h+r*s*c-n*l*c)+e[15]*(-i*s*c-t*a*u+t*s*d+i*o*u-n*o*d+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*d*l+f*a*h-s*m*h-u*a*g+s*d*g,y=p*d*l-c*m*l-p*a*h+o*m*h+c*a*g-o*d*g,b=c*f*l-p*u*l+p*s*h-o*f*h-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*d+o*f*d+c*s*m-o*u*m,_=t*v+n*y+i*b+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(f*d*r-u*m*r-f*i*h+n*m*h+u*i*g-n*d*g)*w,e[2]=(s*m*r-f*a*r+f*i*l-n*m*l-s*i*g+n*a*g)*w,e[3]=(u*a*r-s*d*r-u*i*l+n*d*l+s*i*h-n*a*h)*w,e[4]=y*w,e[5]=(c*m*r-p*d*r+p*i*h-t*m*h-c*i*g+t*d*g)*w,e[6]=(p*a*r-o*m*r-p*i*l+t*m*l+o*i*g-t*a*g)*w,e[7]=(o*d*r-c*a*r+c*i*l-t*d*l-o*i*h+t*a*h)*w,e[8]=b*w,e[9]=(p*u*r-c*f*r-p*n*h+t*f*h+c*n*g-t*u*g)*w,e[10]=(o*f*r-p*s*r+p*n*l-t*f*l-o*n*g+t*s*g)*w,e[11]=(c*s*r-o*u*r-c*n*l+t*u*l+o*n*h-t*s*h)*w,e[12]=x*w,e[13]=(c*f*i-p*u*i+p*n*d-t*f*d-c*n*m+t*u*m)*w,e[14]=(p*s*i-o*f*i-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*i-c*s*i+c*n*a-t*u*a-o*n*d+t*s*d)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,c*s+n,c*a-i*o,0,l*a-i*s,c*a+i*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,u=s+s,d=r*l,h=r*c,p=r*u,f=o*c,m=o*u,g=s*u,v=a*l,y=a*c,b=a*u,x=n.x,_=n.y,w=n.z;return i[0]=(1-(f+g))*x,i[1]=(h+b)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(h-b)*_,i[5]=(1-(d+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(d+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=ca.set(i[0],i[1],i[2]).length();const o=ca.set(i[4],i[5],i[6]).length(),s=ca.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],ua.copy(this);const a=1/r,l=1/o,c=1/s;return ua.elements[0]*=a,ua.elements[1]*=a,ua.elements[2]*=a,ua.elements[4]*=l,ua.elements[5]*=l,ua.elements[6]*=l,ua.elements[8]*=c,ua.elements[9]*=c,ua.elements[10]*=c,t.setFromRotationMatrix(ua),n.x=r,n.y=o,n.z=s,this}makePerspective(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:zo;const a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i);let h,p;if(s===zo)h=-(o+r)/(o-r),p=-2*o*r/(o-r);else{if(s!==Uo)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);h=-o/(o-r),p=-o*r/(o-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:zo;const a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(o-r),d=(t+e)*l,h=(n+i)*c;let p,f;if(s===zo)p=(o+r)*u,f=-2*u;else{if(s!==Uo)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ca=new Rs,ua=new la,da=new Rs(0,0,0),ha=new Rs(1,1,1),pa=new Rs,fa=new Rs,ma=new Rs,ga=new la,va=new ks;class ya{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ya.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=e.elements,r=i[0],o=i[4],s=i[8],a=i[1],l=i[5],c=i[9],u=i[2],d=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(Wo(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Wo(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Wo(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Wo(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Wo(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,h));break;case"XZY":this._z=Math.asin(-Wo(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ga.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ga,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return va.setFromEuler(this),this.setFromQuaternion(va,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ya.DEFAULT_ORDER="XYZ";class ba{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let xa=0;const _a=new Rs,wa=new ks,Sa=new la,Ma=new Rs,Ea=new Rs,Ca=new Rs,Ta=new ks,Aa=new Rs(1,0,0),Pa=new Rs(0,1,0),Da=new Rs(0,0,1),ka={type:"added"},Ra={type:"removed"};class Na extends Fo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xa++}),this.uuid=Go(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Na.DEFAULT_UP.clone();const e=new Rs,t=new ya,n=new ks,i=new Rs(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new la},normalMatrix:{value:new es}}),this.matrix=new la,this.matrixWorld=new la,this.matrixAutoUpdate=Na.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Na.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ba,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return wa.setFromAxisAngle(e,t),this.quaternion.multiply(wa),this}rotateOnWorldAxis(e,t){return wa.setFromAxisAngle(e,t),this.quaternion.premultiply(wa),this}rotateX(e){return this.rotateOnAxis(Aa,e)}rotateY(e){return this.rotateOnAxis(Pa,e)}rotateZ(e){return this.rotateOnAxis(Da,e)}translateOnAxis(e,t){return _a.copy(e).applyQuaternion(this.quaternion),this.position.add(_a.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Aa,e)}translateY(e){return this.translateOnAxis(Pa,e)}translateZ(e){return this.translateOnAxis(Da,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Sa.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ma.copy(e):Ma.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ea.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sa.lookAt(Ea,Ma,this.up):Sa.lookAt(Ma,Ea,this.up),this.quaternion.setFromRotationMatrix(Sa),i&&(Sa.extractRotation(i.matrixWorld),wa.setFromRotationMatrix(Sa),this.quaternion.premultiply(wa.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ka)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ra)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Sa.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Sa.multiply(e.parent.matrixWorld)),e.applyMatrix4(Sa),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ea,e,Ca),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ea,Ta,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Na.DEFAULT_UP=new Rs(0,1,0),Na.DEFAULT_MATRIX_AUTO_UPDATE=!0,Na.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ia=new Rs,La=new Rs,Oa=new Rs,za=new Rs,Ua=new Rs,Fa=new Rs,ja=new Rs,Ba=new Rs,Va=new Rs,Ha=new Rs;let Ga=!1;class Wa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rs;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Ia.subVectors(e,t),i.cross(Ia);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Ia.subVectors(i,t),La.subVectors(n,t),Oa.subVectors(e,t);const o=Ia.dot(Ia),s=Ia.dot(La),a=Ia.dot(Oa),l=La.dot(La),c=La.dot(Oa),u=o*l-s*s;if(0===u)return r.set(0,0,0),null;const d=1/u,h=(l*a-s*c)*d,p=(o*c-s*a)*d;return r.set(1-h-p,p,h)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,za)&&(za.x>=0&&za.y>=0&&za.x+za.y<=1)}static getUV(e,t,n,i,r,o,s,a){return!1===Ga&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Ga=!0),this.getInterpolation(e,t,n,i,r,o,s,a)}static getInterpolation(e,t,n,i,r,o,s,a){return null===this.getBarycoord(e,t,n,i,za)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(r,za.x),a.addScaledVector(o,za.y),a.addScaledVector(s,za.z),a)}static isFrontFacing(e,t,n,i){return Ia.subVectors(n,t),La.subVectors(e,t),Ia.cross(La).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ia.subVectors(this.c,this.b),La.subVectors(this.a,this.b),.5*Ia.cross(La).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Wa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Wa.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return!1===Ga&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Ga=!0),Wa.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}getInterpolation(e,t,n,i,r){return Wa.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Wa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Wa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,s;Ua.subVectors(i,n),Fa.subVectors(r,n),Ba.subVectors(e,n);const a=Ua.dot(Ba),l=Fa.dot(Ba);if(a<=0&&l<=0)return t.copy(n);Va.subVectors(e,i);const c=Ua.dot(Va),u=Fa.dot(Va);if(c>=0&&u<=c)return t.copy(i);const d=a*u-c*l;if(d<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(Ua,o);Ha.subVectors(e,r);const h=Ua.dot(Ha),p=Fa.dot(Ha);if(p>=0&&h<=p)return t.copy(r);const f=h*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(Fa,s);const m=c*p-h*u;if(m<=0&&u-c>=0&&h-p>=0)return ja.subVectors(r,i),s=(u-c)/(u-c+(h-p)),t.copy(i).addScaledVector(ja,s);const g=1/(m+f+d);return o=f*g,s=d*g,t.copy(n).addScaledVector(Ua,o).addScaledVector(Fa,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Xa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ya={h:0,s:0,l:0},$a={h:0,s:0,l:0};function qa(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Za{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xr;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ps.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ps.workingColorSpace;return this.r=e,this.g=t,this.b=n,ps.toWorkingColorSpace(this,i),this}setHSL(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ps.workingColorSpace;if(e=Xo(e,1),t=Wo(t,0,1),n=Wo(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=qa(r,i,e+1/3),this.g=qa(r,i,e),this.b=qa(r,i,e-1/3)}return ps.toWorkingColorSpace(this,i),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xr;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=t[1],s=t[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=t[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xr;const n=Xa[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=fs(e.r),this.g=fs(e.g),this.b=fs(e.b),this}copyLinearToSRGB(e){return this.r=ms(e.r),this.g=ms(e.g),this.b=ms(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xr;return ps.fromWorkingColorSpace(Ka.copy(this),e),65536*Math.round(Wo(255*Ka.r,0,255))+256*Math.round(Wo(255*Ka.g,0,255))+Math.round(Wo(255*Ka.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xr;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ps.workingColorSpace;ps.fromWorkingColorSpace(Ka.copy(this),t);const n=Ka.r,i=Ka.g,r=Ka.b,o=Math.max(n,i,r),s=Math.min(n,i,r);let a,l;const c=(s+o)/2;if(s===o)a=0,l=0;else{const e=o-s;switch(l=c<=.5?e/(o+s):e/(2-o-s),o){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ps.workingColorSpace;return ps.fromWorkingColorSpace(Ka.copy(this),t),e.r=Ka.r,e.g=Ka.g,e.b=Ka.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xr;ps.fromWorkingColorSpace(Ka.copy(this),e);const t=Ka.r,n=Ka.g,i=Ka.b;return e!==Xr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Ya),this.setHSL(Ya.h+e,Ya.s+t,Ya.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ya),e.getHSL($a);const n=Yo(Ya.h,$a.h,t),i=Yo(Ya.s,$a.s,t),r=Yo(Ya.l,$a.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ka=new Za;Za.NAMES=Xa;let Ja=0;class Qa extends Fo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ja++}),this.uuid=Go(),this.name="",this.type="Material",this.blending=mn,this.side=un,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Pn,this.blendDst=Dn,this.blendEquation=xn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Za(0,0,0),this.blendAlpha=0,this.depthFunc=Hn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=go,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=to,this.stencilZFail=to,this.stencilZPass=to,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==mn&&(n.blending=this.blending),this.side!==un&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Pn&&(n.blendSrc=this.blendSrc),this.blendDst!==Dn&&(n.blendDst=this.blendDst),this.blendEquation!==xn&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Hn&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==go&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==to&&(n.stencilFail=this.stencilFail),this.stencilZFail!==to&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==to&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class el extends Qa{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Za(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$n,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const tl=nl();function nl(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,o[l]=e|t}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:o,exponentTable:s,offsetTable:a}}function il(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Wo(e,-65504,65504),tl.floatView[0]=e;const t=tl.uint32View[0],n=t>>23&511;return tl.baseTable[n]+((8388607&t)>>tl.shiftTable[n])}function rl(e){const t=e>>10;return tl.uint32View[0]=tl.mantissaTable[tl.offsetTable[t]+(1023&e)]+tl.exponentTable[t],tl.floatView[0]}const ol={toHalfFloat:il,fromHalfFloat:rl},sl=new Rs,al=new Qo;class ll{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Eo,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ki,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)al.fromBufferAttribute(this,t),al.applyMatrix3(e),this.setXY(t,al.x,al.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.applyMatrix3(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.applyMatrix4(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.applyNormalMatrix(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.transformDirection(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Zo(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Ko(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zo(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zo(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Zo(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array),i=Ko(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array),i=Ko(i,this.array),r=Ko(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Eo&&(e.usage=this.usage),e}}class cl extends ll{constructor(e,t,n){super(new Int8Array(e),t,n)}}class ul extends ll{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class dl extends ll{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class hl extends ll{constructor(e,t,n){super(new Int16Array(e),t,n)}}class pl extends ll{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class fl extends ll{constructor(e,t,n){super(new Int32Array(e),t,n)}}class ml extends ll{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class gl extends ll{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=rl(this.array[e*this.itemSize]);return this.normalized&&(t=Zo(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize]=il(t),this}getY(e){let t=rl(this.array[e*this.itemSize+1]);return this.normalized&&(t=Zo(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize+1]=il(t),this}getZ(e){let t=rl(this.array[e*this.itemSize+2]);return this.normalized&&(t=Zo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize+2]=il(t),this}getW(e){let t=rl(this.array[e*this.itemSize+3]);return this.normalized&&(t=Zo(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ko(t,this.array)),this.array[e*this.itemSize+3]=il(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array)),this.array[e+0]=il(t),this.array[e+1]=il(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array),i=Ko(i,this.array)),this.array[e+0]=il(t),this.array[e+1]=il(n),this.array[e+2]=il(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array),i=Ko(i,this.array),r=Ko(r,this.array)),this.array[e+0]=il(t),this.array[e+1]=il(n),this.array[e+2]=il(i),this.array[e+3]=il(r),this}}class vl extends ll{constructor(e,t,n){super(new Float32Array(e),t,n)}}class yl extends ll{constructor(e,t,n){super(new Float64Array(e),t,n)}}let bl=0;const xl=new la,_l=new Na,wl=new Rs,Sl=new Ls,Ml=new Ls,El=new Rs;class Cl extends Fo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bl++}),this.uuid=Go(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ns(e)?ml:pl)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new es).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return xl.makeRotationFromQuaternion(e),this.applyMatrix4(xl),this}rotateX(e){return xl.makeRotationX(e),this.applyMatrix4(xl),this}rotateY(e){return xl.makeRotationY(e),this.applyMatrix4(xl),this}rotateZ(e){return xl.makeRotationZ(e),this.applyMatrix4(xl),this}translate(e,t,n){return xl.makeTranslation(e,t,n),this.applyMatrix4(xl),this}scale(e,t,n){return xl.makeScale(e,t,n),this.applyMatrix4(xl),this}lookAt(e){return _l.lookAt(e),_l.updateMatrix(),this.applyMatrix4(_l.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wl).negate(),this.translate(wl.x,wl.y,wl.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new vl(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ls);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Rs(-1/0,-1/0,-1/0),new Rs(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];Sl.setFromBufferAttribute(e),this.morphTargetsRelative?(El.addVectors(this.boundingBox.min,Sl.min),this.boundingBox.expandByPoint(El),El.addVectors(this.boundingBox.max,Sl.max),this.boundingBox.expandByPoint(El)):(this.boundingBox.expandByPoint(Sl.min),this.boundingBox.expandByPoint(Sl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Qs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Rs,1/0);if(e){const n=this.boundingSphere.center;if(Sl.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];Ml.setFromBufferAttribute(n),this.morphTargetsRelative?(El.addVectors(Sl.min,Ml.min),Sl.expandByPoint(El),El.addVectors(Sl.max,Ml.max),Sl.expandByPoint(El)):(Sl.expandByPoint(Ml.min),Sl.expandByPoint(Ml.max))}Sl.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)El.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(El));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)El.fromBufferAttribute(o,t),s&&(wl.fromBufferAttribute(e,t),El.add(wl)),i=Math.max(i,n.distanceToSquared(El))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,s=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ll(new Float32Array(4*s),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<s;E++)l[E]=new Rs,c[E]=new Rs;const u=new Rs,d=new Rs,h=new Rs,p=new Qo,f=new Qo,m=new Qo,g=new Rs,v=new Rs;function y(e,t,n){u.fromArray(i,3*e),d.fromArray(i,3*t),h.fromArray(i,3*n),p.fromArray(o,2*e),f.fromArray(o,2*t),m.fromArray(o,2*n),d.sub(u),h.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(h,-f.y).multiplyScalar(r),v.copy(h).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let E=0,C=b.length;E<C;++E){const e=b[E],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)y(n[i+0],n[i+1],n[i+2])}const x=new Rs,_=new Rs,w=new Rs,S=new Rs;function M(e){w.fromArray(r,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),_.crossVectors(S,t);const n=_.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=n}for(let E=0,C=b.length;E<C;++E){const e=b[E],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)M(n[i+0]),M(n[i+1]),M(n[i+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new ll(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Rs,r=new Rs,o=new Rs,s=new Rs,a=new Rs,l=new Rs,c=new Rs,u=new Rs;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);i.fromBufferAttribute(t,h),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,h),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(h,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)El.fromBufferAttribute(e,t),El.normalize(),e.setXYZ(t,El.x,El.y,El.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new ll(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Cl,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const e=o[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,c=o.length;l<c;l++){const e=o[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Tl=new la,Al=new aa,Pl=new Qs,Dl=new Rs,kl=new Rs,Rl=new Rs,Nl=new Rs,Il=new Rs,Ll=new Rs,Ol=new Qo,zl=new Qo,Ul=new Qo,Fl=new Rs,jl=new Rs,Bl=new Rs,Vl=new Rs,Hl=new Rs;class Gl extends Na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new el;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){Ll.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],a=r[n];0!==i&&(Il.fromBufferAttribute(a,e),o?Ll.addScaledVector(Il,i):Ll.addScaledVector(Il.sub(t),i))}t.add(Ll)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Pl.copy(n.boundingSphere),Pl.applyMatrix4(r),Al.copy(e.ray).recast(e.near),!1===Pl.containsPoint(Al.origin)){if(null===Al.intersectSphere(Pl,Dl))return;if(Al.origin.distanceToSquared(Dl)>(e.far-e.near)**2)return}Tl.copy(r).invert(),Al.copy(e.ray).applyMatrix4(Tl),null!==n.boundingBox&&!1===Al.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Al)}}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,s=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,d=r.groups,h=r.drawRange;if(null!==s)if(Array.isArray(o))for(let p=0,f=d.length;p<f;p++){const r=d[p],a=o[r.materialIndex];for(let o=Math.max(r.start,h.start),d=Math.min(s.count,Math.min(r.start+r.count,h.start+h.count));o<d;o+=3){i=Wl(this,a,e,n,l,c,u,s.getX(o),s.getX(o+1),s.getX(o+2)),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,h.start),a=Math.min(s.count,h.start+h.count);r<a;r+=3){i=Wl(this,o,e,n,l,c,u,s.getX(r),s.getX(r+1),s.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==a)if(Array.isArray(o))for(let p=0,f=d.length;p<f;p++){const r=d[p],s=o[r.materialIndex];for(let o=Math.max(r.start,h.start),d=Math.min(a.count,Math.min(r.start+r.count,h.start+h.count));o<d;o+=3){i=Wl(this,s,e,n,l,c,u,o,o+1,o+2),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,h.start),s=Math.min(a.count,h.start+h.count);r<s;r+=3){i=Wl(this,o,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function Wl(e,t,n,i,r,o,s,a,l,c){e.getVertexPosition(a,kl),e.getVertexPosition(l,Rl),e.getVertexPosition(c,Nl);const u=function(e,t,n,i,r,o,s,a){let l;if(l=t.side===dn?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,t.side===un,a),null===l)return null;Hl.copy(a),Hl.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Hl);return c<n.near||c>n.far?null:{distance:c,point:Hl.clone(),object:e}}(e,t,n,i,kl,Rl,Nl,Vl);if(u){r&&(Ol.fromBufferAttribute(r,a),zl.fromBufferAttribute(r,l),Ul.fromBufferAttribute(r,c),u.uv=Wa.getInterpolation(Vl,kl,Rl,Nl,Ol,zl,Ul,new Qo)),o&&(Ol.fromBufferAttribute(o,a),zl.fromBufferAttribute(o,l),Ul.fromBufferAttribute(o,c),u.uv1=Wa.getInterpolation(Vl,kl,Rl,Nl,Ol,zl,Ul,new Qo),u.uv2=u.uv1),s&&(Fl.fromBufferAttribute(s,a),jl.fromBufferAttribute(s,l),Bl.fromBufferAttribute(s,c),u.normal=Wa.getInterpolation(Vl,kl,Rl,Nl,Fl,jl,Bl,new Rs),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a:a,b:l,c:c,normal:new Rs,materialIndex:0};Wa.getNormal(kl,Rl,Nl,e.normal),u.face=e}return u}class Xl extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],c=[],u=[];let d=0,h=0;function p(e,t,n,i,r,o,p,f,m,g,v){const y=o/m,b=p/g,x=o/2,_=p/2,w=f/2,S=m+1,M=g+1;let E=0,C=0;const T=new Rs;for(let s=0;s<M;s++){const o=s*b-_;for(let a=0;a<S;a++){const d=a*y-x;T[e]=d*i,T[t]=o*r,T[n]=w,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=f>0?1:-1,c.push(T.x,T.y,T.z),u.push(a/m),u.push(1-s/g),E+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){const t=d+e+S*s,n=d+e+S*(s+1),i=d+(e+1)+S*(s+1),r=d+(e+1)+S*s;a.push(t,n,r),a.push(n,i,r),C+=6}s.addGroup(h,C,v),h+=C,d+=E}p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,i,o,2),p("x","z","y",1,-1,e,n,-t,i,o,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new vl(l,3)),this.setAttribute("normal",new vl(c,3)),this.setAttribute("uv",new vl(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Yl(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function $l(e){const t={};for(let n=0;n<e.length;n++){const i=Yl(e[n]);for(const e in i)t[e]=i[e]}return t}function ql(e){return null===e.getRenderTarget()?e.outputColorSpace:ps.workingColorSpace}const Zl={clone:Yl,merge:$l};class Kl extends Qa{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Yl(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Jl extends Na{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new la,this.projectionMatrix=new la,this.projectionMatrixInverse=new la,this.coordinateSystem=zo}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Ql extends Jl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ho*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Vo*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ho*Math.atan(Math.tan(.5*Vo*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Vo*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ec=-90;class tc extends Na{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ql(ec,1,e,t);i.layers=this.layers,this.add(i);const r=new Ql(ec,1,e,t);r.layers=this.layers,this.add(r);const o=new Ql(ec,1,e,t);o.layers=this.layers,this.add(o);const s=new Ql(ec,1,e,t);s.layers=this.layers,this.add(s);const a=new Ql(ec,1,e,t);a.layers=this.layers,this.add(a);const l=new Ql(ec,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,s,a]=t;for(const l of t)this.remove(l);if(e===zo)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==Uo)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,s,a,l,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,a),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,d,h),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class nc extends ws{constructor(e,t,n,i,r,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ai,n,i,r,o,s,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ic extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];void 0!==t.encoding&&(ls("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===jr?Xr:Wr),this.texture=new nc(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:xi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Xl(5,5,5),r=new Kl({name:"CubemapFromEquirect",uniforms:Yl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:dn,blending:fn});r.uniforms.tEquirect.value=t;const o=new Gl(i,r),s=t.minFilter;t.minFilter===Si&&(t.minFilter=xi);return new tc(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}const rc=new Rs,oc=new Rs,sc=new es;class ac{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=rc.subVectors(n,t).cross(oc.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(rc),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||sc.getNormalMatrix(e),i=this.coplanarPoint(rc).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const lc=new Qs,cc=new Rs;class uc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ac,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ac,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ac,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ac,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ac,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new ac;this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zo;const n=this.planes,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15];if(n[0].setComponents(a-r,d-l,m-h,b-g).normalize(),n[1].setComponents(a+r,d+l,m+h,b+g).normalize(),n[2].setComponents(a+o,d+c,m+p,b+v).normalize(),n[3].setComponents(a-o,d-c,m-p,b-v).normalize(),n[4].setComponents(a-s,d-u,m-f,b-y).normalize(),t===zo)n[5].setComponents(a+s,d+u,m+f,b+y).normalize();else{if(t!==Uo)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),lc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),lc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(lc)}intersectsSprite(e){return lc.center.set(0,0,0),lc.radius=.7071067811865476,lc.applyMatrix4(e.matrixWorld),this.intersectsSphere(lc)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(cc.x=i.normal.x>0?e.max.x:e.min.x,cc.y=i.normal.y>0?e.max.y:e.min.y,cc.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(cc)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function dc(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function hc(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=i.get(t);if(void 0===o)i.set(t,function(t,i){const r=t.array,o=t.usage,s=r.byteLength,a=e.createBuffer();let l;if(e.bindBuffer(i,a),e.bufferData(i,r,o),t.onUploadCallback(),r instanceof Float32Array)l=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=e.HALF_FLOAT}else l=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)l=e.SHORT;else if(r instanceof Uint32Array)l=e.UNSIGNED_INT;else if(r instanceof Int32Array)l=e.INT;else if(r instanceof Int8Array)l=e.BYTE;else if(r instanceof Uint8Array)l=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);l=e.UNSIGNED_BYTE}return{buffer:a,type:l,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:s}}(t,r));else if(o.version<t.version){if(o.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,i,r){const o=i.array,s=i._updateRange,a=i.updateRanges;if(e.bindBuffer(r,t),-1===s.count&&0===a.length&&e.bufferSubData(r,0,o),0!==a.length){for(let t=0,i=a.length;t<i;t++){const i=a[t];n?e.bufferSubData(r,i.start*o.BYTES_PER_ELEMENT,o,i.start,i.count):e.bufferSubData(r,i.start*o.BYTES_PER_ELEMENT,o.subarray(i.start,i.start+i.count))}i.clearUpdateRanges()}-1!==s.count&&(n?e.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1),i.onUploadCallback()}(o.buffer,t,r),o.version=t.version}}}}class pc extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,s=Math.floor(n),a=Math.floor(i),l=s+1,c=a+1,u=e/s,d=t/a,h=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*d-o;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;h.push(t,n,r),h.push(n,i,r)}this.setIndex(h),this.setAttribute("position",new vl(p,3)),this.setAttribute("normal",new vl(f,3)),this.setAttribute("uv",new vl(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pc(e.width,e.height,e.widthSegments,e.heightSegments)}}const fc={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor *= toneMappingExposure;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\treturn color;\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},mc={common:{diffuse:{value:new Za(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new es},alphaMap:{value:null},alphaMapTransform:{value:new es},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new es}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new es}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new es}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new es},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new es},normalScale:{value:new Qo(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new es},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new es}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new es}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new es}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Za(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Za(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new es},alphaTest:{value:0},uvTransform:{value:new es}},sprite:{diffuse:{value:new Za(16777215)},opacity:{value:1},center:{value:new Qo(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new es},alphaMap:{value:null},alphaMapTransform:{value:new es},alphaTest:{value:0}}},gc={basic:{uniforms:$l([mc.common,mc.specularmap,mc.envmap,mc.aomap,mc.lightmap,mc.fog]),vertexShader:fc.meshbasic_vert,fragmentShader:fc.meshbasic_frag},lambert:{uniforms:$l([mc.common,mc.specularmap,mc.envmap,mc.aomap,mc.lightmap,mc.emissivemap,mc.bumpmap,mc.normalmap,mc.displacementmap,mc.fog,mc.lights,{emissive:{value:new Za(0)}}]),vertexShader:fc.meshlambert_vert,fragmentShader:fc.meshlambert_frag},phong:{uniforms:$l([mc.common,mc.specularmap,mc.envmap,mc.aomap,mc.lightmap,mc.emissivemap,mc.bumpmap,mc.normalmap,mc.displacementmap,mc.fog,mc.lights,{emissive:{value:new Za(0)},specular:{value:new Za(1118481)},shininess:{value:30}}]),vertexShader:fc.meshphong_vert,fragmentShader:fc.meshphong_frag},standard:{uniforms:$l([mc.common,mc.envmap,mc.aomap,mc.lightmap,mc.emissivemap,mc.bumpmap,mc.normalmap,mc.displacementmap,mc.roughnessmap,mc.metalnessmap,mc.fog,mc.lights,{emissive:{value:new Za(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:fc.meshphysical_vert,fragmentShader:fc.meshphysical_frag},toon:{uniforms:$l([mc.common,mc.aomap,mc.lightmap,mc.emissivemap,mc.bumpmap,mc.normalmap,mc.displacementmap,mc.gradientmap,mc.fog,mc.lights,{emissive:{value:new Za(0)}}]),vertexShader:fc.meshtoon_vert,fragmentShader:fc.meshtoon_frag},matcap:{uniforms:$l([mc.common,mc.bumpmap,mc.normalmap,mc.displacementmap,mc.fog,{matcap:{value:null}}]),vertexShader:fc.meshmatcap_vert,fragmentShader:fc.meshmatcap_frag},points:{uniforms:$l([mc.points,mc.fog]),vertexShader:fc.points_vert,fragmentShader:fc.points_frag},dashed:{uniforms:$l([mc.common,mc.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:fc.linedashed_vert,fragmentShader:fc.linedashed_frag},depth:{uniforms:$l([mc.common,mc.displacementmap]),vertexShader:fc.depth_vert,fragmentShader:fc.depth_frag},normal:{uniforms:$l([mc.common,mc.bumpmap,mc.normalmap,mc.displacementmap,{opacity:{value:1}}]),vertexShader:fc.meshnormal_vert,fragmentShader:fc.meshnormal_frag},sprite:{uniforms:$l([mc.sprite,mc.fog]),vertexShader:fc.sprite_vert,fragmentShader:fc.sprite_frag},background:{uniforms:{uvTransform:{value:new es},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:fc.background_vert,fragmentShader:fc.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:fc.backgroundCube_vert,fragmentShader:fc.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:fc.cube_vert,fragmentShader:fc.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:fc.equirect_vert,fragmentShader:fc.equirect_frag},distanceRGBA:{uniforms:$l([mc.common,mc.displacementmap,{referencePosition:{value:new Rs},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:fc.distanceRGBA_vert,fragmentShader:fc.distanceRGBA_frag},shadow:{uniforms:$l([mc.lights,mc.fog,{color:{value:new Za(0)},opacity:{value:1}}]),vertexShader:fc.shadow_vert,fragmentShader:fc.shadow_frag}};gc.physical={uniforms:$l([gc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new es},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new es},clearcoatNormalScale:{value:new Qo(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new es},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new es},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new es},sheen:{value:0},sheenColor:{value:new Za(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new es},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new es},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new es},transmissionSamplerSize:{value:new Qo},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new es},attenuationDistance:{value:0},attenuationColor:{value:new Za(0)},specularColor:{value:new Za(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new es},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new es},anisotropyVector:{value:new Qo},anisotropyMap:{value:null},anisotropyMapTransform:{value:new es}}]),vertexShader:fc.meshphysical_vert,fragmentShader:fc.meshphysical_frag};const vc={r:0,b:0,g:0};function yc(e,t,n,i,r,o,s){const a=new Za(0);let l,c,u=!0===o?0:1,d=null,h=0,p=null;function f(t,n){t.getRGB(vc,ql(e)),i.buffers.color.setClear(vc.r,vc.g,vc.b,n,s)}return{getClearColor:function(){return a},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;a.set(e),u=t,f(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,f(a,u)},render:function(o,m){let g=!1,v=!0===m.isScene?m.background:null;if(v&&v.isTexture){v=(m.backgroundBlurriness>0?n:t).get(v)}null===v?f(a,u):v&&v.isColor&&(f(v,1),g=!0);const y=e.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===di)?(void 0===c&&(c=new Gl(new Xl(1,1,1),new Kl({name:"BackgroundCubeMaterial",uniforms:Yl(gc.backgroundCube.uniforms),vertexShader:gc.backgroundCube.vertexShader,fragmentShader:gc.backgroundCube.fragmentShader,side:dn,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=ps.getTransfer(v.colorSpace)!==Kr,d===v&&h===v.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=v,h=v.version,p=e.toneMapping),c.layers.enableAll(),o.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new Gl(new pc(2,2),new Kl({name:"BackgroundMaterial",uniforms:Yl(gc.background.uniforms),vertexShader:gc.background.vertexShader,fragmentShader:gc.background.fragmentShader,side:un,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=ps.getTransfer(v.colorSpace)!==Kr,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),d===v&&h===v.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=v,h=v.version,p=e.toneMapping),l.layers.enableAll(),o.unshift(l,l.geometry,l.material,0,0,null))}}}function bc(e,t,n,i){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),s=i.isWebGL2||null!==o,a={},l=p(null);let c=l,u=!1;function d(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let o=0;o<r;o++)t[o]=0,n[o]=0,i[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;if(o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==r){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function v(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function y(t,n,i,r,o,s,a){!0===a?e.vertexAttribIPointer(t,n,i,o,s):e.vertexAttribPointer(t,n,i,r,o,s)}function b(){x(),u=!0,c!==l&&(c=l,d(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,b,x){let _=!1;if(s){const t=function(t,n,r){const s=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s];void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[s]=u);return u}(b,h,l);c!==t&&(c=t,d(c.object)),_=function(e,t,n,i){const r=c.attributes,o=t.attributes;let s=0;const a=n.getAttributes();for(const l in a){if(a[l].location>=0){const t=r[l];let n=o[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;s++}}return c.attributesNum!==s||c.index!==i}(r,b,h,x),_&&function(e,t,n,i){const r={},o=t.attributes;let s=0;const a=n.getAttributes();for(const l in a){if(a[l].location>=0){let t=o[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[l]=n,s++}}c.attributes=r,c.attributesNum=s,c.index=i}(r,b,h,x)}else{const e=!0===l.wireframe;c.geometry===b.id&&c.program===h.id&&c.wireframe===e||(c.geometry=b.id,c.program=h.id,c.wireframe=e,_=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(_||u)&&(u=!1,function(r,o,s,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const o=c[t];if(o.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const t=s.normalized,l=s.itemSize,c=n.get(s);if(void 0===c)continue;const u=c.buffer,d=c.type,h=c.bytesPerElement,p=!0===i.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||s.gpuType===Pi);if(s.isInterleavedBufferAttribute){const n=s.data,i=n.stride,c=s.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<o.locationSize;e++)g(o.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<o.locationSize;e++)m(o.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<o.locationSize;e++)y(o.location+e,l/o.locationSize,d,t,i*h,(c+l/o.locationSize*e)*h,p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<o.locationSize;e++)g(o.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<o.locationSize;e++)m(o.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<o.locationSize;e++)y(o.location+e,l/o.locationSize,d,t,l*h,l/o.locationSize*e*h,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(o.location,n);break;case 3:e.vertexAttrib3fv(o.location,n);break;case 4:e.vertexAttrib4fv(o.location,n);break;default:e.vertexAttrib1fv(o.location,n)}}}}v()}(r,l,h,b),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){b();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const n in t){const e=t[n];for(const t in e)h(e[t].object),delete e[t];delete t[n]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function xc(e,t,n,i){const r=i.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,i){e.drawArrays(o,t,i),n.update(i,o,1)},this.renderInstances=function(i,s,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,i,s,a),n.update(s,o,a)},this.renderMultiDraw=function(e,i,r){if(0===r)return;const s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<r;t++)this.render(e[t],i[t]);else{s.multiDrawArraysWEBGL(o,e,0,i,0,r);let t=0;for(let e=0;e<r;e++)t+=i[e];n.update(t,o,1)}}}function _c(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!==typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let s=void 0!==n.precision?n.precision:"highp";const a=r(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=o||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,b=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function wc(e){const t=this;let n=null,i=0,r=!1,o=!1;const s=new ac,a=new es,l={value:null,needsUpdate:!1};function c(e,n,i,r){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const t=i+4*o,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==o;++n,l+=4)s.copy(e[n]).applyMatrix4(r,a),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,a,u){const d=s.clippingPlanes,h=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===d||0===d.length||o&&!p)o?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=o?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(d,a,t,u);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function Sc(e){let t=new WeakMap;function n(e,t){return t===ci?e.mapping=ai:t===ui&&(e.mapping=li),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping;if(o===ci||o===ui){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const o=r.image;if(o&&o.height>0){const s=new ic(o.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class Mc extends Jl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Ec=[.125,.215,.35,.446,.526,.582],Cc=20,Tc=new Mc,Ac=new Za;let Pc=null,Dc=0,kc=0;const Rc=(1+Math.sqrt(5))/2,Nc=1/Rc,Ic=[new Rs(1,1,1),new Rs(-1,1,1),new Rs(1,1,-1),new Rs(-1,1,-1),new Rs(0,Rc,Nc),new Rs(0,Rc,-Nc),new Rs(Nc,0,Rc),new Rs(-Nc,0,Rc),new Rs(Rc,Nc,0),new Rs(-Rc,Nc,0)];class Lc{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Pc=this._renderer.getRenderTarget(),Dc=this._renderer.getActiveCubeFace(),kc=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Fc(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Uc(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Pc,Dc,kc),e.scissorTest=!1,zc(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ai||e.mapping===li?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Pc=this._renderer.getRenderTarget(),Dc=this._renderer.getActiveCubeFace(),kc=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:xi,minFilter:xi,generateMipmaps:!1,type:Ri,format:zi,colorSpace:Yr,depthBuffer:!1},i=Oc(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Oc(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const o=e-4+1+Ec.length;for(let s=0;s<o;s++){const o=Math.pow(2,r);n.push(o);let a=1/o;s>e-4?a=Ec[s-e+4-1]:0===s&&(a=0),i.push(a);const l=1/(o-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*h),y=new Float32Array(m*p*h),b=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),y.set(d,m*p*e);const r=[e,e,e,e,e,e];b.set(r,g*p*e)}const x=new Cl;x.setAttribute("position",new ll(v,f)),x.setAttribute("uv",new ll(y,m)),x.setAttribute("faceIndex",new ll(b,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(Cc),r=new Rs(0,1,0),o=new Kl({name:"SphericalGaussianBlur",defines:{n:Cc,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:jc(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:fn,depthTest:!1,depthWrite:!1});return o}(i,e,t)}return i}_compileMaterial(e){const t=new Gl(this._lodPlanes[0],e);this._renderer.compile(t,Tc)}_sceneToCubeUV(e,t,n,i){const r=new Ql(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Ac),a.toneMapping=Kn,a.autoClear=!1;const u=new el({name:"PMREM.Background",side:dn,depthWrite:!1,depthTest:!1}),d=new Gl(new Xl,u);let h=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,h=!0):(u.color.copy(Ac),h=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(r.up.set(0,o[f],0),r.lookAt(s[f],0,0)):1===t?(r.up.set(0,0,o[f]),r.lookAt(0,s[f],0)):(r.up.set(0,o[f],0),r.lookAt(0,0,s[f]));const n=this._cubeSize;zc(i,t*n,f>2?n:0,n,n),a.setRenderTarget(i),h&&a.render(d,r),a.render(e,r)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===ai||e.mapping===li;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Fc()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Uc());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new Gl(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const s=this._cubeSize;zc(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(o,Tc)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=Ic[(i-1)%Ic.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Gl(this._lodPlanes[i],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/h,f=isFinite(r)?1+Math.floor(3*p):Cc;f>Cc&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let b=0;b<Cc;++b){const e=b/p,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<f&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s);const{_lodMax:v}=this;u.dTheta.value=h,u.mipInt.value=v-n;const y=this._sizeLods[i];zc(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(c,Tc)}}function Oc(e,t,n){const i=new Es(e,t,n);return i.texture.mapping=di,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function zc(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Uc(){return new Kl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:jc(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:fn,depthTest:!1,depthWrite:!1})}function Fc(){return new Kl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:jc(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:fn,depthTest:!1,depthWrite:!1})}function jc(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Bc(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,s=o===ci||o===ui,a=o===ai||o===li;if(s||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new Lc(e)),i=s?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const o=r.image;if(s&&o&&o.height>0||a&&o&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(o)){null===n&&(n=new Lc(e));const o=s?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,o),r.addEventListener("dispose",i),o.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Vc(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?(n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance")):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Hc(e,t,n,i){const r={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const n in a.attributes)t.remove(a.attributes[n]);for(const n in a.morphAttributes){const e=a.morphAttributes[n];for(let n=0,i=e.length;n<i;n++)t.remove(e[n])}a.removeEventListener("dispose",s),delete r[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{if(void 0===r)return;{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const a=new(ns(n)?ml:pl)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const o in i)t.update(i[o],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const o in r){const n=r[o];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Gc(e,t,n,i){const r=i.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(o,i,s,t*a),n.update(i,o,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,d;if(r)u=e,d="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](o,l,s,i*a,c),n.update(l,o,c)},this.renderMultiDraw=function(e,i,r){if(0===r)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<r;t++)this.render(e[t]/a,i[t]);else{l.multiDrawElementsWEBGL(o,i,0,s,e,0,r);let t=0;for(let e=0;e<r;e++)t+=i[e];n.update(t,o,1)}}}function Wc(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Xc(e,t){return e[0]-t[0]}function Yc(e,t){return Math.abs(t[1])-Math.abs(e[1])}function $c(e,t,n){const i={},r=new Float32Array(8),o=new WeakMap,s=new Ss,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function(l,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const h=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==h?h.length:0;let f=o.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const v=void 0!==c.morphAttributes.position,y=void 0!==c.morphAttributes.normal,b=void 0!==c.morphAttributes.color,x=c.morphAttributes.position||[],_=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;!0===v&&(S=1),!0===y&&(S=2),!0===b&&(S=3);let M=c.attributes.position.count*S,E=1;M>t.maxTextureSize&&(E=Math.ceil(M/t.maxTextureSize),M=t.maxTextureSize);const C=new Float32Array(M*E*4*p),T=new Cs(C,M,E,p);T.type=ki,T.needsUpdate=!0;const A=4*S;for(let D=0;D<p;D++){const k=x[D],R=_[D],N=w[D],I=M*E*4*D;for(let L=0;L<k.count;L++){const O=L*A;!0===v&&(s.fromBufferAttribute(k,L),C[I+O+0]=s.x,C[I+O+1]=s.y,C[I+O+2]=s.z,C[I+O+3]=0),!0===y&&(s.fromBufferAttribute(R,L),C[I+O+4]=s.x,C[I+O+5]=s.y,C[I+O+6]=s.z,C[I+O+7]=0),!0===b&&(s.fromBufferAttribute(N,L),C[I+O+8]=s.x,C[I+O+9]=s.y,C[I+O+10]=s.z,C[I+O+11]=4===N.itemSize?s.w:1)}}function P(){T.dispose(),o.delete(c),c.removeEventListener("dispose",P)}f={count:p,texture:T,size:new Qo(M,E)},o.set(c,f),c.addEventListener("dispose",P)}let m=0;for(let z=0;z<d.length;z++)m+=d[z];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(e,"morphTargetBaseInfluence",g),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const U=void 0===d?0:d.length;let F=i[c.id];if(void 0===F||F.length!==U){F=[];for(let G=0;G<U;G++)F[G]=[G,0];i[c.id]=F}for(let W=0;W<U;W++){const X=F[W];X[0]=W,X[1]=d[W]}F.sort(Yc);for(let Y=0;Y<8;Y++)Y<U&&F[Y][1]?(a[Y][0]=F[Y][0],a[Y][1]=F[Y][1]):(a[Y][0]=Number.MAX_SAFE_INTEGER,a[Y][1]=0);a.sort(Xc);const j=c.morphAttributes.position,B=c.morphAttributes.normal;let V=0;for(let $=0;$<8;$++){const q=a[$],Z=q[0],K=q[1];Z!==Number.MAX_SAFE_INTEGER&&K?(j&&c.getAttribute("morphTarget"+$)!==j[Z]&&c.setAttribute("morphTarget"+$,j[Z]),B&&c.getAttribute("morphNormal"+$)!==B[Z]&&c.setAttribute("morphNormal"+$,B[Z]),r[$]=K,V+=K):(j&&!0===c.hasAttribute("morphTarget"+$)&&c.deleteAttribute("morphTarget"+$),B&&!0===c.hasAttribute("morphNormal"+$)&&c.deleteAttribute("morphNormal"+$),r[$]=0)}const H=c.morphTargetsRelative?1:1-V;u.getUniforms().setValue(e,"morphTargetBaseInfluence",H),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function qc(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const a=i.render.frame,l=s.geometry,c=t.get(s,l);if(r.get(c)!==a&&(t.update(c),r.set(c,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),r.get(s)!==a&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,a))),s.isSkinnedMesh){const e=s.skeleton;r.get(e)!==a&&(e.update(),r.set(e,a))}return c},dispose:function(){r=new WeakMap}}}class Zc extends ws{constructor(e,t,n,i,r,o,s,a,l,c){if((c=void 0!==c?c:ji)!==ji&&c!==Bi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===ji&&(n=Di),void 0===n&&c===Bi&&(n=Li),super(null,i,r,o,s,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:mi,this.minFilter=void 0!==a?a:mi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const Kc=new ws,Jc=new Zc(1,1);Jc.compareFunction=xo;const Qc=new Cs,eu=new As,tu=new nc,nu=[],iu=[],ru=new Float32Array(16),ou=new Float32Array(9),su=new Float32Array(4);function au(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=nu[r];if(void 0===o&&(o=new Float32Array(r),nu[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function lu(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function cu(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function uu(e,t){let n=iu[t];void 0===n&&(n=new Int32Array(t),iu[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function du(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function hu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(lu(n,t))return;e.uniform2fv(this.addr,t),cu(n,t)}}function pu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(lu(n,t))return;e.uniform3fv(this.addr,t),cu(n,t)}}function fu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(lu(n,t))return;e.uniform4fv(this.addr,t),cu(n,t)}}function mu(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(lu(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),cu(n,t)}else{if(lu(n,i))return;su.set(i),e.uniformMatrix2fv(this.addr,!1,su),cu(n,i)}}function gu(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(lu(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),cu(n,t)}else{if(lu(n,i))return;ou.set(i),e.uniformMatrix3fv(this.addr,!1,ou),cu(n,i)}}function vu(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(lu(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),cu(n,t)}else{if(lu(n,i))return;ru.set(i),e.uniformMatrix4fv(this.addr,!1,ru),cu(n,i)}}function yu(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function bu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(lu(n,t))return;e.uniform2iv(this.addr,t),cu(n,t)}}function xu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(lu(n,t))return;e.uniform3iv(this.addr,t),cu(n,t)}}function _u(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(lu(n,t))return;e.uniform4iv(this.addr,t),cu(n,t)}}function wu(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Su(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(lu(n,t))return;e.uniform2uiv(this.addr,t),cu(n,t)}}function Mu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(lu(n,t))return;e.uniform3uiv(this.addr,t),cu(n,t)}}function Eu(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(lu(n,t))return;e.uniform4uiv(this.addr,t),cu(n,t)}}function Cu(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r);const o=this.type===e.SAMPLER_2D_SHADOW?Jc:Kc;n.setTexture2D(t||o,r)}function Tu(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||eu,r)}function Au(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||tu,r)}function Pu(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Qc,r)}function Du(e,t){e.uniform1fv(this.addr,t)}function ku(e,t){const n=au(t,this.size,2);e.uniform2fv(this.addr,n)}function Ru(e,t){const n=au(t,this.size,3);e.uniform3fv(this.addr,n)}function Nu(e,t){const n=au(t,this.size,4);e.uniform4fv(this.addr,n)}function Iu(e,t){const n=au(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Lu(e,t){const n=au(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ou(e,t){const n=au(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function zu(e,t){e.uniform1iv(this.addr,t)}function Uu(e,t){e.uniform2iv(this.addr,t)}function Fu(e,t){e.uniform3iv(this.addr,t)}function ju(e,t){e.uniform4iv(this.addr,t)}function Bu(e,t){e.uniform1uiv(this.addr,t)}function Vu(e,t){e.uniform2uiv(this.addr,t)}function Hu(e,t){e.uniform3uiv(this.addr,t)}function Gu(e,t){e.uniform4uiv(this.addr,t)}function Wu(e,t,n){const i=this.cache,r=t.length,o=uu(n,r);lu(i,o)||(e.uniform1iv(this.addr,o),cu(i,o));for(let s=0;s!==r;++s)n.setTexture2D(t[s]||Kc,o[s])}function Xu(e,t,n){const i=this.cache,r=t.length,o=uu(n,r);lu(i,o)||(e.uniform1iv(this.addr,o),cu(i,o));for(let s=0;s!==r;++s)n.setTexture3D(t[s]||eu,o[s])}function Yu(e,t,n){const i=this.cache,r=t.length,o=uu(n,r);lu(i,o)||(e.uniform1iv(this.addr,o),cu(i,o));for(let s=0;s!==r;++s)n.setTextureCube(t[s]||tu,o[s])}function $u(e,t,n){const i=this.cache,r=t.length,o=uu(n,r);lu(i,o)||(e.uniform1iv(this.addr,o),cu(i,o));for(let s=0;s!==r;++s)n.setTexture2DArray(t[s]||Qc,o[s])}class qu{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return du;case 35664:return hu;case 35665:return pu;case 35666:return fu;case 35674:return mu;case 35675:return gu;case 35676:return vu;case 5124:case 35670:return yu;case 35667:case 35671:return bu;case 35668:case 35672:return xu;case 35669:case 35673:return _u;case 5125:return wu;case 36294:return Su;case 36295:return Mu;case 36296:return Eu;case 35678:case 36198:case 36298:case 36306:case 35682:return Cu;case 35679:case 36299:case 36307:return Tu;case 35680:case 36300:case 36308:case 36293:return Au;case 36289:case 36303:case 36311:case 36292:return Pu}}(t.type)}}class Zu{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Du;case 35664:return ku;case 35665:return Ru;case 35666:return Nu;case 35674:return Iu;case 35675:return Lu;case 35676:return Ou;case 5124:case 35670:return zu;case 35667:case 35671:return Uu;case 35668:case 35672:return Fu;case 35669:case 35673:return ju;case 5125:return Bu;case 36294:return Vu;case 36295:return Hu;case 36296:return Gu;case 35678:case 36198:case 36298:case 36306:case 35682:return Wu;case 35679:case 36299:case 36307:return Xu;case 35680:case 36300:case 36308:case 36293:return Yu;case 36289:case 36303:case 36311:case 36292:return $u}}(t.type)}}class Ku{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const Ju=/(\w+)(\])?(\[|\.)?/g;function Qu(e,t){e.seq.push(t),e.map[t.id]=t}function ed(e,t,n){const i=e.name,r=i.length;for(Ju.lastIndex=0;;){const o=Ju.exec(i),s=Ju.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===r){Qu(n,void 0===c?new qu(a,e,t):new Zu(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new Ku(a),Qu(n,e)),n=e}}}class td{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);ed(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function nd(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let id=0;function rd(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let s=r;s<o;s++){const e=s+1;i.push(`${e===t?">":" "} ${e}: ${n[s]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function od(e,t){const n=function(e){const t=ps.getPrimaries(ps.workingColorSpace),n=ps.getPrimaries(e);let i;switch(t===n?i="":t===Qr&&n===Jr?i="LinearDisplayP3ToLinearSRGB":t===Jr&&n===Qr&&(i="LinearSRGBToLinearDisplayP3"),e){case Yr:case qr:return[i,"LinearTransferOETF"];case Xr:case $r:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function sd(e,t){let n;switch(t){case Jn:n="Linear";break;case Qn:n="Reinhard";break;case ei:n="OptimizedCineon";break;case ti:n="ACESFilmic";break;case ii:n="AgX";break;case ni:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ad(e){return""!==e}function ld(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function cd(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ud=/^[ \t]*#include +<([\w\d./]+)>/gm;function dd(e){return e.replace(ud,pd)}const hd=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function pd(e,t){let n=fc[t];if(void 0===n){const e=hd.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=fc[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return dd(n)}const fd=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function md(e){return e.replace(fd,gd)}function gd(e,t,n,i){let r="";for(let o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function vd(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function yd(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===an?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===ln?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===cn&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ai:case li:t="ENVMAP_TYPE_CUBE";break;case di:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===li&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case $n:t="ENVMAP_BLENDING_MULTIPLY";break;case qn:t="ENVMAP_BLENDING_MIX";break;case Zn:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ad).join("\n")}(n),f=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(ad).join("\n")}(n),m=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),g=r.createProgram();let v,y,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(ad).join("\n"),v.length>0&&(v+="\n"),y=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(ad).join("\n"),y.length>0&&(y+="\n")):(v=[vd(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ad).join("\n"),y=[p,vd(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Kn?"#define TONE_MAPPING":"",n.toneMapping!==Kn?fc.tonemapping_pars_fragment:"",n.toneMapping!==Kn?sd("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",fc.colorspace_pars_fragment,od("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ad).join("\n")),s=dd(s),s=ld(s,n),s=cd(s,n),a=dd(a),a=ld(a,n),a=cd(a,n),s=md(s),a=md(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",v=[f,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,y=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===Lo?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Lo?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const x=b+v+s,_=b+y+a,w=nd(r,r.VERTEX_SHADER,x),S=nd(r,r.FRAGMENT_SHADER,_);function M(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(g).trim(),i=r.getShaderInfoLog(w).trim(),o=r.getShaderInfoLog(S).trim();let s=!0,a=!0;if(!1===r.getProgramParameter(g,r.LINK_STATUS))if(s=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(r,g,w,S);else{const e=rd(r,w,"vertex"),t=rd(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+t)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==o||(a=!1);a&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:i,prefix:v},fragmentShader:{log:o,prefix:y}})}r.deleteShader(w),r.deleteShader(S),E=new td(r,g),C=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),o=i.name;let s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(r,g)}let E,C;r.attachShader(g,w),r.attachShader(g,S),void 0!==n.index0AttributeName?r.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g),this.getUniforms=function(){return void 0===E&&M(this),E},this.getAttributes=function(){return void 0===C&&M(this),C};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=r.getProgramParameter(g,37297)),T},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=id++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=S,this}let bd=0;class xd{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new _d(e),t.set(e,n)),n}}class _d{constructor(e){this.id=bd++,this.code=e,this.usedTimes=0}}function wd(e,t,n,i,r,o,s){const a=new ba,l=new xd,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,h=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(o,a,c,g,v){const y=g.fog,b=v.geometry,x=o.isMeshStandardMaterial?g.environment:null,_=(o.isMeshStandardMaterial?n:t).get(o.envMap||x),w=_&&_.mapping===di?_.image.height:null,S=f[o.type];null!==o.precision&&(p=r.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const M=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,E=void 0!==M?M.length:0;let C,T,A,P,D=0;if(void 0!==b.morphAttributes.position&&(D=1),void 0!==b.morphAttributes.normal&&(D=2),void 0!==b.morphAttributes.color&&(D=3),S){const e=gc[S];C=e.vertexShader,T=e.fragmentShader}else C=o.vertexShader,T=o.fragmentShader,l.update(o),A=l.getVertexShaderID(o),P=l.getFragmentShaderID(o);const k=e.getRenderTarget(),R=!0===v.isInstancedMesh,N=!0===v.isBatchedMesh,I=!!o.map,L=!!o.matcap,O=!!_,z=!!o.aoMap,U=!!o.lightMap,F=!!o.bumpMap,j=!!o.normalMap,B=!!o.displacementMap,V=!!o.emissiveMap,H=!!o.metalnessMap,G=!!o.roughnessMap,W=o.anisotropy>0,X=o.clearcoat>0,Y=o.iridescence>0,$=o.sheen>0,q=o.transmission>0,Z=W&&!!o.anisotropyMap,K=X&&!!o.clearcoatMap,J=X&&!!o.clearcoatNormalMap,Q=X&&!!o.clearcoatRoughnessMap,ee=Y&&!!o.iridescenceMap,te=Y&&!!o.iridescenceThicknessMap,ne=$&&!!o.sheenColorMap,ie=$&&!!o.sheenRoughnessMap,re=!!o.specularMap,oe=!!o.specularColorMap,se=!!o.specularIntensityMap,ae=q&&!!o.transmissionMap,le=q&&!!o.thicknessMap,ce=!!o.gradientMap,ue=!!o.alphaMap,de=o.alphaTest>0,he=!!o.alphaHash,pe=!!o.extensions,fe=!!b.attributes.uv1,me=!!b.attributes.uv2,ge=!!b.attributes.uv3;let ve=Kn;return o.toneMapped&&(null!==k&&!0!==k.isXRRenderTarget||(ve=e.toneMapping)),{isWebGL2:u,shaderID:S,shaderType:o.type,shaderName:o.name,vertexShader:C,fragmentShader:T,defines:o.defines,customVertexShaderID:A,customFragmentShaderID:P,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,batching:N,instancing:R,instancingColor:R&&null!==v.instanceColor,supportsVertexTextures:h,outputColorSpace:null===k?e.outputColorSpace:!0===k.isXRRenderTarget?k.texture.colorSpace:Yr,map:I,matcap:L,envMap:O,envMapMode:O&&_.mapping,envMapCubeUVHeight:w,aoMap:z,lightMap:U,bumpMap:F,normalMap:j,displacementMap:h&&B,emissiveMap:V,normalMapObjectSpace:j&&o.normalMapType===Gr,normalMapTangentSpace:j&&o.normalMapType===Hr,metalnessMap:H,roughnessMap:G,anisotropy:W,anisotropyMap:Z,clearcoat:X,clearcoatMap:K,clearcoatNormalMap:J,clearcoatRoughnessMap:Q,iridescence:Y,iridescenceMap:ee,iridescenceThicknessMap:te,sheen:$,sheenColorMap:ne,sheenRoughnessMap:ie,specularMap:re,specularColorMap:oe,specularIntensityMap:se,transmission:q,transmissionMap:ae,thicknessMap:le,gradientMap:ce,opaque:!1===o.transparent&&o.blending===mn,alphaMap:ue,alphaTest:de,alphaHash:he,combine:o.combine,mapUv:I&&m(o.map.channel),aoMapUv:z&&m(o.aoMap.channel),lightMapUv:U&&m(o.lightMap.channel),bumpMapUv:F&&m(o.bumpMap.channel),normalMapUv:j&&m(o.normalMap.channel),displacementMapUv:B&&m(o.displacementMap.channel),emissiveMapUv:V&&m(o.emissiveMap.channel),metalnessMapUv:H&&m(o.metalnessMap.channel),roughnessMapUv:G&&m(o.roughnessMap.channel),anisotropyMapUv:Z&&m(o.anisotropyMap.channel),clearcoatMapUv:K&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:J&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Q&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:te&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(o.sheenRoughnessMap.channel),specularMapUv:re&&m(o.specularMap.channel),specularColorMapUv:oe&&m(o.specularColorMap.channel),specularIntensityMapUv:se&&m(o.specularIntensityMap.channel),transmissionMapUv:ae&&m(o.transmissionMap.channel),thicknessMapUv:le&&m(o.thicknessMap.channel),alphaMapUv:ue&&m(o.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(j||W),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUv1s:fe,vertexUv2s:me,vertexUv3s:ge,pointsUvs:!0===v.isPoints&&!!b.attributes.uv&&(I||ue),fog:!!y,useFog:!0===o.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:E,morphTextureStride:D,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ve,useLegacyLights:e._useLegacyLights,decodeVideoTexture:I&&!0===o.map.isVideoTexture&&ps.getTransfer(o.map.colorSpace)===Kr,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===hn,flipSided:o.side===dn,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:pe&&!0===o.extensions.derivatives,extensionFragDepth:pe&&!0===o.extensions.fragDepth,extensionDrawBuffers:pe&&!0===o.extensions.drawBuffers,extensionShaderTextureLOD:pe&&!0===o.extensions.shaderTextureLOD,extensionClipCullDistance:pe&&o.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0);t.supportsVertexTextures&&a.enable(1);t.instancing&&a.enable(2);t.instancingColor&&a.enable(3);t.matcap&&a.enable(4);t.envMap&&a.enable(5);t.normalMapObjectSpace&&a.enable(6);t.normalMapTangentSpace&&a.enable(7);t.clearcoat&&a.enable(8);t.iridescence&&a.enable(9);t.alphaTest&&a.enable(10);t.vertexColors&&a.enable(11);t.vertexAlphas&&a.enable(12);t.vertexUv1s&&a.enable(13);t.vertexUv2s&&a.enable(14);t.vertexUv3s&&a.enable(15);t.vertexTangents&&a.enable(16);t.anisotropy&&a.enable(17);t.alphaHash&&a.enable(18);t.batching&&a.enable(19);e.push(a.mask),a.disableAll(),t.fog&&a.enable(0);t.useFog&&a.enable(1);t.flatShading&&a.enable(2);t.logarithmicDepthBuffer&&a.enable(3);t.skinning&&a.enable(4);t.morphTargets&&a.enable(5);t.morphNormals&&a.enable(6);t.morphColors&&a.enable(7);t.premultipliedAlpha&&a.enable(8);t.shadowMapEnabled&&a.enable(9);t.useLegacyLights&&a.enable(10);t.doubleSided&&a.enable(11);t.flipSided&&a.enable(12);t.useDepthPacking&&a.enable(13);t.dithering&&a.enable(14);t.transmission&&a.enable(15);t.sheen&&a.enable(16);t.opaque&&a.enable(17);t.pointsUvs&&a.enable(18);t.decodeVideoTexture&&a.enable(19);e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=gc[t];n=Zl.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=c.length;e<r;e++){const t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new yd(e,n,t,o),c.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Sd(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Md(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ed(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Cd(){const e=[];let t=0;const n=[],i=[],r=[];function o(n,i,r,o,s,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:o,renderOrder:n.renderOrder,z:s,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=s,l.group=a),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?i.push(u):!0===s.transparent?r.push(u):n.push(u)},unshift:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?i.unshift(u):!0===s.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Md),i.length>1&&i.sort(t||Ed),r.length>1&&r.sort(t||Ed)}}}function Td(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new Cd,e.set(t,[r])):n>=i.length?(r=new Cd,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function Ad(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Rs,color:new Za};break;case"SpotLight":n={position:new Rs,direction:new Rs,color:new Za,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Rs,color:new Za,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Rs,skyColor:new Za,groundColor:new Za};break;case"RectAreaLight":n={color:new Za,position:new Rs,halfWidth:new Rs,halfHeight:new Rs}}return e[t.id]=n,n}}}let Pd=0;function Dd(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function kd(e,t){const n=new Ad,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qo};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qo,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new Rs);const o=new Rs,s=new la,a=new la;return{setup:function(o,s){let a=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0,x=0;o.sort(Dd);const _=!0===s?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],s=t.color,w=t.intensity,S=t.distance,M=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=s.r*w*_,l+=s.g*w*_,c+=s.b*w*_;else if(t.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],w);x++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=M,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(w*_),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[h]=e;const o=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,o.updateMatrices(t),t.castShadow&&b++),r.spotLightMatrix[h]=o.matrix,t.castShadow){const e=i.get(t);e.shadowBias=o.bias,e.shadowNormalBias=o.normalBias,e.shadowRadius=o.radius,e.shadowMapSize=o.mapSize,r.spotShadow[h]=e,r.spotShadowMap[h]=M,v++}h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[d]=n,r.pointShadowMap[d]=M,r.pointShadowMatrix[d]=t.shadow.matrix,g++}r.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(w*_),e.groundColor.copy(t.groundColor).multiplyScalar(w*_),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2?!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=mc.LTC_FLOAT_1,r.rectAreaLTC2=mc.LTC_FLOAT_2):(r.rectAreaLTC1=mc.LTC_HALF_1,r.rectAreaLTC2=mc.LTC_HALF_2):!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=mc.LTC_FLOAT_1,r.rectAreaLTC2=mc.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=mc.LTC_HALF_1,r.rectAreaLTC2=mc.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const w=r.hash;w.directionalLength===u&&w.pointLength===d&&w.spotLength===h&&w.rectAreaLength===p&&w.hemiLength===f&&w.numDirectionalShadows===m&&w.numPointShadows===g&&w.numSpotShadows===v&&w.numSpotMaps===y&&w.numLightProbes===x||(r.directional.length=u,r.spot.length=h,r.rectArea.length=p,r.point.length=d,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-b,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=b,r.numLightProbes=x,w.directionalLength=u,w.pointLength=d,w.spotLength=h,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,w.numLightProbes=x,r.version=Pd++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let h=0,p=e.length;h<p;h++){const t=e[h];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),o.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),o.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),a.identity(),s.copy(t.matrixWorld),s.premultiply(d),a.extractRotation(s),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(t.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),i++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),u++}}},state:r}}function Rd(e,t){const n=new kd(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Nd(e,t){let n=new WeakMap;return{get:function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=n.get(i);let s;return void 0===o?(s=new Rd(e,t),n.set(i,[s])):r>=o.length?(s=new Rd(e,t),o.push(s)):s=o[r],s},dispose:function(){n=new WeakMap}}}class Id extends Qa{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Br,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ld extends Qa{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Od(e,t,n){let i=new uc;const r=new Qo,o=new Qo,s=new Ss,a=new Id({depthPacking:Vr}),l=new Ld,c={},u=n.maxTextureSize,d={[un]:dn,[dn]:un,[hn]:hn},h=new Kl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qo},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new Cl;f.setAttribute("position",new ll(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Gl(f,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=an;let v=this.type;function y(n,i){const o=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Es(r.x,r.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,h,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,p,m,null)}function b(t,n,i,r){let o=null;const s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)o=s;else if(o=!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=o.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=o.clone(),i[t]=r,n.addEventListener("dispose",_)),o=r}if(o.visible=n.visible,o.wireframe=n.wireframe,o.side=r===cn?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.map=n.map,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===i.isPointLight&&!0===o.isMeshDistanceMaterial){e.properties.get(o).light=i}return o}function x(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===cn)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],d=l[u.materialIndex];if(d&&d.visible){const t=b(n,d,s,a);n.onBeforeShadow(e,n,r,o,i,t,u),e.renderBufferDirect(o,null,i,t,n,u),n.onAfterShadow(e,n,r,o,i,t,u)}}}else if(l.visible){const t=b(n,l,s,a);n.onBeforeShadow(e,n,r,o,i,t,null),e.renderBufferDirect(o,null,i,t,n,null),n.onAfterShadow(e,n,r,o,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,o,s,a)}function _(e){e.target.removeEventListener("dispose",_);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(fn),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=v!==cn&&this.type===cn,f=v===cn&&this.type!==cn;for(let m=0,g=t.length;m<g;m++){const l=t[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const d=c.getFrameExtents();if(r.multiply(d),o.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/d.x),r.x=o.x*d.x,c.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/d.y),r.y=o.y*d.y,c.mapSize.y=o.y)),null===c.map||!0===p||!0===f){const e=this.type!==cn?{minFilter:mi,magFilter:mi}:{};null!==c.map&&c.map.dispose(),c.map=new Es(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),h.viewport(s),c.updateMatrices(l,e),i=c.getFrustum(),x(n,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===cn&&y(c,a),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function zd(e,t,n){const i=n.isWebGL2;const r=new function(){let t=!1;const n=new Ss;let i=null;const r=new Ss(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,s,a){!0===a&&(t*=s,i*=s,o*=s),n.set(t,i,o,s),!1===r.equals(n)&&(e.clearColor(t,i,o,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?V(e.DEPTH_TEST):H(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case jn:e.depthFunc(e.NEVER);break;case Bn:e.depthFunc(e.ALWAYS);break;case Vn:e.depthFunc(e.LESS);break;case Hn:e.depthFunc(e.LEQUAL);break;case Gn:e.depthFunc(e.EQUAL);break;case Wn:e.depthFunc(e.GEQUAL);break;case Xn:e.depthFunc(e.GREATER);break;case Yn:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},s=new function(){let t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?V(e.STENCIL_TEST):H(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&o===s||(e.stencilFunc(t,n,s),i=t,r=n,o=s)},setOp:function(t,n,i){s===t&&a===n&&l===i||(e.stencilOp(t,n,i),s=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null}}},a=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,_=null,w=new Za(0,0,0),S=0,M=!1,E=null,C=null,T=null,A=null,P=null;const D=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,R=0;const N=e.getParameter(e.VERSION);-1!==N.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(N)[1]),k=R>=1):-1!==N.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),k=R>=2);let I=null,L={};const O=e.getParameter(e.SCISSOR_BOX),z=e.getParameter(e.VIEWPORT),U=(new Ss).fromArray(O),F=(new Ss).fromArray(z);function j(t,n,r,o){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let l=0;l<r;l++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+l,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage3D(n,0,e.RGBA,1,1,o,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const B={};function V(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function H(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}B[e.TEXTURE_2D]=j(e.TEXTURE_2D,e.TEXTURE_2D,1),B[e.TEXTURE_CUBE_MAP]=j(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(B[e.TEXTURE_2D_ARRAY]=j(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),B[e.TEXTURE_3D]=j(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),o.setClear(1),s.setClear(0),V(e.DEPTH_TEST),o.setFunc(Hn),Y(!1),$(nn),V(e.CULL_FACE),X(fn);const G={[xn]:e.FUNC_ADD,[_n]:e.FUNC_SUBTRACT,[wn]:e.FUNC_REVERSE_SUBTRACT};if(i)G[Sn]=e.MIN,G[Mn]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(G[Sn]=e.MIN_EXT,G[Mn]=e.MAX_EXT)}const W={[En]:e.ZERO,[Cn]:e.ONE,[Tn]:e.SRC_COLOR,[Pn]:e.SRC_ALPHA,[Ln]:e.SRC_ALPHA_SATURATE,[Nn]:e.DST_COLOR,[kn]:e.DST_ALPHA,[An]:e.ONE_MINUS_SRC_COLOR,[Dn]:e.ONE_MINUS_SRC_ALPHA,[In]:e.ONE_MINUS_DST_COLOR,[Rn]:e.ONE_MINUS_DST_ALPHA,[On]:e.CONSTANT_COLOR,[zn]:e.ONE_MINUS_CONSTANT_COLOR,[Un]:e.CONSTANT_ALPHA,[Fn]:e.ONE_MINUS_CONSTANT_ALPHA};function X(t,n,i,r,o,s,a,l,c,u){if(t!==fn){if(!1===f&&(V(e.BLEND),f=!0),t===bn)o=o||n,s=s||i,a=a||r,n===g&&o===b||(e.blendEquationSeparate(G[n],G[o]),g=n,b=o),i===v&&r===y&&s===x&&a===_||(e.blendFuncSeparate(W[i],W[r],W[s],W[a]),v=i,y=r,x=s,_=a),!1!==l.equals(w)&&c===S||(e.blendColor(l.r,l.g,l.b,c),w.copy(l),S=c),m=t,M=!1;else if(t!==m||u!==M){if(g===xn&&b===xn||(e.blendEquation(e.FUNC_ADD),g=xn,b=xn),u)switch(t){case mn:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case gn:e.blendFunc(e.ONE,e.ONE);break;case vn:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case yn:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case mn:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case gn:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case vn:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case yn:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,_=null,w.set(0,0,0),S=0,m=t,M=u}}else!0===f&&(H(e.BLEND),f=!1)}function Y(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function $(t){t!==tn?(V(e.CULL_FACE),t!==C&&(t===nn?e.cullFace(e.BACK):t===rn?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):H(e.CULL_FACE),C=t}function q(t,n,i){t?(V(e.POLYGON_OFFSET_FILL),A===n&&P===i||(e.polygonOffset(n,i),A=n,P=i)):H(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:o,stencil:s},enable:V,disable:H,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let o=h,s=!1;if(i)if(o=d.get(r),void 0===o&&(o=[],d.set(r,o)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(o.length!==t.length||o[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)o[n]=e.COLOR_ATTACHMENT0+n;o.length=t.length,s=!0}}else o[0]!==e.COLOR_ATTACHMENT0&&(o[0]=e.COLOR_ATTACHMENT0,s=!0);else o[0]!==e.BACK&&(o[0]=e.BACK,s=!0);s&&(n.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:X,setMaterial:function(t,n){t.side===hn?H(e.CULL_FACE):V(e.CULL_FACE);let i=t.side===dn;n&&(i=!i),Y(i),t.blending===mn&&!1===t.transparent?X(fn):X(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),r.setMask(t.colorWrite);const a=t.stencilWrite;s.setTest(a),a&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?V(e.SAMPLE_ALPHA_TO_COVERAGE):H(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Y,setCullFace:$,setLineWidth:function(t){t!==T&&(k&&e.lineWidth(t),T=t)},setPolygonOffset:q,setScissorTest:function(t){t?V(e.SCISSOR_TEST):H(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+D-1),I!==t&&(e.activeTexture(t),I=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===I?e.TEXTURE0+D-1:I);let r=L[i];void 0===r&&(r={type:void 0,texture:void 0},L[i]=r),r.type===t&&r.texture===n||(I!==i&&(e.activeTexture(i),I=i),e.bindTexture(t,n||B[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=L[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},updateUBOMapping:function(t,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=l.get(n).get(t);a.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),a.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(Pb){console.error("THREE.WebGLState:",Pb)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},I=null,L={},u={},d=new WeakMap,h=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,_=null,w=new Za(0,0,0),S=0,M=!1,E=null,C=null,T=null,A=null,P=null,U.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),r.reset(),o.reset(),s.reset()}}}function Ud(e,t,n,i,r,o,s){const a=r.isWebGL2,l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new WeakMap;let d;const h=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(F){}function f(e,t){return p?new OffscreenCanvas(e,t):os("canvas")}function m(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?qo:Math.floor,o=i(r*e.width),s=i(r*e.height);void 0===d&&(d=f(o,s));const a=n?f(o,s):d;a.width=o,a.height=s;return a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return $o(e.width)&&$o(e.height)}function v(e,t){return e.generateMipmaps&&t&&e.minFilter!==mi&&e.minFilter!==xi}function y(t){e.generateMipmap(t)}function b(n,i,r,o){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;if(i===e.RED&&(r===e.FLOAT&&(l=e.R32F),r===e.HALF_FLOAT&&(l=e.R16F),r===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(l=e.R8UI),r===e.UNSIGNED_SHORT&&(l=e.R16UI),r===e.UNSIGNED_INT&&(l=e.R32UI),r===e.BYTE&&(l=e.R8I),r===e.SHORT&&(l=e.R16I),r===e.INT&&(l=e.R32I)),i===e.RG&&(r===e.FLOAT&&(l=e.RG32F),r===e.HALF_FLOAT&&(l=e.RG16F),r===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA){const t=s?Zr:ps.getTransfer(o);r===e.FLOAT&&(l=e.RGBA32F),r===e.HALF_FLOAT&&(l=e.RGBA16F),r===e.UNSIGNED_BYTE&&(l=t===Kr?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function x(e,t,n){return!0===v(e,n)||e.isFramebufferTexture&&e.minFilter!==mi&&e.minFilter!==xi?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function _(t){return t===mi||t===gi||t===yi?e.NEAREST:e.LINEAR}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=h.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(e),0===Object.keys(r).length&&h.delete(n)}i.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=t.texture,r=i.get(t),o=i.get(n);void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),s.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(r.__webglFramebuffer[i]))for(let t=0;t<r.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(r.__webglFramebuffer[i][t]);else e.deleteFramebuffer(r.__webglFramebuffer[i]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[i])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let a=0,l=n.length;a<l;a++){const t=i.get(n[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),i.remove(n[a])}i.remove(n),i.remove(t)}(n)}function M(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete h.get(r)[n.__cacheKey],s.memory.textures--}let E=0;function C(t,r){const o=i.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void R(o,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+r)}const T={[hi]:e.REPEAT,[pi]:e.CLAMP_TO_EDGE,[fi]:e.MIRRORED_REPEAT},A={[mi]:e.NEAREST,[gi]:e.NEAREST_MIPMAP_NEAREST,[yi]:e.NEAREST_MIPMAP_LINEAR,[xi]:e.LINEAR,[_i]:e.LINEAR_MIPMAP_NEAREST,[Si]:e.LINEAR_MIPMAP_LINEAR},P={[vo]:e.NEVER,[Mo]:e.ALWAYS,[yo]:e.LESS,[xo]:e.LEQUAL,[bo]:e.EQUAL,[So]:e.GEQUAL,[_o]:e.GREATER,[wo]:e.NOTEQUAL};function D(n,o,s){if(s?(e.texParameteri(n,e.TEXTURE_WRAP_S,T[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,T[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,T[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A[o.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),o.wrapS===pi&&o.wrapT===pi||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,_(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,_(o.minFilter)),o.minFilter!==mi&&o.minFilter!==xi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,P[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const s=t.get("EXT_texture_filter_anisotropic");if(o.magFilter===mi)return;if(o.minFilter!==yi&&o.minFilter!==Si)return;if(o.type===ki&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&o.type===Ri&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function k(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const r=n.source;let o=h.get(r);void 0===o&&(o={},h.set(r,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),o[a].usedTimes++;const r=o[t.__cacheKey];void 0!==r&&(o[t.__cacheKey].usedTimes--,0===r.usedTimes&&M(n)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return i}function R(t,s,l){let c=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(c=e.TEXTURE_3D);const u=k(t,s),d=s.source;n.bindTexture(c,t.__webglTexture,e.TEXTURE0+l);const h=i.get(d);if(d.version!==h.__version||!0===u){n.activeTexture(e.TEXTURE0+l);const t=ps.getPrimaries(ps.workingColorSpace),i=s.colorSpace===Wr?null:ps.getPrimaries(s.colorSpace),p=s.colorSpace===Wr||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const f=function(e){return!a&&(e.wrapS!==pi||e.wrapT!==pi||e.minFilter!==mi&&e.minFilter!==xi)}(s)&&!1===g(s.image);let _=m(s.image,f,!1,r.maxTextureSize);_=U(s,_);const w=g(_)||a,S=o.convert(s.format,s.colorSpace);let M,E=o.convert(s.type),C=b(s.internalFormat,S,E,s.colorSpace,s.isVideoTexture);D(c,s,w);const T=s.mipmaps,A=a&&!0!==s.isVideoTexture&&C!==tr,P=void 0===h.__version||!0===u,k=x(s,_,w);if(s.isDepthTexture)C=e.DEPTH_COMPONENT,a?C=s.type===ki?e.DEPTH_COMPONENT32F:s.type===Di?e.DEPTH_COMPONENT24:s.type===Li?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:s.type===ki&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===ji&&C===e.DEPTH_COMPONENT&&s.type!==Ai&&s.type!==Di&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=Di,E=o.convert(s.type)),s.format===Bi&&C===e.DEPTH_COMPONENT&&(C=e.DEPTH_STENCIL,s.type!==Li&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=Li,E=o.convert(s.type))),P&&(A?n.texStorage2D(e.TEXTURE_2D,1,C,_.width,_.height):n.texImage2D(e.TEXTURE_2D,0,C,_.width,_.height,0,S,E,null));else if(s.isDataTexture)if(T.length>0&&w){A&&P&&n.texStorage2D(e.TEXTURE_2D,k,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)M=T[t],A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,S,E,M.data):n.texImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,S,E,M.data);s.generateMipmaps=!1}else A?(P&&n.texStorage2D(e.TEXTURE_2D,k,C,_.width,_.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,_.width,_.height,S,E,_.data)):n.texImage2D(e.TEXTURE_2D,0,C,_.width,_.height,0,S,E,_.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){A&&P&&n.texStorage3D(e.TEXTURE_2D_ARRAY,k,C,T[0].width,T[0].height,_.depth);for(let t=0,i=T.length;t<i;t++)M=T[t],s.format!==zi?null!==S?A?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,M.width,M.height,_.depth,S,M.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,C,M.width,M.height,_.depth,0,M.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,M.width,M.height,_.depth,S,E,M.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,C,M.width,M.height,_.depth,0,S,E,M.data)}else{A&&P&&n.texStorage2D(e.TEXTURE_2D,k,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)M=T[t],s.format!==zi?null!==S?A?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,S,M.data):n.compressedTexImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,S,E,M.data):n.texImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,S,E,M.data)}else if(s.isDataArrayTexture)A?(P&&n.texStorage3D(e.TEXTURE_2D_ARRAY,k,C,_.width,_.height,_.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,_.width,_.height,_.depth,S,E,_.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,C,_.width,_.height,_.depth,0,S,E,_.data);else if(s.isData3DTexture)A?(P&&n.texStorage3D(e.TEXTURE_3D,k,C,_.width,_.height,_.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,_.width,_.height,_.depth,S,E,_.data)):n.texImage3D(e.TEXTURE_3D,0,C,_.width,_.height,_.depth,0,S,E,_.data);else if(s.isFramebufferTexture){if(P)if(A)n.texStorage2D(e.TEXTURE_2D,k,C,_.width,_.height);else{let t=_.width,i=_.height;for(let r=0;r<k;r++)n.texImage2D(e.TEXTURE_2D,r,C,t,i,0,S,E,null),t>>=1,i>>=1}}else if(T.length>0&&w){A&&P&&n.texStorage2D(e.TEXTURE_2D,k,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)M=T[t],A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,S,E,M):n.texImage2D(e.TEXTURE_2D,t,C,S,E,M);s.generateMipmaps=!1}else A?(P&&n.texStorage2D(e.TEXTURE_2D,k,C,_.width,_.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,S,E,_)):n.texImage2D(e.TEXTURE_2D,0,C,S,E,_);v(s,w)&&y(c),h.__version=d.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function N(t,r,s,a,c,u){const d=o.convert(s.format,s.colorSpace),h=o.convert(s.type),p=b(s.internalFormat,d,h,s.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,i,r.depth,0,d,h,null):n.texImage2D(c,u,p,t,i,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),z(r)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,c,i.get(s).__webglTexture,0,O(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,a,c,i.get(s).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function I(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let r=!0===a?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(i||z(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===ki?r=e.DEPTH_COMPONENT32F:t.type===Di&&(r=e.DEPTH_COMPONENT24));const i=O(n);z(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=O(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):z(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const s=t[r],a=o.convert(s.format,s.colorSpace),c=o.convert(s.type),u=b(s.internalFormat,a,c,s.colorSpace),d=O(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,u,n.width,n.height):z(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function L(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),C(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture,s=O(r);if(r.depthTexture.format===ji)z(r)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==Bi)throw new Error("Unknown depthTexture format");z(r)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),I(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),I(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(e){return Math.min(r.maxSamples,e.samples)}function z(e){const n=i.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function U(e,n){const i=e.colorSpace,r=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Oo||i!==Yr&&i!==Wr&&(ps.getTransfer(i)===Kr?!1===a?!0===t.has("EXT_sRGB")&&r===zi?(e.format=Oo,e.minFilter=xi,e.generateMipmaps=!1):n=vs.sRGBToLinear(n):r===zi&&o===Ei||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const e=E;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=C,this.setTexture2DArray=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?R(o,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?R(o,t,r):n.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){const l=i.get(t);t.version>0&&l.__version!==t.version?function(t,s,l){if(6!==s.image.length)return;const c=k(t,s),u=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+l);const d=i.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+l);const t=ps.getPrimaries(ps.workingColorSpace),i=s.colorSpace===Wr?null:ps.getPrimaries(s.colorSpace),h=s.colorSpace===Wr||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const p=s.isCompressedTexture||s.image[0].isCompressedTexture,f=s.image[0]&&s.image[0].isDataTexture,_=[];for(let e=0;e<6;e++)_[e]=p||f?f?s.image[e].image:s.image[e]:m(s.image[e],!1,!0,r.maxCubemapSize),_[e]=U(s,_[e]);const w=_[0],S=g(w)||a,M=o.convert(s.format,s.colorSpace),E=o.convert(s.type),C=b(s.internalFormat,M,E,s.colorSpace),T=a&&!0!==s.isVideoTexture,A=void 0===d.__version||!0===c;let P,k=x(s,w,S);if(D(e.TEXTURE_CUBE_MAP,s,S),p){T&&A&&n.texStorage2D(e.TEXTURE_CUBE_MAP,k,C,w.width,w.height);for(let t=0;t<6;t++){P=_[t].mipmaps;for(let i=0;i<P.length;i++){const r=P[i];s.format!==zi?null!==M?T?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,M,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,C,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,M,E,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,C,r.width,r.height,0,M,E,r.data)}}}else{P=s.mipmaps,T&&A&&(P.length>0&&k++,n.texStorage2D(e.TEXTURE_CUBE_MAP,k,C,_[0].width,_[0].height));for(let t=0;t<6;t++)if(f){T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,_[t].width,_[t].height,M,E,_[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,_[t].width,_[t].height,0,M,E,_[t].data);for(let i=0;i<P.length;i++){const r=P[i].image[t].image;T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,M,E,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,C,r.width,r.height,0,M,E,r.data)}}else{T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,M,E,_[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,M,E,_[t]);for(let i=0;i<P.length;i++){const r=P[i];T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,M,E,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,C,M,E,r.image[t])}}}v(s,S)&&y(e.TEXTURE_CUBE_MAP),d.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(l,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,r){const o=i.get(t);void 0!==n&&N(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&L(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener("dispose",S),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,s.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,p=g(t)||a;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(h)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===z(t)){const i=h?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const s=o.convert(r.format,r.colorSpace),a=o.convert(r.type),l=b(r.internalFormat,s,a,r.colorSpace,!0===t.isXRRenderTarget),u=O(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),I(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),D(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(a&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)N(c.__webglFramebuffer[n][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else N(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);v(l,p)&&y(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){const r=t.texture;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i.get(s);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),D(e.TEXTURE_2D,s,p),N(c.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,0),v(s,p)&&y(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,u.__webglTexture),D(i,l,p),a&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)N(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,i,n);else N(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);v(l,p)&&y(i),n.unbindTexture()}t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(t){const r=g(t)||a,o=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=o.length;s<a;s++){const a=o[s];if(v(a,r)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(a).__webglTexture;n.bindTexture(r,o),y(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===z(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.width,s=t.height;let a=e.COLOR_BUFFER_BIT;const l=[],u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,d=i.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,d.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(u);const p=void 0!==d.__ignoreDepthValues&&d.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d.__webglColorRenderbuffer[n]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[u]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[u])),h){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,s,0,0,o,s,a,e.NEAREST),c&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,d.__webglColorRenderbuffer[t]);const o=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=L,this.setupFrameBufferTexture=N,this.useMultisampledRTT=z}function Fd(e,t,n){const i=n.isWebGL2;return{convert:function(n){let r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wr;const s=ps.getTransfer(o);if(n===Ei)return e.UNSIGNED_BYTE;if(n===Ni)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Ii)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Ci)return e.BYTE;if(n===Ti)return e.SHORT;if(n===Ai)return e.UNSIGNED_SHORT;if(n===Pi)return e.INT;if(n===Di)return e.UNSIGNED_INT;if(n===ki)return e.FLOAT;if(n===Ri)return i?e.HALF_FLOAT:(r=t.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(n===Oi)return e.ALPHA;if(n===zi)return e.RGBA;if(n===Ui)return e.LUMINANCE;if(n===Fi)return e.LUMINANCE_ALPHA;if(n===ji)return e.DEPTH_COMPONENT;if(n===Bi)return e.DEPTH_STENCIL;if(n===Oo)return r=t.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(n===Vi)return e.RED;if(n===Hi)return e.RED_INTEGER;if(n===Gi)return e.RG;if(n===Wi)return e.RG_INTEGER;if(n===Xi)return e.RGBA_INTEGER;if(n===Yi||n===$i||n===qi||n===Zi)if(s===Kr){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===Yi)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===$i)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===qi)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Zi)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===Yi)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===$i)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===qi)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Zi)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Ki||n===Ji||n===Qi||n===er){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===Ki)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ji)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Qi)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===er)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===tr)return r=t.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===nr||n===ir){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===nr)return s===Kr?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===ir)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===rr||n===or||n===sr||n===ar||n===lr||n===cr||n===ur||n===dr||n===hr||n===pr||n===fr||n===mr||n===gr||n===vr){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===rr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===or)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===sr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ar)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===lr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===cr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ur)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===dr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===hr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===pr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===fr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===mr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===gr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===vr)return s===Kr?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===yr||n===br||n===xr){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===yr)return s===Kr?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===br)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===xr)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===_r||n===wr||n===Sr||n===Mr){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===yr)return r.COMPRESSED_RED_RGTC1_EXT;if(n===wr)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Sr)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Mr)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Li?i?e.UNSIGNED_INT_24_8:(r=t.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class jd extends Ql{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}}class Bd extends Na{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Vd={type:"move"};class Hd{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Bd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Bd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Rs,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Rs),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Bd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Rs,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Rs),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const o of e.hand.values()){const e=t.getJointPose(o,n),i=this._getHandJoint(l,o);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Vd)))}return null!==s&&(s.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Bd;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Gd extends Fo{constructor(e,t){super();const n=this;let i=null,r=1,o=null,s="local-floor",a=1,l=null,c=null,u=null,d=null,h=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const v=[],y=[],b=new Qo;let x=null;const _=new Ql;_.layers.enable(1),_.viewport=new Ss;const w=new Ql;w.layers.enable(2),w.viewport=new Ss;const S=[_,w],M=new jd;M.layers.enable(1),M.layers.enable(2);let E=null,C=null;function T(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=v[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||o),n.dispatchEvent({type:e.type,data:e.inputSource}))}function A(){i.removeEventListener("select",T),i.removeEventListener("selectstart",T),i.removeEventListener("selectend",T),i.removeEventListener("squeeze",T),i.removeEventListener("squeezestart",T),i.removeEventListener("squeezeend",T),i.removeEventListener("end",A),i.removeEventListener("inputsourceschange",P);for(let e=0;e<v.length;e++){const t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}E=null,C=null,e.setRenderTarget(m),h=null,d=null,u=null,i=null,g=null,I.stop(),n.isPresenting=!1,e.setPixelRatio(x),e.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=y.indexOf(n);i>=0&&(y[i]=null,v[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=y.indexOf(n);if(-1===i){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(n),i=e;break}if(null===y[e]){y[e]=n,i=e;break}}if(-1===i)break}const r=v[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new Hd,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new Hd,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new Hd,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",T),i.addEventListener("selectstart",T),i.addEventListener("selectend",T),i.addEventListener("squeeze",T),i.addEventListener("squeezestart",T),i.addEventListener("squeezeend",T),i.addEventListener("end",A),i.addEventListener("inputsourceschange",P),!0!==f.xrCompatible&&await t.makeXRCompatible(),x=e.getPixelRatio(),e.getSize(b),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),g=new Es(h.framebufferWidth,h.framebufferHeight,{format:zi,type:Ei,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,o=null,s=null;f.depth&&(s=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?Bi:ji,o=f.stencil?Li:Di);const a={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:r};u=new XRWebGLBinding(i,t),d=u.createProjectionLayer(a),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),g=new Es(d.textureWidth,d.textureHeight,{format:zi,type:Ei,depthTexture:new Zc(d.textureWidth,d.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0});e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,o=await i.requestReferenceSpace(s),I.setContext(i),I.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const D=new Rs,k=new Rs;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;M.near=w.near=_.near=e.near,M.far=w.far=_.far=e.far,E===M.near&&C===M.far||(i.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,C=M.far);const t=e.parent,n=M.cameras;R(M,t);for(let i=0;i<n.length;i++)R(n[i],t);2===n.length?function(e,t,n){D.setFromMatrixPosition(t.matrixWorld),k.setFromMatrixPosition(n.matrixWorld);const i=D.distanceTo(k),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(o[8]+1)/o[0],h=s*u,p=s*d,f=i/(-u+d),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=a+f,y=h-m,b=p+(i-m),x=l*a/v*g,_=c*a/v*g;e.projectionMatrix.makePerspective(y,b,x,_,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(M,_,w):M.projectionMatrix.copy(_.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Ho*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,M,t)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==d||null!==h)return a},this.setFoveation=function(e){a=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let N=null;const I=new dc;I.setAnimationLoop(function(t,i){if(c=i.getViewerPose(l||o),p=i,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let o=null;if(null!==h)o=h.getViewport(r);else{const t=u.getViewSubImage(d,r);o=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=S[i];void 0===s&&(s=new Ql,s.layers.enable(i),s.viewport=new Ss,S[i]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(o.x,o.y,o.width,o.height),0===i&&(M.matrix.copy(s.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===n&&M.cameras.push(s)}}for(let e=0;e<v.length;e++){const t=y[e],n=v[e];null!==t&&void 0!==n&&n.update(t,i,l||o)}N&&N(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null}),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}function Wd(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===dn&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===dn&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const o=t.get(r).envMap;if(o&&(i.envMap.value=o,i.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,ql(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,o,s,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform));e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));const r=t.get(i).envMap;r&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===dn&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,o,s):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Xd(e,t,n,i){let r={},o={},s=[];const a=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n,i){const r=e.value,o=t+"_"+n;if(void 0===i[o])return i[o]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const e=i[o];if("number"===typeof r||"boolean"===typeof r){if(e!==r)return i[o]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=s.indexOf(n.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,d){let h=r[n.id];void 0===h&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let o=0,s=t.length;o<s;o++){const e=Array.isArray(t[o])?t[o]:[t[o]];for(let t=0,r=e.length;t<r;t++){const r=e[t],o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]),s=n%i;0!==s&&i-s<t.boundary&&(n+=i-s),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=h,n.addEventListener("dispose",u));const p=d.program;i.updateUBOMapping(n,p);const f=t.render.frame;o[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,s=i.length;r<s;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,o)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let o=0;o<n.length;o++){const s=n[o],a=c(s);"number"===typeof s||"boolean"===typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),o[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);s=[],r={},o={}}}}class Yd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=ss(),context:n=null,depth:i=!0,stencil:r=!0,alpha:o=!1,antialias:s=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:o;const h=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Xr,this._useLegacyLights=!1,this.toneMapping=Kn,this.toneMappingExposure=1;const y=this;let b=!1,x=0,_=0,w=null,S=-1,M=null;const E=new Ss,C=new Ss;let T=null;const A=new Za(0);let P=0,D=t.width,k=t.height,R=1,N=null,I=null;const L=new Ss(0,0,D,k),O=new Ss(0,0,D,k);let z=!1;const U=new uc;let F=!1,j=!1,B=null;const V=new la,H=new Qo,G=new Rs,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===w?R:1}let Y,$,q,Z,K,J,Q,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,de,he,pe,fe,me,ge,ve=n;function ye(e,n){for(let i=0;i<e.length;i++){const r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{const e={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Jt}`),t.addEventListener("webglcontextlost",_e,!1),t.addEventListener("webglcontextrestored",we,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ve){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!==typeof WebGLRenderingContext&&ve instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Pb){throw console.error("THREE.WebGLRenderer: "+Pb.message),Pb}function be(){Y=new Vc(ve),$=new _c(ve,Y,e),Y.init($),fe=new Fd(ve,Y,$),q=new zd(ve,Y,$),Z=new Wc(ve),K=new Sd,J=new Ud(ve,Y,q,K,$,fe,Z),Q=new Sc(y),ee=new Bc(y),te=new hc(ve,$),me=new bc(ve,Y,te,$),ne=new Hc(ve,te,Z,me),ie=new qc(ve,ne,te,Z),de=new $c(ve,$,J),le=new wc(K),re=new wd(y,Q,ee,Y,$,me,le),oe=new Wd(y,K),se=new Td,ae=new Nd(Y,$),ue=new yc(y,Q,ee,q,ie,d,a),ce=new Od(y,ie,$),ge=new Xd(ve,Z,$,q),he=new xc(ve,Y,Z,$),pe=new Gc(ve,Y,Z,$),Z.programs=re.programs,y.capabilities=$,y.extensions=Y,y.properties=K,y.renderLists=se,y.shadowMap=ce,y.state=q,y.info=Z}be();const xe=new Gd(y,ve);function _e(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=Z.autoReset,t=ce.enabled,n=ce.autoUpdate,i=ce.needsUpdate,r=ce.type;be(),Z.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=i,ce.type=r}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){const t=e.target;t.removeEventListener("dispose",Me),function(e){(function(e){const t=K.get(e).programs;void 0!==t&&(t.forEach(function(e){re.releaseProgram(e)}),e.isShaderMaterial&&re.releaseShaderCache(e))})(e),K.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&e.side===hn&&!1===e.forceSinglePass?(e.side=dn,e.needsUpdate=!0,Ie(e,t,n),e.side=un,e.needsUpdate=!0,Ie(e,t,n),e.side=hn):Ie(e,t,n)}this.xr=xe,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(D,k,!1))},this.getSize=function(e){return e.set(D,k)},this.setSize=function(e,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=e,k=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(D*R,k*R).floor()},this.setDrawingBufferSize=function(e,n,i){D=e,k=n,R=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),q.viewport(E.copy(L).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),q.scissor(C.copy(O).multiplyScalar(R).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(e){q.setScissorTest(z=e)},this.setOpaqueSort=function(e){N=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==w){const t=w.texture.format;e=t===Xi||t===Wi||t===Hi}if(e){const e=w.texture.type,t=e===Ei||e===Di||e===Ai||e===Li||e===Ni||e===Ii,n=ue.getClearColor(),i=ue.getClearAlpha(),r=n.r,o=n.g,s=n.b;t?(h[0]=r,h[1]=o,h[2]=s,h[3]=i,ve.clearBufferuiv(ve.COLOR,0,h)):(p[0]=r,p[1]=o,p[2]=s,p[3]=i,ve.clearBufferiv(ve.COLOR,0,p))}else n|=ve.COLOR_BUFFER_BIT}e&&(n|=ve.DEPTH_BUFFER_BIT),t&&(n|=ve.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ve.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",_e,!1),t.removeEventListener("webglcontextrestored",we,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),se.dispose(),ae.dispose(),K.dispose(),Q.dispose(),ee.dispose(),ie.dispose(),me.dispose(),ge.dispose(),re.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",Te),xe.removeEventListener("sessionend",Ae),B&&(B.dispose(),B=null),Pe.stop()},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=W);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=W);J.resetTextureUnits();const o=t.fog,s=i.isMeshStandardMaterial?t.environment:null,a=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Yr,l=(i.isMeshStandardMaterial?ee:Q).get(i.envMap||s),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=Kn;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,b=K.get(i),x=m.state.lights;if(!0===F&&(!0===j||e!==M)){const t=e===M&&i.id===S;le.setState(i,e,t)}let _=!1;i.version===b.__version?b.needsLights&&b.lightsStateVersion!==x.state.version||b.outputColorSpace!==a||r.isBatchedMesh&&!1===b.batching?_=!0:r.isBatchedMesh||!0!==b.batching?r.isInstancedMesh&&!1===b.instancing?_=!0:r.isInstancedMesh||!0!==b.instancing?r.isSkinnedMesh&&!1===b.skinning?_=!0:r.isSkinnedMesh||!0!==b.skinning?r.isInstancedMesh&&!0===b.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===b.instancingColor&&null!==r.instanceColor||b.envMap!==l||!0===i.fog&&b.fog!==o?_=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===le.numPlanes&&b.numIntersection===le.numIntersection?(b.vertexAlphas!==c||b.vertexTangents!==u||b.morphTargets!==d||b.morphNormals!==h||b.morphColors!==p||b.toneMapping!==f||!0===$.isWebGL2&&b.morphTargetsCount!==v)&&(_=!0):_=!0:_=!0:_=!0:_=!0:(_=!0,b.__version=i.version);let E=b.currentProgram;!0===_&&(E=Ie(i,t,r));let C=!1,T=!1,A=!1;const P=E.getUniforms(),D=b.uniforms;q.useProgram(E.program)&&(C=!0,T=!0,A=!0);i.id!==S&&(S=i.id,T=!0);if(C||M!==e){P.setValue(ve,"projectionMatrix",e.projectionMatrix),P.setValue(ve,"viewMatrix",e.matrixWorldInverse);const t=P.map.cameraPosition;void 0!==t&&t.setValue(ve,G.setFromMatrixPosition(e.matrixWorld)),$.logarithmicDepthBuffer&&P.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,T=!0,A=!0)}if(r.isSkinnedMesh){P.setOptional(ve,r,"bindMatrix"),P.setOptional(ve,r,"bindMatrixInverse");const e=r.skeleton;e&&($.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),P.setValue(ve,"boneTexture",e.boneTexture,J)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}r.isBatchedMesh&&(P.setOptional(ve,r,"batchingTexture"),P.setValue(ve,"batchingTexture",r._matricesTexture,J));const N=n.morphAttributes;(void 0!==N.position||void 0!==N.normal||void 0!==N.color&&!0===$.isWebGL2)&&de.update(r,n,E);(T||b.receiveShadow!==r.receiveShadow)&&(b.receiveShadow=r.receiveShadow,P.setValue(ve,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(D.envMap.value=l,D.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);T&&(P.setValue(ve,"toneMappingExposure",y.toneMappingExposure),b.needsLights&&(L=A,(I=D).ambientLightColor.needsUpdate=L,I.lightProbe.needsUpdate=L,I.directionalLights.needsUpdate=L,I.directionalLightShadows.needsUpdate=L,I.pointLights.needsUpdate=L,I.pointLightShadows.needsUpdate=L,I.spotLights.needsUpdate=L,I.spotLightShadows.needsUpdate=L,I.rectAreaLights.needsUpdate=L,I.hemisphereLights.needsUpdate=L),o&&!0===i.fog&&oe.refreshFogUniforms(D,o),oe.refreshMaterialUniforms(D,i,R,k,B),td.upload(ve,Le(b),D,J));var I,L;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(td.upload(ve,Le(b),D,J),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&P.setValue(ve,"center",r.center);if(P.setValue(ve,"modelViewMatrix",r.modelViewMatrix),P.setValue(ve,"normalMatrix",r.normalMatrix),P.setValue(ve,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if($.isWebGL2){const n=e[t];ge.update(n,E),ge.bind(n,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,n,i,r);q.setMaterial(i,s);let l=n.index,c=1;if(!0===i.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,p=(u.start+u.count)*c;null!==o&&(h=Math.max(h,o.start*c),p=Math.min(p,(o.start+o.count)*c)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):void 0!==d&&null!==d&&(h=Math.max(h,0),p=Math.min(p,d.count));const f=p-h;if(f<0||f===1/0)return;let g;me.setup(r,i,a,n,l);let v=he;if(null!==l&&(g=te.get(l),v=pe,v.setIndex(g)),r.isMesh)!0===i.wireframe?(q.setLineWidth(i.wireframeLinewidth*X()),v.setMode(ve.LINES)):v.setMode(ve.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),q.setLineWidth(e*X()),r.isLineSegments?v.setMode(ve.LINES):r.isLineLoop?v.setMode(ve.LINE_LOOP):v.setMode(ve.LINE_STRIP)}else r.isPoints?v.setMode(ve.POINTS):r.isSprite&&v.setMode(ve.TRIANGLES);if(r.isBatchedMesh)v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else if(r.isInstancedMesh)v.renderInstances(h,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(h,f,t)}else v.render(h,f)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),m=ae.get(n),m.init(),v.push(m),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),m.setupLights(y._useLegacyLights);const i=new Set;return e.traverse(function(e){const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const o=t[r];Ee(o,n,e),i.add(o)}else Ee(t,n,e),i.add(t)}),v.pop(),m=null,i},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.compile(e,t,n);return new Promise(t=>{function n(){i.forEach(function(e){K.get(e).currentProgram.isReady()&&i.delete(e)}),0!==i.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ce=null;function Te(){Pe.stop()}function Ae(){Pe.start()}const Pe=new dc;function De(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(V);const t=ie.update(e),r=e.material;r.visible&&f.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=ie.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(V)),Array.isArray(r)){const i=t.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r[s.materialIndex];a&&a.visible&&f.push(e,t,a,n,G.z,s)}}else r.visible&&f.push(e,t,r,n,G.z,null)}const r=e.children;for(let o=0,s=r.length;o<s;o++)De(r[o],t,n,i)}function ke(e,t,n,i){const r=e.opaque,o=e.transmissive,s=e.transparent;m.setupLightsView(n),!0===F&&le.setGlobalState(y.clippingPlanes,n),o.length>0&&function(e,t,n,i){const r=!0===n.isScene?n.overrideMaterial:null;if(null!==r)return;const o=$.isWebGL2;null===B&&(B=new Es(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")?Ri:Ei,minFilter:Si,samples:o?4:0}));y.getDrawingBufferSize(H),o?B.setSize(H.x,H.y):B.setSize(qo(H.x),qo(H.y));const s=y.getRenderTarget();y.setRenderTarget(B),y.getClearColor(A),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5);y.clear();const a=y.toneMapping;y.toneMapping=Kn,Re(e,n,i),J.updateMultisampleRenderTarget(B),J.updateRenderTargetMipmap(B);let l=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c],r=e.object,o=e.geometry,s=e.material,a=e.group;if(s.side===hn&&r.layers.test(i.layers)){const e=s.side;s.side=dn,s.needsUpdate=!0,Ne(r,n,i,o,s,a),s.side=e,s.needsUpdate=!0,l=!0}}!0===l&&(J.updateMultisampleRenderTarget(B),J.updateRenderTargetMipmap(B));y.setRenderTarget(s),y.setClearColor(A,P),y.toneMapping=a}(r,o,t,n),i&&q.viewport(E.copy(i)),r.length>0&&Re(r,t,n),o.length>0&&Re(o,t,n),s.length>0&&Re(s,t,n),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1)}function Re(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,l=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&Ne(s,t,n,a,l,c)}}function Ne(e,t,n,i,r,o){e.onBeforeRender(y,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,o),!0===r.transparent&&r.side===hn&&!1===r.forceSinglePass?(r.side=dn,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,o),r.side=un,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,o),r.side=hn):y.renderBufferDirect(n,t,i,r,e,o),e.onAfterRender(y,t,n,i,r,o)}function Ie(e,t,n){!0!==t.isScene&&(t=W);const i=K.get(e),r=m.state.lights,o=m.state.shadowsArray,s=r.state.version,a=re.getParameters(e,r.state,o,t,n),l=re.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ee:Q).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Me),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===s)return Oe(e,a),u}else a.uniforms=re.getUniforms(e),e.onBuild(n,a,y),e.onBeforeCompile(a,y),u=re.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const d=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),Oe(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Le(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=td.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Oe(e,t){const n=K.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Pe.setAnimationLoop(function(e){Ce&&Ce(e)}),"undefined"!==typeof self&&Pe.setContext(self),this.setAnimationLoop=function(e){Ce=e,xe.setAnimationLoop(e),null===e?Pe.stop():Pe.start()},xe.addEventListener("sessionstart",Te),xe.addEventListener("sessionend",Ae),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),m=ae.get(e,v.length),m.init(),v.push(m),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(V),j=this.localClippingEnabled,F=le.init(this.clippingPlanes,j),f=se.get(e,g.length),f.init(),g.push(f),De(e,t,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(N,I),this.info.render.frame++,!0===F&&le.beginShadows();const n=m.state.shadowsArray;if(ce.render(n,e,t),!0===F&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(f,e),m.setupLights(y._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];ke(f,e,i,i.viewport)}}else ke(f,e,t);null!==w&&(J.updateMultisampleRenderTarget(w),J.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),me.resetDefaultState(),S=-1,M=null,v.pop(),m=v.length>0?v[v.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=n;const i=K.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=K.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;w=e,x=t,_=n;let i=!0,r=null,o=!1,s=!1;if(e){const a=K.get(e);void 0!==a.__useDefaultFramebuffer?(q.bindFramebuffer(ve.FRAMEBUFFER,null),i=!1):void 0===a.__webglFramebuffer?J.setupRenderTarget(e):a.__hasExternalTextures&&J.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],o=!0):r=$.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),C.copy(e.scissor),T=e.scissorTest}else E.copy(L).multiplyScalar(R).floor(),C.copy(O).multiplyScalar(R).floor(),T=z;if(q.bindFramebuffer(ve.FRAMEBUFFER,r)&&$.drawBuffers&&i&&q.drawBuffers(e,r),q.viewport(E),q.scissor(C),q.setScissorTest(T),o){const i=K.get(e.texture);ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(s){const i=K.get(e.texture),r=t||0;ve.framebufferTextureLayer(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}S=-1},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){q.bindFramebuffer(ve.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,l=s.type;if(a!==zi&&fe.convert(a)!==ve.getParameter(ve.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Ri&&(Y.has("EXT_color_buffer_half_float")||$.isWebGL2&&Y.has("EXT_color_buffer_float"));if(l!==Ei&&fe.convert(l)!==ve.getParameter(ve.IMPLEMENTATION_COLOR_READ_TYPE)&&(l!==ki||!($.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ve.readPixels(t,n,i,r,fe.convert(a),fe.convert(l),o)}finally{const e=null!==w?K.get(w).__webglFramebuffer:null;q.bindFramebuffer(ve.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i);J.setTexture2D(t,0),ve.copyTexSubImage2D(ve.TEXTURE_2D,n,0,0,e.x,e.y,r,o),q.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=t.image.width,o=t.image.height,s=fe.convert(n.format),a=fe.convert(n.type);J.setTexture2D(n,0),ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,n.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ve.texSubImage2D(ve.TEXTURE_2D,i,e.x,e.y,r,o,s,a,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(ve.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ve.texSubImage2D(ve.TEXTURE_2D,i,e.x,e.y,s,a,t.image),0===i&&n.generateMipmaps&&ve.generateMipmap(ve.TEXTURE_2D),q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=fe.convert(i.format),c=fe.convert(i.type);let u;if(i.isData3DTexture)J.setTexture3D(i,0),u=ve.TEXTURE_3D;else{if(!i.isDataArrayTexture&&!i.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(i,0),u=ve.TEXTURE_2D_ARRAY}ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,i.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,i.unpackAlignment);const d=ve.getParameter(ve.UNPACK_ROW_LENGTH),h=ve.getParameter(ve.UNPACK_IMAGE_HEIGHT),p=ve.getParameter(ve.UNPACK_SKIP_PIXELS),f=ve.getParameter(ve.UNPACK_SKIP_ROWS),m=ve.getParameter(ve.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[r]:n.image;ve.pixelStorei(ve.UNPACK_ROW_LENGTH,g.width),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,g.height),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,e.min.x),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,e.min.y),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?ve.texSubImage3D(u,r,t.x,t.y,t.z,o,s,a,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ve.compressedTexSubImage3D(u,r,t.x,t.y,t.z,o,s,a,l,g.data)):ve.texSubImage3D(u,r,t.x,t.y,t.z,o,s,a,l,c,g),ve.pixelStorei(ve.UNPACK_ROW_LENGTH,d),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,h),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,p),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,f),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&ve.generateMipmap(u),q.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),q.unbindTexture()},this.resetState=function(){x=0,_=0,w=null,q.reset(),me.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return zo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===$r?"display-p3":"srgb",t.unpackColorSpace=ps.workingColorSpace===qr?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Xr?jr:Fr}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===jr?Xr:Yr}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class $d extends Yd{}$d.prototype.isWebGL1Renderer=!0;class qd{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new Za(e),this.density=t}clone(){return new qd(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Zd{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Za(e),this.near=t,this.far=n}clone(){return new Zd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Kd extends Na{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class Jd{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Eo,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Go()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Go()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Go()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Qd=new Rs;class eh{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Qd.fromBufferAttribute(this,t),Qd.applyMatrix4(e),this.setXYZ(t,Qd.x,Qd.y,Qd.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Qd.fromBufferAttribute(this,t),Qd.applyNormalMatrix(e),this.setXYZ(t,Qd.x,Qd.y,Qd.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Qd.fromBufferAttribute(this,t),Qd.transformDirection(e),this.setXYZ(t,Qd.x,Qd.y,Qd.z);return this}setX(e,t){return this.normalized&&(t=Ko(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ko(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ko(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ko(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zo(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Zo(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zo(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Zo(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array),i=Ko(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ko(t,this.array),n=Ko(n,this.array),i=Ko(i,this.array),r=Ko(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new ll(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new eh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class th extends Qa{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Za(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let nh;const ih=new Rs,rh=new Rs,oh=new Rs,sh=new Qo,ah=new Qo,lh=new la,ch=new Rs,uh=new Rs,dh=new Rs,hh=new Qo,ph=new Qo,fh=new Qo;class mh extends Na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new th;if(super(),this.isSprite=!0,this.type="Sprite",void 0===nh){nh=new Cl;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Jd(e,5);nh.setIndex([0,1,2,0,2,3]),nh.setAttribute("position",new eh(t,3,0,!1)),nh.setAttribute("uv",new eh(t,2,3,!1))}this.geometry=nh,this.material=e,this.center=new Qo(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),rh.setFromMatrixScale(this.matrixWorld),lh.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),oh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&rh.multiplyScalar(-oh.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;gh(ch.set(-.5,-.5,0),oh,o,rh,i,r),gh(uh.set(.5,-.5,0),oh,o,rh,i,r),gh(dh.set(.5,.5,0),oh,o,rh,i,r),hh.set(0,0),ph.set(1,0),fh.set(1,1);let s=e.ray.intersectTriangle(ch,uh,dh,!1,ih);if(null===s&&(gh(uh.set(-.5,.5,0),oh,o,rh,i,r),ph.set(0,1),s=e.ray.intersectTriangle(ch,dh,uh,!1,ih),null===s))return;const a=e.ray.origin.distanceTo(ih);a<e.near||a>e.far||t.push({distance:a,point:ih.clone(),uv:Wa.getInterpolation(ih,ch,uh,dh,hh,ph,fh,new Qo),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function gh(e,t,n,i,r,o){sh.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(ah.x=o*sh.x-r*sh.y,ah.y=r*sh.x+o*sh.y):ah.copy(sh),e.copy(t),e.x+=ah.x,e.y+=ah.y,e.applyMatrix4(lh)}const vh=new Rs,yh=new Rs;class bh extends Na{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){vh.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(vh);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){vh.setFromMatrixPosition(e.matrixWorld),yh.setFromMatrixPosition(this.matrixWorld);const n=vh.distanceTo(yh)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const xh=new Rs,_h=new Ss,wh=new Ss,Sh=new Rs,Mh=new la,Eh=new Rs,Ch=new Qs,Th=new la,Ah=new aa;class Ph extends Gl{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ri,this.bindMatrix=new la,this.bindMatrixInverse=new la,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Ls),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Eh),this.boundingBox.expandByPoint(Eh)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Qs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Eh),this.boundingSphere.expandByPoint(Eh)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ch.copy(this.boundingSphere),Ch.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ch)&&(Th.copy(i).invert(),Ah.copy(e.ray).applyMatrix4(Th),null!==this.boundingBox&&!1===Ah.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Ah)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ss,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===ri?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===oi?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;_h.fromBufferAttribute(i.attributes.skinIndex,e),wh.fromBufferAttribute(i.attributes.skinWeight,e),xh.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=wh.getComponent(r);if(0!==e){const i=_h.getComponent(r);Mh.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Sh.copy(xh).applyMatrix4(Mh),e)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Dh extends Na{constructor(){super(),this.isBone=!0,this.type="Bone"}}class kh extends ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:mi,arguments.length>9&&void 0!==arguments[9]?arguments[9]:mi,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Rh=new la,Nh=new la;class Ih{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Go(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new la)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new la;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:Nh;Rh.multiplyMatrices(i,t[r]),Rh.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ih(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new kh(t,e,e,zi,ki);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Dh),this.bones.push(r),this.boneInverses.push((new la).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class Lh extends ll{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Oh=new la,zh=new la,Uh=[],Fh=new Ls,jh=new la,Bh=new Gl,Vh=new Qs;class Hh extends Gl{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Lh(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,jh)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Ls),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Oh),Fh.copy(e.boundingBox).applyMatrix4(Oh),this.boundingBox.union(Fh)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Qs),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Oh),Vh.copy(e.boundingSphere).applyMatrix4(Oh),this.boundingSphere.union(Vh)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Bh.geometry=this.geometry,Bh.material=this.material,void 0!==Bh.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Vh.copy(this.boundingSphere),Vh.applyMatrix4(n),!1!==e.ray.intersectsSphere(Vh)))for(let r=0;r<i;r++){this.getMatrixAt(r,Oh),zh.multiplyMatrices(n,Oh),Bh.matrixWorld=zh,Bh.raycast(e,Uh);for(let e=0,n=Uh.length;e<n;e++){const n=Uh[e];n.instanceId=r,n.object=this,t.push(n)}Uh.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Lh(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function Gh(e,t){return e.z-t.z}function Wh(e,t){return t.z-e.z}class Xh{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,i=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const r=n[this.index];i.push(r),this.index++,r.start=e.start,r.count=e.count,r.z=t}reset(){this.list.length=0,this.index=0}}const Yh="batchId",$h=new la,qh=new la,Zh=new la,Kh=new la,Jh=new uc,Qh=new Ls,ep=new Qs,tp=new Rs,np=new Xh,ip=new Gl,rp=[];function op(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const r=e.count;for(let o=0;o<r;o++)for(let r=0;r<i;r++)t.setComponent(o+n,r,e.getComponent(o,r))}else t.array.set(e.array,n*i);t.needsUpdate=!0}class sp extends Gl{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t,i=arguments.length>3?arguments[3]:void 0;super(new Cl,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new kh(t,e,e,zi,ki);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxGeometryCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in e.attributes){const r=e.getAttribute(i),{array:o,itemSize:s,normalized:a}=r,l=new o.constructor(n*s),c=new r.constructor(l,s,a);c.setUsage(r.usage),t.setAttribute(i,c)}if(null!==e.getIndex()){const e=n>65536?new Uint32Array(r):new Uint16Array(r);t.setIndex(new ll(e,1))}const o=i>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(Yh,new ll(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Yh))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Yh}"`);const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(n===Yh)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),r=t.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ls);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let i=0;i<e;i++)!1!==n[i]&&(this.getMatrixAt(i,$h),this.getBoundingBoxAt(i,Qh).applyMatrix4($h),t.union(Qh))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Qs);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let i=0;i<e;i++)!1!==n[i]&&(this.getMatrixAt(i,$h),this.getBoundingSphereAt(i,ep).applyMatrix4($h),t.union(ep))}addGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const o=this._reservedRanges,s=this._drawRanges,a=this._bounds;0!==this._geometryCount&&(r=o[o.length-1]),i.vertexCount=-1===t?e.getAttribute("position").count:t,i.vertexStart=null===r?0:r.vertexStart+r.vertexCount;const l=e.getIndex(),c=null!==l;if(c&&(i.indexCount=-1===n?l.count:n,i.indexStart=null===r?0:r.indexStart+r.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,d=this._active,h=this._matricesTexture,p=this._matricesTexture.image.data;u.push(!0),d.push(!0);const f=this._geometryCount;this._geometryCount++,Zh.toArray(p,16*f),h.needsUpdate=!0,o.push(i),s.push({start:c?i.indexStart:i.vertexStart,count:-1}),a.push({boxInitialized:!1,box:new Ls,sphereInitialized:!1,sphere:new Qs});const m=this.geometry.getAttribute(Yh);for(let g=0;g<i.vertexCount;g++)m.setX(i.vertexStart+g,f);return m.needsUpdate=!0,this.setGeometryAt(f,e),f}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),o=t.getIndex(),s=this._reservedRanges[e];if(i&&o.count>s.indexCount||t.attributes.position.count>s.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const a=s.vertexStart,l=s.vertexCount;for(const h in n.attributes){if(h===Yh)continue;const e=t.getAttribute(h),i=n.getAttribute(h);op(e,i,a);const r=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=a+t;for(let t=0;t<r;t++)i.setComponent(e,t,0)}i.needsUpdate=!0}if(i){const e=s.indexStart;for(let t=0;t<o.count;t++)r.setX(e+t,a+o.getX(t));for(let t=o.count,n=s.indexCount;t<n;t++)r.setX(e+t,a);r.needsUpdate=!0}const c=this._bounds[e];null!==t.boundingBox?(c.box.copy(t.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,null!==t.boundingSphere?(c.sphere.copy(t.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const u=this._drawRanges[e],d=t.getAttribute("position");return u.count=i?o.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||!1===t[e]||(t[e]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(e,t){if(!1===this._active[e])return this;const n=this._bounds[e],i=n.box,r=this.geometry;if(!1===n.boxInitialized){i.makeEmpty();const t=r.index,o=r.attributes.position,s=this._drawRanges[e];for(let e=s.start,n=s.start+s.count;e<n;e++){let n=e;t&&(n=t.getX(n)),i.expandByPoint(tp.fromBufferAttribute(o,n))}n.boxInitialized=!0}return t.copy(i),t}getBoundingSphereAt(e,t){if(!1===this._active[e])return this;const n=this._bounds[e],i=n.sphere,r=this.geometry;if(!1===n.sphereInitialized){i.makeEmpty(),this.getBoundingBoxAt(e,Qh),Qh.getCenter(i.center);const t=r.index,o=r.attributes.position,s=this._drawRanges[e];let a=0;for(let e=s.start,n=s.start+s.count;e<n;e++){let n=e;t&&(n=t.getX(n)),tp.fromBufferAttribute(o,n),a=Math.max(a,i.center.distanceToSquared(tp))}i.radius=Math.sqrt(a),n.sphereInitialized=!0}return t.copy(i),t}setMatrixAt(e,t){const n=this._active,i=this._matricesTexture,r=this._matricesTexture.image.data;return e>=this._geometryCount||!1===n[e]||(t.toArray(r,16*e),i.needsUpdate=!0),this}getMatrixAt(e,t){const n=this._active,i=this._matricesTexture.image.data;return e>=this._geometryCount||!1===n[e]?null:t.fromArray(i,16*e)}setVisibleAt(e,t){const n=this._visibility,i=this._active;return e>=this._geometryCount||!1===i[e]||n[e]===t||(n[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){const t=this._visibility,n=this._active;return!(e>=this._geometryCount||!1===n[e])&&t[e]}raycast(e,t){const n=this._visibility,i=this._active,r=this._drawRanges,o=this._geometryCount,s=this.matrixWorld,a=this.geometry;ip.material=this.material,ip.geometry.index=a.index,ip.geometry.attributes=a.attributes,null===ip.geometry.boundingBox&&(ip.geometry.boundingBox=new Ls),null===ip.geometry.boundingSphere&&(ip.geometry.boundingSphere=new Qs);for(let l=0;l<o;l++){if(!n[l]||!i[l])continue;const o=r[l];ip.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(l,ip.matrixWorld).premultiply(s),this.getBoundingBoxAt(l,ip.geometry.boundingBox),this.getBoundingSphereAt(l,ip.geometry.boundingSphere),ip.raycast(e,rp);for(let e=0,n=rp.length;e<n;e++){const n=rp[e];n.object=this,n.batchId=l,t.push(n)}rp.length=0}ip.material=null,ip.geometry.index=null,ip.geometry.attributes={},ip.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(e=>({...e})),this._reservedRanges=e._reservedRanges.map(e=>({...e})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=i.getIndex(),s=null===o?1:o.array.BYTES_PER_ELEMENT,a=this._visibility,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._drawRanges,d=this.perObjectFrustumCulled;d&&(Kh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Jh.setFromProjectionMatrix(Kh,e.isWebGPURenderer?Uo:zo));let h=0;if(this.sortObjects){qh.copy(this.matrixWorld).invert(),tp.setFromMatrixPosition(n.matrixWorld).applyMatrix4(qh);for(let n=0,i=a.length;n<i;n++)if(a[n]){this.getMatrixAt(n,$h),this.getBoundingSphereAt(n,ep).applyMatrix4($h);let e=!1;if(d&&(e=!Jh.intersectsSphere(ep)),!e){const e=tp.distanceTo(ep.center);np.push(u[n],e)}}const e=np.list,t=this.customSort;null===t?e.sort(r.transparent?Wh:Gh):t.call(this,e,n);for(let n=0,i=e.length;n<i;n++){const t=e[n];l[h]=t.start*s,c[h]=t.count,h++}np.reset()}else for(let p=0,f=a.length;p<f;p++)if(a[p]){let e=!1;if(d&&(this.getMatrixAt(p,$h),this.getBoundingSphereAt(p,ep).applyMatrix4($h),e=!Jh.intersectsSphere(ep)),!e){const e=u[p];l[h]=e.start*s,c[h]=e.count,h++}}this._multiDrawCount=h,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,r,o){this.onBeforeRender(e,null,i,r,o)}}class ap extends Qa{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Za(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const lp=new Rs,cp=new Rs,up=new la,dp=new aa,hp=new Qs;class pp extends Na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ap;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)lp.fromBufferAttribute(t,e-1),cp.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=lp.distanceTo(cp);e.setAttribute("lineDistance",new vl(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),hp.copy(n.boundingSphere),hp.applyMatrix4(i),hp.radius+=r,!1===e.ray.intersectsSphere(hp))return;up.copy(i).invert(),dp.copy(e.ray).applyMatrix4(up);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new Rs,c=new Rs,u=new Rs,d=new Rs,h=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p){for(let n=Math.max(0,o.start),i=Math.min(p.count,o.start+o.count)-1;n<i;n+=h){const i=p.getX(n),r=p.getX(n+1);l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,r);if(dp.distanceSqToSegment(l,c,d,u)>a)continue;d.applyMatrix4(this.matrixWorld);const o=e.ray.origin.distanceTo(d);o<e.near||o>e.far||t.push({distance:o,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,o.start),i=Math.min(f.count,o.start+o.count)-1;n<i;n+=h){l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1);if(dp.distanceSqToSegment(l,c,d,u)>a)continue;d.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(d);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const fp=new Rs,mp=new Rs;class gp extends pp{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)fp.fromBufferAttribute(t,e),mp.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+fp.distanceTo(mp);e.setAttribute("lineDistance",new vl(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class vp extends pp{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class yp extends Qa{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Za(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const bp=new la,xp=new aa,_p=new Qs,wp=new Rs;class Sp extends Na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yp;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),_p.copy(n.boundingSphere),_p.applyMatrix4(i),_p.radius+=r,!1===e.ray.intersectsSphere(_p))return;bp.copy(i).invert(),xp.copy(e.ray).applyMatrix4(bp);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,o.start),r=Math.min(l.count,o.start+o.count);n<r;n++){const r=l.getX(n);wp.fromBufferAttribute(c,r),Mp(wp,r,a,i,e,t,this)}}else{for(let n=Math.max(0,o.start),r=Math.min(c.count,o.start+o.count);n<r;n++)wp.fromBufferAttribute(c,n),Mp(wp,n,a,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Mp(e,t,n,i,r,o,s){const a=xp.distanceSqToPoint(e);if(a<n){const n=new Rs;xp.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}class Ep extends ws{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:xi,this.magFilter=void 0!==r?r:xi,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Cp extends ws{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=mi,this.minFilter=mi,this.generateMipmaps=!1,this.needsUpdate=!0}}class Tp extends ws{constructor(e,t,n,i,r,o,s,a,l,c,u,d){super(null,o,s,a,l,c,i,r,u,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Ap extends Tp{constructor(e,t,n,i,r,o){super(e,t,n,r,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=pi}}class Pp extends Tp{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,ai),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Dp extends ws{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class kp{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let s,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),s=n[i]-o,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const c=n[i];return(i+(o-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new Qo:new Rs);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Rs,i=[],r=[],o=[],s=new Rs,a=new la;for(let h=0;h<=e;h++){const t=h/e;i[h]=this.getTangentAt(t,new Rs)}r[0]=new Rs,o[0]=new Rs;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),d<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let h=1;h<=e;h++){if(r[h]=r[h-1].clone(),o[h]=o[h-1].clone(),s.crossVectors(i[h-1],i[h]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Wo(i[h-1].dot(i[h]),-1,1));r[h].applyMatrix4(a.makeRotationAxis(s,e))}o[h].crossVectors(i[h],r[h])}if(!0===t){let t=Math.acos(Wo(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Rp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){const n=t||new Qo,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const s=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Np extends Rp{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Ip(){let e=0,t=0,n=0,i=0;function r(r,o,s,a){e=r,t=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(i-t)/(s+a)+(i-n)/a;l*=s,c*=s,r(t,n,l,c)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}const Lp=new Rs,Op=new Ip,zp=new Ip,Up=new Ip;class Fp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs,n=this.points,i=n.length,r=(i-(this.closed?0:1))*e;let o,s,a=Math.floor(r),l=r-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/i)+1)*i:0===l&&a===i-1&&(a=i-2,l=1),this.closed||a>0?o=n[(a-1)%i]:(Lp.subVectors(n[0],n[1]).add(n[0]),o=Lp);const c=n[a%i],u=n[(a+1)%i];if(this.closed||a+2<i?s=n[(a+2)%i]:(Lp.subVectors(n[i-1],n[i-2]).add(n[i-1]),s=Lp),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Op.initNonuniformCatmullRom(o.x,c.x,u.x,s.x,t,n,i),zp.initNonuniformCatmullRom(o.y,c.y,u.y,s.y,t,n,i),Up.initNonuniformCatmullRom(o.z,c.z,u.z,s.z,t,n,i)}else"catmullrom"===this.curveType&&(Op.initCatmullRom(o.x,c.x,u.x,s.x,this.tension),zp.initCatmullRom(o.y,c.y,u.y,s.y,this.tension),Up.initCatmullRom(o.z,c.z,u.z,s.z,this.tension));return t.set(Op.calc(l),zp.calc(l),Up.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Rs).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function jp(e,t,n,i,r){const o=.5*(i-t),s=.5*(r-n),a=e*e;return(2*n-2*i+o+s)*(e*a)+(-3*n+3*i-2*o-s)*a+o*e+n}function Bp(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Vp(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class Hp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Qo,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Qo;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo,n=this.v0,i=this.v1,r=this.v2,o=this.v3;return t.set(Vp(e,n.x,i.x,r.x,o.x),Vp(e,n.y,i.y,r.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Gp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rs,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Rs;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs,n=this.v0,i=this.v1,r=this.v2,o=this.v3;return t.set(Vp(e,n.x,i.x,r.x,o.x),Vp(e,n.y,i.y,r.y,o.y),Vp(e,n.z,i.z,r.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Wp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Xp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Yp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Qo;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo,n=this.v0,i=this.v1,r=this.v2;return t.set(Bp(e,n.x,i.x,r.x),Bp(e,n.y,i.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class $p extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rs;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs,n=this.v0,i=this.v1,r=this.v2;return t.set(Bp(e,n.x,i.x,r.x),Bp(e,n.y,i.y,r.y),Bp(e,n.z,i.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class qp extends kp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo,n=this.points,i=(n.length-1)*e,r=Math.floor(i),o=i-r,s=n[0===r?r:r-1],a=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return t.set(jp(o,s.x,a.x,l.x,c.x),jp(o,s.y,a.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Qo).fromArray(n))}return this}}var Zp=Object.freeze({__proto__:null,ArcCurve:Np,CatmullRomCurve3:Fp,CubicBezierCurve:Hp,CubicBezierCurve3:Gp,EllipseCurve:Rp,LineCurve:Wp,LineCurve3:Xp,QuadraticBezierCurve:Yp,QuadraticBezierCurve3:$p,SplineCurve:qp});class Kp extends kp{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Zp[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,o=this.curves[r],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Zp[n.type]).fromJSON(n))}return this}}class Jp extends Kp{constructor(e){super(),this.type="Path",this.currentPoint=new Qo,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Wp(this.currentPoint.clone(),new Qo(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Yp(this.currentPoint.clone(),new Qo(e,t),new Qo(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const s=new Hp(this.currentPoint.clone(),new Qo(e,t),new Qo(n,i),new Qo(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new qp(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,o,s,a),this}absellipse(e,t,n,i,r,o,s,a){const l=new Rp(e,t,n,i,r,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Qp extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Qo(0,-.5),new Qo(.5,0),new Qo(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Wo(i,0,2*Math.PI);const r=[],o=[],s=[],a=[],l=[],c=1/t,u=new Rs,d=new Qo,h=new Rs,p=new Rs,f=new Rs;let m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,h.x=1*g,h.y=-m,h.z=0*g,f.copy(h),h.normalize(),a.push(h.x,h.y,h.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,h.x=1*g,h.y=-m,h.z=0*g,p.copy(h),h.x+=f.x,h.y+=f.y,h.z+=f.z,h.normalize(),a.push(h.x,h.y,h.z),f.copy(p)}for(let v=0;v<=t;v++){const r=n+v*c*i,h=Math.sin(r),p=Math.cos(r);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*h,u.y=e[n].y,u.z=e[n].x*p,o.push(u.x,u.y,u.z),d.x=v/t,d.y=n/(e.length-1),s.push(d.x,d.y);const i=a[3*n+0]*h,r=a[3*n+1],c=a[3*n+0]*p;l.push(i,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){const n=t+v*e.length,i=n,o=n+e.length,s=n+e.length+1,a=n+1;r.push(i,o,a),r.push(s,a,o)}this.setIndex(r),this.setAttribute("position",new vl(o,3)),this.setAttribute("uv",new vl(s,2)),this.setAttribute("normal",new vl(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qp(e.points,e.segments,e.phiStart,e.phiLength)}}class ef extends Qp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;const r=new Jp;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new ef(e.radius,e.length,e.capSegments,e.radialSegments)}}class tf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],s=[],a=[],l=new Rs,c=new Qo;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const r=n+u/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[d]/e+1)/2,c.y=(o[d+1]/e+1)/2,a.push(c.x,c.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new vl(o,3)),this.setAttribute("normal",new vl(s,3)),this.setAttribute("uv",new vl(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tf(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class nf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],d=[],h=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,o=new Qo,f=new Rs;let v=0;const y=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*b,0),d.push(0,b,0),h.push(.5,.5),p++;const x=p;for(let e=0;e<=i;e++){const t=e/i*a+s,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*b,f.z=y*n,u.push(f.x,f.y,f.z),d.push(0,b,0),o.x=.5*n+.5,o.y=.5*r*b+.5,h.push(o.x,o.y),p++}for(let e=0;e<i;e++){const t=r+e,i=x+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new Rs,v=new Rs;let y=0;const b=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(l,b,f).normalize(),d.push(o.x,o.y,o.z),h.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],o=f[t][e+1];c.push(n,i,o),c.push(i,r,o),y+=6}l.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new vl(u,3)),this.setAttribute("normal",new vl(d,3)),this.setAttribute("uv",new vl(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nf(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class rf extends nf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}static fromJSON(e){return new rf(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class of extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];function s(e,t,n,i){const r=i+1,o=[];for(let s=0;s<=r;s++){o[s]=[];const i=e.clone().lerp(n,s/r),a=t.clone().lerp(n,s/r),l=r-s;for(let e=0;e<=l;e++)o[s][e]=0===e&&s===r?i:i.clone().lerp(a,e/l)}for(let s=0;s<r;s++)for(let e=0;e<2*(r-s)-1;e++){const t=Math.floor(e/2);e%2===0?(a(o[s][t+1]),a(o[s+1][t]),a(o[s][t])):(a(o[s][t+1]),a(o[s+1][t+1]),a(o[s+1][t]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new Rs,i=new Rs,r=new Rs;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],i),l(t[o+2],r),s(n,i,r,e)}(i),function(e){const t=new Rs;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new Rs;for(let t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];const n=u(e)/2/Math.PI+.5,i=d(e)/Math.PI+.5;o.push(n,1-i)}(function(){const e=new Rs,t=new Rs,n=new Rs,i=new Rs,s=new Qo,a=new Qo,l=new Qo;for(let d=0,h=0;d<r.length;d+=9,h+=6){e.set(r[d+0],r[d+1],r[d+2]),t.set(r[d+3],r[d+4],r[d+5]),n.set(r[d+6],r[d+7],r[d+8]),s.set(o[h+0],o[h+1]),a.set(o[h+2],o[h+3]),l.set(o[h+4],o[h+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);c(s,h+0,e,p),c(a,h+2,t,p),c(l,h+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],i=o[e+4],r=Math.max(t,n,i),s=Math.min(t,n,i);r>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),i<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new vl(r,3)),this.setAttribute("normal",new vl(r.slice(),3)),this.setAttribute("uv",new vl(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new of(e.vertices,e.indices,e.radius,e.details)}}class sf extends of{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sf(e.radius,e.detail)}}const af=new Rs,lf=new Rs,cf=new Rs,uf=new Wa;class df extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(Vo*t),o=e.getIndex(),s=e.getAttribute("position"),a=o?o.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),d={},h=[];for(let e=0;e<a;e+=3){o?(l[0]=o.getX(e),l[1]=o.getX(e+1),l[2]=o.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:a}=uf;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),a.fromBufferAttribute(s,l[2]),uf.getNormal(cf),u[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,u[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],i=u[t],o=uf[c[e]],s=uf[c[t]],a=`${n}_${i}`,p=`${i}_${n}`;p in d&&d[p]?(cf.dot(d[p].normal)<=r&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),d[p]=null):a in d||(d[a]={index0:l[e],index1:l[t],normal:cf.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:n}=d[e];af.fromBufferAttribute(s,t),lf.fromBufferAttribute(s,n),h.push(af.x,af.y,af.z),h.push(lf.x,lf.y,lf.z)}this.setAttribute("position",new vl(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class hf extends Jp{constructor(e){super(e),this.uuid=Go(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Jp).fromJSON(n))}return this}}const pf=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=ff(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,d,h,p;if(i&&(o=function(e,t,n,i){const r=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*i,l=o<s-1?t[o+1]*i:e.length,c=ff(e,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ef(c));for(r.sort(_f),o=0;o<r.length;o++)n=wf(r[o],n);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)d=e[t],h=e[t+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return gf(o,s,n,a,l,p,0),s};function ff(e,t,n,i,r){let o,s;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)s=Lf(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=Lf(o,e[o],e[o+1],s);return s&&Pf(s,s.next)&&(Of(s),s=s.next),s}function mf(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Pf(i,i.next)&&0!==Af(i.prev,i,i.next))i=i.next;else{if(Of(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function gf(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Mf(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?yf(e,i,r,o):vf(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Of(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?gf(e=bf(mf(e),t,n),t,n,i,r,o,2):2===s&&xf(e,t,n,i,r,o):gf(mf(e),t,n,i,r,o,1);break}}function vf(e){const t=e.prev,n=e,i=e.next;if(Af(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,d=a<l?a<c?a:c:l<c?l:c,h=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=h&&f.y>=d&&f.y<=p&&Cf(r,a,o,l,s,c,f.x,f.y)&&Af(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function yf(e,t,n,i){const r=e.prev,o=e,s=e.next;if(Af(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,d=o.y,h=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<d?u<h?u:h:d<h?d:h,m=a>l?a>c?a:c:l>c?l:c,g=u>d?u>h?u:h:d>h?d:h,v=Mf(p,f,t,n,i),y=Mf(m,g,t,n,i);let b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&Cf(a,u,l,d,c,h,b.x,b.y)&&Af(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Cf(a,u,l,d,c,h,x.x,x.y)&&Af(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&Cf(a,u,l,d,c,h,b.x,b.y)&&Af(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Cf(a,u,l,d,c,h,x.x,x.y)&&Af(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function bf(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!Pf(r,o)&&Df(r,i,i.next,o)&&Nf(r,o)&&Nf(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),Of(i),Of(i.next),i=e=o),i=i.next}while(i!==e);return mf(i)}function xf(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Tf(s,e)){let a=If(s,e);return s=mf(s,s.next),a=mf(a,a.next),gf(s,t,n,i,r,o,0),void gf(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function _f(e,t){return e.x-t.x}function wf(e,t){const n=function(e,t){let n,i=t,r=-1/0;const o=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=o&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===o))return n}i=i.next}while(i!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,d=1/0;i=n;do{o>=i.x&&i.x>=l&&o!==i.x&&Cf(s<c?o:r,s,l,c,s<c?r:o,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(o-i.x),Nf(i,e)&&(u<d||u===d&&(i.x>n.x||i.x===n.x&&Sf(n,i)))&&(n=i,d=u)),i=i.next}while(i!==a);return n}(e,t);if(!n)return t;const i=If(n,e);return mf(i,i.next),mf(n,n.next)}function Sf(e,t){return Af(e.prev,e,t.prev)<0&&Af(t.next,e,e.next)<0}function Mf(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ef(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Cf(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Tf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Df(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Nf(e,t)&&Nf(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Af(e.prev,e,t.prev)||Af(e,t.prev,t))||Pf(e,t)&&Af(e.prev,e,e.next)>0&&Af(t.prev,t,t.next)>0)}function Af(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Pf(e,t){return e.x===t.x&&e.y===t.y}function Df(e,t,n,i){const r=Rf(Af(e,t,n)),o=Rf(Af(e,t,i)),s=Rf(Af(n,i,e)),a=Rf(Af(n,i,t));return r!==o&&s!==a||(!(0!==r||!kf(e,n,t))||(!(0!==o||!kf(e,i,t))||(!(0!==s||!kf(n,e,i))||!(0!==a||!kf(n,t,i)))))}function kf(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Rf(e){return e>0?1:e<0?-1:0}function Nf(e,t){return Af(e.prev,e,e.next)<0?Af(e,t,e.next)>=0&&Af(e,e.prev,t)>=0:Af(e,t,e.prev)<0||Af(e,e.next,t)<0}function If(e,t){const n=new zf(e.i,e.x,e.y),i=new zf(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Lf(e,t,n,i){const r=new zf(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Of(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zf(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Uf{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return Uf.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Ff(e),jf(n,e);let o=e.length;t.forEach(Ff);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,jf(n,t[a]);const s=pf(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}}function Ff(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function jf(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Bf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hf([new Qo(.5,.5),new Qo(-.5,.5),new Qo(-.5,-.5),new Qo(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++){o(e[s])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:u-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Vf;let g,v,y,b,x,_=!1;f&&(g=f.getSpacedPoints(a),_=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new Rs,b=new Rs,x=new Rs),c||(p=0,u=0,d=0,h=0);const w=e.extractPoints(s);let S=w.shape;const M=w.holes;if(!Uf.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];Uf.isClockWise(t)&&(M[e]=t.reverse())}}const E=Uf.triangulateShape(S,M),C=S;for(let t=0,n=M.length;t<n;t++){const e=M[t];S=S.concat(e)}function T(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const A=S.length,P=E.length;function D(e,t,n){let i,r,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,d=s*c-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(u),h=Math.sqrt(l*l+c*c),p=t.x-a/d,f=t.y+s/d,m=((n.x-c/h-p)*c-(n.y+l/h-f)*l)/(s*c-a*l);i=p+s*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new Qo(i,r);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,r=s,o=Math.sqrt(u)):(i=s,r=a,o=Math.sqrt(u/2))}return new Qo(i/o,r/o)}const k=[];for(let t=0,n=C.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),k[t]=D(C[t],C[i],C[r]);const R=[];let N,I=k.concat();for(let t=0,n=M.length;t<n;t++){const e=M[t];N=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),N[t]=D(e[t],e[i],e[r]);R.push(N),I=I.concat(N)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,r=C.length;t<r;t++){const e=T(C[t],k[t],i);z(e.x,e.y,-n)}for(let t=0,r=M.length;t<r;t++){const e=M[t];N=R[t];for(let t=0,r=e.length;t<r;t++){const r=T(e[t],N[t],i);z(r.x,r.y,-n)}}}const L=d+h;for(let t=0;t<A;t++){const e=c?T(S[t],I[t],L):S[t];_?(b.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(y),z(x.x,x.y,x.z)):z(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<A;e++){const n=c?T(S[e],I[e],L):S[e];_?(b.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(b).add(y),z(x.x,x.y,x.z)):z(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,r=C.length;t<r;t++){const e=T(C[t],k[t],i);z(e.x,e.y,l+n)}for(let t=0,r=M.length;t<r;t++){const e=M[t];N=R[t];for(let t=0,r=e.length;t<r;t++){const r=T(e[t],N[t],i);_?z(r.x,r.y+g[a-1].y,g[a-1].x+n):z(r.x,r.y,l+n)}}}function O(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=A*e,o=A*(e+1);F(t+i+n,t+r+n,t+r+o,t+i+o)}}}function z(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,r){j(e),j(t),j(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);B(s[0]),B(s[1]),B(s[2])}function F(e,t,r,o){j(e),j(t),j(o),j(t),j(r),j(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);B(a[0]),B(a[1]),B(a[3]),B(a[1]),B(a[2]),B(a[3])}function j(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function B(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=A*e;for(let n=0;n<P;n++){const e=E[n];U(e[2]+t,e[1]+t,e[0]+t)}e=a+2*p,t=A*e;for(let n=0;n<P;n++){const e=E[n];U(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<P;e++){const t=E[e];U(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=E[e];U(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;O(C,t),t+=C.length;for(let n=0,i=M.length;n<i;n++){const e=M[n];O(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new vl(i,3)),this.setAttribute("uv",new vl(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Zp[i.type]).fromJSON(i)),new Bf(n,e.options)}}const Vf={generateTopUV:function(e,t,n,i,r){const o=t[3*n],s=t[3*n+1],a=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new Qo(o,s),new Qo(a,l),new Qo(c,u)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],d=t[3*i+2],h=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new Qo(s,1-l),new Qo(c,1-d),new Qo(h,1-f),new Qo(m,1-v)]:[new Qo(a,1-l),new Qo(u,1-d),new Qo(p,1-f),new Qo(g,1-v)]}};class Hf extends of{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Hf(e.radius,e.detail)}}class Gf extends of{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gf(e.radius,e.detail)}}class Wf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const s=[],a=[],l=[],c=[];let u=e;const d=(t-e)/i,h=new Rs,p=new Qo;for(let f=0;f<=i;f++){for(let e=0;e<=n;e++){const i=r+e/n*o;h.x=u*Math.cos(i),h.y=u*Math.sin(i),a.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,c.push(p.x,p.y)}u+=d}for(let f=0;f<i;f++){const e=f*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,o=i+n+1,a=i+n+2,l=i+1;s.push(r,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute("position",new vl(a,3)),this.setAttribute("normal",new vl(l,3)),this.setAttribute("uv",new vl(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wf(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Xf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hf([new Qo(0,.5),new Qo(-.5,-.5),new Qo(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(s,a,c),s+=a,a=0;function l(e){const s=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Uf.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===Uf.isClockWise(e)&&(u[t]=e.reverse())}const d=Uf.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,i=d.length;t<i;t++){const e=d[t],i=e[0]+s,r=e[1]+s,o=e[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute("position",new vl(i,3)),this.setAttribute("normal",new vl(r,3)),this.setAttribute("uv",new vl(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new Xf(n,e.curveSegments)}}class Yf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new Rs,d=new Rs,h=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const h=[],v=g/n;let y=0;0===g&&0===o?y=.5/t:g===n&&a===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(i+a*r)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),d.copy(u).normalize(),f.push(d.x,d.y,d.z),m.push(a+y,1-v),h.push(l++)}c.push(h)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],s=c[g+1][e+1];(0!==g||o>0)&&h.push(t,i,s),(g!==n-1||a<Math.PI)&&h.push(i,r,s)}this.setIndex(h),this.setAttribute("position",new vl(p,3)),this.setAttribute("normal",new vl(f,3)),this.setAttribute("uv",new vl(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yf(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class $f extends of{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $f(e.radius,e.detail)}}class qf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],a=[],l=[],c=new Rs,u=new Rs,d=new Rs;for(let h=0;h<=n;h++)for(let o=0;o<=i;o++){const p=o/i*r,f=h/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(u,c).normalize(),a.push(d.x,d.y,d.z),l.push(o/i),l.push(h/n)}for(let h=1;h<=n;h++)for(let e=1;e<=i;e++){const t=(i+1)*h+e-1,n=(i+1)*(h-1)+e-1,r=(i+1)*(h-1)+e,s=(i+1)*h+e;o.push(t,n,s),o.push(n,r,s)}this.setIndex(o),this.setAttribute("position",new vl(s,3)),this.setAttribute("normal",new vl(a,3)),this.setAttribute("uv",new vl(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qf(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Zf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],l=[],c=[],u=new Rs,d=new Rs,h=new Rs,p=new Rs,f=new Rs,m=new Rs,g=new Rs;for(let y=0;y<=n;++y){const s=y/n*r*Math.PI*2;v(s,r,o,e,h),v(s+.01,r,o,e,p),m.subVectors(p,h),g.addVectors(p,h),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,o=-t*Math.cos(r),s=t*Math.sin(r);u.x=h.x+(o*g.x+s*f.x),u.y=h.y+(o*g.y+s*f.y),u.z=h.z+(o*g.z+s*f.z),a.push(u.x,u.y,u.z),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(y/n),c.push(e/i)}}for(let y=1;y<=n;y++)for(let e=1;e<=i;e++){const t=(i+1)*(y-1)+(e-1),n=(i+1)*y+(e-1),r=(i+1)*y+e,o=(i+1)*(y-1)+e;s.push(t,n,o),s.push(n,r,o)}function v(e,t,n,i,r){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new vl(a,3)),this.setAttribute("normal",new vl(l,3)),this.setAttribute("uv",new vl(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Zf(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Kf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new $p(new Rs(-1,-1,0),new Rs(-1,1,0),new Rs(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Rs,a=new Rs,l=new Qo;let c=new Rs;const u=[],d=[],h=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=o.normals[r],h=o.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+r*h.x,a.y=o*l.y+r*h.y,a.z=o*l.z+r*h.z,a.normalize(),d.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,h.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),o=(i+1)*e+t,s=(i+1)*(e-1)+t;p.push(n,r,s),p.push(r,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new vl(u,3)),this.setAttribute("normal",new vl(d,3)),this.setAttribute("uv",new vl(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Kf((new Zp[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Jf extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new Rs,r=new Rs;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let l=0;l<3;l++){const a=s.getX(e+l),c=s.getX(e+(l+1)%3);i.fromBufferAttribute(o,a),r.fromBufferAttribute(o,c),!0===Qf(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let e=0,s=o.count/3;e<s;e++)for(let a=0;a<3;a++){const s=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(o,s),r.fromBufferAttribute(o,l),!0===Qf(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new vl(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Qf(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var em=Object.freeze({__proto__:null,BoxGeometry:Xl,CapsuleGeometry:ef,CircleGeometry:tf,ConeGeometry:rf,CylinderGeometry:nf,DodecahedronGeometry:sf,EdgesGeometry:df,ExtrudeGeometry:Bf,IcosahedronGeometry:Hf,LatheGeometry:Qp,OctahedronGeometry:Gf,PlaneGeometry:pc,PolyhedronGeometry:of,RingGeometry:Wf,ShapeGeometry:Xf,SphereGeometry:Yf,TetrahedronGeometry:$f,TorusGeometry:qf,TorusKnotGeometry:Zf,TubeGeometry:Kf,WireframeGeometry:Jf});class tm extends Qa{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Za(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class nm extends Kl{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class im extends Qa{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Za(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hr,this.normalScale=new Qo(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rm extends im{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qo(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Wo(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Za(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Za(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Za(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class om extends Qa{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Za(16777215),this.specular=new Za(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hr,this.normalScale=new Qo(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$n,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sm extends Qa{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Za(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hr,this.normalScale=new Qo(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class am extends Qa{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hr,this.normalScale=new Qo(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class lm extends Qa{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Za(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hr,this.normalScale=new Qo(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$n,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class cm extends Qa{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Za(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hr,this.normalScale=new Qo(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class um extends ap{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function dm(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function hm(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function pm(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n}function fm(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r}function mm(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)}const gm={convertArray:dm,isTypedArray:hm,getKeyframeOrder:pm,sortedArray:fm,flattenJSON:mm,subclip:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const o=e.clone();o.name=t;const s=[];for(let l=0;l<o.tracks.length;++l){const e=o.tracks[l],t=e.getValueSize(),a=[],c=[];for(let o=0;o<e.times.length;++o){const s=e.times[o]*r;if(!(s<n||s>=i)){a.push(e.times[o]);for(let n=0;n<t;++n)c.push(e.values[o*t+n])}}0!==a.length&&(e.times=dm(a,e.times.constructor),e.values=dm(c,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let l=0;l<o.tracks.length;++l)a>o.tracks[l].times[0]&&(a=o.tracks[l].times[0]);for(let l=0;l<o.tracks.length;++l)o.tracks[l].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);const r=n.tracks.length,o=t/i;for(let s=0;s<r;++s){const t=n.tracks[s],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===i});if(void 0===r)continue;let a=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const d=t.times.length-1;let h;if(o<=t.times[0]){const e=a,n=l-a;h=t.values.slice(e,n)}else if(o>=t.times[d]){const e=d*l+a,n=e+l-a;h=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=a,i=l-a;e.evaluate(o),h=e.resultBuffer.slice(n,i)}if("quaternion"===i){(new ks).fromArray(h).normalize().conjugate().toArray(h)}const p=r.times.length;for(let e=0;e<p;++e){const t=e*u+c;if("quaternion"===i)ks.multiplyQuaternionsFlat(r.values,t,h,0,r.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)r.values[t+n]-=h[n]}}}return e.blendMode=Lr,e}};class vm{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=r)){const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ym extends vm{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:kr,endingEnd:kr}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case Rr:r=e,s=2*t-n;break;case Nr:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Rr:o=e,a=2*n-t;break;case Nr:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,y=(-1-h)*m+(1.5+h)*f+.5*p,b=h*m-h*f;for(let x=0;x!==s;++x)r[x]=g*o[c+x]+v*o[l+x]+y*o[a+x]+b*o[u+x];return r}}class bm extends vm{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(i-t),u=1-c;for(let d=0;d!==s;++d)r[d]=o[l+d]*u+o[a+d]*c;return r}}class xm extends vm{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class _m{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=dm(t,this.TimeBufferType),this.values=dm(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:dm(e.times,Array),values:dm(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new xm(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new bm(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ym(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ar:t=this.InterpolantFactoryMethodDiscrete;break;case Pr:t=this.InterpolantFactoryMethodLinear;break;case Dr:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ar;case this.InterpolantFactoryMethodLinear:return Pr;case this.InterpolantFactoryMethodSmooth:return Dr}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=n.slice(r,o),this.values=this.values.slice(r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==o&&o>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,o),e=!1;break}o=t}if(void 0!==i&&hm(i))for(let s=0,a=i.length;s!==a;++s){const t=i[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Dr,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}_m.prototype.TimeBufferType=Float32Array,_m.prototype.ValueBufferType=Float32Array,_m.prototype.DefaultInterpolation=Pr;class wm extends _m{}wm.prototype.ValueTypeName="bool",wm.prototype.ValueBufferType=Array,wm.prototype.DefaultInterpolation=Ar,wm.prototype.InterpolantFactoryMethodLinear=void 0,wm.prototype.InterpolantFactoryMethodSmooth=void 0;class Sm extends _m{}Sm.prototype.ValueTypeName="color";class Mm extends _m{}Mm.prototype.ValueTypeName="number";class Em extends vm{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let c=l+s;l!==c;l+=4)ks.slerpFlat(r,0,o,l-s,o,l,a);return r}}class Cm extends _m{InterpolantFactoryMethodLinear(e){return new Em(this.times,this.values,this.getValueSize(),e)}}Cm.prototype.ValueTypeName="quaternion",Cm.prototype.DefaultInterpolation=Pr,Cm.prototype.InterpolantFactoryMethodSmooth=void 0;class Tm extends _m{}Tm.prototype.ValueTypeName="string",Tm.prototype.ValueBufferType=Array,Tm.prototype.DefaultInterpolation=Ar,Tm.prototype.InterpolantFactoryMethodLinear=void 0,Tm.prototype.InterpolantFactoryMethodSmooth=void 0;class Am extends _m{}Am.prototype.ValueTypeName="vector";class Pm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ir;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Go(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,s=n.length;o!==s;++o)t.push(Dm(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(_m.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const l=pm(e);e=fm(e,1,l),a=fm(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new Mm(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(this.CreateFromMorphTargetSequence(s,i[s],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];mm(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new Mm(".morphTargetInfluence["+r+"]",t,o))}a=t.length*o}else{const r=".bones["+t[c].name+"]";n(Am,r+".position",e,"pos",i),n(Cm,r+".quaternion",e,"rot",i),n(Am,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Dm(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Mm;case"vector":case"vector2":case"vector3":case"vector4":return Am;case"color":return Sm;case"quaternion":return Cm;case"bool":case"boolean":return wm;case"string":return Tm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];mm(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const km={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Rm{constructor(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Nm=new Rm;class Im{constructor(e){this.manager=void 0!==e?e:Nm,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Im.DEFAULT_MATERIAL_NAME="__DEFAULT";const Lm={};class Om extends Error{constructor(e,t){super(e),this.response=t}}class zm extends Im{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=km.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==Lm[e])return void Lm[e].push({onLoad:t,onProgress:n,onError:i});Lm[e]=[],Lm[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=Lm[e],i=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),o=r?parseInt(r):0,s=0!==o;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then(i=>{let{done:r,value:l}=i;if(r)e.close();else{a+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(l),t()}})}()}});return new Response(l)}throw new Om(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,s));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{km.add(e,t);const n=Lm[e];delete Lm[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}}).catch(t=>{const n=Lm[e];if(void 0===n)throw this.manager.itemError(e),t;delete Lm[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Um extends Im{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new zm(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Pm.parse(e[n]);t.push(i)}return t}}class Fm extends Im{constructor(e){super(e)}load(e,t,n,i){const r=this,o=[],s=new Tp,a=new zm(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(e[c],function(e){const n=r.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=xi),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))},n,i)}if(Array.isArray(e))for(let u=0,d=e.length;u<d;++u)c(u);else a.load(e,function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=xi),s.format=n.format,s.needsUpdate=!0,t&&t(s)},n,i);return s}}class jm extends Im{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=km.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const s=os("img");function a(){c(),km.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class Bm extends Im{constructor(e){super(e)}load(e,t,n,i){const r=new nc;r.colorSpace=Xr;const o=new jm(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],function(e){r.images[n]=e,s++,6===s&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let l=0;l<e.length;++l)a(l);return r}}class Vm extends Im{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new kh,s=new zm(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(e,function(e){let n;try{n=r.parse(e)}catch(Pb){if(void 0===i)return void console.error(Pb);i(Pb)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:pi,o.wrapT=void 0!==n.wrapT?n.wrapT:pi,o.magFilter=void 0!==n.magFilter?n.magFilter:xi,o.minFilter=void 0!==n.minFilter?n.minFilter:xi,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?o.colorSpace=n.colorSpace:void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=Si),1===n.mipmapCount&&(o.minFilter=xi),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n)},n,i),o}}class Hm extends Im{constructor(e){super(e)}load(e,t,n,i){const r=new ws,o=new jm(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}class Gm extends Na{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Za(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class Wm extends Gm{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Na.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Za(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Xm=new la,Ym=new Rs,$m=new Rs;class qm{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Qo(512,512),this.map=null,this.mapPass=null,this.matrix=new la,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new uc,this._frameExtents=new Qo(1,1),this._viewportCount=1,this._viewports=[new Ss(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Ym.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ym),$m.setFromMatrixPosition(e.target.matrixWorld),t.lookAt($m),t.updateMatrixWorld(),Xm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Xm),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Xm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Zm extends qm{constructor(){super(new Ql(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Ho*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Km extends Gm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Na.DEFAULT_UP),this.updateMatrix(),this.target=new Na,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Zm}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Jm=new la,Qm=new Rs,eg=new Rs;class tg extends qm{constructor(){super(new Ql(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Qo(4,2),this._viewportCount=6,this._viewports=[new Ss(2,1,1,1),new Ss(0,1,1,1),new Ss(3,1,1,1),new Ss(1,1,1,1),new Ss(3,0,1,1),new Ss(1,0,1,1)],this._cubeDirections=[new Rs(1,0,0),new Rs(-1,0,0),new Rs(0,0,1),new Rs(0,0,-1),new Rs(0,1,0),new Rs(0,-1,0)],this._cubeUps=[new Rs(0,1,0),new Rs(0,1,0),new Rs(0,1,0),new Rs(0,1,0),new Rs(0,0,1),new Rs(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Qm.setFromMatrixPosition(e.matrixWorld),n.position.copy(Qm),eg.copy(n.position),eg.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(eg),n.updateMatrixWorld(),i.makeTranslation(-Qm.x,-Qm.y,-Qm.z),Jm.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jm)}}class ng extends Gm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new tg}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class ig extends qm{constructor(){super(new Mc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class rg extends Gm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Na.DEFAULT_UP),this.updateMatrix(),this.target=new Na,this.shadow=new ig}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class og extends Gm{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class sg extends Gm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class ag{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Rs)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class lg extends Gm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ag;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class cg extends Im{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new zm(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=cg.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Za).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(i.uniforms[r]={},t.type){case"t":i.uniforms[r].value=n(t.value);break;case"c":i.uniforms[r].value=(new Za).setHex(t.value);break;case"v2":i.uniforms[r].value=(new Qo).fromArray(t.value);break;case"v3":i.uniforms[r].value=(new Rs).fromArray(t.value);break;case"v4":i.uniforms[r].value=(new Ss).fromArray(t.value);break;case"m3":i.uniforms[r].value=(new es).fromArray(t.value);break;case"m4":i.uniforms[r].value=(new la).fromArray(t.value);break;default:i.uniforms[r].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Qo).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Qo).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:tm,SpriteMaterial:th,RawShaderMaterial:nm,ShaderMaterial:Kl,PointsMaterial:yp,MeshPhysicalMaterial:rm,MeshStandardMaterial:im,MeshPhongMaterial:om,MeshToonMaterial:sm,MeshNormalMaterial:am,MeshLambertMaterial:lm,MeshDepthMaterial:Id,MeshDistanceMaterial:Ld,MeshBasicMaterial:el,MeshMatcapMaterial:cm,LineDashedMaterial:um,LineBasicMaterial:ap,Material:Qa}[e]}}class ug{static decodeText(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class dg extends Cl{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class hg extends Im{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new zm(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],o=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,r=i[t],o=new Uint32Array(r).buffer;return n[t]=o,o}(e,r.buffer),s=rs(r.type,o),a=new Jd(s,r.stride);return a.uuid=r.uuid,t[i]=a,a}const r=e.isInstancedBufferGeometry?new dg:new Cl,o=e.data.index;if(void 0!==o){const e=rs(o.type,o.array);r.setIndex(new ll(e,1))}const s=e.data.attributes;for(const u in s){const t=s[u];let n;if(t.isInterleavedBufferAttribute){const r=i(e.data,t.data);n=new eh(r,t.itemSize,t.offset,t.normalized)}else{const e=rs(t.type,t.array);n=new(t.isInstancedBufferAttribute?Lh:ll)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),r.setAttribute(u,n)}const a=e.data.morphAttributes;if(a)for(const u in a){const t=a[u],n=[];for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;if(o.isInterleavedBufferAttribute){const t=i(e.data,o.data);s=new eh(t,o.itemSize,o.offset,o.normalized)}else{const e=rs(o.type,o.array);s=new ll(e,o.itemSize,o.normalized)}void 0!==o.name&&(s.name=o.name),n.push(s)}r.morphAttributes[u]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,d=l.length;u!==d;++u){const e=l[u];r.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Rs;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Qs(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class pg extends Im{constructor(e){super(e)}load(e,t,n,i){const r=this,o=""===this.path?ug.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new zm(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){let o=null;try{o=JSON.parse(n)}catch(Pb){return void 0!==i&&i(Pb),void console.error("THREE:ObjectLoader: Can't parse "+e+".",Pb.message)}const s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);r.parse(o,t)},n,i)}async loadAsync(e,t){const n=""===this.path?ug.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new zm(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),o=JSON.parse(r),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){void 0!==t&&t(l)}),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,r,a,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,i,s,o,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new hf).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(e){e.isBone&&(i[e.uuid]=e)}),void 0!==e)for(let r=0,o=e.length;r<o;r++){const t=(new Ih).fromJSON(e[r],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new hg;for(let r=0,o=e.length;r<o;r++){let o;const s=e[r];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;default:s.type in em?o=em[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new cg;r.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=Pm.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:rs(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Rm(t);r=new jm(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=o(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new kh(n.data,n.width,n.height)))}i[n.uuid]=new bs(e)}else{const e=o(n.url);i[n.uuid]=new bs(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"===typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:rs(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new jm(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.url;if(Array.isArray(o)){const e=[];for(let t=0,n=o.length;t<n;t++){const n=o[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new kh(i.data,i.width,i.height)))}n[i.uuid]=new bs(e)}else{const e=await r(i.url);n[i.uuid]=new bs(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,o=e.length;r<o;r++){const o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const s=t[o.image],a=s.data;let l;Array.isArray(a)?(l=new nc,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new kh:new ws,a&&(l.needsUpdate=!0)),l.source=s,l.uuid=o.uuid,void 0!==o.name&&(l.name=o.name),void 0!==o.mapping&&(l.mapping=n(o.mapping,fg)),void 0!==o.channel&&(l.channel=o.channel),void 0!==o.offset&&l.offset.fromArray(o.offset),void 0!==o.repeat&&l.repeat.fromArray(o.repeat),void 0!==o.center&&l.center.fromArray(o.center),void 0!==o.rotation&&(l.rotation=o.rotation),void 0!==o.wrap&&(l.wrapS=n(o.wrap[0],mg),l.wrapT=n(o.wrap[1],mg)),void 0!==o.format&&(l.format=o.format),void 0!==o.internalFormat&&(l.internalFormat=o.internalFormat),void 0!==o.type&&(l.type=o.type),void 0!==o.colorSpace&&(l.colorSpace=o.colorSpace),void 0!==o.encoding&&(l.encoding=o.encoding),void 0!==o.minFilter&&(l.minFilter=n(o.minFilter,gg)),void 0!==o.magFilter&&(l.magFilter=n(o.magFilter,gg)),void 0!==o.anisotropy&&(l.anisotropy=o.anisotropy),void 0!==o.flipY&&(l.flipY=o.flipY),void 0!==o.generateMipmaps&&(l.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(l.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(l.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(l.compareFunction=o.compareFunction),void 0!==o.userData&&(l.userData=o.userData),i[o.uuid]=l}return i}parseObject(e,t,n,i,r){let o,s,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":o=new Kd,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new Za(e.background):o.background=u(e.background)),void 0!==e.environment&&(o.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new Zd(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new qd(e.fog.color,e.fog.density)),""!==e.fog.name&&(o.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(o.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new Ql(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Mc(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new og(e.color,e.intensity);break;case"DirectionalLight":o=new rg(e.color,e.intensity);break;case"PointLight":o=new ng(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new sg(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Km(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Wm(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new lg).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),a=c(e.material),o=new Ph(s,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),a=c(e.material),o=new Gl(s,a);break;case"InstancedMesh":s=l(e.geometry),a=c(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;o=new Hh(s,a,t),o.instanceMatrix=new Lh(new Float32Array(n.array),16),void 0!==i&&(o.instanceColor=new Lh(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":s=l(e.geometry),a=c(e.material),o=new sp(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,a),o.geometry=s,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(e=>{const t=new Ls;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const n=new Qs;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:n}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=u(e.matricesTexture.uuid);break;case"LOD":o=new bh;break;case"Line":o=new pp(l(e.geometry),c(e.material));break;case"LineLoop":o=new vp(l(e.geometry),c(e.material));break;case"LineSegments":o=new gp(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new Sp(l(e.geometry),c(e.material));break;case"Sprite":o=new mh(c(e.material));break;case"Group":o=new Bd;break;case"Bone":o=new Dh;break;default:o=new Na}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.up&&o.up.fromArray(e.up),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=o.getObjectByProperty("uuid",n.object);void 0!==i&&o.addLevel(i,n.distance,n.hysteresis)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}}const fg={UVMapping:si,CubeReflectionMapping:ai,CubeRefractionMapping:li,EquirectangularReflectionMapping:ci,EquirectangularRefractionMapping:ui,CubeUVReflectionMapping:di},mg={RepeatWrapping:hi,ClampToEdgeWrapping:pi,MirroredRepeatWrapping:fi},gg={NearestFilter:mi,NearestMipmapNearestFilter:gi,NearestMipmapLinearFilter:yi,LinearFilter:xi,LinearMipmapNearestFilter:_i,LinearMipmapLinearFilter:Si};class vg extends Im{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=km.get(e);if(void 0!==o)return r.manager.itemStart(e),o.then?void o.then(n=>{t&&t(n),r.manager.itemEnd(e)}).catch(e=>{i&&i(e)}):(setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;const a=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){return km.add(e,n),t&&t(n),r.manager.itemEnd(e),n}).catch(function(t){i&&i(t),km.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});km.add(e,a),r.manager.itemStart(e)}}let yg;class bg{static getContext(){return void 0===yg&&(yg=new(window.AudioContext||window.webkitAudioContext)),yg}static setContext(e){yg=e}}class xg extends Im{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new zm(this.manager);function s(t){i?i(t):console.error(t),r.manager.itemError(e)}o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(e){try{const n=e.slice(0);bg.getContext().decodeAudioData(n,function(e){t(e)}).catch(s)}catch(n){s(n)}},n,i)}}const _g=new la,wg=new la,Sg=new la;class Mg{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ql,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ql,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Sg.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(Vo*t.fov*.5)/t.zoom;let o,s;wg.elements[12]=-n,_g.elements[12]=n,o=-r*t.aspect+i,s=r*t.aspect+i,Sg.elements[0]=2*t.near/(s-o),Sg.elements[8]=(s+o)/(s-o),this.cameraL.projectionMatrix.copy(Sg),o=-r*t.aspect-i,s=r*t.aspect-i,Sg.elements[0]=2*t.near/(s-o),Sg.elements[8]=(s+o)/(s-o),this.cameraR.projectionMatrix.copy(Sg)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(wg),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_g)}}class Eg{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Cg(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Cg();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Cg(){return("undefined"===typeof performance?Date:performance).now()}const Tg=new Rs,Ag=new ks,Pg=new Rs,Dg=new Rs;class kg extends Na{constructor(){super(),this.type="AudioListener",this.context=bg.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Eg}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Tg,Ag,Pg),Dg.set(0,0,-1).applyQuaternion(Ag),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Tg.x,e),t.positionY.linearRampToValueAtTime(Tg.y,e),t.positionZ.linearRampToValueAtTime(Tg.z,e),t.forwardX.linearRampToValueAtTime(Dg.x,e),t.forwardY.linearRampToValueAtTime(Dg.y,e),t.forwardZ.linearRampToValueAtTime(Dg.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Tg.x,Tg.y,Tg.z),t.setOrientation(Dg.x,Dg.y,Dg.z,n.x,n.y,n.z)}}class Rg extends Na{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Ng=new Rs,Ig=new ks,Lg=new Rs,Og=new Rs;class zg extends Rg{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ng,Ig,Lg),Og.set(0,0,1).applyQuaternion(Ig);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ng.x,e),t.positionY.linearRampToValueAtTime(Ng.y,e),t.positionZ.linearRampToValueAtTime(Ng.z,e),t.orientationX.linearRampToValueAtTime(Og.x,e),t.orientationY.linearRampToValueAtTime(Og.y,e),t.orientationZ.linearRampToValueAtTime(Og.z,e)}else t.setPosition(Ng.x,Ng.y,Ng.z),t.setOrientation(Og.x,Og.y,Og.z)}}class Ug{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Fg{constructor(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){s.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){ks.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;ks.multiplyQuaternionsFlat(e,o,e,t,e,n),ks.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]*o+e[n+s]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const jg="\\[\\]\\.:\\/",Bg=new RegExp("["+jg+"]","g"),Vg="[^"+jg+"]",Hg="[^"+jg.replace("\\.","")+"]",Gg=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Vg)+/(WCOD+)?/.source.replace("WCOD",Hg)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Vg)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Vg)+"$"),Wg=["material","materials","bones","map"];class Xg{constructor(e,t,n){this.path=t,this.parsedPath=n||Xg.parseTrackName(t),this.node=Xg.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Xg.Composite(e,t,n):new Xg(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Bg,"")}static parseTrackName(e){const t=Gg.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Wg.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Xg.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Xg.Composite=class{constructor(e,t,n){const i=n||Xg.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Xg.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Xg.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Xg.prototype.GetterByBindingType=[Xg.prototype._getValue_direct,Xg.prototype._getValue_array,Xg.prototype._getValue_arrayElement,Xg.prototype._getValue_toArray],Xg.prototype.SetterByBindingTypeAndVersioning=[[Xg.prototype._setValue_direct,Xg.prototype._setValue_direct_setNeedsUpdate,Xg.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xg.prototype._setValue_array,Xg.prototype._setValue_array_setNeedsUpdate,Xg.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xg.prototype._setValue_arrayElement,Xg.prototype._setValue_arrayElement_setNeedsUpdate,Xg.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xg.prototype._setValue_fromArray,Xg.prototype._setValue_fromArray_setNeedsUpdate,Xg.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Yg{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Go(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],d=u.uuid;let h=t[d];if(void 0===h){h=a++,t[d]=h,e.push(u);for(let e=0,t=o;e!==t;++e)r[e].push(new Xg(u,n[e],i[e]))}else if(h<l){s=e[h];const a=--l,c=e[a];t[c.uuid]=h,e[h]=c,t[d]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=r[e],o=t[a];let s=t[h];t[h]=o,void 0===s&&(s=new Xg(u,n[e],i[e])),t[a]=s}}else e[h]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,l=t[a];if(void 0!==l&&l>=r){const o=r++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=s;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[o],r=t[l];t[l]=i,t[o]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const s=--r,a=e[s],c=--o,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[c];t[l]=i,t[s]=r,t.pop()}}else{const r=--o,s=e[r];r>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,o.push(e),s.push(t),r.push(u);for(let d=c,h=a.length;d!==h;++d){const n=a[d];u[d]=new Xg(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}}class $g{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:kr,endingEnd:kr};for(let l=0;l!==o;++l){const e=r[l].createInterpolant(null);s[l]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Cr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Lr)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===Tr;if(0===e)return-1===r?i:o&&1===(1&r)?t-i:i;if(n===Er){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1===(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Rr,i.endingEnd=Rr):(i.endingStart=e?this.zeroSlopeAtStart?Rr:kr:Nr,i.endingEnd=t?this.zeroSlopeAtEnd?Rr:kr:Nr)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=n,this}}const qg=new Float32Array(1);class Zg extends Fo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==r;++u){const e=i[u],r=e.name;let l=c[r];if(void 0!==l)++l.referenceCount,o[u]=l;else{if(l=o[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=t&&t._propertyBindings[u].binding.parsedPath;l=new Fg(Xg.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),o[u]=l}s[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new bm(new Float32Array(2),new Float32Array(2),1,qg),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o="string"===typeof e?Pm.findByName(i,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:Ir),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new $g(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"===typeof e?Pm.findByName(n,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(i,e,r,o)}const s=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)s[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Kg{constructor(e){this.value=e}clone(){return new Kg(void 0===this.value.clone?this.value:this.value.clone())}}let Jg=0;class Qg extends Fo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Jg++}),this.name="",this.usage=Eo,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class ev extends Jd{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class tv{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class nv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new aa(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new ba,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return rv(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(iv),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=e.length;i<r;i++)rv(e[i],this,n,t);return n.sort(iv),n}}function iv(e,t){return e.distance-t.distance}function rv(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)rv(i[e],t,n,!0)}}class ov{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Wo(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class sv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const av=new Qo;class lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qo(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=av.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,av).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const cv=new Rs,uv=new Rs;class dv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){cv.subVectors(e,this.start),uv.subVectors(this.end,this.start);const n=uv.dot(uv);let i=uv.dot(cv)/n;return t&&(i=Wo(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const hv=new Rs;class pv extends Na{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Cl,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){const e=o/a*Math.PI*2,t=s/a*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new vl(i,3));const r=new ap({fog:!1,toneMapped:!1});this.cone=new gp(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),hv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hv),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const fv=new Rs,mv=new la,gv=new la;class vv extends gp{constructor(e){const t=yv(e),n=new Cl,i=[],r=[],o=new Za(0,0,1),s=new Za(0,1,0);for(let a=0;a<t.length;a++){const e=t[a];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new vl(i,3)),n.setAttribute("color",new vl(r,3));super(n,new ap({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");gv.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(mv.multiplyMatrices(gv,e.matrixWorld),fv.setFromMatrixPosition(mv),i.setXYZ(o,fv.x,fv.y,fv.z),mv.multiplyMatrices(gv,e.parent.matrixWorld),fv.setFromMatrixPosition(mv),i.setXYZ(o+1,fv.x,fv.y,fv.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function yv(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,yv(e.children[n]));return t}class bv extends Gl{constructor(e,t,n){super(new Yf(t,4,2),new el({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const xv=new Rs,_v=new Za,wv=new Za;class Sv extends Na{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Gf(t);i.rotateY(.5*Math.PI),this.material=new el({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new ll(o,3)),this.add(new Gl(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");_v.copy(this.light.color),wv.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?_v:wv;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(xv.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Mv extends gp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new Za(n),i=new Za(i);const r=t/2,o=e/t,s=e/2,a=[],l=[];for(let u=0,d=0,h=-s;u<=t;u++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);const e=u===r?n:i;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new Cl;c.setAttribute("position",new vl(a,3)),c.setAttribute("color",new vl(l,3));super(c,new ap({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ev extends gp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;r=new Za(r),o=new Za(o);const s=[],a=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),i=Math.sin(n)*e,l=Math.cos(n)*e;s.push(0,0,0),s.push(i,0,l);const u=1&c?r:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?r:o,l=e-e/n*c;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),r=Math.sin(n)*l,o=Math.cos(n)*l;s.push(r,0,o),a.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),r=Math.sin(n)*l,o=Math.cos(n)*l,s.push(r,0,o),a.push(t.r,t.g,t.b)}}const l=new Cl;l.setAttribute("position",new vl(s,3)),l.setAttribute("color",new vl(a,3));super(l,new ap({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Cv=new Rs,Tv=new Rs,Av=new Rs;class Pv extends Na{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new Cl;i.setAttribute("position",new vl([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new ap({fog:!1,toneMapped:!1});this.lightPlane=new pp(i,r),this.add(this.lightPlane),i=new Cl,i.setAttribute("position",new vl([0,0,0,0,0,1],3)),this.targetLine=new pp(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Cv.setFromMatrixPosition(this.light.matrixWorld),Tv.setFromMatrixPosition(this.light.target.matrixWorld),Av.subVectors(Tv,Cv),this.lightPlane.lookAt(Tv),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tv),this.targetLine.scale.z=Av.length()}}const Dv=new Rs,kv=new Jl;class Rv extends gp{constructor(e){const t=new Cl,n=new ap({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};function s(e,t){a(e),a(t)}function a(e){i.push(0,0,0),r.push(0,0,0),void 0===o[e]&&(o[e]=[]),o[e].push(i.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new vl(i,3)),t.setAttribute("color",new vl(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new Za(16755200),c=new Za(16711680),u=new Za(43775),d=new Za(16777215),h=new Za(3355443);this.setColors(l,c,u,d,h)}setColors(e,t,n,i,r){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,r.r,r.g,r.b),o.setXYZ(41,r.r,r.g,r.b),o.setXYZ(42,r.r,r.g,r.b),o.setXYZ(43,r.r,r.g,r.b),o.setXYZ(44,r.r,r.g,r.b),o.setXYZ(45,r.r,r.g,r.b),o.setXYZ(46,r.r,r.g,r.b),o.setXYZ(47,r.r,r.g,r.b),o.setXYZ(48,r.r,r.g,r.b),o.setXYZ(49,r.r,r.g,r.b),o.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;kv.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Nv("c",t,e,kv,0,0,-1),Nv("t",t,e,kv,0,0,1),Nv("n1",t,e,kv,-1,-1,-1),Nv("n2",t,e,kv,1,-1,-1),Nv("n3",t,e,kv,-1,1,-1),Nv("n4",t,e,kv,1,1,-1),Nv("f1",t,e,kv,-1,-1,1),Nv("f2",t,e,kv,1,-1,1),Nv("f3",t,e,kv,-1,1,1),Nv("f4",t,e,kv,1,1,1),Nv("u1",t,e,kv,.7,1.1,-1),Nv("u2",t,e,kv,-.7,1.1,-1),Nv("u3",t,e,kv,0,2,-1),Nv("cf1",t,e,kv,-1,0,1),Nv("cf2",t,e,kv,1,0,1),Nv("cf3",t,e,kv,0,-1,1),Nv("cf4",t,e,kv,0,1,1),Nv("cn1",t,e,kv,-1,0,-1),Nv("cn2",t,e,kv,1,0,-1),Nv("cn3",t,e,kv,0,-1,-1),Nv("cn4",t,e,kv,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Nv(e,t,n,i,r,o,s){Dv.set(r,o,s).unproject(i);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],Dv.x,Dv.y,Dv.z)}}const Iv=new Ls;class Lv extends gp{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Cl;r.setIndex(new ll(n,1)),r.setAttribute("position",new ll(i,3)),super(r,new ap({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Iv.setFromObject(this.object),Iv.isEmpty())return;const t=Iv.min,n=Iv.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ov extends gp{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Cl;i.setIndex(new ll(n,1)),i.setAttribute("position",new vl([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new ap({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class zv extends pp{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,i=new Cl;i.setAttribute("position",new vl([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new ap({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new Cl;r.setAttribute("position",new vl([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new Gl(r,new el({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Uv=new Rs;let Fv,jv;class Bv extends Na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rs(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rs(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*r;super(),this.type="ArrowHelper",void 0===Fv&&(Fv=new Cl,Fv.setAttribute("position",new vl([0,0,0,0,1,0],3)),jv=new nf(0,.5,1,5,1),jv.translate(0,-.5,0)),this.position.copy(t),this.line=new pp(Fv,new ap({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gl(jv,new el({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Uv.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Uv,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Vv extends gp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Cl;n.setAttribute("position",new vl(t,3)),n.setAttribute("color",new vl([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new ap({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new Za,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Hv{constructor(){this.type="ShapePath",this.color=new Za,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Jp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=t[r],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[r],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return i}const n=Uf.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,o,s;const a=[];if(1===i.length)return o=i[0],s=new hf,s.curves=o.curves,a.push(s),a;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],u=[];let d,h,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)o=i[m],d=o.getPoints(),r=n(d),r=e?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new hf,p:d},u[f].s.curves=o.curves,l&&f++,p[f]=[]):p[f].push({h:o,p:d[0]});if(!u[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new hf;r.curves=i.curves,t.push(r)}return t}(i);if(u.length>1){let e=!1,n=0;for(let t=0,i=u.length;t<i;t++)c[t]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<u.length;r++)t(s.p,u[r].p)&&(i!==r&&n++,a?(a=!1,c[r].push(s)):e=!0);a&&c[i].push(s)}}n>0&&!1===e&&(p=c)}for(let m=0,g=u.length;m<g;m++){s=u[m].s,a.push(s),h=p[m];for(let e=0,t=h.length;e<t;e++)s.holes.push(h[e].h)}return a}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Jt}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Jt);var Gv=n(205);function Wv(e){let t;const n=new Set,i=(e,i)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=i?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,o={setState:i,getState:r,subscribe:(e,i,o)=>i||o?function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=i(t);function a(){const n=i(t);if(!o(s,n)){const t=s;e(s=n,t)}}return n.add(a),()=>n.delete(a)}(e,i,o):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(i,r,o),o}const Xv="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?t.useEffect:t.useLayoutEffect;function Yv(e){const n="function"===typeof e?Wv(e):e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.getState,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,t.useReducer)(e=>e+1,0),o=n.getState(),s=(0,t.useRef)(o),a=(0,t.useRef)(e),l=(0,t.useRef)(i),c=(0,t.useRef)(!1),u=(0,t.useRef)();let d;void 0===u.current&&(u.current=e(o));let h=!1;(s.current!==o||a.current!==e||l.current!==i||c.current)&&(d=e(o),h=!i(u.current,d)),Xv(()=>{h&&(u.current=d),s.current=o,a.current=e,l.current=i,c.current=!1});const p=(0,t.useRef)(o);Xv(()=>{const e=()=>{try{const e=n.getState(),t=a.current(e);l.current(u.current,t)||(s.current=e,u.current=t,r())}catch(Pb){c.current=!0,r()}},t=n.subscribe(e);return n.getState()!==p.current&&e(),t},[]);const f=h?d:u.current;return(0,t.useDebugValue)(f),f};return Object.assign(i,n),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[i,n];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},i}const $v=[];function qv(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e===t)return!0;if(!e||!t)return!1;const i=e.length;if(t.length!==i)return!1;for(let r=0;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}function Zv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===t&&(t=[e]);for(const s of $v)if(qv(t,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return i.lifespan&&i.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,i.lifespan)),s.response;if(!n)throw s.promise}const r={keys:t,equal:i.equal,remove:()=>{const e=$v.indexOf(r);-1!==e&&$v.splice(e,1)},promise:(o=e,"object"===typeof o&&"function"===typeof o.then?e:e(...t)).then(e=>{r.response=e,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(e=>r.error=e)};var o;if($v.push(r),!n)throw r.promise}const Kv=(e,t,n)=>Zv(e,t,!1,n);var Jv=n(16),Qv=n.n(Jv),ey=n(853);const ty={},ny=e=>{Object.assign(ty,e)};var iy,ry;const oy=e=>"colorSpace"in e||"outputColorSpace"in e,sy=()=>{var e;return null!=(e=ty.ColorManagement)?e:null},ay=e=>e&&e.isOrthographicCamera,ly="undefined"!==typeof window&&(null!=(iy=window.document)&&iy.createElement||"ReactNative"===(null==(ry=window.navigator)?void 0:ry.product))?t.useLayoutEffect:t.useEffect;function cy(e){const n=t.useRef(e);return ly(()=>{n.current=e},[e]),n}function uy(e){let{set:t}=e;return ly(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class dy extends t.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}dy.getDerivedStateFromError=()=>({error:!0});const hy="__default",py=new Map,fy=e=>e&&!!e.memoized&&!!e.changes;function my(e){var t;const n="undefined"!==typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const gy=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function vy(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const yy={obj:e=>e===Object(e)&&!yy.arr(e)&&"function"!==typeof e,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,boo:e=>"boolean"===typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){let{arrays:n="shallow",objects:i="reference",strict:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof e!==typeof t||!!e!==!!t)return!1;if(yy.str(e)||yy.num(e)||yy.boo(e))return e===t;const o=yy.obj(e);if(o&&"reference"===i)return e===t;const s=yy.arr(e);if(s&&"reference"===n)return e===t;if((s||o)&&e===t)return!0;let a;for(a in e)if(!(a in t))return!1;if(o&&"shallow"===n&&"shallow"===i){for(a in r?t:e)if(!yy.equ(e[a],t[a],{strict:r,objects:"reference"}))return!1}else for(a in r?t:e)if(e[a]!==t[a])return!1;if(yy.und(a)){if(s&&0===e.length&&0===t.length)return!0;if(o&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function by(e){const t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}function xy(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function _y(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),r=i.pop();return n=i.reduce((e,t)=>e[t],e),{target:n,key:r}}return{target:n,key:t}}const wy=/-\d+$/;function Sy(e,t,n){if(yy.str(n)){if(wy.test(n)){const t=n.replace(wy,""),{target:i,key:r}=_y(e,t);Array.isArray(i[r])||(i[r]=[])}const{target:i,key:r}=_y(e,n);t.__r3f.previousAttach=i[r],i[r]=t}else t.__r3f.previousAttach=n(e,t)}function My(e,t,n){var i,r;if(yy.str(n)){const{target:i,key:r}=_y(e,n),o=t.__r3f.previousAttach;void 0===o?delete i[r]:i[r]=o}else null==(i=t.__r3f)||null==i.previousAttach||i.previousAttach(e,t);null==(r=t.__r3f)||delete r.previousAttach}function Ey(e,t){let{children:n,key:i,ref:r,...o}=t,{children:s,key:a,ref:l,...c}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=e.__r3f,h=Object.entries(o),p=[];if(u){const e=Object.keys(c);for(let t=0;t<e.length;t++)o.hasOwnProperty(e[t])||h.unshift([e[t],hy+"remove"])}h.forEach(t=>{let[n,i]=t;var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===n)return;if(yy.equ(i,c[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return p.push([n,i,!0,[]]);let s=[];n.includes("-")&&(s=n.split("-")),p.push([n,i,!1,s]);for(const e in o){const t=o[e];e.startsWith(`${n}-`)&&p.push([e,t,!1,e.split("-")])}});const f={...o};return null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.args&&(f.args=d.memoizedProps.args),null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.attach&&(f.attach=d.memoizedProps.attach),{memoized:f,changes:p}}const Cy="undefined"!==typeof process&&!1;function Ty(e,t){var n;const i=e.__r3f,r=null==i?void 0:i.root,o=null==r||null==r.getState?void 0:r.getState(),{memoized:s,changes:a}=fy(t)?t:Ey(e,t),l=null==i?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let d=0;d<a.length;d++){let[t,n,r,s]=a[d];if(oy(e)){const e=3001,i="srgb",r="srgb-linear";"encoding"===t?(t="colorSpace",n=n===e?i:r):"outputEncoding"===t&&(t="outputColorSpace",n=n===e?i:r)}let l=e,h=l[t];if(s.length&&(h=s.reduce((e,t)=>e[t],e),!h||!h.set)){const[n,...i]=s.reverse();l=i.reverse().reduce((e,t)=>e[t],e),t=n}if(n===hy+"remove")if(l.constructor){let e=py.get(l.constructor);e||(e=new l.constructor,py.set(l.constructor,e)),n=e[t]}else n=0;if(r&&i)n?i.handlers[t]=n:delete i.handlers[t],i.eventCount=Object.keys(i.handlers).length;else if(h&&h.set&&(h.copy||h instanceof ba)){if(Array.isArray(n))h.fromArray?h.fromArray(n):h.set(...n);else if(h.copy&&n&&n.constructor&&(Cy?h.constructor.name===n.constructor.name:h.constructor===n.constructor))h.copy(n);else if(void 0!==n){var c;const e=null==(c=h)?void 0:c.isColor;!e&&h.setScalar?h.setScalar(n):h instanceof ba&&n instanceof ba?h.mask=n.mask:h.set(n),!sy()&&o&&!o.linear&&e&&h.convertSRGBToLinear()}}else{var u;if(l[t]=n,null!=(u=l[t])&&u.isTexture&&l[t].format===zi&&l[t].type===Ei&&o){const e=l[t];oy(e)&&oy(o.gl)?e.colorSpace=o.gl.outputColorSpace:e.encoding=o.gl.outputEncoding}}Ay(e)}if(i&&i.parent&&e.raycast&&l!==i.eventCount){const t=vy(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),i.eventCount&&t.interaction.push(e)}return!(1===a.length&&"onUpdate"===a[0][0])&&a.length&&null!=(n=e.__r3f)&&n.parent&&Py(e),e}function Ay(e){var t,n;const i=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function Py(e){null==e.onUpdate||e.onUpdate(e)}function Dy(e,t){e.manual||(ay(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ky(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ry(e,t,n,i){const r=n.get(t);r&&(n.delete(t),0===n.size&&(e.delete(i),r.target.releasePointerCapture(i)))}function Ny(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const i=e.eventObject.__r3f,r=null==i?void 0:i.handlers;if(n.hovered.delete(ky(e)),null!=i&&i.eventCount){const n={...e,intersections:t};null==r.onPointerOut||r.onPointerOut(n),null==r.onPointerLeave||r.onPointerLeave(n)}}}function i(e,t){for(let n=0;n<t.length;n++){const i=t[n].__r3f;null==i||null==i.handlers.onPointerMissed||i.handlers.onPointerMissed(e)}}return{handlePointer:function(r){switch(r){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:i}=e.getState();"pointerId"in t&&i.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{i.capturedMap.has(t.pointerId)&&(i.capturedMap.delete(t.pointerId),n([]))})}}return function(o){const{onPointerMissed:s,internal:a}=e.getState();a.lastEvent.current=o;const l="onPointerMove"===r,c="onClick"===r||"onContextMenu"===r||"onDoubleClick"===r,u=function(t,n){const i=e.getState(),r=new Set,o=[],s=n?n(i.internal.interaction):i.internal.interaction;for(let e=0;e<s.length;e++){const t=gy(s[e]);t&&(t.raycaster.camera=void 0)}i.previousRoot||null==i.events.compute||i.events.compute(t,i);let a=s.flatMap(function(e){const n=gy(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(i=n.previousRoot)?void 0:i.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var i}).sort((e,t)=>{const n=gy(e.object),i=gy(t.object);return n&&i&&i.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=ky(e);return!r.has(t)&&(r.add(t),!0)});i.events.filter&&(a=i.events.filter(a,i));for(const e of a){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&o.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&i.internal.capturedMap.has(t.pointerId))for(let e of i.internal.capturedMap.get(t.pointerId).values())r.has(ky(e.intersection))||o.push(e.intersection);return o}(o,l?t:void 0),d=c?function(t){const{internal:n}=e.getState(),i=t.offsetX-n.initialClick[0],r=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(o):0;"onPointerDown"===r&&(a.initialClick=[o.offsetX,o.offsetY],a.initialHits=u.map(e=>e.eventObject)),c&&!u.length&&d<=2&&(i(o,a.interaction),s&&s(o)),l&&n(u),function(t,i,r,o){const s=e.getState();if(t.length){const e={stopped:!1};for(const a of t){const l=gy(a.object)||s,{raycaster:c,pointer:u,camera:d,internal:h}=l,p=new Rs(u.x,u.y,0).unproject(d),f=e=>{var t,n;return null!=(t=null==(n=h.capturedMap.get(e))?void 0:n.has(a.eventObject))&&t},m=e=>{const t={intersection:a,target:i.target};h.capturedMap.has(e)?h.capturedMap.get(e).set(a.eventObject,t):h.capturedMap.set(e,new Map([[a.eventObject,t]])),i.target.setPointerCapture(e)},g=e=>{const t=h.capturedMap.get(e);t&&Ry(h.capturedMap,a.eventObject,t,e)};let v={};for(let e in i){let t=i[e];"function"!==typeof t&&(v[e]=t)}let y={...a,...v,pointer:u,intersections:t,stopped:e.stopped,delta:r,unprojectedPoint:p,ray:c.ray,camera:d,stopPropagation(){const r="pointerId"in i&&h.capturedMap.get(i.pointerId);(!r||r.has(a.eventObject))&&(y.stopped=e.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(e=>e.eventObject===a.eventObject))&&n([...t.slice(0,t.indexOf(a)),a])},target:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},currentTarget:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},nativeEvent:i};if(o(y),!0===e.stopped)break}}}(u,o,d,function(e){const t=e.eventObject,n=t.__r3f,s=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(s.onPointerOver||s.onPointerEnter||s.onPointerOut||s.onPointerLeave){const t=ky(e),n=a.hovered.get(t);n?n.stopped&&e.stopPropagation():(a.hovered.set(t,e),null==s.onPointerOver||s.onPointerOver(e),null==s.onPointerEnter||s.onPointerEnter(e))}null==s.onPointerMove||s.onPointerMove(e)}else{const n=s[r];n?c&&!a.initialHits.includes(t)||(i(o,a.interaction.filter(e=>!a.initialHits.includes(e))),n(e)):c&&a.initialHits.includes(t)&&i(o,a.interaction.filter(e=>!a.initialHits.includes(e)))}})}}}}const Iy=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Ly=e=>!(null==e||!e.render),Oy=t.createContext(null);let zy,Uy=new Set,Fy=new Set,jy=new Set;function By(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Vy(e,t){switch(e){case"before":return By(Uy,t);case"after":return By(Fy,t);case"tail":return By(jy,t)}}let Hy,Gy;function Wy(e,t,n){let i=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Hy=t.internal.subscribers,zy=0;zy<Hy.length;zy++)Gy=Hy[zy],Gy.ref.current(Gy.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Xy(){const e=t.useContext(Oy);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Yy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;return Xy()(e,t)}function $y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Xy(),i=n.getState().internal.subscribe,r=cy(e);return ly(()=>i(r,t,n),[t,i,n]),null}const qy=new WeakMap;function Zy(e,t){return function(n){let i=qy.get(n);i||(i=new n,qy.set(n,i)),e&&e(i);for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return Promise.all(o.map(e=>new Promise((n,r)=>i.load(e,e=>{e.scene&&Object.assign(e,by(e.scene)),n(e)},t,t=>r(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`))))))}}function Ky(e,t,n,i){const r=Array.isArray(t)?t:[t],o=Kv(Zy(n,i),[e,...r],{equal:yy.equ});return Array.isArray(t)?o:o[0]}Ky.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return((e,t,n)=>{Zv(e,t,!0,n)})(Zy(n),[e,...i])},Ky.clear=function(e,t){return(e=>{if(void 0===e||0===e.length)$v.splice(0,$v.length);else{const t=$v.find(t=>qv(e,t.keys,t.equal));t&&t.remove()}})([e,...Array.isArray(t)?t:[t]])};const Jy=new Map,{invalidate:Qy,advance:eb}=function(e){let t,n,i,r=!1,o=!1;function s(a){n=requestAnimationFrame(s),r=!0,t=0,Vy("before",a),o=!0;for(const n of e.values()){var l;i=n.store.getState(),!i.internal.active||!("always"===i.frameloop||i.internal.frames>0)||null!=(l=i.gl.xr)&&l.isPresenting||(t+=Wy(a,i))}if(o=!1,Vy("after",a),0===t)return Vy("tail",a),r=!1,cancelAnimationFrame(n)}return{loop:s,invalidate:function t(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var a;if(!n)return e.forEach(e=>t(e.store.getState(),i));null!=(a=n.gl.xr)&&a.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=i>1?Math.min(60,n.internal.frames+i):o?2:1,r||(r=!0,requestAnimationFrame(s)))},advance:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n&&Vy("before",t),i)Wy(t,i,r);else for(const o of e.values())Wy(t,o.store.getState());n&&Vy("after",t)}}}(Jy),{reconciler:tb,applyProps:nb}=function(e,t){function n(e,t,n){let i,{args:r=[],attach:o,...s}=t,a=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===s.object)throw new Error("R3F: Primitives without 'object' are invalid!");i=xy(s.object,{type:e,root:n,attach:o,primitive:!0})}else{const t=ty[a];if(!t)throw new Error(`R3F: ${a} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");i=xy(new t(...r),{type:e,root:n,attach:o,memoizedProps:{args:r}})}return void 0===i.__r3f.attach&&(i.isBufferGeometry?i.__r3f.attach="geometry":i.isMaterial&&(i.__r3f.attach="material")),"inject"!==a&&Ty(i,s),i}function i(e,t){let n=!1;var i,r;t&&(null!=(i=t.__r3f)&&i.attach?Sy(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(r=e.__r3f)||r.objects.push(t),t.__r3f||xy(t,{}),t.__r3f.parent=e,Py(t),Ay(t))}function r(e,t,n){let i=!1;if(t){var r,o;if(null!=(r=t.__r3f)&&r.attach)Sy(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const r=e.children.filter(e=>e!==t),o=r.indexOf(n);e.children=[...r.slice(0,o),t,...r.slice(o)],i=!0}i||null==(o=e.__r3f)||o.objects.push(t),t.__r3f||xy(t,{}),t.__r3f.parent=e,Py(t),Ay(t)}}function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&[...e].forEach(e=>s(t,e,n))}function s(e,t,n){if(t){var i,r,s;if(t.__r3f&&(t.__r3f.parent=null),null!=(i=e.__r3f)&&i.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(r=t.__r3f)&&r.attach)My(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var a;e.remove(t),null!=(a=t.__r3f)&&a.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,i)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(i)}),n.capturedMap.forEach((e,i)=>{Ry(n.capturedMap,t,e,i)})}(vy(t),t)}const c=null==(s=t.__r3f)?void 0:s.primitive,u=!c&&(void 0===n?null!==t.dispose:n);var l;if(!c)o(null==(l=t.__r3f)?void 0:l.objects,t,u),o(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"===typeof IS_REACT_ACT_ENVIRONMENT?(0,ey.unstable_scheduleCallback)(ey.unstable_IdlePriority,e):e()}Ay(e)}}const a=()=>{},l=Qv()({createInstance:n,removeChild:s,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,i(n,t))},removeChildFromContainer:(e,t)=>{t&&s(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const i=e.getState().scene;i.__r3f&&r(i,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,i){var r;if((null!=(r=null==e?void 0:e.__r3f)?r:{}).primitive&&i.object&&i.object!==e)return[!0];{const{args:t=[],children:r,...o}=i,{args:s=[],children:a,...l}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==s[t]))return[!0];const c=Ey(e,o,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(e,t,r,o,a,l){let[c,u]=t;c?function(e,t,r,o){var a;const l=null==(a=e.__r3f)?void 0:a.parent;if(!l)return;const c=n(t,r,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&i(c,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>i(c,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||s(l,e),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),i(l,c),c.raycast&&c.__r3f.eventCount&&vy(c).getState().internal.interaction.push(c);[o,o.alternate].forEach(e=>{null!==e&&(e.stateNode=c,e.ref&&("function"===typeof e.ref?e.ref(c):e.ref.current=c))})}(e,r,a,l):Ty(e,u)},commitMount(e,t,n,i){var r;const o=null!=(r=e.__r3f)?r:{};e.raycast&&o.handlers&&o.eventCount&&vy(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>xy(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:i}=null!=(t=e.__r3f)?t:{};n&&i&&My(i,e,n),e.isObject3D&&(e.visible=!1),Ay(e)},unhideInstance(e,t){var n;const{attach:i,parent:r}=null!=(n=e.__r3f)?n:{};i&&r&&Sy(r,e,i),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),Ay(e)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():Gv.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!==typeof performance&&yy.fun(performance.now)?performance.now:yy.fun(Date.now)?Date.now:()=>0,scheduleTimeout:yy.fun(setTimeout)?setTimeout:void 0,cancelTimeout:yy.fun(clearTimeout)?clearTimeout:void 0});return{reconciler:l,applyProps:Ty}}(0,function(){var e;const t="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!t)return Gv.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Gv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Gv.ContinuousEventPriority;default:return Gv.DefaultEventPriority}}),ib={objects:"shallow",strict:!1},rb=(e,t)=>{const n="function"===typeof e?e(t):e;return Ly(n)?n:new Yd({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function ob(e){const n=Jy.get(e),i=null==n?void 0:n.fiber,o=null==n?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const s="function"===typeof reportError?reportError:console.error,a=o||((e,n)=>{const i=Yv((i,r)=>{const o=new Rs,s=new Rs,a=new Rs;function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:i,height:l,top:c,left:u}=n,d=i/l;t.isVector3?a.copy(t):a.set(...t);const h=e.getWorldPosition(o).distanceTo(a);if(ay(e))return{width:i/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:h,aspect:d};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*h,r=n*(i/l);return{width:r,height:n,top:c,left:u,factor:i/r,distance:h,aspect:d}}}let c;const u=e=>i(t=>({performance:{...t.performance,current:e}})),d=new Qo,h={set:i,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:(e,t)=>n(e,t,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Eg,pointer:d,mouse:d,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&u(e.performance.min),c=setTimeout(()=>u(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:e=>i(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,n,o,a)=>{const c=r().camera,u={width:e,height:t,top:o||0,left:a||0,updateStyle:n};i(e=>({size:u,viewport:{...e.viewport,...l(c,s,u)}}))},setDpr:e=>i(t=>{const n=my(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}}),setFrameloop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),i(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:t.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return h}),r=i.getState();let o=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:e,size:t,viewport:n,gl:r,set:l}=i.getState();if(t.width!==o.width||t.height!==o.height||n.dpr!==s){var c;o=t,s=n.dpr,Dy(e,t),r.setPixelRatio(n.dpr);const i=null!=(c=t.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&r.domElement instanceof HTMLCanvasElement;r.setSize(t.width,t.height,i)}e!==a&&(a=e,l(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),i.subscribe(t=>e(t)),i})(Qy,eb),l=i||tb.createContainer(a,Gv.ConcurrentRoot,null,!1,null,"",s,null);let c;n||Jy.set(e,{fiber:l,store:a});let u,d=!1;return{configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:i,scene:r,events:o,onCreated:s,shadows:l=!1,linear:h=!1,flat:p=!1,legacy:f=!1,orthographic:m=!1,frameloop:g="always",dpr:v=[1,2],performance:y,raycaster:b,camera:x,onPointerMissed:_}=t,w=a.getState(),S=w.gl;w.gl||w.set({gl:S=rb(n,e)});let M=w.raycaster;M||w.set({raycaster:M=new nv});const{params:E,...C}=b||{};if(yy.equ(C,M,ib)||nb(M,{...C}),yy.equ(E,M.params,ib)||nb(M,{params:{...M.params,...E}}),!w.camera||w.camera===u&&!yy.equ(u,x,ib)){u=x;const e=x instanceof Jl,t=e?x:m?new Mc(0,0,0,0,.1,1e3):new Ql(75,0,.1,1e3);e||(t.position.z=5,x&&(nb(t,x),("aspect"in x||"left"in x||"right"in x||"bottom"in x||"top"in x)&&(t.manual=!0,t.updateProjectionMatrix())),w.camera||null!=x&&x.rotation||t.lookAt(0,0,0)),w.set({camera:t}),M.camera=t}if(!w.scene){let e;null!=r&&r.isScene?e=r:(e=new Kd,r&&nb(e,r)),w.set({scene:xy(e)})}if(!w.xr){var T;const e=(e,t)=>{const n=a.getState();"never"!==n.frameloop&&eb(e,!0,n,t)},t=()=>{const t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Qy(t)},n={connect(){const e=a.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=a.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"===typeof(null==(T=S.xr)?void 0:T.addEventListener)&&n.connect(),w.set({xr:n})}if(S.shadowMap){const e=S.shadowMap.enabled,t=S.shadowMap.type;if(S.shadowMap.enabled=!!l,yy.boo(l))S.shadowMap.type=ln;else if(yy.str(l)){var A;const e={basic:sn,percentage:an,soft:ln,variance:cn};S.shadowMap.type=null!=(A=e[l])?A:ln}else yy.obj(l)&&Object.assign(S.shadowMap,l);e===S.shadowMap.enabled&&t===S.shadowMap.type||(S.shadowMap.needsUpdate=!0)}const P=sy();if(P&&("enabled"in P?P.enabled=!f:"legacyMode"in P&&(P.legacyMode=f)),!d){nb(S,{outputEncoding:h?3e3:3001,toneMapping:p?Kn:ti})}w.legacy!==f&&w.set(()=>({legacy:f})),w.linear!==h&&w.set(()=>({linear:h})),w.flat!==p&&w.set(()=>({flat:p})),!n||yy.fun(n)||Ly(n)||yy.equ(n,S,ib)||nb(S,n),o&&!w.events.handlers&&w.set({events:o(a)});const D=function(e,t){const n="undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:i,top:r,left:o,updateStyle:s=n}=t;return{width:e,height:i,top:r,left:o,updateStyle:s}}if("undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:i,top:r,left:o}=e.parentElement.getBoundingClientRect();return{width:t,height:i,top:r,left:o,updateStyle:n}}return"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,i);return yy.equ(D,w.size,ib)||w.setSize(D.width,D.height,D.updateStyle,D.top,D.left),v&&w.viewport.dpr!==my(v)&&w.setDpr(v),w.frameloop!==g&&w.setFrameloop(g),w.onPointerMissed||w.set({onPointerMissed:_}),y&&!yy.equ(y,w.performance,ib)&&w.set(e=>({performance:{...e.performance,...y}})),c=s,d=!0,this},render(t){return d||this.configure(),tb.updateContainer((0,r.jsx)(sb,{store:a,children:t,onCreated:c,rootElement:e}),l,null,()=>{}),a},unmount(){ab(e)}}}function sb(e){let{store:t,children:n,onCreated:i,rootElement:o}=e;return ly(()=>{const e=t.getState();e.set(e=>({internal:{...e.internal,active:!0}})),i&&i(e),t.getState().events.connected||null==e.events.connect||e.events.connect(o)},[]),(0,r.jsx)(Oy.Provider,{value:t,children:n})}function ab(e,t){const n=Jy.get(e),i=null==n?void 0:n.fiber;if(i){const r=null==n?void 0:n.store.getState();r&&(r.internal.active=!1),tb.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var n,i,o,s;null==r.events.disconnect||r.events.disconnect(),null==(n=r.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(o=r.gl)||null==o.forceContextLoss||o.forceContextLoss(),null!=(s=r.gl)&&s.xr&&r.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(r),Jy.delete(e),t&&t(e)}catch(a){}},500)})}}function lb(e,t,n){return(0,r.jsx)(cb,{children:e,container:t,state:n},t.uuid)}function cb(e){let{state:n={},children:i,container:o}=e;const{events:s,size:a,...l}=n,c=Xy(),[u]=t.useState(()=>new nv),[d]=t.useState(()=>new Qo),h=t.useCallback((e,t)=>{const n={...e};let i;if(Object.keys(e).forEach(i=>{(Iy.includes(i)||e[i]!==t[i]&&t[i])&&delete n[i]}),t&&a){const n=t.camera;i=e.viewport.getCurrentViewport(n,new Rs,a),n!==e.camera&&Dy(n,a)}return{...n,scene:o,raycaster:u,pointer:d,mouse:d,previousRoot:c,events:{...e.events,...null==t?void 0:t.events,...s},size:{...e.size,...a},viewport:{...e.viewport,...i},...l}},[n]),[p]=t.useState(()=>{const e=c.getState(),t=Yv((t,n)=>({...e,scene:o,raycaster:u,pointer:d,mouse:d,previousRoot:c,events:{...e.events,...s},size:{...e.size,...a},...l,set:t,get:n,setEvents:e=>t(t=>({...t,events:{...t.events,...e}}))}));return t});return t.useEffect(()=>{const e=c.subscribe(e=>p.setState(t=>h(e,t)));return()=>{e()}},[h]),t.useEffect(()=>{p.setState(e=>h(c.getState(),e))},[h]),t.useEffect(()=>()=>{p.destroy()},[]),(0,r.jsx)(r.Fragment,{children:tb.createPortal((0,r.jsx)(Oy.Provider,{value:p,children:i}),p,null)})}tb.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:t.version});t.unstable_act;const ub={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function db(e){const{handlePointer:t}=Ny(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(ub).reduce((e,n)=>({...e,[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:i}=e.getState();null!=(t=i.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{var n;const{set:i,events:r}=e.getState();null==r.disconnect||r.disconnect(),i(e=>({events:{...e.events,connected:t}})),Object.entries(null!=(n=r.handlers)?n:[]).forEach(e=>{let[n,i]=e;const[r,o]=ub[n];t.addEventListener(r,i,{passive:o})})},disconnect:()=>{const{set:t,events:n}=e.getState();var i;n.connected&&(Object.entries(null!=(i=n.handlers)?i:[]).forEach(e=>{let[t,i]=e;if(n&&n.connected instanceof HTMLElement){const[e]=ub[t];n.connected.removeEventListener(e,i)}}),t(e=>({events:{...e.events,connected:void 0}})))}}}function hb(e,t){let n;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];window.clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}function pb(){let{debounce:e,scroll:n,polyfill:i,offsetSize:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debounce:0,scroll:!1,offsetSize:!1};const o=i||("undefined"==typeof window?class{}:window.ResizeObserver);if(!o)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=(0,t.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=(0,t.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=e?"number"==typeof e?e:e.scroll:null,u=e?"number"==typeof e?e:e.resize:null,d=(0,t.useRef)(!1);(0,t.useEffect)(()=>(d.current=!0,()=>{d.current=!1}));const[h,p,f]=(0,t.useMemo)(()=>{const e=()=>{if(!l.current.element)return;const{left:e,top:t,width:n,height:i,bottom:o,right:s,x:c,y:u}=l.current.element.getBoundingClientRect(),h={left:e,top:t,width:n,height:i,bottom:o,right:s,x:c,y:u};l.current.element instanceof HTMLElement&&r&&(h.height=l.current.element.offsetHeight,h.width=l.current.element.offsetWidth),Object.freeze(h),d.current&&!gb(l.current.lastBounds,h)&&a(l.current.lastBounds=h)};return[e,u?hb(e,u):e,c?hb(e,c):e]},[a,r,c,u]);function m(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",f,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null),l.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",l.current.orientationHandler))}function g(){l.current.element&&(l.current.resizeObserver=new o(f),l.current.resizeObserver.observe(l.current.element),n&&l.current.scrollContainers&&l.current.scrollContainers.forEach(e=>e.addEventListener("scroll",f,{capture:!0,passive:!0})),l.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",l.current.orientationHandler))}return function(e,n){(0,t.useEffect)(()=>{if(n){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,n])}(f,!!n),function(e){(0,t.useEffect)(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(p),(0,t.useEffect)(()=>{m(),g()},[n,f,p]),(0,t.useEffect)(()=>m,[]),[e=>{!e||e===l.current.element||(m(),l.current.element=e,l.current.scrollContainers=fb(e),g())},s,h]}function fb(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:i,overflowY:r}=window.getComputedStyle(e);return[n,i,r].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...fb(e.parentElement)]}const mb=["x","y","top","bottom","left","right","width","height"],gb=(e,t)=>mb.every(n=>e[n]===t[n]);var vb,yb,bb=Object.defineProperty,xb=Object.defineProperties,_b=Object.getOwnPropertyDescriptors,wb=Object.getOwnPropertySymbols,Sb=Object.prototype.hasOwnProperty,Mb=Object.prototype.propertyIsEnumerable,Eb=(e,t,n)=>t in e?bb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cb=(e,t)=>{for(var n in t||(t={}))Sb.call(t,n)&&Eb(e,n,t[n]);if(wb)for(var n of wb(t))Mb.call(t,n)&&Eb(e,n,t[n]);return e};"undefined"===typeof window||!(null==(vb=window.document)?void 0:vb.createElement)&&"ReactNative"!==(null==(yb=window.navigator)?void 0:yb.product)?t.useEffect:t.useLayoutEffect;function Tb(e,t,n){if(!e)return;if(!0===n(e))return e;let i=t?e.return:e.child;for(;i;){const e=Tb(i,t,n);if(e)return e;i=t?null:i.sibling}}function Ab(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}const Pb=console.error;console.error=function(){const e=[...arguments].join("");if(!(null==e?void 0:e.startsWith("Warning:"))||!e.includes("useContext"))return Pb.apply(this,arguments);console.error=Pb};const Db=Ab(t.createContext(null));class kb extends t.Component{render(){return t.createElement(Db.Provider,{value:this._reactInternals},this.props.children)}}function Rb(){const e=t.useContext(Db);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const n=t.useId(),i=t.useMemo(()=>{for(const t of[e,null==e?void 0:e.alternate]){if(!t)continue;const e=Tb(t,!1,e=>{let t=e.memoizedState;for(;t;){if(t.memoizedState===n)return!0;t=t.next}});if(e)return e}},[e,n]);return i}function Nb(){const e=function(){const e=Rb(),[n]=t.useState(()=>new Map);n.clear();let i=e;for(;i;){if(i.type&&"object"===typeof i.type){const e=void 0===i.type._context&&i.type.Provider===i.type?i.type:i.type._context;e&&e!==Db&&!n.has(e)&&n.set(e,t.useContext(Ab(e)))}i=i.return}return n}();return t.useMemo(()=>Array.from(e.keys()).reduce((n,i)=>r=>t.createElement(n,null,t.createElement(i.Provider,((e,t)=>xb(e,_b(t)))(Cb({},r),{value:e.get(i)}))),e=>t.createElement(kb,Cb({},e))),[e])}const Ib=t.forwardRef(function(n,i){let{children:o,fallback:s,resize:a,style:l,gl:c,events:u=db,eventSource:d,eventPrefix:h,shadows:p,linear:f,flat:m,legacy:g,orthographic:v,frameloop:y,dpr:b,performance:x,raycaster:_,camera:w,scene:S,onPointerMissed:M,onCreated:E,...C}=n;t.useMemo(()=>ny(e),[]);const T=Nb(),[A,P]=pb({scroll:!0,debounce:{scroll:50,resize:0},...a}),D=t.useRef(null),k=t.useRef(null);t.useImperativeHandle(i,()=>D.current);const R=cy(M),[N,I]=t.useState(!1),[L,O]=t.useState(!1);if(N)throw N;if(L)throw L;const z=t.useRef(null);ly(()=>{const e=D.current;P.width>0&&P.height>0&&e&&(z.current||(z.current=ob(e)),z.current.configure({gl:c,events:u,shadows:p,linear:f,flat:m,legacy:g,orthographic:v,frameloop:y,dpr:b,performance:x,raycaster:_,camera:w,scene:S,size:P,onPointerMissed:function(){return null==R.current?void 0:R.current(...arguments)},onCreated:e=>{var t;null==e.events.connect||e.events.connect(d?(t=d)&&t.hasOwnProperty("current")?d.current:d:k.current),h&&e.setEvents({compute:(e,t)=>{const n=e[h+"X"],i=e[h+"Y"];t.pointer.set(n/t.size.width*2-1,-i/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==E||E(e)}}),z.current.render((0,r.jsx)(T,{children:(0,r.jsx)(dy,{set:O,children:(0,r.jsx)(t.Suspense,{fallback:(0,r.jsx)(uy,{set:I}),children:null!=o?o:null})})})))}),t.useEffect(()=>{const e=D.current;if(e)return()=>ab(e)},[]);const U=d?"none":"auto";return(0,r.jsx)("div",{ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:U,...l},...C,children:(0,r.jsx)("div",{ref:A,style:{width:"100%",height:"100%"},children:(0,r.jsx)("canvas",{ref:D,style:{display:"block"},children:s})})})}),Lb=t.forwardRef(function(e,t){return(0,r.jsx)(kb,{children:(0,r.jsx)(Ib,{...e,ref:t})})});function Ob(){return Ob=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ob.apply(null,arguments)}var zb=Object.defineProperty,Ub=(e,t,n)=>(((e,t,n)=>{t in e?zb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class Fb{constructor(){Ub(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}var jb=Object.defineProperty,Bb=(e,t,n)=>(((e,t,n)=>{t in e?jb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const Vb=new aa,Hb=new ac,Gb=Math.cos(Math.PI/180*70),Wb=(e,t)=>(e%t+t)%t;class Xb extends Fb{constructor(e,t){super(),Bb(this,"object"),Bb(this,"domElement"),Bb(this,"enabled",!0),Bb(this,"target",new Rs),Bb(this,"minDistance",0),Bb(this,"maxDistance",1/0),Bb(this,"minZoom",0),Bb(this,"maxZoom",1/0),Bb(this,"minPolarAngle",0),Bb(this,"maxPolarAngle",Math.PI),Bb(this,"minAzimuthAngle",-1/0),Bb(this,"maxAzimuthAngle",1/0),Bb(this,"enableDamping",!1),Bb(this,"dampingFactor",.05),Bb(this,"enableZoom",!0),Bb(this,"zoomSpeed",1),Bb(this,"enableRotate",!0),Bb(this,"rotateSpeed",1),Bb(this,"enablePan",!0),Bb(this,"panSpeed",1),Bb(this,"screenSpacePanning",!0),Bb(this,"keyPanSpeed",7),Bb(this,"zoomToCursor",!1),Bb(this,"autoRotate",!1),Bb(this,"autoRotateSpeed",2),Bb(this,"reverseOrbit",!1),Bb(this,"reverseHorizontalOrbit",!1),Bb(this,"reverseVerticalOrbit",!1),Bb(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Bb(this,"mouseButtons",{LEFT:Qt.ROTATE,MIDDLE:Qt.DOLLY,RIGHT:Qt.PAN}),Bb(this,"touches",{ONE:en.ROTATE,TWO:en.DOLLY_PAN}),Bb(this,"target0"),Bb(this,"position0"),Bb(this,"zoom0"),Bb(this,"_domElementKeyEvents",null),Bb(this,"getPolarAngle"),Bb(this,"getAzimuthalAngle"),Bb(this,"setPolarAngle"),Bb(this,"setAzimuthalAngle"),Bb(this,"getDistance"),Bb(this,"getZoomScale"),Bb(this,"listenToKeyEvents"),Bb(this,"stopListenToKeyEvents"),Bb(this,"saveState"),Bb(this,"reset"),Bb(this,"update"),Bb(this,"connect"),Bb(this,"dispose"),Bb(this,"dollyIn"),Bb(this,"dollyOut"),Bb(this,"getScale"),Bb(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=Wb(e,2*Math.PI),i=c.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let r=Math.abs(t-i);2*Math.PI-r<r&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.phi=t-i,n.update()},this.setAzimuthalAngle=e=>{let t=Wb(e,2*Math.PI),i=c.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let r=Math.abs(t-i);2*Math.PI-r<r&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.theta=t-i,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Z),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),a=s.NONE},this.update=(()=>{const t=new Rs,r=new Rs(0,1,0),o=(new ks).setFromUnitVectors(e.up,r),p=o.clone().invert(),f=new Rs,m=new ks,g=2*Math.PI;return function(){const v=n.object.position;o.setFromUnitVectors(e.up,r),p.copy(o).invert(),t.copy(v).sub(n.target),t.applyQuaternion(o),c.setFromVector3(t),n.autoRotate&&a===s.NONE&&A(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let y=n.minAzimuthAngle,b=n.maxAzimuthAngle;isFinite(y)&&isFinite(b)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),b<-Math.PI?b+=g:b>Math.PI&&(b-=g),c.theta=y<=b?Math.max(y,Math.min(b,c.theta)):c.theta>(y+b)/2?Math.max(y,c.theta):Math.min(b,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),n.zoomToCursor&&M||n.object.isOrthographicCamera?c.radius=z(c.radius):c.radius=z(c.radius*d),t.setFromSpherical(c),t.applyQuaternion(p),v.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),h.set(0,0,0));let x=!1;if(n.zoomToCursor&&M){let i=null;if(n.object instanceof Ql&&n.object.isPerspectiveCamera){const e=t.length();i=z(e*d);const r=e-i;n.object.position.addScaledVector(w,r),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new Rs(S.x,S.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix(),x=!0;const r=new Rs(S.x,S.y,0);r.unproject(n.object),n.object.position.sub(r).add(e),n.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(Vb.origin.copy(n.object.position),Vb.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Vb.direction))<Gb?e.lookAt(n.target):(Hb.setFromNormalAndCoplanarPoint(n.object.up,n.target),Vb.intersectPlane(Hb,n.target))))}else n.object instanceof Mc&&n.object.isOrthographicCamera&&(x=1!==d,x&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix()));return d=1,M=!1,!!(x||f.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(i),f.copy(n.object.position),m.copy(n.object.quaternion),x=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",K),n.domElement.addEventListener("pointerdown",X),n.domElement.addEventListener("pointercancel",$),n.domElement.addEventListener("wheel",q)},this.dispose=()=>{var e,t,i,r,o,s;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",K),null==(t=n.domElement)||t.removeEventListener("pointerdown",X),null==(i=n.domElement)||i.removeEventListener("pointercancel",$),null==(r=n.domElement)||r.removeEventListener("wheel",q),null==(o=n.domElement)||o.ownerDocument.removeEventListener("pointermove",Y),null==(s=n.domElement)||s.ownerDocument.removeEventListener("pointerup",$),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Z)};const n=this,i={type:"change"},r={type:"start"},o={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=s.NONE;const l=1e-6,c=new ov,u=new ov;let d=1;const h=new Rs,p=new Qo,f=new Qo,m=new Qo,g=new Qo,v=new Qo,y=new Qo,b=new Qo,x=new Qo,_=new Qo,w=new Rs,S=new Qo;let M=!1;const E=[],C={};function T(){return Math.pow(.95,n.zoomSpeed)}function A(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function P(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}const D=(()=>{const e=new Rs;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}})(),k=(()=>{const e=new Rs;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}})(),R=(()=>{const e=new Rs;return function(t,i){const r=n.domElement;if(r&&n.object instanceof Ql&&n.object.isPerspectiveCamera){const o=n.object.position;e.copy(o).sub(n.target);let s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),D(2*t*s/r.clientHeight,n.object.matrix),k(2*i*s/r.clientHeight,n.object.matrix)}else r&&n.object instanceof Mc&&n.object.isOrthographicCamera?(D(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),k(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function N(e){n.object instanceof Ql&&n.object.isPerspectiveCamera||n.object instanceof Mc&&n.object.isOrthographicCamera?d=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(e){N(d/e)}function L(e){N(d*e)}function O(e){if(!n.zoomToCursor||!n.domElement)return;M=!0;const t=n.domElement.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top,o=t.width,s=t.height;S.x=i/o*2-1,S.y=-r/s*2+1,w.set(S.x,S.y,1).unproject(n.object).sub(n.object.position).normalize()}function z(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function U(e){p.set(e.clientX,e.clientY)}function F(e){g.set(e.clientX,e.clientY)}function j(){if(1==E.length)p.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);p.set(e,t)}}function B(){if(1==E.length)g.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);g.set(e,t)}}function V(){const e=E[0].pageX-E[1].pageX,t=E[0].pageY-E[1].pageY,n=Math.sqrt(e*e+t*t);b.set(0,n)}function H(e){if(1==E.length)f.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);f.set(n,i)}m.subVectors(f,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(A(2*Math.PI*m.x/t.clientHeight),P(2*Math.PI*m.y/t.clientHeight)),p.copy(f)}function G(e){if(1==E.length)v.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);v.set(n,i)}y.subVectors(v,g).multiplyScalar(n.panSpeed),R(y.x,y.y),g.copy(v)}function W(e){const t=Q(e),i=e.pageX-t.x,r=e.pageY-t.y,o=Math.sqrt(i*i+r*r);x.set(0,o),_.set(0,Math.pow(x.y/b.y,n.zoomSpeed)),I(_.y),b.copy(x)}function X(e){var t,i;!1!==n.enabled&&(0===E.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",Y),null==(i=n.domElement)||i.ownerDocument.addEventListener("pointerup",$)),function(e){E.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),E.length){case 1:switch(n.touches.ONE){case en.ROTATE:if(!1===n.enableRotate)return;j(),a=s.TOUCH_ROTATE;break;case en.PAN:if(!1===n.enablePan)return;B(),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(n.touches.TWO){case en.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&B(),a=s.TOUCH_DOLLY_PAN;break;case en.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&j(),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&n.dispatchEvent(r)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Qt.DOLLY:if(!1===n.enableZoom)return;!function(e){O(e),b.set(e.clientX,e.clientY)}(e),a=s.DOLLY;break;case Qt.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;F(e),a=s.PAN}else{if(!1===n.enableRotate)return;U(e),a=s.ROTATE}break;case Qt.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;U(e),a=s.ROTATE}else{if(!1===n.enablePan)return;F(e),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&n.dispatchEvent(r)}(e))}function Y(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),a){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;H(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;G(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&W(e),n.enablePan&&G(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&W(e),n.enableRotate&&H(e)}(e),n.update();break;default:a=s.NONE}}(e):function(e){if(!1===n.enabled)return;switch(a){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){f.set(e.clientX,e.clientY),m.subVectors(f,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(A(2*Math.PI*m.x/t.clientHeight),P(2*Math.PI*m.y/t.clientHeight)),p.copy(f),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),_.subVectors(x,b),_.y>0?I(T()):_.y<0&&L(T()),b.copy(x),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,g).multiplyScalar(n.panSpeed),R(y.x,y.y),g.copy(v),n.update()}(e)}}(e))}function $(e){var t,i,r;!function(e){delete C[e.pointerId];for(let t=0;t<E.length;t++)if(E[t].pointerId==e.pointerId)return void E.splice(t,1)}(e),0===E.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointermove",Y),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointerup",$)),n.dispatchEvent(o),a=s.NONE}function q(e){!1===n.enabled||!1===n.enableZoom||a!==s.NONE&&a!==s.ROTATE||(e.preventDefault(),n.dispatchEvent(r),function(e){O(e),e.deltaY<0?L(T()):e.deltaY>0&&I(T()),n.update()}(e),n.dispatchEvent(o))}function Z(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:R(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:R(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:R(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:R(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function K(e){!1!==n.enabled&&e.preventDefault()}function J(e){let t=C[e.pointerId];void 0===t&&(t=new Qo,C[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){const t=e.pointerId===E[0].pointerId?E[1]:E[0];return C[t.pointerId]}this.dollyIn=function(){L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:T()),n.update()},this.dollyOut=function(){I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:T()),n.update()},this.getScale=()=>d,this.setScale=e=>{N(e),n.update()},this.getZoomScale=()=>T(),void 0!==t&&this.connect(t),this.update()}}const Yb=t.forwardRef((e,n)=>{let{makeDefault:i,camera:r,regress:o,domElement:s,enableDamping:a=!0,keyEvents:l=!1,onChange:c,onStart:u,onEnd:d,...h}=e;const p=Yy(e=>e.invalidate),f=Yy(e=>e.camera),m=Yy(e=>e.gl),g=Yy(e=>e.events),v=Yy(e=>e.setEvents),y=Yy(e=>e.set),b=Yy(e=>e.get),x=Yy(e=>e.performance),_=r||f,w=s||g.connected||m.domElement,S=t.useMemo(()=>new Xb(_),[_]);return $y(()=>{S.enabled&&S.update()},-1),t.useEffect(()=>(l&&S.connect(!0===l?w:l),S.connect(w),()=>{S.dispose()}),[l,w,o,S,p]),t.useEffect(()=>{const e=e=>{p(),o&&x.regress(),c&&c(e)},t=e=>{u&&u(e)},n=e=>{d&&d(e)};return S.addEventListener("change",e),S.addEventListener("start",t),S.addEventListener("end",n),()=>{S.removeEventListener("start",t),S.removeEventListener("end",n),S.removeEventListener("change",e)}},[c,u,d,S,p,v]),t.useEffect(()=>{if(i){const e=b().controls;return y({controls:S}),()=>y({controls:e})}},[i,S]),t.createElement("primitive",Ob({ref:n,object:S,enableDamping:a},h))}),$b=(()=>parseInt(Jt.replace(/\D+/g,"")))();class qb extends Gl{constructor(e,t){var n,i;const r=(o=e)&&o.isCubeTexture;var o;const s=(null!=(i=r?null==(n=e.image[0])?void 0:n.width:e.image.width)?i:1024)/4,a=Math.floor(Math.log2(s)),l=Math.pow(2,a),c=[r?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/(3*Math.max(l,112)),"#define CUBEUV_TEXEL_HEIGHT "+1/(4*l),`#define CUBEUV_MAX_MIP ${a}.0`].join("\n")+`\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <${$b>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n        `,u={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new Hf(1,16),new Kl({uniforms:u,fragmentShader:c,vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",side:hn}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class Zb extends Vm{constructor(e){super(e),this.type=Ri}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,n){t=t||1024;let i=e.pos,r=-1,o=0,s="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(r=a.indexOf("\n"))&&o<t&&i<e.byteLength;)s+=a,o+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(!1!==n&&(e.pos+=o+r+1),s+a.slice(0,r))},i=function(e,t,n,i){const r=e[t+3],o=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*o,n[i+1]=e[t+1]*o,n[i+2]=e[t+2]*o,n[i+3]=1},r=function(e,t,n,i){const r=e[t+3],o=Math.pow(2,r-128)/255;n[i+0]=ol.toHalfFloat(Math.min(e[t+0]*o,65504)),n[i+1]=ol.toHalfFloat(Math.min(e[t+1]*o,65504)),n[i+2]=ol.toHalfFloat(Math.min(e[t+2]*o,65504)),n[i+3]=ol.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const s=function(e){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=n(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),a.valid|=1,a.programtype=c[1],a.string+=l+"\n";l=n(e),!1!==l;)if(a.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(i))&&(a.gamma=parseFloat(c[1])),(c=l.match(r))&&(a.exposure=parseFloat(c[1])),(c=l.match(o))&&(a.valid|=2,a.format=c[1]),(c=l.match(s))&&(a.valid|=4,a.height=parseInt(c[1],10),a.width=parseInt(c[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=l+"\n";return 2&a.valid||t(3,"missing format specifier"),4&a.valid||t(3,"missing image size specifier"),a}(o),a=s.width,l=s.height,c=function(e,n,i){const r=n;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);r!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const o=new Uint8Array(4*n*i);o.length||t(4,"unable to allocate buffer space");let s=0,a=0;const l=4*r,c=new Uint8Array(4),u=new Uint8Array(l);let d=i;for(;d>0&&a<e.byteLength;){a+4>e.byteLength&&t(1),c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==r||t(3,"bad rgbe scanline format");let n,i=0;for(;i<l&&a<e.byteLength;){n=e[a++];const r=n>128;if(r&&(n-=128),(0===n||i+n>l)&&t(3,"bad scanline data"),r){const t=e[a++];for(let e=0;e<n;e++)u[i++]=t}else u.set(e.subarray(a,a+n),i),i+=n,a+=n}const h=r;for(let e=0;e<h;e++){let t=0;o[s]=u[e+t],t+=r,o[s+1]=u[e+t],t+=r,o[s+2]=u[e+t],t+=r,o[s+3]=u[e+t],s+=4}d--}return o}(o.subarray(o.pos),a,l);let u,d,h;switch(this.type){case ki:h=c.length/4;const e=new Float32Array(4*h);for(let n=0;n<h;n++)i(c,4*n,e,4*n);u=e,d=ki;break;case Ri:h=c.length/4;const t=new Uint16Array(4*h);for(let n=0;n<h;n++)r(c,4*n,t,4*n);u=t,d=Ri;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:a,height:l,data:u,header:s.string,gamma:s.gamma,exposure:s.exposure,type:d}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(e,n){switch(e.type){case ki:case Ri:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=xi,e.magFilter=xi,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)},n,i)}}var Kb=Uint8Array,Jb=Uint16Array,Qb=Uint32Array,ex=new Kb([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tx=new Kb([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nx=new Kb([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ix=function(e,t){for(var n=new Jb(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new Qb(n[30]);for(i=1;i<30;++i)for(var o=n[i];o<n[i+1];++o)r[o]=o-n[i]<<5|i;return[n,r]},rx=ix(ex,2),ox=rx[0],sx=rx[1];ox[28]=258,sx[258]=28;for(var ax=ix(tx,0),lx=ax[0],cx=(ax[1],new Jb(32768)),ux=0;ux<32768;++ux){var dx=(43690&ux)>>>1|(21845&ux)<<1;dx=(61680&(dx=(52428&dx)>>>2|(13107&dx)<<2))>>>4|(3855&dx)<<4,cx[ux]=((65280&dx)>>>8|(255&dx)<<8)>>>1}var hx=function(e,t,n){for(var i=e.length,r=0,o=new Jb(t);r<i;++r)++o[e[r]-1];var s,a=new Jb(t);for(r=0;r<t;++r)a[r]=a[r-1]+o[r-1]<<1;if(n){s=new Jb(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],d=a[e[r]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)s[cx[d]>>>l]=c}else for(s=new Jb(i),r=0;r<i;++r)e[r]&&(s[r]=cx[a[e[r]-1]++]>>>15-e[r]);return s},px=new Kb(288);for(ux=0;ux<144;++ux)px[ux]=8;for(ux=144;ux<256;++ux)px[ux]=9;for(ux=256;ux<280;++ux)px[ux]=7;for(ux=280;ux<288;++ux)px[ux]=8;var fx=new Kb(32);for(ux=0;ux<32;++ux)fx[ux]=5;var mx=hx(px,9,1),gx=hx(fx,5,1),vx=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},yx=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},bx=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},xx=function(e){return(e/8|0)+(7&e&&1)},_x=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof Jb?Jb:e instanceof Qb?Qb:Kb)(n-t);return i.set(e.subarray(t,n)),i},wx=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new Kb(0);var r=!t||n,o=!n||n.i;n||(n={}),t||(t=new Kb(3*i));var s=function(e){var n=t.length;if(e>n){var i=new Kb(Math.max(2*n,e));i.set(t),t=i}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,d=n.d,h=n.m,p=n.n,f=8*i;do{if(!u){n.f=a=yx(e,l,1);var m=yx(e,l+1,3);if(l+=3,!m){var g=e[(T=xx(l)+4)-4]|e[T-3]<<8,v=T+g;if(v>i){if(o)throw"unexpected EOF";break}r&&s(c+g),t.set(e.subarray(T,v),c),n.b=c+=g,n.p=l=8*v;continue}if(1==m)u=mx,d=gx,h=9,p=5;else{if(2!=m)throw"invalid block type";var y=yx(e,l,31)+257,b=yx(e,l+10,15)+4,x=y+yx(e,l+5,31)+1;l+=14;for(var _=new Kb(x),w=new Kb(19),S=0;S<b;++S)w[nx[S]]=yx(e,l+3*S,7);l+=3*b;var M=vx(w),E=(1<<M)-1,C=hx(w,M,1);for(S=0;S<x;){var T,A=C[yx(e,l,E)];if(l+=15&A,(T=A>>>4)<16)_[S++]=T;else{var P=0,D=0;for(16==T?(D=3+yx(e,l,3),l+=2,P=_[S-1]):17==T?(D=3+yx(e,l,7),l+=3):18==T&&(D=11+yx(e,l,127),l+=7);D--;)_[S++]=P}}var k=_.subarray(0,y),R=_.subarray(y);h=vx(k),p=vx(R),u=hx(k,h,1),d=hx(R,p,1)}if(l>f){if(o)throw"unexpected EOF";break}}r&&s(c+131072);for(var N=(1<<h)-1,I=(1<<p)-1,L=l;;L=l){var O=(P=u[bx(e,l)&N])>>>4;if((l+=15&P)>f){if(o)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(O<256)t[c++]=O;else{if(256==O){L=l,u=null;break}var z=O-254;if(O>264){var U=ex[S=O-257];z=yx(e,l,(1<<U)-1)+ox[S],l+=U}var F=d[bx(e,l)&I],j=F>>>4;if(!F)throw"invalid distance";l+=15&F;R=lx[j];if(j>3){U=tx[j];R+=bx(e,l)&(1<<U)-1,l+=U}if(l>f){if(o)throw"unexpected EOF";break}r&&s(c+131072);for(var B=c+z;c<B;c+=4)t[c]=t[c-R],t[c+1]=t[c+1-R],t[c+2]=t[c+2-R],t[c+3]=t[c+3-R];c=B}}n.l=u,n.p=L,n.b=c,u&&(a=1,n.m=h,n.d=d,n.n=p)}while(!a);return c==t.length?t:_x(t,0,c)},Sx=new Kb(0),Mx=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Ex(e,t){return wx((Mx(e),e.subarray(2,-4)),t)}var Cx="undefined"!=typeof TextDecoder&&new TextDecoder;try{Cx.decode(Sx,{stream:!0})}catch(nV){}const Tx=$b>=152;class Ax extends Vm{constructor(e){super(e),this.type=Ri}parse(e){const t=65536,n=14,i=65537,r=16384,o=Math.pow(2.7182818,2.2);const s={l:0,c:0,lc:0};function a(e,t,n,i,r){for(;n<e;)t=t<<8|B(i,r),n+=8;n-=e,s.l=t>>n&(1<<e)-1,s.c=t,s.lc=n}const l=new Array(59);function c(e,t,n,r,o,c,u){for(var d=n,h=0,p=0;o<=c;o++){if(d.value-n.value>r)return!1;a(6,h,p,e,d);var f=s.l;if(h=s.c,p=s.lc,u[o]=f,63==f){if(d.value-n.value>r)throw"Something wrong with hufUnpackEncTable";a(8,h,p,e,d);var m=s.l+6;if(h=s.c,p=s.lc,o+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)u[o++]=0;o--}else if(f>=59){if(o+(m=f-59+2)>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)u[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<i;++t)l[e[t]]+=1;var n=0;for(t=58;t>0;--t){var r=n+l[t]>>1;l[t]=n,n=r}for(t=0;t<i;++t){var o=e[t];o>0&&(e[t]=o|l[o]++<<6)}}(u)}function u(e){return 63&e}function d(e){return e>>6}const h={c:0,lc:0};function p(e,t,n,i){e=e<<8|B(n,i),t+=8,h.c=e,h.lc=t}const f={c:0,lc:0};function m(e,t,n,i,r,o,s,a,l,c){if(e==t){i<8&&(p(n,i,r,s),n=h.c,i=h.lc);var u=n>>(i-=8);u=new Uint8Array([u])[0];if(l.value+u>c)return!1;for(var d=a[l.value-1];u-- >0;)a[l.value++]=d}else{if(!(l.value<c))return!1;a[l.value++]=e}f.c=n,f.lc=i}function g(e){return 65535&e}function v(e){var t=g(e);return t>32767?t-65536:t}const y={a:0,b:0};function b(e,t){var n=v(e),i=v(t),r=n+(1&i)+(i>>1),o=r,s=r-i;y.a=o,y.b=s}function x(e,t){var n=g(e),i=g(t),r=n-(i>>1)&65535,o=i+r-32768&65535;y.a=o,y.b=r}function _(e,t,n,i,r,o,s){for(var a,l=s<16384,c=n>r?r:n,u=1;u<=c;)u<<=1;for(a=u>>=1,u>>=1;u>=1;){for(var d,h,p,f,m=0,g=m+o*(r-a),v=o*u,_=o*a,w=i*u,S=i*a;m<=g;m+=_){for(var M=m,E=m+i*(n-a);M<=E;M+=S){var C=M+w,T=(A=M+v)+w;l?(b(e[M+t],e[A+t]),d=y.a,p=y.b,b(e[C+t],e[T+t]),h=y.a,f=y.b,b(d,h),e[M+t]=y.a,e[C+t]=y.b,b(p,f),e[A+t]=y.a,e[T+t]=y.b):(x(e[M+t],e[A+t]),d=y.a,p=y.b,x(e[C+t],e[T+t]),h=y.a,f=y.b,x(d,h),e[M+t]=y.a,e[C+t]=y.b,x(p,f),e[A+t]=y.a,e[T+t]=y.b)}if(n&u){var A=M+v;l?b(e[M+t],e[A+t]):x(e[M+t],e[A+t]),d=y.a,e[A+t]=y.b,e[M+t]=d}}if(r&u)for(M=m,E=m+i*(n-a);M<=E;M+=S){C=M+w;l?b(e[M+t],e[C+t]):x(e[M+t],e[C+t]),d=y.a,e[C+t]=y.b,e[M+t]=d}a=u,u>>=1}return m}function w(e,t,o,s,a,l){var g=o.value,v=j(t,o),y=j(t,o);o.value+=4;var b=j(t,o);if(o.value+=4,v<0||v>=i||y<0||y>=i)throw"Something wrong with HUF_ENCSIZE";var x=new Array(i),_=new Array(r);if(function(e){for(var t=0;t<r;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(_),c(e,0,o,s-(o.value-g),v,y,x),b>8*(s-(o.value-g)))throw"Something wrong with hufUncompress";!function(e,t,i,r){for(;t<=i;t++){var o=d(e[t]),s=u(e[t]);if(o>>s)throw"Invalid table entry";if(s>n){if((h=r[o>>s-n]).len)throw"Invalid table entry";if(h.lit++,h.p){var a=h.p;h.p=new Array(h.lit);for(var l=0;l<h.lit-1;++l)h.p[l]=a[l]}else h.p=new Array(1);h.p[h.lit-1]=t}else if(s){var c=0;for(l=1<<n-s;l>0;l--){var h;if((h=r[(o<<n-s)+c]).len||h.p)throw"Invalid table entry";h.len=s,h.lit=t,c++}}}}(x,v,y,_),function(e,t,i,r,o,s,a,l,c,g){for(var v=0,y=0,b=l,x=Math.trunc(o.value+(s+7)/8);o.value<x;)for(p(v,y,i,o),v=h.c,y=h.lc;y>=n;)if((M=t[v>>y-n&16383]).len)y-=M.len,m(M.lit,a,v,y,i,0,o,c,g,b),v=f.c,y=f.lc;else{if(!M.p)throw"hufDecode issues";var _;for(_=0;_<M.lit;_++){for(var w=u(e[M.p[_]]);y<w&&o.value<x;)p(v,y,i,o),v=h.c,y=h.lc;if(y>=w&&d(e[M.p[_]])==(v>>y-w&(1<<w)-1)){y-=w,m(M.p[_],a,v,y,i,0,o,c,g,b),v=f.c,y=f.lc;break}}if(_==M.lit)throw"hufDecode issues"}var S=8-s&7;for(v>>=S,y-=S;y>0;){var M;if(!(M=t[v<<n-y&16383]).len)throw"hufDecode issues";y-=M.len,m(M.lit,a,v,y,i,0,o,c,g,b),v=f.c,y=f.lc}}(x,_,e,0,o,b,y,l,a,{value:0})}function S(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function M(e,t){for(var n=0,i=Math.floor((e.length+1)/2),r=0,o=e.length-1;!(r>o)&&(t[r++]=e[n++],!(r>o));)t[r++]=e[i++]}function E(e){for(var t=e.byteLength,n=new Array,i=0,r=new DataView(e);t>0;){var o=r.getInt8(i++);if(o<0){t-=(a=-o)+1;for(var s=0;s<a;s++)n.push(r.getUint8(i++))}else{var a=o;t-=2;var l=r.getUint8(i++);for(s=0;s<a+1;s++)n.push(l)}}return n}function C(e,t,n){for(var i,r=1;r<64;)65280==(i=t[e.value])?r=64:i>>8==255?r+=255&i:(n[r]=i,r++),e.value++}function T(e,t){t[0]=X(e[0]),t[1]=X(e[1]),t[2]=X(e[5]),t[3]=X(e[6]),t[4]=X(e[14]),t[5]=X(e[15]),t[6]=X(e[27]),t[7]=X(e[28]),t[8]=X(e[2]),t[9]=X(e[4]),t[10]=X(e[7]),t[11]=X(e[13]),t[12]=X(e[16]),t[13]=X(e[26]),t[14]=X(e[29]),t[15]=X(e[42]),t[16]=X(e[3]),t[17]=X(e[8]),t[18]=X(e[12]),t[19]=X(e[17]),t[20]=X(e[25]),t[21]=X(e[30]),t[22]=X(e[41]),t[23]=X(e[43]),t[24]=X(e[9]),t[25]=X(e[11]),t[26]=X(e[18]),t[27]=X(e[24]),t[28]=X(e[31]),t[29]=X(e[40]),t[30]=X(e[44]),t[31]=X(e[53]),t[32]=X(e[10]),t[33]=X(e[19]),t[34]=X(e[23]),t[35]=X(e[32]),t[36]=X(e[39]),t[37]=X(e[45]),t[38]=X(e[52]),t[39]=X(e[54]),t[40]=X(e[20]),t[41]=X(e[22]),t[42]=X(e[33]),t[43]=X(e[38]),t[44]=X(e[46]),t[45]=X(e[51]),t[46]=X(e[55]),t[47]=X(e[60]),t[48]=X(e[21]),t[49]=X(e[34]),t[50]=X(e[37]),t[51]=X(e[47]),t[52]=X(e[50]),t[53]=X(e[56]),t[54]=X(e[59]),t[55]=X(e[61]),t[56]=X(e[35]),t[57]=X(e[36]),t[58]=X(e[48]),t[59]=X(e[49]),t[60]=X(e[57]),t[61]=X(e[58]),t[62]=X(e[62]),t[63]=X(e[63])}function A(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),r=.5*Math.cos(3*3.14159/16),o=.5*Math.cos(.981746875),s=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),u=new Array(4),d=new Array(4),h=0;h<8;++h){var p=8*h;l[0]=i*e[p+2],l[1]=s*e[p+2],l[2]=i*e[p+6],l[3]=s*e[p+6],c[0]=n*e[p+1]+r*e[p+3]+o*e[p+5]+a*e[p+7],c[1]=r*e[p+1]-a*e[p+3]-n*e[p+5]-o*e[p+7],c[2]=o*e[p+1]-n*e[p+3]+a*e[p+5]+r*e[p+7],c[3]=a*e[p+1]-o*e[p+3]+r*e[p+5]-n*e[p+7],u[0]=t*(e[p+0]+e[p+4]),u[3]=t*(e[p+0]-e[p+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],d[0]=u[0]+u[1],d[1]=u[3]+u[2],d[2]=u[3]-u[2],d[3]=u[0]-u[1],e[p+0]=d[0]+c[0],e[p+1]=d[1]+c[1],e[p+2]=d[2]+c[2],e[p+3]=d[3]+c[3],e[p+4]=d[3]-c[3],e[p+5]=d[2]-c[2],e[p+6]=d[1]-c[1],e[p+7]=d[0]-c[0]}for(var f=0;f<8;++f)l[0]=i*e[16+f],l[1]=s*e[16+f],l[2]=i*e[48+f],l[3]=s*e[48+f],c[0]=n*e[8+f]+r*e[24+f]+o*e[40+f]+a*e[56+f],c[1]=r*e[8+f]-a*e[24+f]-n*e[40+f]-o*e[56+f],c[2]=o*e[8+f]-n*e[24+f]+a*e[40+f]+r*e[56+f],c[3]=a*e[8+f]-o*e[24+f]+r*e[40+f]-n*e[56+f],u[0]=t*(e[f]+e[32+f]),u[3]=t*(e[f]-e[32+f]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],d[0]=u[0]+u[1],d[1]=u[3]+u[2],d[2]=u[3]-u[2],d[3]=u[0]-u[1],e[0+f]=d[0]+c[0],e[8+f]=d[1]+c[1],e[16+f]=d[2]+c[2],e[24+f]=d[3]+c[3],e[32+f]=d[3]-c[3],e[40+f]=d[2]-c[2],e[48+f]=d[1]-c[1],e[56+f]=d[0]-c[0]}function P(e){for(var t=0;t<64;++t){var n=e[0][t],i=e[1][t],r=e[2][t];e[0][t]=n+1.5747*r,e[1][t]=n-.1873*i-.4682*r,e[2][t]=n+1.8556*i}}function D(e,t,n){for(var i=0;i<64;++i)t[n+i]=ol.toHalfFloat(k(e[i]))}function k(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(o,Math.abs(e)-1)}function R(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function N(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(E(t)),i=new Uint8Array(n.length);return S(n),M(n,i),new DataView(i.buffer)}function I(e){var t=Ex(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return S(t),M(t,n),new DataView(n.buffer)}function L(e){for(var n=e.viewer,i={value:e.offset.value},r=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(8192),s=0,a=new Array(e.channels),l=0;l<e.channels;l++)a[l]={},a[l].start=s,a[l].end=a[l].start,a[l].nx=e.width,a[l].ny=e.lines,a[l].size=e.type,s+=a[l].nx*a[l].ny*a[l].size;var c=Y(n,i),u=Y(n,i);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=u)for(l=0;l<u-c+1;l++)o[l+c]=V(n,i);var d=new Uint16Array(t),h=function(e,n){for(var i=0,r=0;r<t;++r)(0==r||e[r>>3]&1<<(7&r))&&(n[i++]=r);for(var o=i-1;i<t;)n[i++]=0;return o}(o,d),p=j(n,i);w(e.array,n,i,p,r,s);for(l=0;l<e.channels;++l)for(var f=a[l],m=0;m<a[l].size;++m)_(r,f.start+m,f.nx,f.size,f.ny,f.nx*f.size,h);!function(e,t,n){for(var i=0;i<n;++i)t[i]=e[t[i]]}(d,r,s);for(var g=0,v=new Uint8Array(r.buffer.byteLength),y=0;y<e.lines;y++)for(var b=0;b<e.channels;b++){var x=(f=a[b]).nx*f.size,S=new Uint8Array(r.buffer,2*f.end,2*x);v.set(S,g),g+=2*x,f.end+=x}return new DataView(v.buffer)}function O(e){var t=Ex(e.array.slice(e.offset.value,e.offset.value+e.size));const n=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(n):new Uint32Array(n);let r=0,o=0;const s=new Array(4);for(let a=0;a<e.lines;a++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:s[0]=r,s[1]=s[0]+e.width,r=s[1]+e.width;for(let r=0;r<e.width;++r){n+=t[s[0]++]<<8|t[s[1]++],i[o]=n,o++}break;case 2:s[0]=r,s[1]=s[0]+e.width,s[2]=s[1]+e.width,r=s[2]+e.width;for(let r=0;r<e.width;++r){n+=t[s[0]++]<<24|t[s[1]++]<<16|t[s[2]++]<<8,i[o]=n,o++}}}return new DataView(i.buffer)}function z(e){var t=e.viewer,n={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),r={version:H(t,n),unknownUncompressedSize:H(t,n),unknownCompressedSize:H(t,n),acCompressedSize:H(t,n),dcCompressedSize:H(t,n),rleCompressedSize:H(t,n),rleUncompressedSize:H(t,n),rleRawSize:H(t,n),totalAcUncompressedCount:H(t,n),totalDcUncompressedCount:H(t,n),acCompression:H(t,n)};if(r.version<2)throw"EXRLoader.parse: "+Q.compression+" version "+r.version+" is unsupported";for(var o=new Array,s=Y(t,n)-2;s>0;){var a=U(t.buffer,n),l=V(t,n),c=l>>2&3,u=new Int8Array([(l>>4)-1])[0],d=V(t,n);o.push({name:a,index:u,type:d,compression:c}),s-=a.length+3}for(var h=Q.channels,p=new Array(e.channels),f=0;f<e.channels;++f){var m=p[f]={},g=h[f];m.name=g.name,m.compression=0,m.decoded=!1,m.type=g.pixelType,m.pLinear=g.pLinear,m.width=e.width,m.height=e.lines}for(var v={idx:new Array(3)},y=0;y<e.channels;++y)for(m=p[y],f=0;f<o.length;++f){var b=o[f];m.name==b.name&&(m.compression=b.compression,b.index>=0&&(v.idx[b.index]=y),m.offset=y)}if(r.acCompressedSize>0)switch(r.acCompression){case 0:var x=new Uint16Array(r.totalAcUncompressedCount);w(e.array,t,n,r.acCompressedSize,x,r.totalAcUncompressedCount);break;case 1:var _=Ex(e.array.slice(n.value,n.value+r.totalAcUncompressedCount));x=new Uint16Array(_.buffer);n.value+=r.totalAcUncompressedCount}if(r.dcCompressedSize>0){var S={array:e.array,offset:n,size:r.dcCompressedSize},M=new Uint16Array(I(S).buffer);n.value+=r.dcCompressedSize}if(r.rleRawSize>0){var k=E((_=Ex(e.array.slice(n.value,n.value+r.rleCompressedSize))).buffer);n.value+=r.rleCompressedSize}var R=0,N=new Array(p.length);for(f=0;f<N.length;++f)N[f]=new Array;for(var L=0;L<e.lines;++L)for(var O=0;O<p.length;++O)N[O].push(R),R+=p[O].width*e.type*2;!function(e,t,n,i,r,o){var s=new DataView(o.buffer),a=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(a/8),u=Math.ceil(a/8),d=Math.ceil(l/8),h=a-8*(u-1),p=l-8*(d-1),f={value:0},m=new Array(3),g=new Array(3),v=new Array(3),y=new Array(3),b=new Array(3);for(let C=0;C<3;++C)b[C]=t[e.idx[C]],m[C]=C<1?0:m[C-1]+u*d,g[C]=new Float32Array(64),v[C]=new Uint16Array(64),y[C]=new Uint16Array(64*u);for(let R=0;R<d;++R){var x=8;R==d-1&&(x=p);var _=8;for(let e=0;e<u;++e){e==u-1&&(_=h);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=r[m[e]++],C(f,i,v[e]),T(v[e],g[e]),A(g[e]);P(g);for(let t=0;t<3;++t)D(g[t],y[t],64*e)}let t=0;for(let i=0;i<3;++i){const r=n[e.idx[i]].type;for(let e=8*R;e<8*R+x;++e){t=b[i][e];for(let n=0;n<c;++n){const o=64*n+8*(7&e);s.setUint16(t+0*r,y[i][o+0],!0),s.setUint16(t+2*r,y[i][o+1],!0),s.setUint16(t+4*r,y[i][o+2],!0),s.setUint16(t+6*r,y[i][o+3],!0),s.setUint16(t+8*r,y[i][o+4],!0),s.setUint16(t+10*r,y[i][o+5],!0),s.setUint16(t+12*r,y[i][o+6],!0),s.setUint16(t+14*r,y[i][o+7],!0),t+=16*r}}if(c!=u)for(let e=8*R;e<8*R+x;++e){const t=b[i][e]+8*c*2*r,n=64*c+8*(7&e);for(let e=0;e<_;++e)s.setUint16(t+2*e*r,y[i][n+e],!0)}}}for(var w=new Uint16Array(a),S=(s=new DataView(o.buffer),0);S<3;++S){n[e.idx[S]].decoded=!0;var M=n[e.idx[S]].type;if(2==n[S].type)for(var E=0;E<l;++E){const e=b[S][E];for(var k=0;k<a;++k)w[k]=s.getUint16(e+2*k*M,!0);for(k=0;k<a;++k)s.setFloat32(e+2*k*M,X(w[k]),!0)}}}(v,N,p,x,M,i);for(f=0;f<p.length;++f){if(!(m=p[f]).decoded){if(2!==m.compression)throw"EXRLoader.parse: unsupported channel compression";var z=0,F=0;for(L=0;L<e.lines;++L){for(var j=N[f][z],B=0;B<m.width;++B){for(var G=0;G<2*m.type;++G)i[j++]=k[F+G*m.width*m.height];F++}z++}}}return new DataView(i.buffer)}function U(e,t){for(var n=new Uint8Array(e),i=0;0!=n[t.value+i];)i+=1;var r=(new TextDecoder).decode(n.slice(t.value,t.value+i));return t.value=t.value+i+1,r}function F(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function j(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function B(e,t){var n=e[t.value];return t.value=t.value+1,n}function V(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const H=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function G(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function W(e,t){return ol.toHalfFloat(G(e,t))}function X(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function Y(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function $(e,t){return X(Y(e,t))}function q(e,t,n,i,r){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,n){var i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,i}(t,n,r):"chlist"===i?function(e,t,n,i){for(var r=n.value,o=[];n.value<r+i-1;){var s=U(t,n),a=F(e,n),l=V(e,n);n.value+=3;var c=F(e,n),u=F(e,n);o.push({name:s,pixelType:a,pLinear:l,xSampling:c,ySampling:u})}return n.value+=1,o}(e,t,n,r):"chromaticities"===i?function(e,t){return{redX:G(e,t),redY:G(e,t),greenX:G(e,t),greenY:G(e,t),blueX:G(e,t),blueY:G(e,t),whiteX:G(e,t),whiteY:G(e,t)}}(e,n):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][V(e,t)]}(e,n):"box2i"===i?function(e,t){return{xMin:j(e,t),yMin:j(e,t),xMax:j(e,t),yMax:j(e,t)}}(e,n):"lineOrder"===i?function(e,t){return["INCREASING_Y"][V(e,t)]}(e,n):"float"===i?G(e,n):"v2f"===i?function(e,t){return[G(e,t),G(e,t)]}(e,n):"v3f"===i?function(e,t){return[G(e,t),G(e,t),G(e,t)]}(e,n):"int"===i?F(e,n):"rational"===i?function(e,t){return[F(e,t),j(e,t)]}(e,n):"timecode"===i?function(e,t){return[j(e,t),j(e,t)]}(e,n):"preview"===i?(n.value+=r,"skipped"):void(n.value+=r)}const Z=new DataView(e),K=new Uint8Array(e),J={value:0},Q=function(e,t,n){const i={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);const r=e.getUint8(5);i.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},n.value=8;for(var o=!0;o;){var s=U(t,n);if(0==s)o=!1;else{var a=U(t,n),l=q(e,t,n,a,j(e,n));void 0===l?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${a}'.`):i[s]=l}}if(0!=(-5&r))throw console.error("EXRHeader:",i),"THREE.EXRLoader: provided file is currently unsupported.";return i}(Z,e,J),ee=function(e,t,n,i,r){const o={size:0,viewer:t,array:n,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Tx?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=R;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=N;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=I;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=I;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=L;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=O;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=z;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=z;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(o.scanlineBlockSize=o.lines,1==o.type)switch(r){case ki:o.getter=$,o.inputSize=2;break;case Ri:o.getter=Y,o.inputSize=2}else{if(2!=o.type)throw"EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".";switch(r){case ki:o.getter=G,o.inputSize=4;break;case Ri:o.getter=W,o.inputSize=4}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(var s=0;s<o.blockCount;s++)H(t,i);o.outputChannels=3==o.channels?4:o.channels;const a=o.width*o.height*o.outputChannels;switch(r){case ki:o.byteArray=new Float32Array(a),o.channels<o.outputChannels&&o.byteArray.fill(1,0,a);break;case Ri:o.byteArray=new Uint16Array(a),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,a);break;default:console.error("THREE.EXRLoader: unsupported type: ",r)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?o.format=zi:o.format=Vi,Tx?o.colorSpace="srgb-linear":o.encoding=3e3,o}(Q,Z,K,J,this.type),te={value:0},ne={R:0,G:1,B:2,A:3,Y:0};for(let ie=0;ie<ee.height/ee.scanlineBlockSize;ie++){const e=j(Z,J);ee.size=j(Z,J),ee.lines=e+ee.scanlineBlockSize>ee.height?ee.height-e:ee.scanlineBlockSize;const t=ee.size<ee.lines*ee.bytesPerLine?ee.uncompress(ee):R(ee);J.value+=ee.size;for(let n=0;n<ee.scanlineBlockSize;n++){const e=n+ie*ee.scanlineBlockSize;if(e>=ee.height)break;for(let i=0;i<ee.channels;i++){const r=ne[Q.channels[i].name];for(let o=0;o<ee.width;o++){te.value=(n*(ee.channels*ee.width)+i*ee.width+o)*ee.inputSize;const s=(ee.height-1-e)*(ee.width*ee.outputChannels)+o*ee.outputChannels+r;ee.byteArray[s]=ee.getter(t,te)}}}}return{header:Q,width:ee.width,height:ee.height,data:ee.byteArray,format:ee.format,[Tx?"colorSpace":"encoding"]:ee[Tx?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(e,n){Tx?e.colorSpace=n.colorSpace:e.encoding=n.encoding,e.minFilter=xi,e.magFilter=xi,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)},n,i)}}const Px=(e,t,n)=>{let i;switch(e){case Ei:i=new Uint8ClampedArray(t*n*4);break;case Ri:i=new Uint16Array(t*n*4);break;case Di:i=new Uint32Array(t*n*4);break;case Ci:i=new Int8Array(t*n*4);break;case Ti:i=new Int16Array(t*n*4);break;case Pi:i=new Int32Array(t*n*4);break;case ki:i=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return i};let Dx;class kx{constructor(e){var t,n,i,r,o,s,a,l,c,u,d,h,p,f,m,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(nV){throw this._renderer.setRenderTarget(null),nV}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const v={format:zi,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(n=e.renderTargetOptions)||void 0===n?void 0:n.anisotropy:1,generateMipmaps:void 0!==(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps)&&(null===(r=e.renderTargetOptions)||void 0===r?void 0:r.generateMipmaps),magFilter:void 0!==(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.magFilter)?null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter:xi,minFilter:void 0!==(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.minFilter)?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:xi,samples:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.samples:void 0,wrapS:void 0!==(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS)?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.wrapS:pi,wrapT:void 0!==(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT)?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.wrapT:pi};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=kx.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Kd,this._camera=new Mc,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,n,i)=>{if(void 0!==Dx)return Dx;const r=new Es(1,1,i);t.setRenderTarget(r);const o=new Gl(new pc,new el({color:16777215}));t.render(o,n),t.setRenderTarget(null);const s=Px(e,r.width,r.height);return t.readRenderTargetPixels(r,0,0,r.width,r.height,s),r.dispose(),o.geometry.dispose(),o.material.dispose(),Dx=0!==s[0],Dx})(this._type,this._renderer,this._camera,v)){let e;if(this._type===Ri)e=this._renderer.extensions.has("EXT_color_buffer_float")?ki:void 0;void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${ki}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Gl(new pc,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Es(this.width,this.height,v),this._renderTarget.texture.mapping=void 0!==(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping)?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:si}static instantiateRenderer(){const e=new Yd;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Px(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new kh(this.toArray(),this.width,this.height,zi,this._type,(null===e||void 0===e?void 0:e.mapping)||si,(null===e||void 0===e?void 0:e.wrapS)||pi,(null===e||void 0===e?void 0:e.wrapT)||pi,(null===e||void 0===e?void 0:e.magFilter)||xi,(null===e||void 0===e?void 0:e.minFilter)||xi,(null===e||void 0===e?void 0:e.anisotropy)||1,Yr);return t.generateMipmaps=void 0!==(null===e||void 0===e?void 0:e.generateMipmaps)&&(null===e||void 0===e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Kl&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof ws&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof ws&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Rx extends Kl{constructor(e){let{gamma:t,offsetHdr:n,offsetSdr:i,gainMapMin:r,gainMapMax:o,maxDisplayBoost:s,hdrCapacityMin:a,hdrCapacityMax:l,sdr:c,gainMap:u}=e;super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:c},gainMap:{value:u},gamma:{value:new Rs(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:(new Rs).fromArray(n)},offsetSdr:{value:(new Rs).fromArray(i)},gainMapMin:{value:(new Rs).fromArray(r)},gainMapMax:{value:(new Rs).fromArray(o)},weightFactor:{value:(Math.log2(s)-a)/(l-a)}},blending:fn,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=s,this._hdrCapacityMin=a,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Nx extends Error{}class Ix extends Error{}const Lx=(e,t,n)=>{const i=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(i)return i[1];const r=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(r){const e=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(void 0!==n)return n;throw new Error(`Can't find ${t} in gainmap metadata`)};class Ox{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,n)=>{const i=this.options.debug,r=new DataView(e.buffer);if(65496!==r.getUint16(0))return void n(new Error("Not a valid jpeg"));const o=r.byteLength;let s,a=2,l=0;for(;a<o;){if(++l>250)return void n(new Error(`Found no marker after ${l} loops \ud83d\ude35`));if(255!==r.getUint8(a))return void n(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${r.getUint8(a).toString(16)}`));if(s=r.getUint8(a+1),i&&console.log(`Marker: ${s.toString(16)}`),226===s){i&&console.log("Found APP2 marker (0xffe2)");const e=a+4;if(1297106432===r.getUint32(e)){const i=e+4;let o;if(18761===r.getUint16(i))o=!1;else{if(19789!==r.getUint16(i))return void n(new Error("No valid endianness marker found in TIFF header"));o=!0}if(42!==r.getUint16(i+2,!o))return void n(new Error("Not valid TIFF data! (no 0x002A marker)"));const s=r.getUint32(i+4,!o);if(s<8)return void n(new Error("Not valid TIFF data! (First offset less than 8)"));const a=i+s,l=r.getUint16(a,!o),c=a+2;let u=0;for(let e=c;e<c+12*l;e+=12)45057===r.getUint16(e,!o)&&(u=r.getUint32(e+8,!o));const d=a+2+12*l+4,h=[];for(let e=d;e<d+16*u;e+=16){const t={MPType:r.getUint32(e,!o),size:r.getUint32(e+4,!o),dataOffset:r.getUint32(e+8,!o),dependantImages:r.getUint32(e+12,!o),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=i+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,h.push(t)}if(this.options.extractNonFII&&h.length){const e=new Blob([r]),n=[];for(const t of h){if(t.isFII&&!this.options.extractFII)continue;const i=e.slice(t.start,t.end+1,"image/jpeg");n.push(i)}t(n)}}}a+=2+r.getUint16(a+2)}})}}const zx=async e=>{const t=(e=>{let t;t="undefined"!==typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let n=t.indexOf("<x:xmpmeta");for(;-1!==n;){const e=t.indexOf("x:xmpmeta>",n),i=t.slice(n,e+10);try{const e=Lx(i,"hdrgm:GainMapMin","0"),t=Lx(i,"hdrgm:GainMapMax"),n=Lx(i,"hdrgm:Gamma","1"),r=Lx(i,"hdrgm:OffsetSDR","0.015625"),o=Lx(i,"hdrgm:OffsetHDR","0.015625"),s=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),a=s?s[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!l)throw new Error("Incomplete gainmap metadata");const c=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetSdr:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetHdr:Array.isArray(o)?o.map(e=>parseFloat(e)):[parseFloat(o),parseFloat(o),parseFloat(o)],hdrCapacityMin:parseFloat(a),hdrCapacityMax:parseFloat(c)}}catch(nV){}n=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new Ix("Gain map XMP metadata not found");const n=new Ox({extractFII:!0,extractNonFII:!0}),i=await n.extract(e);if(2!==i.length)throw new Nx("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:t}},Ux=e=>new Promise((t,n)=>{const i=document.createElement("img");i.onload=()=>{t(i)},i.onerror=e=>{n(e)},i.src=URL.createObjectURL(e)});class Fx extends Im{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new Rm}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Rx({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new ws,sdr:new ws});return new kx({width:16,height:16,type:Ri,colorSpace:Yr,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,n,i){const r=i?new Blob([i],{type:"image/jpeg"}):void 0,o=new Blob([n],{type:"image/jpeg"});let s,a,l=!1;if("undefined"===typeof createImageBitmap){const e=await Promise.all([r?Ux(r):Promise.resolve(void 0),Ux(o)]);a=e[0],s=e[1],l=!0}else{const e=await Promise.all([r?createImageBitmap(r,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:"flipY"})]);a=e[0],s=e[1]}const c=new ws(a||new ImageData(2,2),si,pi,pi,xi,Mi,zi,Ei,1,Yr);c.flipY=l,c.needsUpdate=!0;const u=new ws(s,si,pi,pi,xi,Mi,zi,Ei,1,Xr);u.flipY=l,u.needsUpdate=!0,e.width=s.width,e.height=s.height,e.material.gainMap=c,e.material.sdr=u,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class jx extends Fx{load(e,t,n,i){let[r,o,s]=e;const a=this.prepareQuadRenderer();let l,c,u;const d=async()=>{if(l&&c&&u){try{await this.render(a,u,l,c)}catch(Pb){return this.manager.itemError(r),this.manager.itemError(o),this.manager.itemError(s),"function"===typeof i&&i(Pb),void a.disposeOnDemandRenderer()}"function"===typeof t&&t(a),this.manager.itemEnd(r),this.manager.itemEnd(o),this.manager.itemEnd(s),a.disposeOnDemandRenderer()}};let h=!0,p=0,f=0,m=!0,g=0,v=0,y=!0,b=0,x=0;const _=()=>{if("function"===typeof n){n(new ProgressEvent("progress",{lengthComputable:h&&m&&y,loaded:f+v+x,total:p+g+b}))}};this.manager.itemStart(r),this.manager.itemStart(o),this.manager.itemStart(s);const w=new zm(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(r,async e=>{if("string"===typeof e)throw new Error("Invalid sdr buffer");l=e,await d()},e=>{h=e.lengthComputable,f=e.loaded,p=e.total,_()},e=>{this.manager.itemError(r),"function"===typeof i&&i(e)});const S=new zm(this._internalLoadingManager);S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(o,async e=>{if("string"===typeof e)throw new Error("Invalid gainmap buffer");c=e,await d()},e=>{m=e.lengthComputable,v=e.loaded,g=e.total,_()},e=>{this.manager.itemError(o),"function"===typeof i&&i(e)});const M=new zm(this._internalLoadingManager);return M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(s,async e=>{if("string"!==typeof e)throw new Error("Invalid metadata string");u=JSON.parse(e),await d()},e=>{y=e.lengthComputable,x=e.loaded,b=e.total,_()},e=>{this.manager.itemError(s),"function"===typeof i&&i(e)}),a}}class Bx extends Fx{load(e,t,n,i){const r=this.prepareQuadRenderer(),o=new zm(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async n=>{if("string"===typeof n)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const o=new Uint8Array(n);let s,a,l;try{const e=await zx(o);s=e.sdr,a=e.gainMap,l=e.metadata}catch(nV){if(!(nV instanceof Ix||nV instanceof Nx))throw nV;console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},s=o}try{await this.render(r,l,s,a)}catch(Pb){return this.manager.itemError(e),"function"===typeof i&&i(Pb),void r.disposeOnDemandRenderer()}"function"===typeof t&&t(r),this.manager.itemEnd(e),r.disposeOnDemandRenderer()},n,t=>{this.manager.itemError(e),"function"===typeof i&&i(t)}),r}}const Vx={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Hx="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Gx=e=>Array.isArray(e),Wx=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Xx(){let{files:e=Wx,path:n="",preset:i,encoding:r,extensions:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=null,a=!1;i&&(qx(i),e=Vx[i],n=Hx),a=Gx(e);const{extension:l,isCubemap:c}=Zx(e);if(s=Kx(l),!s)throw new Error("useEnvironment: Unrecognized file extension: "+e);const u=Yy(e=>e.gl);(0,t.useLayoutEffect)(()=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||u.domElement.addEventListener("webglcontextlost",function(){Ky.clear(s,a?[e]:e)},{once:!0})},[e,u.domElement]);const d=Ky(s,a?[e]:e,e=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||e.setRenderer(u),null==e.setPath||e.setPath(n),o&&o(e)});let h=a?d[0]:d;var p;"jpg"!==l&&"jpeg"!==l&&"webp"!==l||(h=null==(p=h.renderTarget)?void 0:p.texture);return h.mapping=c?ai:ci,"colorSpace"in h?h.colorSpace=(null!==r&&void 0!==r?r:c)?"srgb":"srgb-linear":h.encoding=(null!==r&&void 0!==r?r:c)?3001:3e3,h}const Yx={files:Wx,path:"",preset:void 0,extensions:void 0};Xx.preload=e=>{const t={...Yx,...e};let{files:n,path:i=""}=t;const{preset:r,extensions:o}=t;r&&(qx(r),n=Vx[r],i=Hx);const{extension:s}=Zx(n);if("webp"===s||"jpg"===s||"jpeg"===s)throw new Error("useEnvironment: Preloading gainmaps is not supported");const a=Kx(s);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+n);Ky.preload(a,Gx(n)?[n]:n,e=>{null==e.setPath||e.setPath(i),o&&o(e)})};const $x={files:Wx,preset:void 0};function qx(e){if(!(e in Vx))throw new Error("Preset must be one of: "+Object.keys(Vx).join(", "))}function Zx(e){var t;const n=Gx(e)&&6===e.length,i=Gx(e)&&3===e.length&&e.some(e=>e.endsWith("json")),r=Gx(e)?e[0]:e;return{extension:n?"cube":i?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":null==(t=r.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:n,isGainmap:i}}function Kx(e){return"cube"===e?Bm:"hdr"===e?Zb:"exr"===e?Ax:"jpg"===e||"jpeg"===e?Bx:"webp"===e?jx:null}Xx.clear=e=>{const t={...$x,...e};let{files:n}=t;const{preset:i}=t;i&&(qx(i),n=Vx[i]);const{extension:r}=Zx(n),o=Kx(r);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+n);Ky.clear(o,Gx(n)?[n]:n)};function Jx(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};var o,s,a,l;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const c=(e=>{return(t=e).current&&t.current.isScene?e.current:e;var t})(t||n),u=c.background,d=c.environment,h={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:null!==(o=null==(s=c.backgroundRotation)||null==s.clone?void 0:s.clone())&&void 0!==o?o:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:null!==(a=null==(l=c.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==a?a:[0,0,0]};return"only"!==e&&(c.environment=i),e&&(c.background=i),nb(c,r),()=>{"only"!==e&&(c.environment=d),e&&(c.background=u),nb(c,h)}}function Qx(e){let{scene:n,background:i=!1,map:r,...o}=e;const s=Yy(e=>e.scene);return t.useLayoutEffect(()=>{if(r)return Jx(i,n,s,r,o)}),null}function e_(e){let{background:n=!1,scene:i,blur:r,backgroundBlurriness:o,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:l,environmentRotation:c,...u}=e;const d=Xx(u),h=Yy(e=>e.scene);return t.useLayoutEffect(()=>Jx(n,i,h,d,{backgroundBlurriness:null!==r&&void 0!==r?r:o,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:l,environmentRotation:c})),t.useEffect(()=>()=>{d.dispose()},[d]),null}function t_(e){let{children:n,near:i=.1,far:r=1e3,resolution:o=256,frames:s=1,map:a,background:l=!1,blur:c,backgroundBlurriness:u,backgroundIntensity:d,backgroundRotation:h,environmentIntensity:p,environmentRotation:f,scene:m,files:g,path:v,preset:y,extensions:b}=e;const x=Yy(e=>e.gl),_=Yy(e=>e.scene),w=t.useRef(null),[S]=t.useState(()=>new Kd),M=t.useMemo(()=>{const e=new ic(o);return e.texture.type=Ri,e},[o]);t.useEffect(()=>()=>{M.dispose()},[M]),t.useLayoutEffect(()=>{if(1===s){const e=x.autoClear;x.autoClear=!0,w.current.update(x,S),x.autoClear=e}return Jx(l,m,_,M.texture,{backgroundBlurriness:null!==c&&void 0!==c?c:u,backgroundIntensity:d,backgroundRotation:h,environmentIntensity:p,environmentRotation:f})},[n,S,M.texture,m,_,l,s,x]);let E=1;return $y(()=>{if(s===1/0||E<s){const e=x.autoClear;x.autoClear=!0,w.current.update(x,S),x.autoClear=e,E++}}),t.createElement(t.Fragment,null,lb(t.createElement(t.Fragment,null,n,t.createElement("cubeCamera",{ref:w,args:[i,r,M]}),g||y?t.createElement(e_,{background:!0,files:g,preset:y,path:v,extensions:b}):a?t.createElement(Qx,{background:!0,map:a,extensions:b}):null),S))}function n_(e){var n,i,r,o;const s=Xx(e),a=e.map||s;t.useMemo(()=>ny({GroundProjectedEnvImpl:qb}),[]),t.useEffect(()=>()=>{s.dispose()},[s]);const l=t.useMemo(()=>[a],[a]),c=null==(n=e.ground)?void 0:n.height,u=null==(i=e.ground)?void 0:i.radius,d=null!==(r=null==(o=e.ground)?void 0:o.scale)&&void 0!==r?r:1e3;return t.createElement(t.Fragment,null,t.createElement(Qx,Ob({},e,{map:a})),t.createElement("groundProjectedEnvImpl",{args:l,scale:d,height:c,radius:u}))}function i_(e){return e.ground?t.createElement(n_,e):e.map?t.createElement(Qx,e):e.children?t.createElement(t_,e):t.createElement(e_,e)}function r_(e,t,n,i){const r=class extends Kl{constructor(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=Object.entries(e);super({uniforms:o.reduce((e,t)=>{let[n,i]=t;return{...e,...Zl.clone({[n]:{value:i}})}},{}),vertexShader:t,fragmentShader:n}),this.key="",o.forEach(e=>{let[t]=e;return Object.defineProperty(this,t,{get:()=>this.uniforms[t].value,set:e=>this.uniforms[t].value=e})}),Object.assign(this,r),i&&i(this)}};return r.key=Jo.generateUUID(),r}const o_=(()=>parseInt(Jt.replace(/\D+/g,"")))(),s_=r_({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new Za,sectionColor:new Za,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new Rs,worldPlanePosition:new Rs},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform float cellSize;\n    uniform float sectionSize;\n    uniform vec3 cellColor;\n    uniform vec3 sectionColor;\n    uniform float fadeDistance;\n    uniform float fadeStrength;\n    uniform float fadeFrom;\n    uniform float cellThickness;\n    uniform float sectionThickness;\n\n    float getGrid(float size, float thickness) {\n      vec2 r = localPosition.xz / size;\n      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n      float line = min(grid.x, grid.y) + 1.0 - thickness;\n      return 1.0 - min(line, 1.0);\n    }\n\n    void main() {\n      float g1 = getGrid(cellSize, cellThickness);\n      float g2 = getGrid(sectionSize, sectionThickness);\n\n      vec3 from = worldCamProjPosition*vec3(fadeFrom);\n      float dist = distance(from, worldPosition.xyz);\n      float d = 1.0 - min(dist / fadeDistance, 1.0);\n      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));\n\n      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));\n      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n      if (gl_FragColor.a <= 0.0) discard;\n\n      #include <tonemapping_fragment>\n      #include <${o_>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `),a_=t.forwardRef((e,n)=>{let{args:i,cellColor:r="#000000",sectionColor:o="#2080ff",cellSize:s=.5,sectionSize:a=1,followCamera:l=!1,infiniteGrid:c=!1,fadeDistance:u=100,fadeStrength:d=1,fadeFrom:h=1,cellThickness:p=.5,sectionThickness:f=1,side:m=dn,...g}=e;ny({GridMaterial:s_});const v=t.useRef(null);t.useImperativeHandle(n,()=>v.current,[]);const y=new ac,b=new Rs(0,1,0),x=new Rs(0,0,0);$y(e=>{y.setFromNormalAndCoplanarPoint(b,x).applyMatrix4(v.current.matrixWorld);const t=v.current.material,n=t.uniforms.worldCamProjPosition,i=t.uniforms.worldPlanePosition;y.projectPoint(e.camera.position,n.value),i.value.set(0,0,0).applyMatrix4(v.current.matrixWorld)});const _={cellSize:s,sectionSize:a,cellColor:r,sectionColor:o,cellThickness:p,sectionThickness:f},w={fadeDistance:u,fadeStrength:d,fadeFrom:h,infiniteGrid:c,followCamera:l};return t.createElement("mesh",Ob({ref:v,frustumCulled:!1},g),t.createElement("gridMaterial",Ob({transparent:!0,"extensions-derivatives":!0,side:m},_,w)),t.createElement("planeGeometry",{args:i}))});function l_(e,n,i){const r=Yy(e=>e.size),o=Yy(e=>e.viewport),s="number"===typeof e?e:r.width*o.dpr,a="number"===typeof n?n:r.height*o.dpr,l=("number"===typeof e?i:e)||{},{samples:c=0,depth:u,...d}=l,h=t.useMemo(()=>{const e=new Es(s,a,{minFilter:xi,magFilter:xi,type:Ri,...d});return u&&(e.depthTexture=new Zc(s,a,ki)),e.samples=c,e},[]);return t.useLayoutEffect(()=>{h.setSize(s,a),c&&(h.samples=c)},[c,h,s,a]),t.useEffect(()=>()=>h.dispose(),[]),h}const c_=t.forwardRef((e,n)=>{let{envMap:i,resolution:r=256,frames:o=1/0,children:s,makeDefault:a,...l}=e;const c=Yy(e=>{let{set:t}=e;return t}),u=Yy(e=>{let{camera:t}=e;return t}),d=Yy(e=>{let{size:t}=e;return t}),h=t.useRef(null);t.useImperativeHandle(n,()=>h.current,[]);const p=t.useRef(null),f=l_(r);t.useLayoutEffect(()=>{l.manual||h.current.updateProjectionMatrix()},[d,l]),t.useLayoutEffect(()=>{h.current.updateProjectionMatrix()}),t.useLayoutEffect(()=>{if(a){const e=u;return c(()=>({camera:h.current})),()=>c(()=>({camera:e}))}},[h,a,c]);let m=0,g=null;const v=(e=>"function"===typeof e)(s);return $y(e=>{v&&(o===1/0||m<o)&&(p.current.visible=!1,e.gl.setRenderTarget(f),g=e.scene.background,i&&(e.scene.background=i),e.gl.render(e.scene,h.current),e.scene.background=g,e.gl.setRenderTarget(null),p.current.visible=!0,m++)}),t.createElement(t.Fragment,null,t.createElement("orthographicCamera",Ob({left:d.width/-2,right:d.width/2,top:d.height/2,bottom:d.height/-2,ref:h},l),!v&&s),t.createElement("group",{ref:p},v&&s(f.texture)))});function u_(e){let{defaultScene:n,defaultCamera:i,renderPriority:r=1}=e;const{gl:o,scene:s,camera:a}=Yy();let l;return $y(()=>{l=o.autoClear,1===r&&(o.autoClear=!0,o.render(n,i)),o.autoClear=!1,o.clearDepth(),o.render(s,a),o.autoClear=l},r),t.createElement("group",{onPointerOver:()=>null})}function d_(e){let{children:n,renderPriority:i=1}=e;const{scene:r,camera:o}=Yy(),[s]=t.useState(()=>new Kd);return t.createElement(t.Fragment,null,lb(t.createElement(t.Fragment,null,n,t.createElement(u_,{defaultScene:r,defaultCamera:o,renderPriority:i})),s,{events:{priority:i+1}}))}const h_=t.createContext({}),p_=2*Math.PI,f_=new Na,m_=new la,[g_,v_]=[new ks,new ks],y_=new Rs,b_=new Rs,x_=e=>"getTarget"in e,__=e=>{let{alignment:n="bottom-right",margin:i=[80,80],renderPriority:r=1,onUpdate:o,onTarget:s,children:a}=e;const l=Yy(e=>e.size),c=Yy(e=>e.camera),u=Yy(e=>e.controls),d=Yy(e=>e.invalidate),h=t.useRef(null),p=t.useRef(null),f=t.useRef(!1),m=t.useRef(0),g=t.useRef(new Rs(0,0,0)),v=t.useRef(new Rs(0,0,0));t.useEffect(()=>{v.current.copy(c.up),f_.up.copy(c.up)},[c]);const y=t.useCallback(e=>{f.current=!0,(u||s)&&(g.current=(null==s?void 0:s())||(x_(u)?u.getTarget(g.current):null==u?void 0:u.target)),m.current=c.position.distanceTo(y_),g_.copy(c.quaternion),b_.copy(e).multiplyScalar(m.current).add(y_),f_.lookAt(b_),v_.copy(f_.quaternion),d()},[u,c,s,d]);$y((e,t)=>{if(p.current&&h.current){var n;if(f.current)if(g_.angleTo(v_)<.01)f.current=!1,"minPolarAngle"in u&&c.up.copy(v.current);else{const e=t*p_;g_.rotateTowards(v_,e),c.position.set(0,0,1).applyQuaternion(g_).multiplyScalar(m.current).add(g.current),c.up.set(0,1,0).applyQuaternion(g_).normalize(),c.quaternion.copy(g_),x_(u)&&u.setPosition(c.position.x,c.position.y,c.position.z),o?o():u&&u.update(t),d()}m_.copy(c.matrix).invert(),null==(n=h.current)||n.quaternion.setFromRotationMatrix(m_)}});const b=t.useMemo(()=>({tweenCamera:y}),[y]),[x,_]=i,w=n.endsWith("-center")?0:n.endsWith("-left")?-l.width/2+x:l.width/2-x,S=n.startsWith("center-")?0:n.startsWith("top-")?l.height/2-_:-l.height/2+_;return t.createElement(d_,{renderPriority:r},t.createElement(h_.Provider,{value:b},t.createElement(c_,{makeDefault:!0,ref:p,position:[0,0,200]}),t.createElement("group",{ref:h,position:[w,S,0]},a)))};function w_(e){let{scale:n=[.8,.05,.05],color:i,rotation:r}=e;return t.createElement("group",{rotation:r},t.createElement("mesh",{position:[.4,0,0]},t.createElement("boxGeometry",{args:n}),t.createElement("meshBasicMaterial",{color:i,toneMapped:!1})))}function S_(e){let{onClick:n,font:i,disabled:r,arcStyle:o,label:s,labelColor:a,axisHeadScale:l=1,...c}=e;const u=Yy(e=>e.gl),d=t.useMemo(()=>{const e=document.createElement("canvas");e.width=64,e.height=64;const t=e.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=o,t.fill(),s&&(t.font=i,t.textAlign="center",t.fillStyle=a,t.fillText(s,32,41)),new Dp(e)},[o,s,a,i]),[h,p]=t.useState(!1),f=(s?1:.75)*(h?1.2:1)*l;return t.createElement("sprite",Ob({scale:f,onPointerOver:r?void 0:e=>{e.stopPropagation(),p(!0)},onPointerOut:r?void 0:n||(e=>{e.stopPropagation(),p(!1)})},c),t.createElement("spriteMaterial",{map:d,"map-anisotropy":u.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const M_=e=>{let{hideNegativeAxes:n,hideAxisHeads:i,disabled:r,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:l,labels:c=["X","Y","Z"],labelColor:u="#000",onClick:d,...h}=e;const[p,f,m]=s,{tweenCamera:g}=t.useContext(h_),v={font:o,disabled:r,labelColor:u,onClick:d,axisHeadScale:a,onPointerDown:r?void 0:e=>{g(e.object.position),e.stopPropagation()}};return t.createElement("group",Ob({scale:40},h),t.createElement(w_,{color:p,rotation:[0,0,0],scale:l}),t.createElement(w_,{color:f,rotation:[0,0,Math.PI/2],scale:l}),t.createElement(w_,{color:m,rotation:[0,-Math.PI/2,0],scale:l}),!i&&t.createElement(t.Fragment,null,t.createElement(S_,Ob({arcStyle:p,position:[1,0,0],label:c[0]},v)),t.createElement(S_,Ob({arcStyle:f,position:[0,1,0],label:c[1]},v)),t.createElement(S_,Ob({arcStyle:m,position:[0,0,1],label:c[2]},v)),!n&&t.createElement(t.Fragment,null,t.createElement(S_,Ob({arcStyle:p,position:[-1,0,0]},v)),t.createElement(S_,Ob({arcStyle:f,position:[0,-1,0]},v)),t.createElement(S_,Ob({arcStyle:m,position:[0,0,-1]},v)))))},E_=e=>{let t;const n=new Set,i=(e,i)=>{const r="function"===typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=i?i:"object"!==typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,o={setState:i,getState:r,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},s=t=e(i,r,o);return o},C_=e=>e?E_(e):E_;var T_=n(443);const{useDebugValue:A_}=t,{useSyncExternalStoreWithSelector:P_}=T_;let D_=!1;const k_=e=>e;const R_=e=>{"function"!==typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"===typeof e?C_(e):e,n=(e,n)=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k_,n=arguments.length>2?arguments[2]:void 0;n&&!D_&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),D_=!0);const i=P_(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return A_(i),i}(t,e,n);return Object.assign(n,t),n},N_=e=>e?R_(e):R_;const I_=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ws://localhost:8000/ws";this.ws=null,this.url=void 0,this.reconnectInterval=5e3,this.shouldReconnect=!0,this.messageHandlers=new Map,this.connectionStatusCallback=void 0,this.url=e}setUrl(e){this.url=e}connect(){return new Promise((e,t)=>{try{var n;null===(n=this.connectionStatusCallback)||void 0===n||n.call(this,"connecting"),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{var t;null===(t=this.connectionStatusCallback)||void 0===t||t.call(this,"connected"),e()},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(Pb){console.error("Failed to parse WebSocket message:",Pb)}},this.ws.onerror=e=>{t(e)},this.ws.onclose=()=>{var e;null===(e=this.connectionStatusCallback)||void 0===e||e.call(this,"disconnected"),this.shouldReconnect&&setTimeout(()=>{this.connect().catch(()=>{})},this.reconnectInterval)}}catch(Pb){t(Pb)}})}disconnect(){this.shouldReconnect=!1,this.ws&&(this.ws.close(),this.ws=null)}handleMessage(e){const t=this.messageHandlers.get(e.type);t?t(e):console.warn("No handler for message type:",e.type)}on(e,t){this.messageHandlers.set(e,t)}off(e,t){this.messageHandlers.delete(e)}onConnectionStatus(e){this.connectionStatusCallback=e}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}_eulerToQuaternion(e){const t=(new ks).setFromEuler(e);return[t.x,t.y,t.z,t.w]}updateTransform(e,t){const n={position:t.position?Array.isArray(t.position)?t.position:[t.position.x,t.position.y,t.position.z]:void 0,rotation:t.rotation?Array.isArray(t.rotation)?t.rotation:this._eulerToQuaternion(t.rotation):void 0,scale:t.scale?Array.isArray(t.scale)?t.scale:[t.scale.x,t.scale.y,t.scale.z]:void 0};Object.keys(n).forEach(e=>{void 0===n[e]&&delete n[e]}),this.send({type:"update_transform",object_id:e,transform:n})}updateMaterial(e,t){this.send({type:"update_material",object_id:e,material:t})}updateObjectName(e,t){this.send({type:"update_name",object_id:e,name:t})}updateObjectTag(e,t){this.send({type:"update_tag",object_id:e,tag:t})}updateVisibility(e,t){this.send({type:"update_visibility",object_id:e,visible:t})}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}requestTraceData(){this.send({type:"get_trace"})}updateParent(e,t){this.send({type:"update_parent",object_id:e,parent_id:t})}duplicateObject(e){this.send({type:"duplicate_object",object_id:e})}updateComponent(e,t,n,i){this.send({type:"update_component",object_id:e,component_name:t,field_name:n,value:i})}addComponent(e,t){this.send({type:"add_component",object_id:e,component_name:t})}removeComponent(e,t){this.send({type:"remove_component",object_id:e,component_name:t})}clickComponentButton(e,t,n){this.send({type:"click_component_button",object_id:e,component_name:t,button_name:n})}getComponents(e){this.send({type:"get_components",object_id:e})}getComponentDefinitions(){this.send({type:"get_component_definitions"})}createObject(e){const t={...e,transform:{position:e.transform.position instanceof Array?e.transform.position:e.transform.position.toArray(),rotation:e.transform.rotation instanceof Array?e.transform.rotation:this._eulerToQuaternion(e.transform.rotation),scale:e.transform.scale instanceof Array?e.transform.scale:e.transform.scale.toArray()}};this.send({type:"create_object",object:t})}deleteObject(e){this.send({type:"delete_object",object_id:e})}compileNodeGraph(e,t){this.send({type:"compile_node_graph",nodes:e,edges:t})}updateNodeEditor(e,t,n,i){const r={type:"update_node_editor"};void 0!==e&&(r.nodes=e),void 0!==t&&(r.edges=t),void 0!==n&&(r.parameters=n),void 0!==i&&(r.differentiableParams=i),this.send(r)}requestNodeEditorState(){this.send({type:"get_node_editor"})}},L_=N_((e,t)=>({past:[],future:[],maxHistorySize:100,isUndoing:!1,isRedoing:!1,pushAction:n=>{const i=t();i.isUndoing||i.isRedoing?console.log("[History] Skipping push - currently undoing/redoing"):(console.log("[History] Pushing action:",n),e(e=>({past:[...e.past.slice(1-e.maxHistorySize),n],future:[]})))},undo:()=>{const n=t();if(0===n.past.length)return null;const i=n.past[n.past.length-1];return e(e=>({past:e.past.slice(0,-1),future:[i,...e.future]})),i},redo:()=>{const n=t();if(0===n.future.length)return null;const i=n.future[0];return e(e=>({past:[...e.past,i],future:e.future.slice(1)})),i},canUndo:()=>t().past.length>0,canRedo:()=>t().future.length>0,clearHistory:()=>e({past:[],future:[]}),setUndoing:t=>e({isUndoing:t}),setRedoing:t=>e({isRedoing:t})})),O_=N_((e,t)=>({copiedObject:null,copyObject:t=>{const n={...t,transform:{position:t.transform.position instanceof Rs?t.transform.position.toArray():t.transform.position,rotation:t.transform.rotation instanceof ya?t.transform.rotation.toArray():t.transform.rotation,scale:t.transform.scale instanceof Rs?t.transform.scale.toArray():t.transform.scale}},i=JSON.parse(JSON.stringify(n));e({copiedObject:i})},getCopiedObject:()=>t().copiedObject,clearClipboard:()=>e({copiedObject:null})})),z_=N_(e=>({objects:{},selectedObjectId:null,hoveredObjectId:null,transformMode:"translate",transformSpace:"world",showObjectNames:!1,traceData:null,pendingSelectId:null,resultsData:null,resultsVersion:0,resultsHistory:[],consoleMessages:[],consoleMessageIdCounter:0,selectObject:t=>e({selectedObjectId:t}),hoverObject:t=>e({hoveredObjectId:t}),updateObjectTransform:(t,n)=>e(e=>{const i=e.objects[t];return i?{objects:{...e.objects,[t]:{...i,transform:{...i.transform,...n}}}}:e}),updateObjectMaterial:(t,n)=>e(e=>{const i=e.objects[t];return i&&i.material?{objects:{...e.objects,[t]:{...i,material:{...i.material,...n}}}}:e}),setTransformMode:t=>e({transformMode:t}),setTransformSpace:t=>e({transformSpace:t}),addObject:t=>e(e=>{const n=L_.getState();n.isUndoing||n.isRedoing||n.pushAction({type:"create_object",object:t});const i=e.pendingSelectId===t.id;return{objects:{...e.objects,[t.id]:t},selectedObjectId:i?t.id:e.selectedObjectId,pendingSelectId:i?null:e.pendingSelectId}}),removeObject:t=>e(e=>{const n=e.objects[t];if(!n)return e;const i=t=>{const n=[];return Object.values(e.objects).forEach(e=>{e.parent_id===t&&(n.push(e),n.push(...i(e.id)))}),n},r=i(t),o=L_.getState();o.isUndoing||o.isRedoing||o.pushAction({type:"delete_object",object:n,children:r});const{[t]:s,...a}=e.objects;return{objects:a,selectedObjectId:e.selectedObjectId===t?null:e.selectedObjectId}}),toggleObjectVisibility:t=>e(e=>{const n=e.objects[t];if(!n)return e;const i=L_.getState();return i.isUndoing||i.isRedoing||i.pushAction({type:"update_visibility",objectId:t,oldVisible:n.visible,newVisible:!n.visible}),{objects:{...e.objects,[t]:{...n,visible:!n.visible}}}}),setObjects:t=>e({objects:t}),setObjectVisibility:(t,n)=>e(e=>{const i=e.objects[t];return i?{objects:{...e.objects,[t]:{...i,visible:n}}}:e}),toggleShowObjectNames:()=>e(e=>({showObjectNames:!e.showObjectNames})),setTraceData:t=>e({traceData:t}),setResultsData:(t,n,i,r,o)=>e(e=>{const s=e.resultsHistory.find(e=>e.version===n);if(s)return console.log(`[EditorStore] Version ${n} already exists, skipping`),e;const a={version:n,message:i||`v${n}`,plots:t,timestamp:new Date,...r&&{tag:r},...o&&{tagColor:o}};return{resultsData:t,resultsVersion:n,resultsHistory:[...e.resultsHistory,a]}}),setResultsHistory:t=>e(e=>{const n=t.map(e=>({version:e.version,message:e.message||`v${e.version}`,plots:e.plots,timestamp:new Date(e.timestamp),...e.tag&&{tag:e.tag},...e.tag_color&&{tagColor:e.tag_color}})),i=n.length>0?n[n.length-1]:null;return{resultsHistory:n,resultsData:(null===i||void 0===i?void 0:i.plots)||e.resultsData,resultsVersion:(null===i||void 0===i?void 0:i.version)||e.resultsVersion}}),deleteResultsVersion:t=>e(e=>{const n=e.resultsHistory.filter(e=>e.version!==t);let i=e.resultsData,r=e.resultsVersion;if(e.resultsVersion===t&&n.length>0){const e=n[n.length-1];i=e.plots,r=e.version}else 0===n.length&&(i=null,r=0);return{resultsHistory:n,resultsData:i,resultsVersion:r}}),addConsoleMessage:t=>e(e=>{const{id:n,...i}=t,r={id:e.consoleMessageIdCounter,...i};return{consoleMessages:[...e.consoleMessages,r],consoleMessageIdCounter:e.consoleMessageIdCounter+1}}),setConsoleMessages:t=>e(e=>{const n=t.map((t,n)=>{const{id:i,...r}=t;return{...r,id:e.consoleMessageIdCounter+n}});return{consoleMessages:n,consoleMessageIdCounter:e.consoleMessageIdCounter+t.length}}),clearConsoleMessages:()=>e({consoleMessages:[]}),updateObjectParent:(t,n)=>e(e=>{const i=e.objects[t];return i?{objects:{...e.objects,[t]:{...i,parent_id:n}}}:e}),updateObject:t=>e(e=>({objects:{...e.objects,[t.id]:t}})),duplicateObject:e=>{I_.duplicateObject(e)},deleteSelectedObjects:()=>{const e=z_.getState();e.selectedObjectId&&I_.deleteObject(e.selectedObjectId)},getObjectChildren:e=>{const t=z_.getState();return Object.keys(t.objects).filter(n=>t.objects[n].parent_id===e)},getObjectHierarchy:()=>{const e=z_.getState(),t=[],n=new Map;Object.values(e.objects).forEach(e=>{e.parent_id?(n.has(e.parent_id)||n.set(e.parent_id,[]),n.get(e.parent_id).push(e.id)):t.push(e.id)});const i=t=>{const r=e.objects[t],o=n.get(t)||[];return{id:r.id,name:r.name,visible:r.visible,children:o.map(e=>i(e))}};return t.map(e=>i(e))},undo:()=>{const e=L_.getState(),t=e.undo();if(console.log("[Undo] Attempting undo, action:",t),!t)return void console.log("[Undo] No action to undo");e.setUndoing(!0);const n=e=>{switch(console.log("[Undo] Processing action:",e.type,e),e.type){case"create_object":I_.deleteObject(e.object.id);break;case"delete_object":I_.createObject(e.object),e.children.forEach(e=>{I_.createObject(e)});break;case"update_transform":console.log("[Undo] Reverting transform to:",e.oldTransform);const t=z_.getState();t.objects[e.objectId]&&t.updateObjectTransform(e.objectId,{position:new Rs(...e.oldTransform.position),rotation:new ya(e.oldTransform.rotation[0],e.oldTransform.rotation[1],e.oldTransform.rotation[2],"YXZ"),scale:new Rs(...e.oldTransform.scale)}),I_.updateTransform(e.objectId,e.oldTransform);break;case"update_material":z_.getState().updateObjectMaterial(e.objectId,e.oldMaterial),I_.updateMaterial(e.objectId,e.oldMaterial);break;case"update_parent":I_.updateParent(e.objectId,e.oldParentId);break;case"update_visibility":I_.updateVisibility(e.objectId,e.oldVisible);break;case"batch":e.actions.reverse().forEach(n)}};n(t),setTimeout(()=>{e.setUndoing(!1)},100)},redo:()=>{const e=L_.getState(),t=e.redo();if(!t)return;e.setRedoing(!0);const n=e=>{switch(e.type){case"create_object":I_.createObject(e.object);break;case"delete_object":I_.deleteObject(e.object.id);break;case"update_transform":const t=z_.getState();t.objects[e.objectId]&&t.updateObjectTransform(e.objectId,{position:new Rs(...e.newTransform.position),rotation:new ya(e.newTransform.rotation[0],e.newTransform.rotation[1],e.newTransform.rotation[2],"YXZ"),scale:new Rs(...e.newTransform.scale)}),I_.updateTransform(e.objectId,e.newTransform);break;case"update_material":z_.getState().updateObjectMaterial(e.objectId,e.newMaterial),I_.updateMaterial(e.objectId,e.newMaterial);break;case"update_parent":I_.updateParent(e.objectId,e.newParentId);break;case"update_visibility":I_.updateVisibility(e.objectId,e.newVisible);break;case"batch":e.actions.forEach(n)}};n(t),setTimeout(()=>{e.setRedoing(!1)},100)},copySelectedObject:()=>{const e=z_.getState(),t=O_.getState();if(e.selectedObjectId){const n=e.objects[e.selectedObjectId];n&&t.copyObject(n)}},pasteObject:()=>{const t=O_.getState().getCopiedObject();if(t){var n;const i=`${(null===(n=t.mesh)||void 0===n?void 0:n.toLowerCase())||"object"}-${Date.now()}`,r=Array.isArray(t.transform.position)?t.transform.position:[t.transform.position.x,t.transform.position.y,t.transform.position.z],o=Array.isArray(t.transform.rotation)?t.transform.rotation:[t.transform.rotation.x,t.transform.rotation.y,t.transform.rotation.z],s=Array.isArray(t.transform.scale)?t.transform.scale:[t.transform.scale.x,t.transform.scale.y,t.transform.scale.z],a={...t,id:i,name:`${t.name} (Copy)`,transform:{position:new Rs(r[0],r[1],r[2]),rotation:new ya(o[0],o[1],o[2],"YXZ"),scale:new Rs(s[0],s[1],s[2])},parent_id:null};I_.createObject(a),e({pendingSelectId:i})}}}));var U_=Object.defineProperty,F_=(e,t,n)=>(((e,t,n)=>{t in e?U_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class j_ extends Na{constructor(e,t){super(),F_(this,"isTransformControls",!0),F_(this,"visible",!1),F_(this,"domElement"),F_(this,"raycaster",new nv),F_(this,"gizmo"),F_(this,"plane"),F_(this,"tempVector",new Rs),F_(this,"tempVector2",new Rs),F_(this,"tempQuaternion",new ks),F_(this,"unit",{X:new Rs(1,0,0),Y:new Rs(0,1,0),Z:new Rs(0,0,1)}),F_(this,"pointStart",new Rs),F_(this,"pointEnd",new Rs),F_(this,"offset",new Rs),F_(this,"rotationAxis",new Rs),F_(this,"startNorm",new Rs),F_(this,"endNorm",new Rs),F_(this,"rotationAngle",0),F_(this,"cameraPosition",new Rs),F_(this,"cameraQuaternion",new ks),F_(this,"cameraScale",new Rs),F_(this,"parentPosition",new Rs),F_(this,"parentQuaternion",new ks),F_(this,"parentQuaternionInv",new ks),F_(this,"parentScale",new Rs),F_(this,"worldPositionStart",new Rs),F_(this,"worldQuaternionStart",new ks),F_(this,"worldScaleStart",new Rs),F_(this,"worldPosition",new Rs),F_(this,"worldQuaternion",new ks),F_(this,"worldQuaternionInv",new ks),F_(this,"worldScale",new Rs),F_(this,"eye",new Rs),F_(this,"positionStart",new Rs),F_(this,"quaternionStart",new ks),F_(this,"scaleStart",new Rs),F_(this,"camera"),F_(this,"object"),F_(this,"enabled",!0),F_(this,"axis",null),F_(this,"mode","translate"),F_(this,"translationSnap",null),F_(this,"rotationSnap",null),F_(this,"scaleSnap",null),F_(this,"space","world"),F_(this,"size",1),F_(this,"dragging",!1),F_(this,"showX",!0),F_(this,"showY",!0),F_(this,"showZ",!0),F_(this,"changeEvent",{type:"change"}),F_(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),F_(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),F_(this,"objectChangeEvent",{type:"objectChange"}),F_(this,"intersectObjectWithRay",(e,t,n)=>{const i=t.intersectObject(e,!0);for(let r=0;r<i.length;r++)if(i[r].object.visible||n)return i[r];return!1}),F_(this,"attach",e=>(this.object=e,this.visible=!0,this)),F_(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),F_(this,"reset",()=>this.enabled?(this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),F_(this,"updateMatrixWorld",()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),F_(this,"pointerHover",e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);this.axis=t?t.object.name:null}),F_(this,"pointerDown",e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),F_(this,"pointerMove",e=>{const t=this.axis,n=this.mode,i=this.object;let r=this.space;if("scale"===n?r="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(r="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);const o=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),"translate"===n)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===r&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===r&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),i.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===r&&(i.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this.quaternionStart)),"world"===r&&(i.parent&&i.position.add(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);i.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this.offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===r&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===r&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this.quaternionStart),i.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),i.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),F_(this,"pointerUp",e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),F_(this,"getPointer",e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{const t=e.changedTouches?e.changedTouches[0]:e,n=this.domElement.getBoundingClientRect();return{x:(t.clientX-n.left)/n.width*2-1,y:-(t.clientY-n.top)/n.height*2+1,button:e.button}}}),F_(this,"onPointerHover",e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}}),F_(this,"onPointerDown",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))}),F_(this,"onPointerMove",e=>{this.enabled&&this.pointerMove(this.getPointer(e))}),F_(this,"onPointerUp",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))}),F_(this,"getMode",()=>this.mode),F_(this,"setMode",e=>{this.mode=e}),F_(this,"setTranslationSnap",e=>{this.translationSnap=e}),F_(this,"setRotationSnap",e=>{this.rotationSnap=e}),F_(this,"setScaleSnap",e=>{this.scaleSnap=e}),F_(this,"setSize",e=>{this.size=e}),F_(this,"setSpace",e=>{this.space=e}),F_(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),F_(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),F_(this,"dispose",()=>{var e,t,n,i,r,o;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(i=null==(n=this.domElement)?void 0:n.ownerDocument)||i.removeEventListener("pointermove",this.onPointerMove),null==(o=null==(r=this.domElement)?void 0:r.ownerDocument)||o.removeEventListener("pointerup",this.onPointerUp),this.traverse(e=>{const t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new B_,this.add(this.gizmo),this.plane=new V_,this.add(this.plane);const n=(e,t)=>{let n=t;Object.defineProperty(this,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),void 0!==t&&this.connect(t)}}class B_ extends Na{constructor(){super(),F_(this,"isTransformControlsGizmo",!0),F_(this,"type","TransformControlsGizmo"),F_(this,"tempVector",new Rs(0,0,0)),F_(this,"tempEuler",new ya),F_(this,"alignVector",new Rs(0,1,0)),F_(this,"zeroVector",new Rs(0,0,0)),F_(this,"lookAtMatrix",new la),F_(this,"tempQuaternion",new ks),F_(this,"tempQuaternion2",new ks),F_(this,"identityQuaternion",new ks),F_(this,"unitX",new Rs(1,0,0)),F_(this,"unitY",new Rs(0,1,0)),F_(this,"unitZ",new Rs(0,0,1)),F_(this,"gizmo"),F_(this,"picker"),F_(this,"helper"),F_(this,"rotationAxis",new Rs),F_(this,"cameraPosition",new Rs),F_(this,"worldPositionStart",new Rs),F_(this,"worldQuaternionStart",new ks),F_(this,"worldPosition",new Rs),F_(this,"worldQuaternion",new ks),F_(this,"eye",new Rs),F_(this,"camera",null),F_(this,"enabled",!0),F_(this,"axis",null),F_(this,"mode","translate"),F_(this,"space","world"),F_(this,"size",1),F_(this,"dragging",!1),F_(this,"showX",!0),F_(this,"showY",!0),F_(this,"showZ",!0),F_(this,"updateMatrixWorld",()=>{let e=this.space;"scale"===this.mode&&(e="local");const t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const e=n[i];let r;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),r=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(r*this.size/7),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const n=.99,i=.2,r=0;"X"!==e.name&&"XYZX"!==e.name||Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"!==e.name&&"XYZY"!==e.name||Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"!==e.name&&"XYZZ"!==e.name||Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),-1!==e.name.search("X")&&(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)<r?"fwd"===e.tag?e.visible=!1:e.scale.x*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Y")&&(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)<r?"fwd"===e.tag?e.visible=!1:e.scale.y*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Z")&&(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)<r?"fwd"===e.tag?e.visible=!1:e.scale.z*=-1:"bwd"===e.tag&&(e.visible=!1))}else"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)),"Y"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)),"Z"===e.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),e.quaternion.copy(this.tempQuaternion)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material.tempOpacity=e.material.tempOpacity||e.material.opacity,e.material.tempColor=e.material.tempColor||e.material.color.clone(),e.material.color.copy(e.material.tempColor),e.material.opacity=e.material.tempOpacity,this.enabled?this.axis&&(e.name===this.axis||this.axis.split("").some(function(t){return e.name===t})?(e.material.opacity=1,e.material.color.lerp(new Za(1,1,1),.5)):(e.material.opacity*=.25,e.material.color.lerp(new Za(1,1,1),.5))):(e.material.opacity*=.5,e.material.color.lerp(new Za(1,1,1),.5))}else e.visible=!1,"AXIS"===e.name?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),e.quaternion.multiply(this.tempQuaternion),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(this.tempVector),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld()});const e=new el({depthTest:!1,depthWrite:!1,transparent:!0,side:hn,fog:!1,toneMapped:!1}),t=new ap({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const i=e.clone();i.opacity=.33;const r=e.clone();r.color.set(16711680);const o=e.clone();o.color.set(65280);const s=e.clone();s.color.set(255);const a=e.clone();a.opacity=.25;const l=a.clone();l.color.set(16776960);const c=a.clone();c.color.set(65535);const u=a.clone();u.color.set(16711935);e.clone().color.set(16776960);const d=t.clone();d.color.set(16711680);const h=t.clone();h.color.set(65280);const p=t.clone();p.color.set(255);const f=t.clone();f.color.set(65535);const m=t.clone();m.color.set(16711935);const g=t.clone();g.color.set(16776960);const v=t.clone();v.color.set(7895160);const y=g.clone();y.opacity=.25;const b=new nf(0,.05,.2,12,1,!1),x=new Xl(.125,.125,.125),_=new Cl;_.setAttribute("position",new vl([0,0,0,1,0,0],3));const w=(e,t)=>{const n=new Cl,i=[];for(let r=0;r<=64*t;++r)i.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return n.setAttribute("position",new vl(i,3)),n},S={X:[[new Gl(b,r),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new Gl(b,r),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new pp(_,d)]],Y:[[new Gl(b,o),[0,1,0],null,null,"fwd"],[new Gl(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new pp(_,h),null,[0,0,Math.PI/2]]],Z:[[new Gl(b,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new Gl(b,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new pp(_,p),null,[0,-Math.PI/2,0]]],XYZ:[[new Gl(new Gf(.1,0),a.clone()),[0,0,0],[0,0,0]]],XY:[[new Gl(new pc(.295,.295),l.clone()),[.15,.15,0]],[new pp(_,g),[.18,.3,0],null,[.125,1,1]],[new pp(_,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Gl(new pc(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new pp(_,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new pp(_,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Gl(new pc(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new pp(_,m),[.18,0,.3],null,[.125,1,1]],[new pp(_,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},M={X:[[new Gl(new nf(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Gl(new nf(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new Gl(new nf(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Gl(new Gf(.2,0),n)]],XY:[[new Gl(new pc(.4,.4),n),[.2,.2,0]]],YZ:[[new Gl(new pc(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Gl(new pc(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},E={START:[[new Gl(new Gf(.01,2),i),null,null,null,"helper"]],END:[[new Gl(new Gf(.01,2),i),null,null,null,"helper"]],DELTA:[[new pp((()=>{const e=new Cl;return e.setAttribute("position",new vl([0,0,0,1,1,1],3)),e})(),i),null,null,null,"helper"]],X:[[new pp(_,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new pp(_,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new pp(_,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={X:[[new pp(w(1,.5),d)],[new Gl(new Gf(.04,0),r),[0,0,.99],null,[1,3,1]]],Y:[[new pp(w(1,.5),h),null,[0,0,-Math.PI/2]],[new Gl(new Gf(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new pp(w(1,.5),p),null,[0,Math.PI/2,0]],[new Gl(new Gf(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new pp(w(1.25,1),y),null,[0,Math.PI/2,0]],[new Gl(new nf(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new Gl(new nf(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new Gl(new nf(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new Gl(new nf(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new pp(w(1,1),v),null,[0,Math.PI/2,0]]]},T={AXIS:[[new pp(_,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},A={X:[[new Gl(new qf(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Gl(new qf(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Gl(new qf(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Gl(new qf(1.25,.1,2,24),n)]],XYZE:[[new Gl(new Yf(.7,10,8),n)]]},P={X:[[new Gl(x,r),[.8,0,0],[0,0,-Math.PI/2]],[new pp(_,d),null,null,[.8,1,1]]],Y:[[new Gl(x,o),[0,.8,0]],[new pp(_,h),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new Gl(x,s),[0,0,.8],[Math.PI/2,0,0]],[new pp(_,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new Gl(x,l),[.85,.85,0],null,[2,2,.2]],[new pp(_,g),[.855,.98,0],null,[.125,1,1]],[new pp(_,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Gl(x,c),[0,.85,.85],null,[.2,2,2]],[new pp(_,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new pp(_,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Gl(x,u),[.85,0,.85],null,[2,.2,2]],[new pp(_,m),[.855,0,.98],null,[.125,1,1]],[new pp(_,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new Gl(new Xl(.125,.125,.125),a.clone()),[1.1,0,0]]],XYZY:[[new Gl(new Xl(.125,.125,.125),a.clone()),[0,1.1,0]]],XYZZ:[[new Gl(new Xl(.125,.125,.125),a.clone()),[0,0,1.1]]]},D={X:[[new Gl(new nf(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new Gl(new nf(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new Gl(new nf(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new Gl(x,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new Gl(x,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new Gl(x,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new Gl(new Xl(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new Gl(new Xl(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new Gl(new Xl(.2,.2,.2),n),[0,0,1.1]]]},k={X:[[new pp(_,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new pp(_,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new pp(_,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R=e=>{const t=new Na;for(let n in e)for(let i=e[n].length;i--;){const r=e[n][i][0].clone(),o=e[n][i][1],s=e[n][i][2],a=e[n][i][3],l=e[n][i][4];r.name=n,r.tag=l,o&&r.position.set(o[0],o[1],o[2]),s&&r.rotation.set(s[0],s[1],s[2]),a&&r.scale.set(a[0],a[1],a[2]),r.updateMatrix();const c=r.geometry.clone();c.applyMatrix4(r.matrix),r.geometry=c,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=R(S)),this.add(this.gizmo.rotate=R(C)),this.add(this.gizmo.scale=R(P)),this.add(this.picker.translate=R(M)),this.add(this.picker.rotate=R(A)),this.add(this.picker.scale=R(D)),this.add(this.helper.translate=R(E)),this.add(this.helper.rotate=R(T)),this.add(this.helper.scale=R(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class V_ extends Gl{constructor(){super(new pc(1e5,1e5,2,2),new el({visible:!1,wireframe:!0,side:hn,transparent:!0,opacity:.1,toneMapped:!1})),F_(this,"isTransformControlsPlane",!0),F_(this,"type","TransformControlsPlane"),F_(this,"unitX",new Rs(1,0,0)),F_(this,"unitY",new Rs(0,1,0)),F_(this,"unitZ",new Rs(0,0,1)),F_(this,"tempVector",new Rs),F_(this,"dirVector",new Rs),F_(this,"alignVector",new Rs),F_(this,"tempMatrix",new la),F_(this,"identityQuaternion",new ks),F_(this,"cameraQuaternion",new ks),F_(this,"worldPosition",new Rs),F_(this,"worldQuaternion",new ks),F_(this,"eye",new Rs),F_(this,"axis",null),F_(this,"mode","translate"),F_(this,"space","world"),F_(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}const H_=t.forwardRef((e,n)=>{let{children:i,domElement:r,onChange:o,onMouseDown:s,onMouseUp:a,onObjectChange:l,object:c,makeDefault:u,camera:d,enabled:h,axis:p,mode:f,translationSnap:m,rotationSnap:g,scaleSnap:v,space:y,size:b,showX:x,showY:_,showZ:w,...S}=e;const M=Yy(e=>e.controls),E=Yy(e=>e.gl),C=Yy(e=>e.events),T=Yy(e=>e.camera),A=Yy(e=>e.invalidate),P=Yy(e=>e.get),D=Yy(e=>e.set),k=d||T,R=r||C.connected||E.domElement,N=t.useMemo(()=>new j_(k,R),[k,R]),I=t.useRef(null);t.useLayoutEffect(()=>(c?N.attach(c instanceof Na?c:c.current):I.current instanceof Na&&N.attach(I.current),()=>{N.detach()}),[c,i,N]),t.useEffect(()=>{if(M){const e=e=>M.enabled=!e.value;return N.addEventListener("dragging-changed",e),()=>N.removeEventListener("dragging-changed",e)}},[N,M]);const L=t.useRef(),O=t.useRef(),z=t.useRef(),U=t.useRef();return t.useLayoutEffect(()=>{L.current=o},[o]),t.useLayoutEffect(()=>{O.current=s},[s]),t.useLayoutEffect(()=>{z.current=a},[a]),t.useLayoutEffect(()=>{U.current=l},[l]),t.useEffect(()=>{const e=e=>{A(),null==L.current||L.current(e)},t=e=>null==O.current?void 0:O.current(e),n=e=>null==z.current?void 0:z.current(e),i=e=>null==U.current?void 0:U.current(e);return N.addEventListener("change",e),N.addEventListener("mouseDown",t),N.addEventListener("mouseUp",n),N.addEventListener("objectChange",i),()=>{N.removeEventListener("change",e),N.removeEventListener("mouseDown",t),N.removeEventListener("mouseUp",n),N.removeEventListener("objectChange",i)}},[A,N]),t.useEffect(()=>{if(u){const e=P().controls;return D({controls:N}),()=>D({controls:e})}},[u,N]),t.createElement(t.Fragment,null,t.createElement("primitive",{ref:n,object:N,enabled:h,axis:p,mode:f,translationSnap:m,rotationSnap:g,scaleSnap:v,space:y,size:b,showX:x,showY:_,showZ:w}),t.createElement("group",Ob({ref:I},S),i))}),G_=[],W_=[];let X_=null;const Y_=e=>{J_.getState().isConnected&&(X_&&clearTimeout(X_),X_=setTimeout(()=>{const e=$_.getState(),t=Array.from(e.differentiableParams);I_.updateNodeEditor(e.nodes,e.edges,e.parameters,t)},500))},$_=N_((e,t)=>({nodes:[],edges:[],parameters:[],differentiableParams:new Set,isSyncing:!1,hasReceivedInitialState:!1,nodeDefinitions:[],setNodes:t=>{e(e=>{const n="function"===typeof t?t(e.nodes):t;return e.isSyncing||Y_(),{nodes:n}})},setEdges:t=>{e(e=>{const n="function"===typeof t?t(e.edges):t;return e.isSyncing||Y_(),{edges:n}})},setParameters:t=>{e(e=>{const n="function"===typeof t?t(e.parameters):t;return e.isSyncing||Y_(),{parameters:n}})},setDifferentiableParams:t=>{e(e=>{const n="function"===typeof t?t(e.differentiableParams):t;return e.isSyncing||Y_(),{differentiableParams:n}})},setNodesFromSync:t=>{e({nodes:t,isSyncing:!0}),setTimeout(()=>e({isSyncing:!1}),100)},setEdgesFromSync:t=>{e({edges:t,isSyncing:!0}),setTimeout(()=>e({isSyncing:!1}),100)},setParametersFromSync:t=>{e({parameters:t,isSyncing:!0}),setTimeout(()=>e({isSyncing:!1}),100)},setDifferentiableParamsFromSync:t=>{e({differentiableParams:t,isSyncing:!0}),setTimeout(()=>e({isSyncing:!1}),100)},setInitialStateFromBackend:n=>{n.nodes&&n.nodes.length>0||n.edges&&n.edges.length>0||n.parameters&&n.parameters.length>0?e({nodes:n.nodes||[],edges:n.edges||[],parameters:n.parameters||[],differentiableParams:new Set(n.differentiableParams||[]),hasReceivedInitialState:!0,isSyncing:!0}):t().hasReceivedInitialState||e({nodes:G_,edges:W_,parameters:[],differentiableParams:new Set,hasReceivedInitialState:!0,isSyncing:!1}),setTimeout(()=>e({isSyncing:!1}),100)},resetEditor:()=>e({nodes:[],edges:[],parameters:[],differentiableParams:new Set,hasReceivedInitialState:!1}),setNodeDefinitions:t=>{e({nodeDefinitions:t})}})),q_=e=>new Rs(e[0],e[1],e[2]),Z_=e=>(new ya).setFromQuaternion(new ks(e[0],e[1],e[2],e[3]),"YXZ"),K_=e=>{let t="mesh";"Transmitter"===e.mesh?t="transmitter":"Receiver"===e.mesh&&(t="receiver"),console.log("rotation pre:",e.transform.rotation,"post:",Z_(e.transform.rotation));let n=e.material?{color:e.material.color,metalness:e.material.metalness||.5,roughness:e.material.roughness||.5}:void 0;if(e.components&&Array.isArray(e.components)){const t=e.components.find(e=>"Material"===e.name);var i,r;if(t&&t.values)n={color:t.values.color||"#808080",metalness:null!==(i=t.values.metalness)&&void 0!==i?i:.5,roughness:null!==(r=t.values.roughness)&&void 0!==r?r:.5}}return{id:e.id,name:e.name,tag:e.tag||"",type:t,mesh:e.mesh,transform:{position:q_(e.transform.position),rotation:Z_(e.transform.rotation),scale:q_(e.transform.scale)},material:n,visible:void 0===e.visible||e.visible,parent_id:e.parent_id,model_path:e.model_path,meshData:e.mesh_data?{vertices:e.mesh_data.vertices,faces:e.mesh_data.faces,center:e.mesh_data.center}:void 0,components:e.components||[]}},J_=N_((e,t)=>({isConnected:!1,connectionStatus:"disconnected",serverUrl:"ws://localhost:8000/ws",wsService:I_,connect:async n=>{const i=t();if("connecting"===i.connectionStatus||"connected"===i.connectionStatus)return void console.log("[WebSocketStore] Already connecting or connected, skipping...");e({connectionStatus:"connecting"});const r=z_.getState();console.log("[WebSocketStore] Connect called, clearing handlers..."),r.setTraceData(null),r.setResultsHistory([]),r.clearConsoleMessages();$_.getState().resetEditor(),n&&(I_.setUrl(n),e({serverUrl:n})),I_.messageHandlers.clear(),console.log("[WebSocketStore] Handler count after clear:",I_.messageHandlers.size),I_.on("scene_update",e=>{console.log("[WebSocket] scene_update received, object count:",Object.keys(e.scene.objects||{}).length);const t={};Object.entries(e.scene.objects).forEach(e=>{let[n,i]=e;const r=K_(i);i.components&&(r.components=i.components),t[n]=r}),console.log("[WebSocket] Setting objects in store:",Object.keys(t)),r.setObjects(t),console.log("[WebSocket] Scene loaded, requesting component definitions..."),I_.getComponentDefinitions()}),I_.on("object_created",e=>{console.log("[WebSocket] object_created received:",e.object.id,e.object.name);const t=K_(e.object);e.object.components&&(t.components=e.object.components),console.log("[WebSocket] Adding object to store:",t.id),r.addObject(t),console.log("[WebSocket] Current objects in store after add:",Object.keys(r.objects))}),I_.on("object_deleted",e=>{r.removeObject(e.object_id)}),I_.on("transform_updated",e=>{const t={};console.log("transform_updated:",e.transform),e.transform.position&&(t.position=q_(e.transform.position)),e.transform.rotation&&(t.rotation=Z_(e.transform.rotation)),e.transform.scale&&(t.scale=q_(e.transform.scale)),r.updateObjectTransform(e.object_id,t)}),I_.on("material_updated",e=>{r.updateObjectMaterial(e.object_id,e.material)}),I_.on("visibility_updated",e=>{r.objects[e.object_id]&&r.setObjectVisibility(e.object_id,e.visible)}),I_.on("name_updated",e=>{const t=z_.getState(),n=t.objects[e.object_id];n&&t.updateObject({...n,name:e.name})}),I_.on("tag_updated",e=>{const t=z_.getState(),n=t.objects[e.object_id];n&&t.updateObject({...n,tag:e.tag})}),I_.on("mesh_uploaded",e=>{const t=K_(e.object);r.addObject(t)}),I_.on("trace_data",e=>{r.setTraceData(e.data.pathGroups)}),I_.on("parent_updated",e=>{console.log("[WebSocket] Received parent_updated:",e),r.updateObjectParent(e.object_id,e.parent_id)}),I_.on("node_editor_state",e=>{$_.getState().setInitialStateFromBackend(e.node_editor||{})}),I_.on("node_definitions",e=>{console.log("[WebSocket] Received node definitions:",e.definitions);const t=$_.getState();e.definitions&&e.definitions.categories&&t.setNodeDefinitions(e.definitions.categories)}),I_.on("node_definitions_updated",e=>{console.log("[WebSocket] Node definitions updated:",e.definitions);const t=$_.getState();e.definitions&&e.definitions.categories&&t.setNodeDefinitions(e.definitions.categories)}),I_.on("node_editor_updated",e=>{const t=$_.getState();e.node_editor&&(void 0!==e.node_editor.nodes&&t.setNodesFromSync(e.node_editor.nodes),void 0!==e.node_editor.edges&&t.setEdgesFromSync(e.node_editor.edges),void 0!==e.node_editor.parameters&&t.setParametersFromSync(e.node_editor.parameters),void 0!==e.node_editor.differentiableParams&&t.setDifferentiableParamsFromSync(new Set(e.node_editor.differentiableParams)))}),I_.on("object_updated",e=>{console.log("[WebSocket] Received object_updated:",e);const t=K_(e.object);r.updateObject(t)}),I_.on("button_click_result",e=>{console.log("[WebSocket] Button click result:",e);const{success:t,result:n,error:i,button_name:r}=e;t?n&&console.log(`[Button ${r}] Result: ${n}`):console.error(`[Button ${r}] Error: ${i}`)}),I_.on("component_updated",e=>{console.log("[WebSocket] Received component_updated:",e);const{object_id:t,component_name:n,field_name:i,value:o}=e,s=z_.getState().objects[t];if(s&&s.components){const e=s.components.map(e=>{if(e.name===n){const t={...e,values:{...e.values||{},[i]:o}};return e.fields&&Array.isArray(e.fields)&&(t.fields=e.fields.map(e=>e.name===i?{...e,value:o}:e)),t}return e}),t={...s,components:e};if("Material"===n||"material"===n){const i=e.find(e=>e.name===n);var a,l,c;if(i&&i.values)t.material={color:i.values.color||"#808080",metalness:null!==(a=i.values.metalness)&&void 0!==a?a:.5,roughness:null!==(l=i.values.roughness)&&void 0!==l?l:.5,permittivity:null!==(c=i.values.permittivity)&&void 0!==c?c:1}}r.updateObject(t)}}),I_.on("component_added",e=>{console.log("[WebSocket] component_added received:",e);const{object_id:t,component:n}=e,i=z_.getState();console.log("[WebSocket] Current state objects:",Object.keys(i.objects));const o=i.objects[t];if(console.log("[WebSocket] Found object:",!!o,t),console.log("[WebSocket] All objects in store:",Object.keys(i.objects)),o){var s;const e=null===(s=o.components)||void 0===s?void 0:s.find(e=>e.name===n.name);if(e)return void console.log(`[WebSocket] Component ${n.name} already exists on object, skipping duplicate`);console.log("[WebSocket] Current components:",o.components);const t={...o,components:[...o.components||[],n]};console.log("[WebSocket] Updated components:",t.components),r.updateObject(t),console.log("[WebSocket] Object updated in store")}else console.warn(`[WebSocket] Object ${t} not found in store. The object needs to be added to the scene first using scene.add_object() before adding components.`),console.log("[WebSocket] All objects in store:",Object.keys(r.objects))}),I_.on("component_removed",e=>{const{object_id:t,component_name:n}=e,i=z_.getState().objects[t];if(i&&i.components){const e={...i,components:i.components.filter(e=>e.name!==n)};r.updateObject(e)}}),I_.on("components_updated",e=>{const{object_id:t,components:n}=e,i=r.objects[t];if(i){const e={...i,components:n};r.updateObject(e)}}),I_.on("results_update",e=>{console.log("[WebSocket] Received results_update:",e);const{version:t,plots:n,message:i,tag:o,tag_color:s}=e;r.setResultsData(n,t,i,o,s)}),I_.on("results_history",e=>{console.log("[WebSocket] Received results_history:",e);const{versions:t}=e;r.setResultsHistory(t)}),I_.on("console_message",e=>{console.log("[WebSocket] Received console_message:",e.data),r.addConsoleMessage(e.data)}),I_.on("console_history",e=>{console.log("[WebSocket] Received console_history:",e);const{messages:t}=e;r.setConsoleMessages(t)}),I_.on("console_cleared",e=>{console.log("[WebSocket] Console cleared message received (ignored - clearing is now client-side only)")}),I_.on("console_command_result",e=>{console.log("[WebSocket] Command result:",e)}),I_.onConnectionStatus(t=>{if(e({connectionStatus:t,isConnected:"connected"===t}),"disconnected"===t){const e=z_.getState(),t=$_.getState();e.setTraceData(null),e.setResultsHistory([]),e.clearConsoleMessages(),t.resetEditor()}}),console.log("[WebSocketStore] Handler count after registration:",I_.messageHandlers.size);r.updateObjectTransform;const o=r.toggleObjectVisibility;r.toggleObjectVisibility=e=>{const n=r.objects[e];n&&(o(e),t().isConnected&&I_.updateVisibility(e,!n.visible))};try{await I_.connect(),e({isConnected:!0,connectionStatus:"connected"})}catch(Pb){e({isConnected:!1,connectionStatus:"disconnected"})}},disconnect:()=>{const t=z_.getState(),n=$_.getState();t.setTraceData(null),t.setResultsHistory([]),t.clearConsoleMessages(),n.resetEditor(),I_.disconnect(),e({isConnected:!1,connectionStatus:"disconnected"})},setConnectionStatus:t=>e({connectionStatus:t}),setServerUrl:t=>e({serverUrl:t})})),Q_=t.forwardRef(function(e,n){let{children:i,follow:r=!0,lockX:o=!1,lockY:s=!1,lockZ:a=!1,...l}=e;const c=t.useRef(null),u=t.useRef(null),d=new ks;return $y(e=>{let{camera:t}=e;if(!r||!u.current)return;const n=c.current.rotation.clone();u.current.updateMatrix(),u.current.updateWorldMatrix(!1,!1),u.current.getWorldQuaternion(d),t.getWorldQuaternion(c.current.quaternion).premultiply(d.invert()),o&&(c.current.rotation.x=n.x),s&&(c.current.rotation.y=n.y),a&&(c.current.rotation.z=n.z)}),t.useImperativeHandle(n,()=>u.current,[]),t.createElement("group",Ob({ref:u},l),t.createElement("group",{ref:c},i))});function ew(){var e=Object.create(null);function t(i,r){var o=i.id,s=i.name,a=i.dependencies;void 0===a&&(a=[]);var l=i.init;void 0===l&&(l=function(){});var c=i.getTransferables;if(void 0===c&&(c=null),!e[o])try{a=a.map(function(n){return n&&n.isWorkerModule&&(t(n,function(e){if(e instanceof Error)throw e}),n=e[n.id].value),n}),l=n("<"+s+">.init",l),c&&(c=n("<"+s+">.getTransferables",c));var u=null;"function"===typeof l?u=l.apply(void 0,a):console.error("worker module init function failed to rehydrate"),e[o]={id:o,value:u,getTransferables:c},r(u)}catch(d){d&&d.noLog||console.error(d),r(d)}}function n(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(r){console.error(r)}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",function(n){var i=n.data,r=i.messageId,o=i.action,s=i.data;try{"registerModule"===o&&t(s,function(e){e instanceof Error?postMessage({messageId:r,success:!1,error:e.message}):postMessage({messageId:r,success:!0,result:{isCallable:"function"===typeof e}})}),"callModule"===o&&function(t,n){var i,r=t.id,o=t.args;e[r]&&"function"===typeof e[r].value||n(new Error("Worker module "+r+": not found or its 'init' did not return a function"));try{var s=(i=e[r]).value.apply(i,o);s&&"function"===typeof s.then?s.then(a,function(e){return n(e instanceof Error?e:new Error(""+e))}):a(s)}catch(l){n(l)}function a(t){try{var i=e[r].getTransferables&&e[r].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),n(t,i)}catch(l){console.error(l),n(l)}}}(s,function(e,t){e instanceof Error?postMessage({messageId:r,success:!1,error:e.message}):postMessage({messageId:r,success:!0,result:e},t||void 0)})}catch(a){postMessage({messageId:r,success:!1,error:a.stack})}})}var tw=function(){var e=!1;if("undefined"!==typeof window&&"undefined"!==typeof window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return tw=function(){return e},e},nw=0,iw=0,rw=!1,ow=Object.create(null),sw=Object.create(null),aw=Object.create(null);function lw(e){if((!e||"function"!==typeof e.init)&&!rw)throw new Error("requires `options.init` function");var t=e.dependencies,n=e.init,i=e.getTransferables,r=e.workerId,o=function(e){var t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t._getInitResult().then(function(t){if("function"===typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var n=e.dependencies,i=e.init;n=Array.isArray(n)?n.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[];var r=Promise.all(n).then(function(e){return i.apply(null,e)});return t._getInitResult=function(){return r},r},t}(e);null==r&&(r="#default");var s="workerModule"+ ++nw,a=e.name||s,l=null;function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!tw())return o.apply(void 0,e);if(!l){l=uw(r,"registerModule",c.workerModuleData);var n=function(){l=null,sw[r].delete(n)};(sw[r]||(sw[r]=new Set)).add(n)}return l.then(function(t){if(t.isCallable)return uw(r,"callModule",{id:s,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")})}return t=t&&t.map(function(e){return"function"!==typeof e||e.workerModuleData||(rw=!0,e=lw({workerId:r,name:"<"+a+"> function dependency: "+e.name,init:"function(){return (\n"+cw(e)+"\n)}"}),rw=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),c.workerModuleData={isWorkerModule:!0,id:s,name:a,dependencies:t,init:cw(n),getTransferables:i&&cw(i)},c.onMainThread=o,c}function cw(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function uw(e,t,n){return new Promise(function(i,r){var o=++iw;aw[o]=function(e){e.success?i(e.result):r(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=ow[e];if(!t){var n=cw(ew);(t=ow[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,i=aw[n];if(!i)throw new Error("WorkerModule response with empty or unknown messageId");delete aw[n],i(t)}}return t}(e).postMessage({messageId:o,action:t,data:n})})}function dw(){var e=function(e){function t(e,t,n,i,r,o,s,a){var l=1-s;a.x=l*l*e+2*l*s*n+s*s*r,a.y=l*l*t+2*l*s*i+s*s*o}function n(e,t,n,i,r,o,s,a,l,c){var u=1-l;c.x=u*u*u*e+3*u*u*l*n+3*u*l*l*r+l*l*l*s,c.y=u*u*u*t+3*u*u*l*i+3*u*l*l*o+l*l*l*a}function i(e,t){for(var n,i,r,o,s,a=/([MLQCZ])([^MLQCZ]*)/g;n=a.exec(e);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(n[1]){case"M":o=i=l[0],s=r=l[1];break;case"L":l[0]===o&&l[1]===s||t("L",o,s,o=l[0],s=l[1]);break;case"Q":t("Q",o,s,o=l[2],s=l[3],l[0],l[1]);break;case"C":t("C",o,s,o=l[4],s=l[5],l[0],l[1],l[2],l[3]);break;case"Z":o===i&&s===r||t("L",o,s,i,r)}}}function r(e,r,o){void 0===o&&(o=16);var s={x:0,y:0};i(e,function(e,i,a,l,c,u,d,h,p){switch(e){case"L":r(i,a,l,c);break;case"Q":for(var f=i,m=a,g=1;g<o;g++)t(i,a,u,d,l,c,g/(o-1),s),r(f,m,s.x,s.y),f=s.x,m=s.y;break;case"C":for(var v=i,y=a,b=1;b<o;b++)n(i,a,u,d,h,p,l,c,b/(o-1),s),r(v,y,s.x,s.y),v=s.x,y=s.y}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",s=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(e,t){var n=e.getContext?e.getContext("webgl",a):e,i=s.get(n);if(!i){var r="undefined"!==typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,o={},l={},c={},u=-1,d=[];function h(e){var t=o[e];if(!t&&!(t=o[e]=n.getExtension(e)))throw new Error(e+" not supported");return t}function p(e,t){var i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}function f(e,t,i,o){if(!l[e]){var s={},a={},c=n.createProgram();n.attachShader(c,p(t,n.VERTEX_SHADER)),n.attachShader(c,p(i,n.FRAGMENT_SHADER)),n.linkProgram(c),l[e]={program:c,transaction:function(e){n.useProgram(c),e({setUniform:function(e,t){for(var i=[],r=arguments.length-2;r-- >0;)i[r]=arguments[r+2];var o=a[t]||(a[t]=n.getUniformLocation(c,t));n["uniform"+e].apply(n,[o].concat(i))},setAttribute:function(e,t,i,o,a){var l=s[e];l||(l=s[e]={buf:n.createBuffer(),loc:n.getAttribLocation(c,e),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,t,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),r?n.vertexAttribDivisor(l.loc,o):h("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,o),a!==l.data&&(n.bufferData(n.ARRAY_BUFFER,a,i),l.data=a)}})}}}l[e].transaction(o)}function m(e,t){u++;try{n.activeTexture(n.TEXTURE0+u);var i=c[e];i||(i=c[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,i),t(i,u)}finally{u--}}function g(e,t,i){var r=n.createFramebuffer();d.push(r),n.bindFramebuffer(n.FRAMEBUFFER,r),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{i(r)}finally{n.deleteFramebuffer(r),n.bindFramebuffer(n.FRAMEBUFFER,d[--d.length-1]||null)}}function v(){o={},l={},c={},u=-1,d.length=0}n.canvas.addEventListener("webglcontextlost",function(e){v(),e.preventDefault()},!1),s.set(n,i={gl:n,isWebGL2:r,getExtension:h,withProgram:f,withTexture:m,withTextureFramebuffer:g,handleContextLoss:v})}t(i)}function c(e,t,n,i,r,s,a,c){void 0===a&&(a=15),void 0===c&&(c=null),l(e,function(e){var l=e.gl,u=e.withProgram;(0,e.withTexture)("copy",function(e,d){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,r,s,0,l.RGBA,l.UNSIGNED_BYTE,t),u("copy",o,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",d),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&a,4&a,2&a,1&a),l.viewport(n,i,r,s),l.scissor(n,i,r,s),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(e,t,n){var i=e.width,r=e.height;l(e,function(o){var s=o.gl,a=new Uint8Array(i*r*4);s.readPixels(0,0,i,r,s.RGBA,s.UNSIGNED_BYTE,a),e.width=t,e.height=n,c(s,a,0,0,i,r)})}});function d(e,t,n,i,o,s){void 0===s&&(s=1);var a=new Uint8Array(e*t),l=i[2]-i[0],c=i[3]-i[1],u=[];r(n,function(e,t,n,i){u.push({x1:e,y1:t,x2:n,y2:i,minX:Math.min(e,n),minY:Math.min(t,i),maxX:Math.max(e,n),maxY:Math.max(t,i)})}),u.sort(function(e,t){return e.maxX-t.maxX});for(var d=0;d<e;d++)for(var h=0;h<t;h++){var p=g(i[0]+l*(d+.5)/e,i[1]+c*(h+.5)/t),m=Math.pow(1-Math.abs(p)/o,s)/2;p<0&&(m=1-m),m=Math.max(0,Math.min(255,Math.round(255*m))),a[h*e+d]=m}return a;function g(e,t){for(var n=1/0,i=1/0,r=u.length;r--;){var o=u[r];if(o.maxX+i<=e)break;if(e+i>o.minX&&t-i<o.maxY&&t+i>o.minY){var s=f(e,t,o.x1,o.y1,o.x2,o.y2);s<n&&(n=s,i=Math.sqrt(n))}}return function(e,t){for(var n=0,i=u.length;i--;){var r=u[i];if(r.maxX<=e)break;r.y1>t!==r.y2>t&&e<(r.x2-r.x1)*(t-r.y1)/(r.y2-r.y1)+r.x1&&(n+=r.y1<r.y2?1:-1)}return 0!==n}(e,t)&&(i=-i),i}}function h(e,t,n,i,r,o,s,a,l,c){void 0===o&&(o=1),void 0===a&&(a=0),void 0===l&&(l=0),void 0===c&&(c=0),p(e,t,n,i,r,o,s,null,a,l,c)}function p(e,t,n,i,r,o,s,a,l,u,h){void 0===o&&(o=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0);for(var p=d(e,t,n,i,r,o),f=new Uint8Array(4*p.length),m=0;m<p.length;m++)f[4*m+h]=p[m];c(s,f,l,u,e,t,1<<3-h,a)}function f(e,t,n,i,r,o){var s=r-n,a=o-i,l=s*s+a*a,c=l?Math.max(0,Math.min(1,((e-n)*s+(t-i)*a)/l)):0,u=e-(n+c*s),d=t-(i+c*a);return u*u+d*d}var m=Object.freeze({__proto__:null,generate:d,generateIntoCanvas:h,generateIntoFramebuffer:p}),g=new Float32Array([0,0,2,0,0,2]),v=null,y=!1,b={},x=new WeakMap;function _(e){if(!y&&!E(e))throw new Error("WebGL generation not supported")}function w(e,t,n,i,r,o,s){if(void 0===o&&(o=1),void 0===s&&(s=null),!s&&!(s=v)){var a="function"===typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!==typeof document?document.createElement("canvas"):null;if(!a)throw new Error("OffscreenCanvas or DOM canvas not supported");s=v=a.getContext("webgl",{depth:!1})}_(s);var c=new Uint8Array(e*t*4);l(s,function(s){var a=s.gl,l=s.withTexture,u=s.withTextureFramebuffer;l("readable",function(s,l){a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,t,0,a.RGBA,a.UNSIGNED_BYTE,null),u(s,l,function(s){M(e,t,n,i,r,o,a,s,0,0,0),a.readPixels(0,0,e,t,a.RGBA,a.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(e*t),d=0,h=0;d<c.length;d+=4)u[h++]=c[d];return u}function S(e,t,n,i,r,o,s,a,l,c){void 0===o&&(o=1),void 0===a&&(a=0),void 0===l&&(l=0),void 0===c&&(c=0),M(e,t,n,i,r,o,s,null,a,l,c)}function M(e,t,n,i,s,a,c,u,d,h,p){void 0===a&&(a=1),void 0===d&&(d=0),void 0===h&&(h=0),void 0===p&&(p=0),_(c);var f=[];r(n,function(e,t,n,i){f.push(e,t,n,i)}),f=new Float32Array(f),l(c,function(n){var r=n.gl,l=n.isWebGL2,c=n.getExtension,m=n.withProgram,v=n.withTexture,y=n.withTextureFramebuffer,b=n.handleContextLoss;if(v("rawDistances",function(n,v){e===n._lastWidth&&t===n._lastHeight||r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n._lastWidth=e,n._lastHeight=t,0,r.RGBA,r.UNSIGNED_BYTE,null),m("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(o){var u=o.setAttribute,d=o.setUniform,h=!l&&c("ANGLE_instanced_arrays"),p=!l&&c("EXT_blend_minmax");u("aUV",2,r.STATIC_DRAW,0,g),u("aLineSegment",4,r.DYNAMIC_DRAW,1,f),d.apply(void 0,["4f","uGlyphBounds"].concat(i)),d("1f","uMaxDistance",s),d("1f","uExponent",a),y(n,v,function(n){r.enable(r.BLEND),r.colorMask(!0,!0,!0,!0),r.viewport(0,0,e,t),r.scissor(0,0,e,t),r.blendFunc(r.ONE,r.ONE),r.blendEquationSeparate(r.FUNC_ADD,l?r.MAX:p.MAX_EXT),r.clear(r.COLOR_BUFFER_BIT),l?r.drawArraysInstanced(r.TRIANGLES,0,3,f.length/4):h.drawArraysInstancedANGLE(r.TRIANGLES,0,3,f.length/4)})}),m("post",o,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(n){n.setAttribute("aUV",2,r.STATIC_DRAW,0,g),n.setUniform("1i","tex",v),r.bindFramebuffer(r.FRAMEBUFFER,u),r.disable(r.BLEND),r.colorMask(0===p,1===p,2===p,3===p),r.viewport(d,h,e,t),r.scissor(d,h,e,t),r.drawArrays(r.TRIANGLES,0,3)})}),r.isContextLost())throw b(),new Error("webgl context lost")})}function E(e){var t=e&&e!==v?e.canvas||e:b,n=x.get(t);if(void 0===n){y=!0;var i=null;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],o=w(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);n=o&&r.length===o.length&&o.every(function(e,t){return e===r[t]}),n||(i="bad trial run results",console.info(r,o))}catch(s){n=!1,i=s.message}i&&console.warn("WebGL SDF generation not supported:",i),y=!1,x.set(t,n)}return n}var C=Object.freeze({__proto__:null,generate:w,generateIntoCanvas:S,generateIntoFramebuffer:M,isSupported:E});return e.forEachPathCommand=i,e.generate=function(e,t,n,i,r,o){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===o&&(o=1);try{return w.apply(C,arguments)}catch(nV){return console.info("WebGL SDF generation failed, falling back to JS",nV),d.apply(m,arguments)}},e.generateIntoCanvas=function(e,t,n,i,r,o,s,a,l,c){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===o&&(o=1),void 0===a&&(a=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return S.apply(C,arguments)}catch(nV){return console.info("WebGL SDF generation failed, falling back to JS",nV),h.apply(m,arguments)}},e.javascript=m,e.pathToLineSegments=r,e.webgl=C,e.webglUtils=u,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const hw=function(){var e=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},i={};n.L=1,i[1]="L",Object.keys(t).forEach(function(e,t){n[e]=1<<t+1,i[n[e]]=e}),Object.freeze(n);var r=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,s=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,a=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|r|n.PDI|a,c=null;function u(e){return function(){if(!c){c=new Map;var e=function(e){if(t.hasOwnProperty(e)){var i=0;t[e].split(",").forEach(function(t){var r=t.split("+"),o=r[0],s=r[1];o=parseInt(o,36),s=s?parseInt(s,36):0,c.set(i+=o,n[e]);for(var a=0;a<s;a++)c.set(++i,n[e])})}};for(var i in t)e(i)}}(),c.get(e.codePointAt(0))||n.L}var d,h,p,f="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",m="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(e,t){var n,i=0,r=new Map,o=t&&new Map;return e.split(",").forEach(function e(s){if(-1!==s.indexOf("+"))for(var a=+s;a--;)e(n);else{n=s;var l=s.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(i+=parseInt(c,36)),u=String.fromCodePoint(i+=parseInt(u,36)),r.set(c,u),t&&o.set(u,c)}}),{map:r,reverseMap:o}}function v(){if(!d){var e=g(f,!0),t=e.map,n=e.reverseMap;d=t,h=n,p=g(m,!1).map}}function y(e){return v(),d.get(e)||null}function b(e){return v(),h.get(e)||null}function x(e){return v(),p.get(e)||null}var _=n.L,w=n.R,S=n.EN,M=n.ES,E=n.ET,C=n.AN,T=n.CS,A=n.B,P=n.S,D=n.ON,k=n.BN,R=n.NSM,N=n.AL,I=n.LRO,L=n.RLO,O=n.LRE,z=n.RLE,U=n.PDF,F=n.LRI,j=n.RLI,B=n.FSI,V=n.PDI;var H;function G(e){return function(){if(!H){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,n){t.set(n,e)}),H=t}}(),H.get(e)||null}function W(e,t,n,i){var r=e.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);var o=[];return t.paragraphs.forEach(function(r){var s=Math.max(n,r.start),a=Math.min(i,r.end);if(s<a){for(var c=t.levels.slice(s,a+1),d=a;d>=s&&u(e[d])&l;d--)c[d]=r.level;for(var h=r.level,p=1/0,f=0;f<c.length;f++){var m=c[f];m>h&&(h=m),m<p&&(p=1|m)}for(var g=h;g>=p;g--)for(var v=0;v<c.length;v++)if(c[v]>=g){for(var y=v;v+1<c.length&&c[v+1]>=g;)v++;v>y&&o.push([y+s,v+s])}}}),o}function X(e,t,n,i){for(var r=W(e,t,n,i),o=[],s=0;s<e.length;s++)o[s]=s;return r.forEach(function(e){for(var t=e[0],n=e[1],i=o.slice(t,n+1),r=i.length;r--;)o[n-r]=i[r]}),o}return e.closingToOpeningBracket=b,e.getBidiCharType=u,e.getBidiCharTypeName=function(e){return i[u(e)]},e.getCanonicalBracket=x,e.getEmbeddingLevels=function(e,t){for(var n=new Uint32Array(e.length),i=0;i<e.length;i++)n[i]=u(e[i]);var c=new Map;function d(e,t){var i=n[e];n[e]=t,c.set(i,c.get(i)-1),i&s&&c.set(s,c.get(s)-1),c.set(t,(c.get(t)||0)+1),t&s&&c.set(s,(c.get(s)||0)+1)}for(var h=new Uint8Array(e.length),p=new Map,f=[],m=null,g=0;g<e.length;g++)m||f.push(m={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Bt(g,!1)}),n[g]&A&&(m.end=g,m=null);for(var v=z|O|L|I|r|V|U|A,H=function(e){return e+(1&e?1:2)},G=function(e){return e+(1&e?2:1)},W=0;W<f.length;W++){var X=[{_level:(m=f[W]).level,_override:0,_isolate:0}],Y=void 0,$=0,q=0,Z=0;c.clear();for(var K=m.start;K<=m.end;K++){var J=n[K];if(Y=X[X.length-1],c.set(J,(c.get(J)||0)+1),J&s&&c.set(s,(c.get(s)||0)+1),J&v)if(J&(z|O)){h[K]=Y._level;var Q=(J===z?G:H)(Y._level);Q<=125&&!$&&!q?X.push({_level:Q,_override:0,_isolate:0}):$||q++}else if(J&(L|I)){h[K]=Y._level;var ee=(J===L?G:H)(Y._level);ee<=125&&!$&&!q?X.push({_level:ee,_override:J&L?w:_,_isolate:0}):$||q++}else if(J&r){J&B&&(J=1===Bt(K+1,!0)?j:F),h[K]=Y._level,Y._override&&d(K,Y._override);var te=(J===j?G:H)(Y._level);te<=125&&0===$&&0===q?(Z++,X.push({_level:te,_override:0,_isolate:1,_isolInitIndex:K})):$++}else if(J&V){if($>0)$--;else if(Z>0){for(q=0;!X[X.length-1]._isolate;)X.pop();var ne=X[X.length-1]._isolInitIndex;null!=ne&&(p.set(ne,K),p.set(K,ne)),X.pop(),Z--}Y=X[X.length-1],h[K]=Y._level,Y._override&&d(K,Y._override)}else J&U?(0===$&&(q>0?q--:!Y._isolate&&X.length>1&&(X.pop(),Y=X[X.length-1])),h[K]=Y._level):J&A&&(h[K]=m.level);else h[K]=Y._level,Y._override&&J!==k&&d(K,Y._override)}for(var ie=[],re=null,oe=m.start;oe<=m.end;oe++){var se=n[oe];if(!(se&a)){var ae=h[oe],le=se&r,ce=se===V;re&&ae===re._level?(re._end=oe,re._endsWithIsolInit=le):ie.push(re={_start:oe,_end:oe,_level:ae,_startsWithPDI:ce,_endsWithIsolInit:le})}}for(var ue=[],de=0;de<ie.length;de++){var he=ie[de];if(!he._startsWithPDI||he._startsWithPDI&&!p.has(he._start)){for(var pe=[re=he],fe=void 0;re&&re._endsWithIsolInit&&null!=(fe=p.get(re._end));)for(var me=de+1;me<ie.length;me++)if(ie[me]._start===fe){pe.push(re=ie[me]);break}for(var ge=[],ve=0;ve<pe.length;ve++)for(var ye=pe[ve],be=ye._start;be<=ye._end;be++)ge.push(be);for(var xe=h[ge[0]],_e=m.level,we=ge[0]-1;we>=0;we--)if(!(n[we]&a)){_e=h[we];break}var Se=ge[ge.length-1],Me=h[Se],Ee=m.level;if(!(n[Se]&r))for(var Ce=Se+1;Ce<=m.end;Ce++)if(!(n[Ce]&a)){Ee=h[Ce];break}ue.push({_seqIndices:ge,_sosType:Math.max(_e,xe)%2?w:_,_eosType:Math.max(Ee,Me)%2?w:_})}}for(var Te=0;Te<ue.length;Te++){var Ae=ue[Te],Pe=Ae._seqIndices,De=Ae._sosType,ke=Ae._eosType,Re=1&h[Pe[0]]?w:_;if(c.get(R))for(var Ne=0;Ne<Pe.length;Ne++){var Ie=Pe[Ne];if(n[Ie]&R){for(var Le=De,Oe=Ne-1;Oe>=0;Oe--)if(!(n[Pe[Oe]]&a)){Le=n[Pe[Oe]];break}d(Ie,Le&(r|V)?D:Le)}}if(c.get(S))for(var ze=0;ze<Pe.length;ze++){var Ue=Pe[ze];if(n[Ue]&S)for(var Fe=ze-1;Fe>=-1;Fe--){var je=-1===Fe?De:n[Pe[Fe]];if(je&o){je===N&&d(Ue,C);break}}}if(c.get(N))for(var Be=0;Be<Pe.length;Be++){var Ve=Pe[Be];n[Ve]&N&&d(Ve,w)}if(c.get(M)||c.get(T))for(var He=1;He<Pe.length-1;He++){var Ge=Pe[He];if(n[Ge]&(M|T)){for(var We=0,Xe=0,Ye=He-1;Ye>=0&&(We=n[Pe[Ye]])&a;Ye--);for(var $e=He+1;$e<Pe.length&&(Xe=n[Pe[$e]])&a;$e++);We===Xe&&(n[Ge]===M?We===S:We&(S|C))&&d(Ge,We)}}if(c.get(S))for(var qe=0;qe<Pe.length;qe++){var Ze=Pe[qe];if(n[Ze]&S){for(var Ke=qe-1;Ke>=0&&n[Pe[Ke]]&(E|a);Ke--)d(Pe[Ke],S);for(qe++;qe<Pe.length&&n[Pe[qe]]&(E|a|S);qe++)n[Pe[qe]]!==S&&d(Pe[qe],S)}}if(c.get(E)||c.get(M)||c.get(T))for(var Je=0;Je<Pe.length;Je++){var Qe=Pe[Je];if(n[Qe]&(E|M|T)){d(Qe,D);for(var et=Je-1;et>=0&&n[Pe[et]]&a;et--)d(Pe[et],D);for(var tt=Je+1;tt<Pe.length&&n[Pe[tt]]&a;tt++)d(Pe[tt],D)}}if(c.get(S))for(var nt=0,it=De;nt<Pe.length;nt++){var rt=Pe[nt],ot=n[rt];ot&S?it===_&&d(rt,_):ot&o&&(it=ot)}if(c.get(s)){for(var st=w|S|C,at=st|_,lt=[],ct=[],ut=0;ut<Pe.length;ut++)if(n[Pe[ut]]&s){var dt=e[Pe[ut]],ht=void 0;if(null!==y(dt)){if(!(ct.length<63))break;ct.push({char:dt,seqIndex:ut})}else if(null!==(ht=b(dt)))for(var pt=ct.length-1;pt>=0;pt--){var ft=ct[pt].char;if(ft===ht||ft===b(x(dt))||y(x(ft))===dt){lt.push([ct[pt].seqIndex,ut]),ct.length=pt;break}}}lt.sort(function(e,t){return e[0]-t[0]});for(var mt=0;mt<lt.length;mt++){for(var gt=lt[mt],vt=gt[0],yt=gt[1],bt=!1,xt=0,_t=vt+1;_t<yt;_t++){var wt=Pe[_t];if(n[wt]&at){bt=!0;var St=n[wt]&st?w:_;if(St===Re){xt=St;break}}}if(bt&&!xt){xt=De;for(var Mt=vt-1;Mt>=0;Mt--){var Et=Pe[Mt];if(n[Et]&at){var Ct=n[Et]&st?w:_;xt=Ct!==Re?Ct:Re;break}}}if(xt){if(n[Pe[vt]]=n[Pe[yt]]=xt,xt!==Re)for(var Tt=vt+1;Tt<Pe.length;Tt++)if(!(n[Pe[Tt]]&a)){u(e[Pe[Tt]])&R&&(n[Pe[Tt]]=xt);break}if(xt!==Re)for(var At=yt+1;At<Pe.length;At++)if(!(n[Pe[At]]&a)){u(e[Pe[At]])&R&&(n[Pe[At]]=xt);break}}}for(var Pt=0;Pt<Pe.length;Pt++)if(n[Pe[Pt]]&s){for(var Dt=Pt,kt=Pt,Rt=De,Nt=Pt-1;Nt>=0;Nt--){if(!(n[Pe[Nt]]&a)){Rt=n[Pe[Nt]]&st?w:_;break}Dt=Nt}for(var It=ke,Lt=Pt+1;Lt<Pe.length;Lt++){if(!(n[Pe[Lt]]&(s|a))){It=n[Pe[Lt]]&st?w:_;break}kt=Lt}for(var Ot=Dt;Ot<=kt;Ot++)n[Pe[Ot]]=Rt===It?Rt:Re;Pt=kt}}}for(var zt=m.start;zt<=m.end;zt++){var Ut=h[zt],Ft=n[zt];if(1&Ut?Ft&(_|S|C)&&h[zt]++:Ft&w?h[zt]++:Ft&(C|S)&&(h[zt]+=2),Ft&a&&(h[zt]=0===zt?m.level:h[zt-1]),zt===m.end||u(e[zt])&(P|A))for(var jt=zt;jt>=0&&u(e[jt])&l;jt--)h[jt]=m.level}}return{levels:h,paragraphs:f};function Bt(t,i){for(var o=t;o<e.length;o++){var s=n[o];if(s&(w|N))return 1;if(s&(A|_)||i&&s===V)return 0;if(s&r){var a=Vt(o);o=-1===a?e.length:a}}return 0}function Vt(t){for(var i=1,o=t+1;o<e.length;o++){var s=n[o];if(s&A)break;if(s&V){if(0===--i)return o}else s&r&&i++}return-1}},e.getMirroredCharacter=G,e.getMirroredCharactersMap=function(e,t,n,i){var r=e.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);for(var o=new Map,s=n;s<=i;s++)if(1&t[s]){var a=G(e[s]);null!==a&&o.set(s,a)}return o},e.getReorderSegments=W,e.getReorderedIndices=X,e.getReorderedString=function(e,t,n,i){var r=X(e,t,n,i),o=[].concat(e);return r.forEach(function(n,i){o[i]=(1&t.levels[n]?G(e[n]):null)||e[n]}),o.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e},pw=/\bvoid\s+main\s*\(\s*\)\s*{/g;function fw(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let n=fc[t];return n?fw(n):e})}const mw=[];for(let n=0;n<256;n++)mw[n]=(n<16?"0":"")+n.toString(16);const gw=Object.assign||function(){let e=arguments[0];for(let t=1,n=arguments.length;t<n;t++){let n=arguments[t];if(n)for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},vw=Date.now(),yw=new WeakMap,bw=new Map;let xw=1e10;function _w(e,t){const n=function(e){const t=JSON.stringify(e,Sw);let n=Ew.get(t);null==n&&Ew.set(t,n=++Mw);return n}(t);let i=yw.get(e);if(i||yw.set(e,i=Object.create(null)),i[n])return new i[n];const r=`_onBeforeCompile${n}`,o=function(i,o){e.onBeforeCompile.call(this,i,o);const s=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let a=bw[s];if(!a){const e=function(e,t,n,i){let{vertexShader:r,fragmentShader:o}=t,{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:l,vertexTransform:c,fragmentDefs:u,fragmentMainIntro:d,fragmentMainOutro:h,fragmentColorTransform:p,customRewriter:f,timeUniform:m}=n;s=s||"",a=a||"",l=l||"",u=u||"",d=d||"",h=h||"",(c||f)&&(r=fw(r));(p||f)&&(o=o.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"),o=fw(o));if(f){let e=f({vertexShader:r,fragmentShader:o});r=e.vertexShader,o=e.fragmentShader}if(p){let e=[];o=o.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),h=`${p}\n${e.join("\n")}\n${h}`}if(m){const e=`\nuniform float ${m};\n`;s=e+s,u=e+u}c&&(r=`vec3 troika_position_${i};\nvec3 troika_normal_${i};\nvec2 troika_uv_${i};\n${r}\n`,s=`${s}\nvoid troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${c}\n}\n`,a=`\ntroika_position_${i} = vec3(position);\ntroika_normal_${i} = vec3(normal);\ntroika_uv_${i} = vec2(uv);\ntroikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});\n${a}\n`,r=r.replace(/\b(position|normal|uv)\b/g,(e,t,n,r)=>/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?t:`troika_${t}_${i}`),e.map&&e.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${i}`)));return r=ww(r,i,s,a,l),o=ww(o,i,u,d,h),{vertexShader:r,fragmentShader:o}}(this,i,t,n);a=bw[s]=e}i.vertexShader=a.vertexShader,i.fragmentShader=a.fragmentShader,gw(i.uniforms,this.uniforms),t.timeUniform&&(i.uniforms[t.timeUniform]={get value(){return Date.now()-vw}}),this[r]&&this[r](i)},s=function(){return a(t.chained?e:e.clone())},a=function(i){const r=Object.create(i,l);return Object.defineProperty(r,"baseMaterial",{value:e}),Object.defineProperty(r,"id",{value:xw++}),r.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(mw[255&e]+mw[e>>8&255]+mw[e>>16&255]+mw[e>>24&255]+"-"+mw[255&t]+mw[t>>8&255]+"-"+mw[t>>16&15|64]+mw[t>>24&255]+"-"+mw[63&n|128]+mw[n>>8&255]+"-"+mw[n>>16&255]+mw[n>>24&255]+mw[255&i]+mw[i>>8&255]+mw[i>>16&255]+mw[i>>24&255]).toUpperCase()}(),r.uniforms=gw({},i.uniforms,t.uniforms),r.defines=gw({},i.defines,t.defines),r.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",r.extensions=gw({},i.extensions,t.extensions),r._listeners=void 0,r},l={constructor:{value:s},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:t=>{e.type=t}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){const t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>o,set(e){this[r]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(gw(this.extensions,t.extensions),gw(this.defines,t.defines),gw(this.uniforms,Zl.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return a(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=_w(e.isDerivedMaterial?e.getDepthMaterial():new Id({depthPacking:Vr}),t),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=_w(e.isDerivedMaterial?e.getDistanceMaterial():new Ld,t),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:n}=this;t&&t.dispose(),n&&n.dispose(),e.dispose.call(this)}}};return i[n]=s,new s}function ww(e,t,n,i,r){return(i||r||n)&&(e=e.replace(pw,`\n${n}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${i}\n  troikaOrigMain${t}();\n  ${r}\n}`),e}function Sw(e,t){return"uniforms"===e?void 0:"function"===typeof t?t.toString():t}let Mw=0;const Ew=new Map;const Cw=lw({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var n=t._bin,i=new Uint8Array(e);if("ttcf"==n.readASCII(i,0,4)){var r=4;n.readUshort(i,r),r+=2,n.readUshort(i,r),r+=2;var o=n.readUint(i,r);r+=4;for(var s=[],a=0;a<o;a++){var l=n.readUint(i,r);r+=4,s.push(t._readFont(i,l))}return s}return[t._readFont(i,0)]},_readFont:function(e,n){var i=t._bin,r=n;i.readFixed(e,n),n+=4;var o=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2;for(var s=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],a={_data:e,_offset:r},l={},c=0;c<o;c++){var u=i.readASCII(e,n,4);n+=4,i.readUint(e,n),n+=4;var d=i.readUint(e,n);n+=4;var h=i.readUint(e,n);n+=4,l[u]={offset:d,length:h}}for(c=0;c<s.length;c++){var p=s[c];l[p]&&(a[p.trim()]=t[p.trim()].parse(e,l[p].offset,l[p].length,a))}return a},_tabOffset:function(e,n,i){for(var r=t._bin,o=r.readUshort(e,i+4),s=i+12,a=0;a<o;a++){var l=r.readASCII(e,s,4);s+=4,r.readUint(e,s),s+=4;var c=r.readUint(e,s);if(s+=4,r.readUint(e,s),s+=4,l==n)return c}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,n){return t._bin.readShort(e,n)/16384},readInt:function(e,n){return t._bin._view(e).getInt32(n)},readInt8:function(e,n){return t._bin._view(e).getInt8(n)},readShort:function(e,n){return t._bin._view(e).getInt16(n)},readUshort:function(e,n){return t._bin._view(e).getUint16(n)},readUshorts:function(e,n,i){for(var r=[],o=0;o<i;o++)r.push(t._bin.readUshort(e,n+2*o));return r},readUint:function(e,n){return t._bin._view(e).getUint32(n)},readUint64:function(e,n){return 4294967296*t._bin.readUint(e,n)+t._bin.readUint(e,n+4)},readASCII:function(e,t,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(e[t+r]);return i},readUnicode:function(e,t,n){for(var i="",r=0;r<n;r++){var o=e[t++]<<8|e[t++];i+=String.fromCharCode(o)}return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,n,i){var r=t._bin._tdec;return r&&0==n&&i==e.length?r.decode(e):t._bin.readASCII(e,n,i)},readBytes:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(e[t+r]);return i},readASCIIArray:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(String.fromCharCode(e[t+r]));return i},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,n,i,r,o){var s=t._bin,a={},l=n;s.readFixed(e,n),n+=4;var c=s.readUshort(e,n);n+=2;var u=s.readUshort(e,n);n+=2;var d=s.readUshort(e,n);return n+=2,a.scriptList=t._lctf.readScriptList(e,l+c),a.featureList=t._lctf.readFeatureList(e,l+u),a.lookupList=t._lctf.readLookupList(e,l+d,o),a},t._lctf.readLookupList=function(e,n,i){var r=t._bin,o=n,s=[],a=r.readUshort(e,n);n+=2;for(var l=0;l<a;l++){var c=r.readUshort(e,n);n+=2;var u=t._lctf.readLookupTable(e,o+c,i);s.push(u)}return s},t._lctf.readLookupTable=function(e,n,i){var r=t._bin,o=n,s={tabs:[]};s.ltype=r.readUshort(e,n),n+=2,s.flag=r.readUshort(e,n),n+=2;var a=r.readUshort(e,n);n+=2;for(var l=s.ltype,c=0;c<a;c++){var u=r.readUshort(e,n);n+=2;var d=i(e,l,o+u,s);s.tabs.push(d)}return s},t._lctf.numOfOnes=function(e){for(var t=0,n=0;n<32;n++)0!=(e>>>n&1)&&t++;return t},t._lctf.readClassDef=function(e,n){var i=t._bin,r=[],o=i.readUshort(e,n);if(n+=2,1==o){var s=i.readUshort(e,n);n+=2;var a=i.readUshort(e,n);n+=2;for(var l=0;l<a;l++)r.push(s+l),r.push(s+l),r.push(i.readUshort(e,n)),n+=2}if(2==o){var c=i.readUshort(e,n);for(n+=2,l=0;l<c;l++)r.push(i.readUshort(e,n)),n+=2,r.push(i.readUshort(e,n)),n+=2,r.push(i.readUshort(e,n)),n+=2}return r},t._lctf.getInterval=function(e,t){for(var n=0;n<e.length;n+=3){var i=e[n],r=e[n+1];if(e[n+2],i<=t&&t<=r)return n}return-1},t._lctf.readCoverage=function(e,n){var i=t._bin,r={};r.fmt=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);return n+=2,1==r.fmt&&(r.tab=i.readUshorts(e,n,o)),2==r.fmt&&(r.tab=i.readUshorts(e,n,3*o)),r},t._lctf.coverageIndex=function(e,n){var i=e.tab;if(1==e.fmt)return i.indexOf(n);if(2==e.fmt){var r=t._lctf.getInterval(i,n);if(-1!=r)return i[r+2]+(n-i[r])}return-1},t._lctf.readFeatureList=function(e,n){var i=t._bin,r=n,o=[],s=i.readUshort(e,n);n+=2;for(var a=0;a<s;a++){var l=i.readASCII(e,n,4);n+=4;var c=i.readUshort(e,n);n+=2;var u=t._lctf.readFeatureTable(e,r+c);u.tag=l.trim(),o.push(u)}return o},t._lctf.readFeatureTable=function(e,n){var i=t._bin,r=n,o={},s=i.readUshort(e,n);n+=2,s>0&&(o.featureParams=r+s);var a=i.readUshort(e,n);n+=2,o.tab=[];for(var l=0;l<a;l++)o.tab.push(i.readUshort(e,n+2*l));return o},t._lctf.readScriptList=function(e,n){var i=t._bin,r=n,o={},s=i.readUshort(e,n);n+=2;for(var a=0;a<s;a++){var l=i.readASCII(e,n,4);n+=4;var c=i.readUshort(e,n);n+=2,o[l.trim()]=t._lctf.readScriptTable(e,r+c)}return o},t._lctf.readScriptTable=function(e,n){var i=t._bin,r=n,o={},s=i.readUshort(e,n);n+=2,s>0&&(o.default=t._lctf.readLangSysTable(e,r+s));var a=i.readUshort(e,n);n+=2;for(var l=0;l<a;l++){var c=i.readASCII(e,n,4);n+=4;var u=i.readUshort(e,n);n+=2,o[c.trim()]=t._lctf.readLangSysTable(e,r+u)}return o},t._lctf.readLangSysTable=function(e,n){var i=t._bin,r={};i.readUshort(e,n),n+=2,r.reqFeature=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);return n+=2,r.features=i.readUshorts(e,n,o),r},t.CFF={},t.CFF.parse=function(e,n,i){var r=t._bin;(e=new Uint8Array(e.buffer,n,i))[n=0],e[++n],e[++n],e[++n],n++;var o=[];n=t.CFF.readIndex(e,n,o);for(var s=[],a=0;a<o.length-1;a++)s.push(r.readASCII(e,n+o[a],o[a+1]-o[a]));n+=o[o.length-1];var l=[];n=t.CFF.readIndex(e,n,l);var c=[];for(a=0;a<l.length-1;a++)c.push(t.CFF.readDict(e,n+l[a],n+l[a+1]));n+=l[l.length-1];var u=c[0],d=[];n=t.CFF.readIndex(e,n,d);var h=[];for(a=0;a<d.length-1;a++)h.push(r.readASCII(e,n+d[a],d[a+1]-d[a]));if(n+=d[d.length-1],t.CFF.readSubrs(e,n,u),u.CharStrings){n=u.CharStrings,d=[],n=t.CFF.readIndex(e,n,d);var p=[];for(a=0;a<d.length-1;a++)p.push(r.readBytes(e,n+d[a],d[a+1]-d[a]));u.CharStrings=p}if(u.ROS){n=u.FDArray;var f=[];for(n=t.CFF.readIndex(e,n,f),u.FDArray=[],a=0;a<f.length-1;a++){var m=t.CFF.readDict(e,n+f[a],n+f[a+1]);t.CFF._readFDict(e,m,h),u.FDArray.push(m)}n+=f[f.length-1],n=u.FDSelect,u.FDSelect=[];var g=e[n];if(n++,3!=g)throw g;var v=r.readUshort(e,n);for(n+=2,a=0;a<v+1;a++)u.FDSelect.push(r.readUshort(e,n),e[n+2]),n+=3}return u.Encoding&&(u.Encoding=t.CFF.readEncoding(e,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=t.CFF.readCharset(e,u.charset,u.CharStrings.length)),t.CFF._readFDict(e,u,h),u},t.CFF._readFDict=function(e,n,i){var r;for(var o in n.Private&&(r=n.Private[1],n.Private=t.CFF.readDict(e,r,r+n.Private[0]),n.Private.Subrs&&t.CFF.readSubrs(e,r+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)&&(n[o]=i[n[o]-426+35])},t.CFF.readSubrs=function(e,n,i){var r=t._bin,o=[];n=t.CFF.readIndex(e,n,o);var s,a=o.length;s=a<1240?107:a<33900?1131:32768,i.Bias=s,i.Subrs=[];for(var l=0;l<o.length-1;l++)i.Subrs.push(r.readBytes(e,n+o[l],o[l+1]-o[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var n=0;n<e.charset.length;n++)if(e.charset[n]==t)return n;return-1},t.CFF.glyphBySE=function(e,n){return n<0||n>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[n])},t.CFF.readEncoding=function(e,n,i){t._bin;var r=[".notdef"],o=e[n];if(n++,0!=o)throw"error: unknown encoding format: "+o;var s=e[n];n++;for(var a=0;a<s;a++)r.push(e[n+a]);return r},t.CFF.readCharset=function(e,n,i){var r=t._bin,o=[".notdef"],s=e[n];if(n++,0==s)for(var a=0;a<i;a++){var l=r.readUshort(e,n);n+=2,o.push(l)}else{if(1!=s&&2!=s)throw"error: format: "+s;for(;o.length<i;){l=r.readUshort(e,n),n+=2;var c=0;for(1==s?(c=e[n],n++):(c=r.readUshort(e,n),n+=2),a=0;a<=c;a++)o.push(l),l++}}return o},t.CFF.readIndex=function(e,n,i){var r=t._bin,o=r.readUshort(e,n)+1,s=e[n+=2];if(n++,1==s)for(var a=0;a<o;a++)i.push(e[n+a]);else if(2==s)for(a=0;a<o;a++)i.push(r.readUshort(e,n+2*a));else if(3==s)for(a=0;a<o;a++)i.push(16777215&r.readUint(e,n+3*a-1));else if(1!=o)throw"unsupported offset size: "+s+", count: "+o;return(n+=o*s)-1},t.CFF.getCharString=function(e,n,i){var r=t._bin,o=e[n],s=e[n+1];e[n+2],e[n+3],e[n+4];var a=1,l=null,c=null;o<=20&&(l=o,a=1),12==o&&(l=100*o+s,a=2),21<=o&&o<=27&&(l=o,a=1),28==o&&(c=r.readShort(e,n+1),a=3),29<=o&&o<=31&&(l=o,a=1),32<=o&&o<=246&&(c=o-139,a=1),247<=o&&o<=250&&(c=256*(o-247)+s+108,a=2),251<=o&&o<=254&&(c=256*-(o-251)-s-108,a=2),255==o&&(c=r.readInt(e,n+1)/65535,a=5),i.val=null!=c?c:"o"+l,i.size=a},t.CFF.readCharString=function(e,n,i){for(var r=n+i,o=t._bin,s=[];n<r;){var a=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var c=1,u=null,d=null;a<=20&&(u=a,c=1),12==a&&(u=100*a+l,c=2),19!=a&&20!=a||(u=a,c=2),21<=a&&a<=27&&(u=a,c=1),28==a&&(d=o.readShort(e,n+1),c=3),29<=a&&a<=31&&(u=a,c=1),32<=a&&a<=246&&(d=a-139,c=1),247<=a&&a<=250&&(d=256*(a-247)+l+108,c=2),251<=a&&a<=254&&(d=256*-(a-251)-l-108,c=2),255==a&&(d=o.readInt(e,n+1)/65535,c=5),s.push(null!=d?d:"o"+u),n+=c}return s},t.CFF.readDict=function(e,n,i){for(var r=t._bin,o={},s=[];n<i;){var a=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var c=1,u=null,d=null;if(28==a&&(d=r.readShort(e,n+1),c=3),29==a&&(d=r.readInt(e,n+1),c=5),32<=a&&a<=246&&(d=a-139,c=1),247<=a&&a<=250&&(d=256*(a-247)+l+108,c=2),251<=a&&a<=254&&(d=256*-(a-251)-l-108,c=2),255==a)throw d=r.readInt(e,n+1)/65535,c=5,"unknown number";if(30==a){var h=[];for(c=1;;){var p=e[n+c];c++;var f=p>>4,m=15&p;if(15!=f&&h.push(f),15!=m&&h.push(m),15==m)break}for(var g="",v=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<h.length;y++)g+=v[h[y]];d=parseFloat(g)}a<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][a],c=1,12==a&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(o[u]=1==s.length?s[0]:s,s=[]):s.push(d),n+=c}return o},t.cmap={},t.cmap.parse=function(e,n,i){e=new Uint8Array(e.buffer,n,i),n=0;var r=t._bin,o={};r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2;var a=[];o.tables=[];for(var l=0;l<s;l++){var c=r.readUshort(e,n);n+=2;var u=r.readUshort(e,n);n+=2;var d=r.readUint(e,n);n+=4;var h="p"+c+"e"+u,p=a.indexOf(d);if(-1==p){var f;p=o.tables.length,a.push(d);var m=r.readUshort(e,d);0==m?f=t.cmap.parse0(e,d):4==m?f=t.cmap.parse4(e,d):6==m?f=t.cmap.parse6(e,d):12==m?f=t.cmap.parse12(e,d):console.debug("unknown format: "+m,c,u,d),o.tables.push(f)}if(null!=o[h])throw"multiple tables for one platform+encoding";o[h]=p}return o},t.cmap.parse0=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,r.map=[];for(var s=0;s<o-6;s++)r.map.push(e[n+s]);return r},t.cmap.parse4=function(e,n){var i=t._bin,r=n,o={};o.format=i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2;var l=a/2;o.searchRange=i.readUshort(e,n),n+=2,o.entrySelector=i.readUshort(e,n),n+=2,o.rangeShift=i.readUshort(e,n),n+=2,o.endCount=i.readUshorts(e,n,l),n+=2*l,n+=2,o.startCount=i.readUshorts(e,n,l),n+=2*l,o.idDelta=[];for(var c=0;c<l;c++)o.idDelta.push(i.readShort(e,n)),n+=2;for(o.idRangeOffset=i.readUshorts(e,n,l),n+=2*l,o.glyphIdArray=[];n<r+s;)o.glyphIdArray.push(i.readUshort(e,n)),n+=2;return o},t.cmap.parse6=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,r.firstCode=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);n+=2,r.glyphIdArray=[];for(var s=0;s<o;s++)r.glyphIdArray.push(i.readUshort(e,n)),n+=2;return r},t.cmap.parse12=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2,n+=2,i.readUint(e,n),n+=4,i.readUint(e,n),n+=4;var o=i.readUint(e,n);n+=4,r.groups=[];for(var s=0;s<o;s++){var a=n+12*s,l=i.readUint(e,a+0),c=i.readUint(e,a+4),u=i.readUint(e,a+8);r.groups.push([l,c,u])}return r},t.glyf={},t.glyf.parse=function(e,t,n,i){for(var r=[],o=0;o<i.maxp.numGlyphs;o++)r.push(null);return r},t.glyf._parseGlyf=function(e,n){var i=t._bin,r=e._data,o=t._tabOffset(r,"glyf",e._offset)+e.loca[n];if(e.loca[n]==e.loca[n+1])return null;var s={};if(s.noc=i.readShort(r,o),o+=2,s.xMin=i.readShort(r,o),o+=2,s.yMin=i.readShort(r,o),o+=2,s.xMax=i.readShort(r,o),o+=2,s.yMax=i.readShort(r,o),o+=2,s.xMin>=s.xMax||s.yMin>=s.yMax)return null;if(s.noc>0){s.endPts=[];for(var a=0;a<s.noc;a++)s.endPts.push(i.readUshort(r,o)),o+=2;var l=i.readUshort(r,o);if(o+=2,r.length-o<l)return null;s.instructions=i.readBytes(r,o,l),o+=l;var c=s.endPts[s.noc-1]+1;for(s.flags=[],a=0;a<c;a++){var u=r[o];if(o++,s.flags.push(u),0!=(8&u)){var d=r[o];o++;for(var h=0;h<d;h++)s.flags.push(u),a++}}for(s.xs=[],a=0;a<c;a++){var p=0!=(2&s.flags[a]),f=0!=(16&s.flags[a]);p?(s.xs.push(f?r[o]:-r[o]),o++):f?s.xs.push(0):(s.xs.push(i.readShort(r,o)),o+=2)}for(s.ys=[],a=0;a<c;a++)p=0!=(4&s.flags[a]),f=0!=(32&s.flags[a]),p?(s.ys.push(f?r[o]:-r[o]),o++):f?s.ys.push(0):(s.ys.push(i.readShort(r,o)),o+=2);var m=0,g=0;for(a=0;a<c;a++)m+=s.xs[a],g+=s.ys[a],s.xs[a]=m,s.ys[a]=g}else{var v;s.parts=[];do{v=i.readUshort(r,o),o+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(s.parts.push(y),y.glyphIndex=i.readUshort(r,o),o+=2,1&v){var b=i.readShort(r,o);o+=2;var x=i.readShort(r,o);o+=2}else b=i.readInt8(r,o),o++,x=i.readInt8(r,o),o++;2&v?(y.m.tx=b,y.m.ty=x):(y.p1=b,y.p2=x),8&v?(y.m.a=y.m.d=i.readF2dot14(r,o),o+=2):64&v?(y.m.a=i.readF2dot14(r,o),o+=2,y.m.d=i.readF2dot14(r,o),o+=2):128&v&&(y.m.a=i.readF2dot14(r,o),o+=2,y.m.b=i.readF2dot14(r,o),o+=2,y.m.c=i.readF2dot14(r,o),o+=2,y.m.d=i.readF2dot14(r,o),o+=2)}while(32&v);if(256&v){var _=i.readUshort(r,o);for(o+=2,s.instr=[],a=0;a<_;a++)s.instr.push(r[o]),o++}}return s},t.GDEF={},t.GDEF.parse=function(e,n,i,r){var o=n;n+=4;var s=t._bin.readUshort(e,n);return{glyphClassDef:0===s?null:t._lctf.readClassDef(e,o+s)}},t.GPOS={},t.GPOS.parse=function(e,n,i,r){return t._lctf.parse(e,n,i,r,t.GPOS.subt)},t.GPOS.subt=function(e,n,i,r){var o=t._bin,s=i,a={};if(a.fmt=o.readUshort(e,i),i+=2,1==n||2==n||3==n||7==n||8==n&&a.fmt<=2){var l=o.readUshort(e,i);i+=2,a.coverage=t._lctf.readCoverage(e,l+s)}if(1==n&&1==a.fmt){var c=o.readUshort(e,i);i+=2,0!=c&&(a.pos=t.GPOS.readValueRecord(e,i,c))}else if(2==n&&a.fmt>=1&&a.fmt<=2){c=o.readUshort(e,i),i+=2;var u=o.readUshort(e,i);i+=2;var d=t._lctf.numOfOnes(c),h=t._lctf.numOfOnes(u);if(1==a.fmt){a.pairsets=[];var p=o.readUshort(e,i);i+=2;for(var f=0;f<p;f++){var m=s+o.readUshort(e,i);i+=2;var g=o.readUshort(e,m);m+=2;for(var v=[],y=0;y<g;y++){var b=o.readUshort(e,m);m+=2,0!=c&&(E=t.GPOS.readValueRecord(e,m,c),m+=2*d),0!=u&&(C=t.GPOS.readValueRecord(e,m,u),m+=2*h),v.push({gid2:b,val1:E,val2:C})}a.pairsets.push(v)}}if(2==a.fmt){var x=o.readUshort(e,i);i+=2;var _=o.readUshort(e,i);i+=2;var w=o.readUshort(e,i);i+=2;var S=o.readUshort(e,i);for(i+=2,a.classDef1=t._lctf.readClassDef(e,s+x),a.classDef2=t._lctf.readClassDef(e,s+_),a.matrix=[],f=0;f<w;f++){var M=[];for(y=0;y<S;y++){var E=null,C=null;0!=c&&(E=t.GPOS.readValueRecord(e,i,c),i+=2*d),0!=u&&(C=t.GPOS.readValueRecord(e,i,u),i+=2*h),M.push({val1:E,val2:C})}a.matrix.push(M)}}}else if(4==n&&1==a.fmt)a.markCoverage=t._lctf.readCoverage(e,o.readUshort(e,i)+s),a.baseCoverage=t._lctf.readCoverage(e,o.readUshort(e,i+2)+s),a.markClassCount=o.readUshort(e,i+4),a.markArray=t.GPOS.readMarkArray(e,o.readUshort(e,i+6)+s),a.baseArray=t.GPOS.readBaseArray(e,o.readUshort(e,i+8)+s,a.markClassCount);else if(6==n&&1==a.fmt)a.mark1Coverage=t._lctf.readCoverage(e,o.readUshort(e,i)+s),a.mark2Coverage=t._lctf.readCoverage(e,o.readUshort(e,i+2)+s),a.markClassCount=o.readUshort(e,i+4),a.mark1Array=t.GPOS.readMarkArray(e,o.readUshort(e,i+6)+s),a.mark2Array=t.GPOS.readBaseArray(e,o.readUshort(e,i+8)+s,a.markClassCount);else{if(9==n&&1==a.fmt){var T=o.readUshort(e,i);i+=2;var A=o.readUint(e,i);if(i+=4,9==r.ltype)r.ltype=T;else if(r.ltype!=T)throw"invalid extension substitution";return t.GPOS.subt(e,r.ltype,s+A)}console.debug("unsupported GPOS table LookupType",n,"format",a.fmt)}return a},t.GPOS.readValueRecord=function(e,n,i){var r=t._bin,o=[];return o.push(1&i?r.readShort(e,n):0),n+=1&i?2:0,o.push(2&i?r.readShort(e,n):0),n+=2&i?2:0,o.push(4&i?r.readShort(e,n):0),n+=4&i?2:0,o.push(8&i?r.readShort(e,n):0),n+=8&i?2:0,o},t.GPOS.readBaseArray=function(e,n,i){var r=t._bin,o=[],s=n,a=r.readUshort(e,n);n+=2;for(var l=0;l<a;l++){for(var c=[],u=0;u<i;u++)c.push(t.GPOS.readAnchorRecord(e,s+r.readUshort(e,n))),n+=2;o.push(c)}return o},t.GPOS.readMarkArray=function(e,n){var i=t._bin,r=[],o=n,s=i.readUshort(e,n);n+=2;for(var a=0;a<s;a++){var l=t.GPOS.readAnchorRecord(e,i.readUshort(e,n+2)+o);l.markClass=i.readUshort(e,n),r.push(l),n+=4}return r},t.GPOS.readAnchorRecord=function(e,n){var i=t._bin,r={};return r.fmt=i.readUshort(e,n),r.x=i.readShort(e,n+2),r.y=i.readShort(e,n+4),r},t.GSUB={},t.GSUB.parse=function(e,n,i,r){return t._lctf.parse(e,n,i,r,t.GSUB.subt)},t.GSUB.subt=function(e,n,i,r){var o=t._bin,s=i,a={};if(a.fmt=o.readUshort(e,i),i+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&a.fmt<=2||6==n&&a.fmt<=2){var l=o.readUshort(e,i);i+=2,a.coverage=t._lctf.readCoverage(e,s+l)}if(1==n&&a.fmt>=1&&a.fmt<=2){if(1==a.fmt)a.delta=o.readShort(e,i),i+=2;else if(2==a.fmt){var c=o.readUshort(e,i);i+=2,a.newg=o.readUshorts(e,i,c),i+=2*a.newg.length}}else if(2==n&&1==a.fmt){c=o.readUshort(e,i),i+=2,a.seqs=[];for(var u=0;u<c;u++){var d=o.readUshort(e,i)+s;i+=2;var h=o.readUshort(e,d);a.seqs.push(o.readUshorts(e,d+2,h))}}else if(4==n)for(a.vals=[],c=o.readUshort(e,i),i+=2,u=0;u<c;u++){var p=o.readUshort(e,i);i+=2,a.vals.push(t.GSUB.readLigatureSet(e,s+p))}else if(5==n&&2==a.fmt){if(2==a.fmt){var f=o.readUshort(e,i);i+=2,a.cDef=t._lctf.readClassDef(e,s+f),a.scset=[];var m=o.readUshort(e,i);for(i+=2,u=0;u<m;u++){var g=o.readUshort(e,i);i+=2,a.scset.push(0==g?null:t.GSUB.readSubClassSet(e,s+g))}}}else if(6==n&&3==a.fmt){if(3==a.fmt){for(u=0;u<3;u++){c=o.readUshort(e,i),i+=2;for(var v=[],y=0;y<c;y++)v.push(t._lctf.readCoverage(e,s+o.readUshort(e,i+2*y)));i+=2*c,0==u&&(a.backCvg=v),1==u&&(a.inptCvg=v),2==u&&(a.ahedCvg=v)}c=o.readUshort(e,i),i+=2,a.lookupRec=t.GSUB.readSubstLookupRecords(e,i,c)}}else{if(7==n&&1==a.fmt){var b=o.readUshort(e,i);i+=2;var x=o.readUint(e,i);if(i+=4,9==r.ltype)r.ltype=b;else if(r.ltype!=b)throw"invalid extension substitution";return t.GSUB.subt(e,r.ltype,s+x)}console.debug("unsupported GSUB table LookupType",n,"format",a.fmt)}return a},t.GSUB.readSubClassSet=function(e,n){var i=t._bin.readUshort,r=n,o=[],s=i(e,n);n+=2;for(var a=0;a<s;a++){var l=i(e,n);n+=2,o.push(t.GSUB.readSubClassRule(e,r+l))}return o},t.GSUB.readSubClassRule=function(e,n){var i=t._bin.readUshort,r={},o=i(e,n),s=i(e,n+=2);n+=2,r.input=[];for(var a=0;a<o-1;a++)r.input.push(i(e,n)),n+=2;return r.substLookupRecords=t.GSUB.readSubstLookupRecords(e,n,s),r},t.GSUB.readSubstLookupRecords=function(e,n,i){for(var r=t._bin.readUshort,o=[],s=0;s<i;s++)o.push(r(e,n),r(e,n+2)),n+=4;return o},t.GSUB.readChainSubClassSet=function(e,n){var i=t._bin,r=n,o=[],s=i.readUshort(e,n);n+=2;for(var a=0;a<s;a++){var l=i.readUshort(e,n);n+=2,o.push(t.GSUB.readChainSubClassRule(e,r+l))}return o},t.GSUB.readChainSubClassRule=function(e,n){for(var i=t._bin,r={},o=["backtrack","input","lookahead"],s=0;s<o.length;s++){var a=i.readUshort(e,n);n+=2,1==s&&a--,r[o[s]]=i.readUshorts(e,n,a),n+=2*r[o[s]].length}return a=i.readUshort(e,n),n+=2,r.subst=i.readUshorts(e,n,2*a),n+=2*r.subst.length,r},t.GSUB.readLigatureSet=function(e,n){var i=t._bin,r=n,o=[],s=i.readUshort(e,n);n+=2;for(var a=0;a<s;a++){var l=i.readUshort(e,n);n+=2,o.push(t.GSUB.readLigature(e,r+l))}return o},t.GSUB.readLigature=function(e,n){var i=t._bin,r={chain:[]};r.nglyph=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);n+=2;for(var s=0;s<o-1;s++)r.chain.push(i.readUshort(e,n)),n+=2;return r},t.head={},t.head.parse=function(e,n,i){var r=t._bin,o={};return r.readFixed(e,n),n+=4,o.fontRevision=r.readFixed(e,n),n+=4,r.readUint(e,n),n+=4,r.readUint(e,n),n+=4,o.flags=r.readUshort(e,n),n+=2,o.unitsPerEm=r.readUshort(e,n),n+=2,o.created=r.readUint64(e,n),n+=8,o.modified=r.readUint64(e,n),n+=8,o.xMin=r.readShort(e,n),n+=2,o.yMin=r.readShort(e,n),n+=2,o.xMax=r.readShort(e,n),n+=2,o.yMax=r.readShort(e,n),n+=2,o.macStyle=r.readUshort(e,n),n+=2,o.lowestRecPPEM=r.readUshort(e,n),n+=2,o.fontDirectionHint=r.readShort(e,n),n+=2,o.indexToLocFormat=r.readShort(e,n),n+=2,o.glyphDataFormat=r.readShort(e,n),n+=2,o},t.hhea={},t.hhea.parse=function(e,n,i){var r=t._bin,o={};return r.readFixed(e,n),n+=4,o.ascender=r.readShort(e,n),n+=2,o.descender=r.readShort(e,n),n+=2,o.lineGap=r.readShort(e,n),n+=2,o.advanceWidthMax=r.readUshort(e,n),n+=2,o.minLeftSideBearing=r.readShort(e,n),n+=2,o.minRightSideBearing=r.readShort(e,n),n+=2,o.xMaxExtent=r.readShort(e,n),n+=2,o.caretSlopeRise=r.readShort(e,n),n+=2,o.caretSlopeRun=r.readShort(e,n),n+=2,o.caretOffset=r.readShort(e,n),n+=2,n+=8,o.metricDataFormat=r.readShort(e,n),n+=2,o.numberOfHMetrics=r.readUshort(e,n),n+=2,o},t.hmtx={},t.hmtx.parse=function(e,n,i,r){for(var o=t._bin,s={aWidth:[],lsBearing:[]},a=0,l=0,c=0;c<r.maxp.numGlyphs;c++)c<r.hhea.numberOfHMetrics&&(a=o.readUshort(e,n),n+=2,l=o.readShort(e,n),n+=2),s.aWidth.push(a),s.lsBearing.push(l);return s},t.kern={},t.kern.parse=function(e,n,i,r){var o=t._bin,s=o.readUshort(e,n);if(n+=2,1==s)return t.kern.parseV1(e,n-2,i,r);var a=o.readUshort(e,n);n+=2;for(var l={glyph1:[],rval:[]},c=0;c<a;c++){n+=2,i=o.readUshort(e,n),n+=2;var u=o.readUshort(e,n);n+=2;var d=u>>>8;if(0!=(d&=15))throw"unknown kern table format: "+d;n=t.kern.readFormat0(e,n,l)}return l},t.kern.parseV1=function(e,n,i,r){var o=t._bin;o.readFixed(e,n),n+=4;var s=o.readUint(e,n);n+=4;for(var a={glyph1:[],rval:[]},l=0;l<s;l++){o.readUint(e,n),n+=4;var c=o.readUshort(e,n);n+=2,o.readUshort(e,n),n+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=t.kern.readFormat0(e,n,a)}return a},t.kern.readFormat0=function(e,n,i){var r=t._bin,o=-1,s=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2;for(var a=0;a<s;a++){var l=r.readUshort(e,n);n+=2;var c=r.readUshort(e,n);n+=2;var u=r.readShort(e,n);n+=2,l!=o&&(i.glyph1.push(l),i.rval.push({glyph2:[],vals:[]}));var d=i.rval[i.rval.length-1];d.glyph2.push(c),d.vals.push(u),o=l}return n},t.loca={},t.loca.parse=function(e,n,i,r){var o=t._bin,s=[],a=r.head.indexToLocFormat,l=r.maxp.numGlyphs+1;if(0==a)for(var c=0;c<l;c++)s.push(o.readUshort(e,n+(c<<1))<<1);if(1==a)for(c=0;c<l;c++)s.push(o.readUint(e,n+(c<<2)));return s},t.maxp={},t.maxp.parse=function(e,n,i){var r=t._bin,o={},s=r.readUint(e,n);return n+=4,o.numGlyphs=r.readUshort(e,n),n+=2,65536==s&&(o.maxPoints=r.readUshort(e,n),n+=2,o.maxContours=r.readUshort(e,n),n+=2,o.maxCompositePoints=r.readUshort(e,n),n+=2,o.maxCompositeContours=r.readUshort(e,n),n+=2,o.maxZones=r.readUshort(e,n),n+=2,o.maxTwilightPoints=r.readUshort(e,n),n+=2,o.maxStorage=r.readUshort(e,n),n+=2,o.maxFunctionDefs=r.readUshort(e,n),n+=2,o.maxInstructionDefs=r.readUshort(e,n),n+=2,o.maxStackElements=r.readUshort(e,n),n+=2,o.maxSizeOfInstructions=r.readUshort(e,n),n+=2,o.maxComponentElements=r.readUshort(e,n),n+=2,o.maxComponentDepth=r.readUshort(e,n),n+=2),o},t.name={},t.name.parse=function(e,n,i){var r=t._bin,o={};r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2,r.readUshort(e,n);for(var a,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=n+=2,u=0;u<s;u++){var d=r.readUshort(e,n);n+=2;var h=r.readUshort(e,n);n+=2;var p=r.readUshort(e,n);n+=2;var f=r.readUshort(e,n);n+=2;var m=r.readUshort(e,n);n+=2;var g=r.readUshort(e,n);n+=2;var v,y=l[f],b=c+12*s+g;if(0==d)v=r.readUnicode(e,b,m/2);else if(3==d&&0==h)v=r.readUnicode(e,b,m/2);else if(0==h)v=r.readASCII(e,b,m);else if(1==h)v=r.readUnicode(e,b,m/2);else if(3==h)v=r.readUnicode(e,b,m/2);else{if(1!=d)throw"unknown encoding "+h+", platformID: "+d;v=r.readASCII(e,b,m),console.debug("reading unknown MAC encoding "+h+" as ASCII")}var x="p"+d+","+p.toString(16);null==o[x]&&(o[x]={}),o[x][void 0!==y?y:f]=v,o[x]._lang=p}for(var _ in o)if(null!=o[_].postScriptName&&1033==o[_]._lang)return o[_];for(var _ in o)if(null!=o[_].postScriptName&&0==o[_]._lang)return o[_];for(var _ in o)if(null!=o[_].postScriptName&&3084==o[_]._lang)return o[_];for(var _ in o)if(null!=o[_].postScriptName)return o[_];for(var _ in o){a=_;break}return console.debug("returning name table with languageID "+o[a]._lang),o[a]},t["OS/2"]={},t["OS/2"].parse=function(e,n,i){var r=t._bin.readUshort(e,n);n+=2;var o={};if(0==r)t["OS/2"].version0(e,n,o);else if(1==r)t["OS/2"].version1(e,n,o);else if(2==r||3==r||4==r)t["OS/2"].version2(e,n,o);else{if(5!=r)throw"unknown OS/2 table version: "+r;t["OS/2"].version5(e,n,o)}return o},t["OS/2"].version0=function(e,n,i){var r=t._bin;return i.xAvgCharWidth=r.readShort(e,n),n+=2,i.usWeightClass=r.readUshort(e,n),n+=2,i.usWidthClass=r.readUshort(e,n),n+=2,i.fsType=r.readUshort(e,n),n+=2,i.ySubscriptXSize=r.readShort(e,n),n+=2,i.ySubscriptYSize=r.readShort(e,n),n+=2,i.ySubscriptXOffset=r.readShort(e,n),n+=2,i.ySubscriptYOffset=r.readShort(e,n),n+=2,i.ySuperscriptXSize=r.readShort(e,n),n+=2,i.ySuperscriptYSize=r.readShort(e,n),n+=2,i.ySuperscriptXOffset=r.readShort(e,n),n+=2,i.ySuperscriptYOffset=r.readShort(e,n),n+=2,i.yStrikeoutSize=r.readShort(e,n),n+=2,i.yStrikeoutPosition=r.readShort(e,n),n+=2,i.sFamilyClass=r.readShort(e,n),n+=2,i.panose=r.readBytes(e,n,10),n+=10,i.ulUnicodeRange1=r.readUint(e,n),n+=4,i.ulUnicodeRange2=r.readUint(e,n),n+=4,i.ulUnicodeRange3=r.readUint(e,n),n+=4,i.ulUnicodeRange4=r.readUint(e,n),n+=4,i.achVendID=[r.readInt8(e,n),r.readInt8(e,n+1),r.readInt8(e,n+2),r.readInt8(e,n+3)],n+=4,i.fsSelection=r.readUshort(e,n),n+=2,i.usFirstCharIndex=r.readUshort(e,n),n+=2,i.usLastCharIndex=r.readUshort(e,n),n+=2,i.sTypoAscender=r.readShort(e,n),n+=2,i.sTypoDescender=r.readShort(e,n),n+=2,i.sTypoLineGap=r.readShort(e,n),n+=2,i.usWinAscent=r.readUshort(e,n),n+=2,i.usWinDescent=r.readUshort(e,n),n+2},t["OS/2"].version1=function(e,n,i){var r=t._bin;return n=t["OS/2"].version0(e,n,i),i.ulCodePageRange1=r.readUint(e,n),n+=4,i.ulCodePageRange2=r.readUint(e,n),n+4},t["OS/2"].version2=function(e,n,i){var r=t._bin;return n=t["OS/2"].version1(e,n,i),i.sxHeight=r.readShort(e,n),n+=2,i.sCapHeight=r.readShort(e,n),n+=2,i.usDefault=r.readUshort(e,n),n+=2,i.usBreak=r.readUshort(e,n),n+=2,i.usMaxContext=r.readUshort(e,n),n+2},t["OS/2"].version5=function(e,n,i){var r=t._bin;return n=t["OS/2"].version2(e,n,i),i.usLowerOpticalPointSize=r.readUshort(e,n),n+=2,i.usUpperOpticalPointSize=r.readUshort(e,n),n+2},t.post={},t.post.parse=function(e,n,i){var r=t._bin,o={};return o.version=r.readFixed(e,n),n+=4,o.italicAngle=r.readFixed(e,n),n+=4,o.underlinePosition=r.readShort(e,n),n+=2,o.underlineThickness=r.readShort(e,n),n+=2,o},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var n=e.cmap,i=-1;if(null!=n.p0e4?i=n.p0e4:null!=n.p3e1?i=n.p3e1:null!=n.p1e0?i=n.p1e0:null!=n.p0e3&&(i=n.p0e3),-1==i)throw"no familiar platform and encoding!";var r=n.tables[i];if(0==r.format)return t>=r.map.length?0:r.map[t];if(4==r.format){for(var o=-1,s=0;s<r.endCount.length;s++)if(t<=r.endCount[s]){o=s;break}return-1==o||r.startCount[o]>t?0:65535&(0!=r.idRangeOffset[o]?r.glyphIdArray[t-r.startCount[o]+(r.idRangeOffset[o]>>1)-(r.idRangeOffset.length-o)]:t+r.idDelta[o])}if(12==r.format){if(t>r.groups[r.groups.length-1][1])return 0;for(s=0;s<r.groups.length;s++){var a=r.groups[s];if(a[0]<=t&&t<=a[1])return a[2]+(t-a[0])}return 0}throw"unknown cmap table format "+r.format},t.U.glyphToPath=function(e,n){var i={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[n]){var r=e.SVG.entries[n];return null==r?i:("string"==typeof r&&(r=t.SVG.toPath(r),e.SVG.entries[n]=r),r)}if(e.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},s=e.CFF,a=e.CFF.Private;if(s.ROS){for(var l=0;s.FDSelect[l+2]<=n;)l+=2;a=s.FDArray[s.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[n],o,s,a,i)}else e.glyf&&t.U._drawGlyf(n,e,i);return i},t.U._drawGlyf=function(e,n,i){var r=n.glyf[e];null==r&&(r=n.glyf[e]=t.glyf._parseGlyf(n,e)),null!=r&&(r.noc>-1?t.U._simpleGlyph(r,i):t.U._compoGlyph(r,n,i))},t.U._simpleGlyph=function(e,n){for(var i=0;i<e.noc;i++){for(var r=0==i?0:e.endPts[i-1]+1,o=e.endPts[i],s=r;s<=o;s++){var a=s==r?o:s-1,l=s==o?r:s+1,c=1&e.flags[s],u=1&e.flags[a],d=1&e.flags[l],h=e.xs[s],p=e.ys[s];if(s==r)if(c){if(!u){t.U.P.moveTo(n,h,p);continue}t.U.P.moveTo(n,e.xs[a],e.ys[a])}else u?t.U.P.moveTo(n,e.xs[a],e.ys[a]):t.U.P.moveTo(n,(e.xs[a]+h)/2,(e.ys[a]+p)/2);c?u&&t.U.P.lineTo(n,h,p):d?t.U.P.qcurveTo(n,h,p,e.xs[l],e.ys[l]):t.U.P.qcurveTo(n,h,p,(h+e.xs[l])/2,(p+e.ys[l])/2)}t.U.P.closePath(n)}},t.U._compoGlyph=function(e,n,i){for(var r=0;r<e.parts.length;r++){var o={cmds:[],crds:[]},s=e.parts[r];t.U._drawGlyf(s.glyphIndex,n,o);for(var a=s.m,l=0;l<o.crds.length;l+=2){var c=o.crds[l],u=o.crds[l+1];i.crds.push(c*a.a+u*a.b+a.tx),i.crds.push(c*a.c+u*a.d+a.ty)}for(l=0;l<o.cmds.length;l++)i.cmds.push(o.cmds[l])}},t.U._getGlyphClass=function(e,n){var i=t._lctf.getInterval(n,e);return-1==i?0:n[i+2]},t.U._applySubs=function(e,n,i,r){for(var o=e.length-n-1,s=0;s<i.tabs.length;s++)if(null!=i.tabs[s]){var a,l=i.tabs[s];if(!l.coverage||-1!=(a=t._lctf.coverageIndex(l.coverage,e[n])))if(1==i.ltype)e[n],1==l.fmt?e[n]=e[n]+l.delta:e[n]=l.newg[a];else if(4==i.ltype)for(var c=l.vals[a],u=0;u<c.length;u++){var d=c[u],h=d.chain.length;if(!(h>o)){for(var p=!0,f=0,m=0;m<h;m++){for(;-1==e[n+f+(1+m)];)f++;d.chain[m]!=e[n+f+(1+m)]&&(p=!1)}if(p){for(e[n]=d.nglyph,m=0;m<h+f;m++)e[n+m+1]=-1;break}}}else if(5==i.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[n]),v=l.cDef[g+2],y=l.scset[v],b=0;b<y.length;b++){var x=y[b],_=x.input;if(!(_.length>o)){for(p=!0,m=0;m<_.length;m++){var w=t._lctf.getInterval(l.cDef,e[n+1+m]);if(-1==g&&l.cDef[w+2]!=_[m]){p=!1;break}}if(p){var S=x.substLookupRecords;for(u=0;u<S.length;u+=2)S[u],S[u+1]}}}else if(6==i.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,n-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,n))continue;if(!t.U._glsCovered(e,l.ahedCvg,n+l.inptCvg.length))continue;var M=l.lookupRec;for(b=0;b<M.length;b+=2){g=M[b];var E=r[M[b+1]];t.U._applySubs(e,n+g,E,r)}}}},t.U._glsCovered=function(e,n,i){for(var r=0;r<n.length;r++)if(-1==t._lctf.coverageIndex(n[r],e[i+r]))return!1;return!0},t.U.glyphsToPath=function(e,n,i){for(var r={cmds:[],crds:[]},o=0,s=0;s<n.length;s++){var a=n[s];if(-1!=a){for(var l=s<n.length-1&&-1!=n[s+1]?n[s+1]:0,c=t.U.glyphToPath(e,a),u=0;u<c.crds.length;u+=2)r.crds.push(c.crds[u]+o),r.crds.push(c.crds[u+1]);for(i&&r.cmds.push(i),u=0;u<c.cmds.length;u++)r.cmds.push(c.cmds[u]);i&&r.cmds.push("X"),o+=e.hmtx.aWidth[a],s<n.length-1&&(o+=t.U.getPairAdjustment(e,a,l))}}return r},t.U.P={},t.U.P.moveTo=function(e,t,n){e.cmds.push("M"),e.crds.push(t,n)},t.U.P.lineTo=function(e,t,n){e.cmds.push("L"),e.crds.push(t,n)},t.U.P.curveTo=function(e,t,n,i,r,o,s){e.cmds.push("C"),e.crds.push(t,n,i,r,o,s)},t.U.P.qcurveTo=function(e,t,n,i,r){e.cmds.push("Q"),e.crds.push(t,n,i,r)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,n,i,r,o){for(var s=n.stack,a=n.nStems,l=n.haveWidth,c=n.width,u=n.open,d=0,h=n.x,p=n.y,f=0,m=0,g=0,v=0,y=0,b=0,x=0,_=0,w=0,S=0,M={val:0,size:0};d<e.length;){t.CFF.getCharString(e,d,M);var E=M.val;if(d+=M.size,"o1"==E||"o18"==E)s.length%2!=0&&!l&&(c=s.shift()+r.nominalWidthX),a+=s.length>>1,s.length=0,l=!0;else if("o3"==E||"o23"==E)s.length%2!=0&&!l&&(c=s.shift()+r.nominalWidthX),a+=s.length>>1,s.length=0,l=!0;else if("o4"==E)s.length>1&&!l&&(c=s.shift()+r.nominalWidthX,l=!0),u&&t.U.P.closePath(o),p+=s.pop(),t.U.P.moveTo(o,h,p),u=!0;else if("o5"==E)for(;s.length>0;)h+=s.shift(),p+=s.shift(),t.U.P.lineTo(o,h,p);else if("o6"==E||"o7"==E)for(var C=s.length,T="o6"==E,A=0;A<C;A++){var P=s.shift();T?h+=P:p+=P,T=!T,t.U.P.lineTo(o,h,p)}else if("o8"==E||"o24"==E){C=s.length;for(var D=0;D+6<=C;)f=h+s.shift(),m=p+s.shift(),g=f+s.shift(),v=m+s.shift(),h=g+s.shift(),p=v+s.shift(),t.U.P.curveTo(o,f,m,g,v,h,p),D+=6;"o24"==E&&(h+=s.shift(),p+=s.shift(),t.U.P.lineTo(o,h,p))}else{if("o11"==E)break;if("o1234"==E||"o1235"==E||"o1236"==E||"o1237"==E)"o1234"==E&&(m=p,g=(f=h+s.shift())+s.shift(),S=v=m+s.shift(),b=v,_=p,h=(x=(y=(w=g+s.shift())+s.shift())+s.shift())+s.shift(),t.U.P.curveTo(o,f,m,g,v,w,S),t.U.P.curveTo(o,y,b,x,_,h,p)),"o1235"==E&&(f=h+s.shift(),m=p+s.shift(),g=f+s.shift(),v=m+s.shift(),w=g+s.shift(),S=v+s.shift(),y=w+s.shift(),b=S+s.shift(),x=y+s.shift(),_=b+s.shift(),h=x+s.shift(),p=_+s.shift(),s.shift(),t.U.P.curveTo(o,f,m,g,v,w,S),t.U.P.curveTo(o,y,b,x,_,h,p)),"o1236"==E&&(f=h+s.shift(),m=p+s.shift(),g=f+s.shift(),S=v=m+s.shift(),b=v,x=(y=(w=g+s.shift())+s.shift())+s.shift(),_=b+s.shift(),h=x+s.shift(),t.U.P.curveTo(o,f,m,g,v,w,S),t.U.P.curveTo(o,y,b,x,_,h,p)),"o1237"==E&&(f=h+s.shift(),m=p+s.shift(),g=f+s.shift(),v=m+s.shift(),w=g+s.shift(),S=v+s.shift(),y=w+s.shift(),b=S+s.shift(),x=y+s.shift(),_=b+s.shift(),Math.abs(x-h)>Math.abs(_-p)?h=x+s.shift():p=_+s.shift(),t.U.P.curveTo(o,f,m,g,v,w,S),t.U.P.curveTo(o,y,b,x,_,h,p));else if("o14"==E){if(s.length>0&&!l&&(c=s.shift()+i.nominalWidthX,l=!0),4==s.length){var k=s.shift(),R=s.shift(),N=s.shift(),I=s.shift(),L=t.CFF.glyphBySE(i,N),O=t.CFF.glyphBySE(i,I);t.U._drawCFF(i.CharStrings[L],n,i,r,o),n.x=k,n.y=R,t.U._drawCFF(i.CharStrings[O],n,i,r,o)}u&&(t.U.P.closePath(o),u=!1)}else if("o19"==E||"o20"==E)s.length%2!=0&&!l&&(c=s.shift()+r.nominalWidthX),a+=s.length>>1,s.length=0,l=!0,d+=a+7>>3;else if("o21"==E)s.length>2&&!l&&(c=s.shift()+r.nominalWidthX,l=!0),p+=s.pop(),h+=s.pop(),u&&t.U.P.closePath(o),t.U.P.moveTo(o,h,p),u=!0;else if("o22"==E)s.length>1&&!l&&(c=s.shift()+r.nominalWidthX,l=!0),h+=s.pop(),u&&t.U.P.closePath(o),t.U.P.moveTo(o,h,p),u=!0;else if("o25"==E){for(;s.length>6;)h+=s.shift(),p+=s.shift(),t.U.P.lineTo(o,h,p);f=h+s.shift(),m=p+s.shift(),g=f+s.shift(),v=m+s.shift(),h=g+s.shift(),p=v+s.shift(),t.U.P.curveTo(o,f,m,g,v,h,p)}else if("o26"==E)for(s.length%2&&(h+=s.shift());s.length>0;)f=h,m=p+s.shift(),h=g=f+s.shift(),p=(v=m+s.shift())+s.shift(),t.U.P.curveTo(o,f,m,g,v,h,p);else if("o27"==E)for(s.length%2&&(p+=s.shift());s.length>0;)m=p,g=(f=h+s.shift())+s.shift(),v=m+s.shift(),h=g+s.shift(),p=v,t.U.P.curveTo(o,f,m,g,v,h,p);else if("o10"==E||"o29"==E){var z="o10"==E?r:i;if(0==s.length)console.debug("error: empty stack");else{var U=s.pop(),F=z.Subrs[U+z.Bias];n.x=h,n.y=p,n.nStems=a,n.haveWidth=l,n.width=c,n.open=u,t.U._drawCFF(F,n,i,r,o),h=n.x,p=n.y,a=n.nStems,l=n.haveWidth,c=n.width,u=n.open}}else if("o30"==E||"o31"==E){var j=s.length,B=(D=0,"o31"==E);for(D+=j-(C=-3&j);D<C;)B?(m=p,g=(f=h+s.shift())+s.shift(),p=(v=m+s.shift())+s.shift(),C-D==5?(h=g+s.shift(),D++):h=g,B=!1):(f=h,m=p+s.shift(),g=f+s.shift(),v=m+s.shift(),h=g+s.shift(),C-D==5?(p=v+s.shift(),D++):p=v,B=!0),t.U.P.curveTo(o,f,m,g,v,h,p),D+=4}else{if("o"==(E+"").charAt(0))throw console.debug("Unknown operation: "+E,e),E;s.push(E)}}}n.x=h,n.y=p,n.nStems=a,n.haveWidth=l,n.width=c,n.open=u};var n=t,i={Typr:n};return e.Typr=n,e.default=i,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr},function(){return function(e){var t=Uint8Array,n=Uint16Array,i=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(e,t){for(var r=new n(31),o=0;o<31;++o)r[o]=t+=1<<e[o-1];var s=new i(r[30]);for(o=1;o<30;++o)for(var a=r[o];a<r[o+1];++a)s[a]=a-r[o]<<5|o;return[r,s]},l=a(r,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var d=a(o,0)[0],h=new n(32768),p=0;p<32768;++p){var f=(43690&p)>>>1|(21845&p)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,h[p]=((65280&f)>>>8|(255&f)<<8)>>>1}var m=function(e,t,i){for(var r=e.length,o=0,s=new n(t);o<r;++o)++s[e[o]-1];var a,l=new n(t);for(o=0;o<t;++o)l[o]=l[o-1]+s[o-1]<<1;if(i){a=new n(1<<t);var c=15-t;for(o=0;o<r;++o)if(e[o])for(var u=o<<4|e[o],d=t-e[o],p=l[e[o]-1]++<<d,f=p|(1<<d)-1;p<=f;++p)a[h[p]>>>c]=u}else for(a=new n(r),o=0;o<r;++o)e[o]&&(a[o]=h[l[e[o]-1]++]>>>15-e[o]);return a},g=new t(288);for(p=0;p<144;++p)g[p]=8;for(p=144;p<256;++p)g[p]=9;for(p=256;p<280;++p)g[p]=7;for(p=280;p<288;++p)g[p]=8;var v=new t(32);for(p=0;p<32;++p)v[p]=5;var y=m(g,9,1),b=m(v,5,1),x=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},_=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},w=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},S=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],M=function(e,t,n){var i=new Error(t||S[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,M),!n)throw i;return i},E=function(e,a,l){var u=e.length;if(!u||l&&!l.l&&u<5)return a||new t(0);var h=!a||l,p=!l||l.i;l||(l={}),a||(a=new t(3*u));var f,g=function(e){var n=a.length;if(e>n){var i=new t(Math.max(2*n,e));i.set(a),a=i}},v=l.f||0,S=l.p||0,E=l.b||0,C=l.l,T=l.d,A=l.m,P=l.n,D=8*u;do{if(!C){l.f=v=_(e,S,1);var k=_(e,S+1,3);if(S+=3,!k){var R=e[(H=((f=S)/8|0)+(7&f&&1)+4)-4]|e[H-3]<<8,N=H+R;if(N>u){p&&M(0);break}h&&g(E+R),a.set(e.subarray(H,N),E),l.b=E+=R,l.p=S=8*N;continue}if(1==k)C=y,T=b,A=9,P=5;else if(2==k){var I=_(e,S,31)+257,L=_(e,S+10,15)+4,O=I+_(e,S+5,31)+1;S+=14;for(var z=new t(O),U=new t(19),F=0;F<L;++F)U[s[F]]=_(e,S+3*F,7);S+=3*L;var j=x(U),B=(1<<j)-1,V=m(U,j,1);for(F=0;F<O;){var H,G=V[_(e,S,B)];if(S+=15&G,(H=G>>>4)<16)z[F++]=H;else{var W=0,X=0;for(16==H?(X=3+_(e,S,3),S+=2,W=z[F-1]):17==H?(X=3+_(e,S,7),S+=3):18==H&&(X=11+_(e,S,127),S+=7);X--;)z[F++]=W}}var Y=z.subarray(0,I),$=z.subarray(I);A=x(Y),P=x($),C=m(Y,A,1),T=m($,P,1)}else M(1);if(S>D){p&&M(0);break}}h&&g(E+131072);for(var q=(1<<A)-1,Z=(1<<P)-1,K=S;;K=S){var J=(W=C[w(e,S)&q])>>>4;if((S+=15&W)>D){p&&M(0);break}if(W||M(2),J<256)a[E++]=J;else{if(256==J){K=S,C=null;break}var Q=J-254;if(J>264){var ee=r[F=J-257];Q=_(e,S,(1<<ee)-1)+c[F],S+=ee}var te=T[w(e,S)&Z],ne=te>>>4;if(te||M(3),S+=15&te,$=d[ne],ne>3&&(ee=o[ne],$+=w(e,S)&(1<<ee)-1,S+=ee),S>D){p&&M(0);break}h&&g(E+131072);for(var ie=E+Q;E<ie;E+=4)a[E]=a[E-$],a[E+1]=a[E+1-$],a[E+2]=a[E+2-$],a[E+3]=a[E+3-$];E=ie}}l.l=C,l.p=K,l.b=E,C&&(v=1,l.m=A,l.d=T,l.n=P)}while(!v);return E==a.length?a:function(e,r,o){(null==r||r<0)&&(r=0),(null==o||o>e.length)&&(o=e.length);var s=new(e instanceof n?n:e instanceof i?i:t)(o-r);return s.set(e.subarray(r,o)),s}(a,0,E)},C=new t(0),T="undefined"!=typeof TextDecoder&&new TextDecoder;try{T.decode(C,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),n=0;function i(){var e=t.getUint16(n);return n+=2,e}function r(){var e=t.getUint32(n);return n+=4,e}function o(e){v.setUint16(y,e),y+=2}function s(e){v.setUint32(y,e),y+=4}for(var a={signature:r(),flavor:r(),length:r(),numTables:i(),reserved:i(),totalSfntSize:r(),majorVersion:i(),minorVersion:i(),metaOffset:r(),metaLength:r(),metaOrigLength:r(),privOffset:r(),privLength:r()},l=0;Math.pow(2,l)<=a.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*a.numTables-c,d=12,h=[],p=0;p<a.numTables;p++)h.push({tag:r(),offset:r(),compLength:r(),origLength:r(),origChecksum:r()}),d+=16;var f,m=new Uint8Array(12+16*h.length+h.reduce(function(e,t){return e+t.origLength+4},0)),g=m.buffer,v=new DataView(g),y=0;return s(a.flavor),o(a.numTables),o(c),o(l),o(u),h.forEach(function(e){s(e.tag),s(e.origChecksum),s(d),s(e.origLength),e.outOffset=d,(d+=e.origLength)%4!=0&&(d+=4-d%4)}),h.forEach(function(t){var n,i=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var r=new Uint8Array(t.origLength);n=new Uint8Array(i,2),E(n,r)}else r=new Uint8Array(i);m.set(r,t.outOffset);var o=0;(d=t.outOffset+t.origLength)%4!=0&&(o=4-d%4),m.set(new Uint8Array(o).buffer,t.outOffset+t.origLength),f=d+o}),g.slice(0,f)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const n={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let r;function o(e){if(!r){const e={R:2,L:1,D:4,C:16,U:32,T:8};r=new Map;for(let t in i){let n=0;i[t].split(",").forEach(i=>{let[o,s]=i.split("+");o=parseInt(o,36),s=s?parseInt(s,36):0,r.set(n+=o,e[t]);for(let a=s;a--;)r.set(++n,e[t])})}}return r.get(e)||32}const s=[null,"isol","init","fina","medi"];function a(e){const t=new Uint8Array(e.length);let n=32,i=1,r=-1;for(let s=0;s<e.length;s++){const a=e.codePointAt(s);let l=0|o(a),c=1;8&l||(21&n?22&l?(c=3,1!==i&&3!==i||t[r]++):33&l&&(2!==i&&4!==i||t[r]--):34&n&&(2!==i&&4!==i||t[r]--),i=t[s]=c,n=l,r=s,a>65535&&s++)}return t}function l(t,n){const i=t.GDEF&&t.GDEF.glyphClassDef;return i?e.U._getGlyphClass(n,i):0}function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<t.length;i++)if("number"===typeof t[i])return t[i]}function u(t){const i=Object.create(null),r=t["OS/2"],o=t.hhea,u=t.head.unitsPerEm,d=c(r&&r.sTypoAscender,o&&o.ascender,u),h={unitsPerEm:u,ascender:d,descender:c(r&&r.sTypoDescender,o&&o.descender,0),capHeight:c(r&&r.sCapHeight,d),xHeight:c(r&&r.sxHeight,d),lineGap:c(r&&r.sTypoLineGap,o&&o.lineGap),supportsCodePoint:n=>e.U.codeToGlyph(t,n)>0,forEachGlyph(r,o,c,u){let d=0;const p=1/h.unitsPerEm*o,f=function(t,n){const i=[];for(let o=0;o<n.length;o++){const r=n.codePointAt(o);r>65535&&o++,i.push(e.U.codeToGlyph(t,r))}const r=t.GSUB;if(r){const{lookupList:t,featureList:o}=r;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];o.forEach(r=>{if(c.test(r.tag))for(let o=0;o<r.tab.length;o++){if(u[r.tab[o]])continue;u[r.tab[o]]=!0;const c=t[r.tab[o]],d=/^(isol|init|fina|medi)$/.test(r.tag);d&&!l&&(l=a(n));for(let n=0;n<i.length;n++)l&&d&&s[l[n]]!==r.tag||e.U._applySubs(i,n,c,t)}})}return i}(t,r);let m=0;const g=function(t,n){const i=new Int16Array(3*n.length);let r=0;for(;r<n.length;r++){const c=n[r];if(-1===c)continue;i[3*r+2]=t.hmtx.aWidth[c];const u=t.GPOS;if(u){const d=u.lookupList;for(let u=0;u<d.length;u++){const h=d[u];for(let u=0;u<h.tabs.length;u++){const d=h.tabs[u];if(1===h.ltype){if(-1!==e._lctf.coverageIndex(d.coverage,c)&&d.pos){a(d.pos,r);break}}else if(2===h.ltype){let t=null,i=o();if(-1!==i){const o=e._lctf.coverageIndex(d.coverage,n[i]);if(-1!==o){if(1===d.fmt){const e=d.pairsets[o];for(let n=0;n<e.length;n++)e[n].gid2===c&&(t=e[n])}else if(2===d.fmt){const r=e.U._getGlyphClass(n[i],d.classDef1),o=e.U._getGlyphClass(c,d.classDef2);t=d.matrix[r][o]}if(t){t.val1&&a(t.val1,i),t.val2&&a(t.val2,r);break}}}}else if(4===h.ltype){const t=e._lctf.coverageIndex(d.markCoverage,c);if(-1!==t){const a=o(s),l=-1===a?-1:e._lctf.coverageIndex(d.baseCoverage,n[a]);if(-1!==l){const e=d.markArray[t],n=d.baseArray[l][e.markClass];i[3*r]=n.x-e.x+i[3*a]-i[3*a+2],i[3*r+1]=n.y-e.y+i[3*a+1];break}}}else if(6===h.ltype){const s=e._lctf.coverageIndex(d.mark1Coverage,c);if(-1!==s){const a=o();if(-1!==a){const o=n[a];if(3===l(t,o)){const t=e._lctf.coverageIndex(d.mark2Coverage,o);if(-1!==t){const e=d.mark1Array[s],n=d.mark2Array[t][e.markClass];i[3*r]=n.x-e.x+i[3*a]-i[3*a+2],i[3*r+1]=n.y-e.y+i[3*a+1];break}}}}}}}}else if(t.kern&&!t.cff){const e=o();if(-1!==e){const r=t.kern.glyph1.indexOf(n[e]);if(-1!==r){const n=t.kern.rval[r].glyph2.indexOf(c);-1!==n&&(i[3*e+2]+=t.kern.rval[r].vals[n])}}}}return i;function o(e){for(let t=r-1;t>=0;t--)if(-1!==n[t]&&(!e||e(n[t])))return t;return-1}function s(e){return 1===l(t,e)}function a(e,t){for(let n=0;n<3;n++)i[3*t+n]+=e[n]||0}}(t,f);return f.forEach((s,a)=>{if(-1!==s){let r=i[s];if(!r){const{cmds:o,crds:a}=e.U.glyphToPath(t,s);let l,c,u,d,h="",p=0;for(let e=0,t=o.length;e<t;e++){const t=n[o[e]];h+=o[e];for(let e=1;e<=t;e++)h+=(e>1?",":"")+a[p++]}if(a.length){l=c=1/0,u=d=-1/0;for(let e=0,t=a.length;e<t;e+=2){let t=a[e],n=a[e+1];t<l&&(l=t),n<c&&(c=n),t>u&&(u=t),n>d&&(d=n)}}else l=u=c=d=0;r=i[s]={index:s,advanceWidth:t.hmtx.aWidth[s],xMin:l,yMin:c,xMax:u,yMax:d,path:h}}u.call(null,r,d+g[3*a]*p,g[3*a+1]*p,m),d+=g[3*a+2]*p,c&&(d+=c*o)}m+=r.codePointAt(m)>65535?2:1}),d}};return h}return function(n){const i=new Uint8Array(n,0,4),r=e._bin.readASCII(i,0,4);if("wOFF"===r)n=t(n);else if("wOF2"===r)throw new Error("woff2 fonts not supported");return u(e.parse(n)[0])}}],init:(e,t,n)=>n(e(),t())});const Tw=lw({name:"FontResolver",dependencies:[function(e,t){const n=Object.create(null),i=Object.create(null);function r(t,r){let o=n[t];o?r(o):i[t]?i[t].push(r):(i[t]=[r],function(t,n){const i=e=>{console.error(`Failure loading font ${t}`,e)};try{const r=new XMLHttpRequest;r.open("get",t,!0),r.responseType="arraybuffer",r.onload=function(){if(r.status>=400)i(new Error(r.statusText));else if(r.status>0)try{const i=e(r.response);i.src=t,n(i)}catch(nV){i(nV)}},r.onerror=i,r.send()}catch(r){i(r)}}(t,e=>{e.src=t,n[t]=e,i[t].forEach(t=>t(e)),delete i[t]}))}return function(e,i){let{lang:o,fonts:s=[],style:a="normal",weight:l="normal",unicodeFontsURL:c}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const u=new Uint8Array(e.length),d=[];e.length||m();const h=new Map,p=[];if("italic"!==a&&(a="normal"),"number"!==typeof l&&(l="bold"===l?700:400),s&&!Array.isArray(s)&&(s=[s]),s=s.slice().filter(e=>!e.lang||e.lang.test(o)).reverse(),s.length){const t=1,i=2;let o=0;!function a(){for(let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=e.length;l<c;l++){const f=e.codePointAt(l);if(o===t&&d[u[l-1]].supportsCodePoint(f)||l>0&&/\s/.test(e[l]))u[l]=u[l-1],o===i&&(p[p.length-1][1]=l);else for(let e=u[l],c=s.length;e<=c;e++)if(e===c){(o===i?p[p.length-1]:p[p.length]=[l,l])[1]=l,o=i}else{u[l]=e;const{src:i,unicodeRange:c}=s[e];if(!c||g(f,c)){const e=n[i];if(!e)return void r(i,()=>{a(l)});if(e.supportsCodePoint(f)){let n=h.get(e);"number"!==typeof n&&(n=d.length,d.push(e),h.set(e,n)),u[l]=n,o=t;break}}}f>65535&&l+1<c&&(u[l+1]=u[l],l++,o===i&&(p[p.length-1][1]=l))}f()}()}else p.push([0,e.length-1]),f();function f(){if(p.length){const n=p.map(t=>e.substring(t[0],t[1]+1)).join("\n");t.getFontsForString(n,{lang:o||void 0,style:a,weight:l,dataUrl:c}).then(e=>{let{fontUrls:t,chars:n}=e;const i=d.length;let o=0;p.forEach(e=>{for(let t=0,r=e[1]-e[0];t<=r;t++)u[e[0]+t]=n[o++]+i;o++});let s=0;t.forEach((e,n)=>{r(e,e=>{d[n+i]=e,++s===t.length&&m()})})})}else m()}function m(){i({chars:u,fonts:d})}function g(e,t){for(let n=0;n<t.length;n++){const[i,r=i]=t[n];if(i<=e&&e<=r)return!0}return!1}}},Cw,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&0!=(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(t,n){e.push((+n).toString(36)+":"+t.toString(36))}),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach(function(e){var n=e.split(":");t.buckets.set(parseInt(n[0],36),parseInt(n[1],36))})};var n=Math.pow(2,8),i=n-1,r=~i;function o(e){var t=function(e){return e&r}(e).toString(16),i=function(e){return(e&r)+n-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+t+"-"+i+".json"}function s(e,t){var n=e&i,r=t.codePointAt(n/6|0);return 0!=((r=(r||48)-48)&1<<n%6)}function a(e,t){!function(e,t){var n;(n=e,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})})).forEach(function(e){var n=e[0],i=e[1];void 0===i&&(i=n),t(n,i)})}(e,function(e,n){for(var i=e;i<=n;i++)t(i)})}var l={},c={},u=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(e){var n=u.get(e);return n||(n=new t,a(e.ranges,function(e){return n.add(e)}),u.set(e,n)),n}var p,f=new Map;function m(e,t,n){return e[t]?t:e[n]?n:function(e){for(var t in e)return t}(e)}function g(e,t){var n=t;if(!e.includes(n)){n=1/0;for(var i=0;i<e.length;i++)Math.abs(e[i]-t)<Math.abs(n-t)&&(n=e[i])}return n}function v(e){return p||(p=new Set,a("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){p.add(e)})),p.has(e)}return e.CodePointSet=t,e.clearCache=function(){l={},c={}},e.getFontsForString=function(e,t){void 0===t&&(t={});var n,i=t.lang;void 0===i&&(i=/\p{Script=Hangul}/u.test(n=e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var r=t.category;void 0===r&&(r="sans-serif");var a=t.style;void 0===a&&(a="normal");var u=t.weight;void 0===u&&(u=400);var p=(t.dataUrl||d).replace(/\/$/g,""),y=new Map,b=new Uint8Array(e.length),x={},_={},w=new Array(e.length),S=new Map,M=!1;function E(e){var t=f.get(e);return t||(t=fetch(p+"/"+e).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(t){if(p!==d)return M||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+p+'", trying default CDN. '+t.message),M=!0),p=d,f.delete(e),E(e);throw t}),f.set(e,t)),t}for(var C=function(t){var n=e.codePointAt(t),i=o(n);w[t]=i,l[i]||S.has(i)||S.set(i,E(i).then(function(e){l[i]=e})),n>65535&&(t++,T=t)},T=0;T<e.length;T++)C(T);return Promise.all(S.values()).then(function(){S.clear();for(var t=function(t){var r=e.codePointAt(t),o=null,a=l[w[t]],u=void 0;for(var d in a){var h=_[d];if(void 0===h&&(h=_[d]=new RegExp(d).test(i||"en")),h){for(var p in u=d,a[d])if(s(r,a[d][p])){o=p;break}break}}if(!o)e:for(var f in a)if(f!==u)for(var m in a[f])if(s(r,a[f][m])){o=m;break e}o||(console.debug("No font coverage for U+"+r.toString(16)),o="latin"),w[t]=o,c[o]||S.has(o)||S.set(o,E("font-meta/"+o+".json").then(function(e){c[o]=e})),r>65535&&(t++,n=t)},n=0;n<e.length;n++)t(n);return Promise.all(S.values())}).then(function(){for(var t,n=null,i=0;i<e.length;i++){var o=e.codePointAt(i);if(n&&(v(o)||h(n).has(o)))b[i]=b[i-1];else{n=c[w[i]];var s=x[n.id];if(!s){var l=n.typeforms,d=m(l,r,"sans-serif"),f=m(l[d],a,"normal"),_=g(null===(t=l[d])||void 0===t?void 0:t[f],u);s=x[n.id]=p+"/font-files/"+n.id+"/"+d+"."+f+"."+_+".woff"}var S=y.get(s);null==S&&(S=y.size,y.set(s,S)),b[i]=S}o>65535&&(i++,b[i]=b[i-1])}return{fontUrls:Array.from(y.keys()),chars:b}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,n)=>e(t,n())});const Aw=()=>(self.performance||Date).now(),Pw=dw();let Dw;const kw=[];let Rw=0;function Nw(){const e=Aw();for(;kw.length&&Aw()-e<5;)kw.shift()();Rw=kw.length?setTimeout(Nw,0):0}const Iw=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Promise((e,n)=>{kw.push(()=>{const i=Aw();try{Pw.webgl.generateIntoCanvas(...t),e({timing:Aw()-i})}catch(r){n(r)}}),Rw||(Rw=setTimeout(Nw,0))})},Lw=4,Ow=2e3,zw={};let Uw=0;function Fw(e,t,n,i,r,o,s,a,l,c){const u="TroikaTextSDFGenerator_JS_"+Uw++%Lw;let d=zw[u];return d||(d=zw[u]={workerModule:lw({name:u,workerId:u,dependencies:[dw,Aw],init(e,t){const n=e().javascript.generate;return function(){const e=t();return{textureData:n(...arguments),timing:t()-e}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),d.requests++,clearTimeout(d.idleTimer),d.workerModule(e,t,n,i,r,o).then(n=>{let{textureData:i,timing:r}=n;const o=Aw(),h=new Uint8Array(4*i.length);for(let e=0;e<i.length;e++)h[4*e+c]=i[e];return Pw.webglUtils.renderImageData(s,h,a,l,e,t,1<<3-c),r+=Aw()-o,0===--d.requests&&(d.idleTimer=setTimeout(()=>{!function(e){sw[e]&&sw[e].forEach(function(e){e()}),ow[e]&&(ow[e].terminate(),delete ow[e])}(u)},Ow)),{timing:r}})}const jw=Pw.webglUtils.resizeWebGLCanvasWithoutClearing,Bw={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},Vw=new Za;let Hw=!1;function Gw(){return(self.performance||Date).now()}const Ww=Object.create(null);function Xw(e,t){Hw=!0,e=$w({},e);const n=Gw(),{defaultFontURL:i}=Bw,r=[];if(i&&r.push({label:"default",src:Zw(i)}),e.font&&r.push({label:"user",src:Zw(e.font)}),e.font=r,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||Bw.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||Bw.unicodeFontsURL,null!=e.colorRanges){let t={};for(let n in e.colorRanges)if(e.colorRanges.hasOwnProperty(n)){let i=e.colorRanges[n];"number"!==typeof i&&(i=Vw.set(i).getHex()),t[n]=i}e.colorRanges=t}Object.freeze(e);const{textureWidth:o,sdfExponent:s}=Bw,{sdfGlyphSize:a}=e,l=o/a*4;let c=Ww[a];if(!c){const e=document.createElement("canvas");e.width=o,e.height=256*a/l,c=Ww[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:e,sdfTexture:new ws(e,void 0,void 0,void 0,xi,xi),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,function(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),e.contextLost=!1;const n=[];e.glyphsByFont.forEach(t=>{t.forEach(t=>{n.push(Yw(t,e,!0))})}),Promise.all(n).then(()=>{Kw(e),e.sdfTexture.needsUpdate=!0})})}(c)}const{sdfTexture:u,sdfCanvas:d}=c;(Bw.useWorker?Qw:eS)(e).then(i=>{const{glyphIds:r,glyphFontIndices:h,fontData:p,glyphPositions:f,fontSize:m,timings:g}=i,v=[],y=new Float32Array(4*r.length);let b=0,x=0;const _=Gw(),w=p.map(e=>{let t=c.glyphsByFont.get(e.src);return t||c.glyphsByFont.set(e.src,t=new Map),t});r.forEach((e,t)=>{const n=h[t],{src:o,unitsPerEm:s}=p[n];let l=w[n].get(e);if(!l){const{path:t,pathBounds:r}=i.glyphData[o][e],s=Math.max(r[2]-r[0],r[3]-r[1])/a*(Bw.sdfMargin*a+.5),u=c.glyphCount++,d=[r[0]-s,r[1]-s,r[2]+s,r[3]+s];w[n].set(e,l={path:t,atlasIndex:u,sdfViewBox:d}),v.push(l)}const{sdfViewBox:u}=l,d=f[x++],g=f[x++],_=m/s;y[b++]=d+u[0]*_,y[b++]=g+u[1]*_,y[b++]=d+u[2]*_,y[b++]=g+u[3]*_,r[t]=l.atlasIndex}),g.quads=(g.quads||0)+(Gw()-_);const S=Gw();g.sdf={};const M=d.height,E=Math.ceil(c.glyphCount/l),C=Math.pow(2,Math.ceil(Math.log2(E*a)));C>M&&(console.info(`Increasing SDF texture size ${M}->${C}`),jw(d,o,C),u.dispose()),Promise.all(v.map(t=>Yw(t,c,e.gpuAccelerateSDF).then(e=>{let{timing:n}=e;g.sdf[t.atlasIndex]=n}))).then(()=>{v.length&&!c.contextLost&&(Kw(c),u.needsUpdate=!0),g.sdfTotal=Gw()-S,g.total=Gw()-n,t(Object.freeze({parameters:e,sdfTexture:u,sdfGlyphSize:a,sdfExponent:s,glyphBounds:y,glyphAtlasIndices:r,glyphColors:i.glyphColors,caretPositions:i.caretPositions,chunkedBounds:i.chunkedBounds,ascender:i.ascender,descender:i.descender,lineHeight:i.lineHeight,capHeight:i.capHeight,xHeight:i.xHeight,topBaseline:i.topBaseline,blockBounds:i.blockBounds,visibleBounds:i.visibleBounds,timings:i.timings}))})}),Promise.resolve().then(()=>{var e;c.contextLost||(e=d)._warm||(Pw.webgl.isSupported(e),e._warm=!0)})}function Yw(e,t,n){let{path:i,atlasIndex:r,sdfViewBox:o}=e,{sdfGlyphSize:s,sdfCanvas:a,contextLost:l}=t;if(l)return Promise.resolve({timing:-1});const{textureWidth:c,sdfExponent:u}=Bw,d=Math.max(o[2]-o[0],o[3]-o[1]),h=Math.floor(r/4);return function(e,t,n,i,r,o,s,a,l,c){return arguments.length>10&&void 0!==arguments[10]&&!arguments[10]?Fw(e,t,n,i,r,o,s,a,l,c):Iw(e,t,n,i,r,o,s,a,l,c).then(null,u=>(Dw||(console.warn("WebGL SDF generation failed, falling back to JS",u),Dw=!0),Fw(e,t,n,i,r,o,s,a,l,c)))}(s,s,i,o,d,u,a,h%(c/s)*s,Math.floor(h/(c/s))*s,r%4,n)}function $w(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}let qw;function Zw(e){return qw||(qw="undefined"===typeof document?{}:document.createElement("a")),qw.href=e,qw.href}function Kw(e){if("function"!==typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:n}=e,{width:i,height:r}=t,o=e.sdfCanvas.getContext("webgl");let s=n.image.data;s&&s.length===i*r*4||(s=new Uint8Array(i*r*4),n.image={width:i,height:r,data:s},n.flipY=!1,n.isDataTexture=!0),o.readPixels(0,0,i,r,o.RGBA,o.UNSIGNED_BYTE,s)}}const Jw=lw({name:"Typesetter",dependencies:[function(e,t){const n=1/0,i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",o=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function s(s,d){let{text:h="",font:p,lang:f,sdfGlyphSize:m=64,fontSize:g=400,fontWeight:v=1,fontStyle:y="normal",letterSpacing:b=0,lineHeight:x="normal",maxWidth:_=n,direction:w,textAlign:S="left",textIndent:M=0,whiteSpace:E="normal",overflowWrap:C="normal",anchorX:T=0,anchorY:A=0,metricsOnly:P=!1,unicodeFontsURL:D,preResolvedFonts:k=null,includeCaretPositions:R=!1,chunkedBoundsSize:N=8192,colorRanges:I=null}=s;const L=c(),O={fontLoad:0,typesetting:0};h.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),h=h.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),g=+g,b=+b,_=+_,x=x||"normal",M=+M,function(t,n){let{text:i,lang:r,fonts:o,style:s,weight:a,preResolvedFonts:l,unicodeFontsURL:c}=t;const u=e=>{let t,i,{chars:r,fonts:o}=e;const s=[];for(let n=0;n<r.length;n++)r[n]!==i?(i=r[n],s.push(t={start:n,end:n,fontObj:o[r[n]]})):t.end=n;n(s)};l?u(l):e(i,u,{lang:r,fonts:o,style:s,weight:a,unicodeFontsURL:c})}({text:h,lang:f,style:y,weight:v,fonts:"string"===typeof p?[{src:p}]:p,unicodeFontsURL:D,preResolvedFonts:k},e=>{O.fontLoad=c()-L;const s=isFinite(_);let p=null,f=null,m=null,v=null,y=null,D=null,k=null,z=null,U=0,F=0,j="nowrap"!==E;const B=new Map,V=c();let H=M,G=0,W=new u;const X=[W];e.forEach(e=>{const{fontObj:t}=e,{ascender:n,descender:a,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:p}=t;let f=B.get(t);if(!f){const e=g/l,i="normal"===x?(n-a+c)*e:x*g,r=(i-(n-a)*e)/2,o=Math.min(i,(n-a)*e),s=(n+a)/2*e+o/2;f={index:B.size,src:t.src,fontObj:t,fontSizeMult:e,unitsPerEm:l,ascender:n*e,descender:a*e,capHeight:d*e,xHeight:p*e,lineHeight:i,baseline:-r-n*e,caretTop:s,caretBottom:s-o},B.set(t,f)}const{fontSizeMult:m}=f,v=h.slice(e.start,e.end+1);let y,w;t.forEachGlyph(v,g,b,(t,n,a,l)=>{n+=G,l+=e.start,y=n,w=t;const c=h.charAt(l),d=t.advanceWidth*m,p=W.count;let v;if("isEmpty"in t||(t.isWhitespace=!!c&&new RegExp(r).test(c),t.canBreakAfter=!!c&&o.test(c),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||i.test(c)),t.isWhitespace||t.isEmpty||F++,j&&s&&!t.isWhitespace&&n+d+H>_&&p){if(W.glyphAt(p-1).glyphObj.canBreakAfter)v=new u,H=-n;else for(let e=p;e--;){if(0===e&&"break-word"===C){v=new u,H=-n;break}if(W.glyphAt(e).glyphObj.canBreakAfter){v=W.splitAt(e+1);const t=v.glyphAt(0).x;H-=t;for(let e=v.count;e--;)v.glyphAt(e).x-=t;break}}v&&(W.isSoftWrapped=!0,W=v,X.push(W),U=_)}let x=W.glyphAt(W.count);x.glyphObj=t,x.x=n+H,x.y=a,x.width=d,x.charIndex=l,x.fontData=f,"\n"===c&&(W=new u,X.push(W),H=-(n+d+b*g)+M)}),G=y+w.advanceWidth*m+b*g});let Y=0;X.forEach(e=>{let t=!0;for(let n=e.count;n--;){const i=e.glyphAt(n);t&&!i.glyphObj.isWhitespace&&(e.width=i.x+i.width,e.width>U&&(U=e.width),t=!1);let{lineHeight:r,capHeight:o,xHeight:s,baseline:a}=i.fontData;r>e.lineHeight&&(e.lineHeight=r);const l=a-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+o),e.ex=Math.max(e.ex,e.baseline+s)}e.baseline-=Y,e.cap-=Y,e.ex-=Y,Y+=e.lineHeight});let $=0,q=0;if(T&&("number"===typeof T?$=-T:"string"===typeof T&&($=-U*("left"===T?0:"center"===T?.5:"right"===T?1:a(T)))),A&&("number"===typeof A?q=-A:"string"===typeof A&&(q="top"===A?0:"top-baseline"===A?-X[0].baseline:"top-cap"===A?-X[0].cap:"top-ex"===A?-X[0].ex:"middle"===A?Y/2:"bottom"===A?Y:"bottom-baseline"===A?-X[X.length-1].baseline:a(A)*Y)),!P){const e=t.getEmbeddingLevels(h,w);p=new Uint16Array(F),f=new Uint8Array(F),m=new Float32Array(2*F),v={},k=[n,n,-n,-n],z=[],R&&(D=new Float32Array(4*h.length)),I&&(y=new Uint8Array(3*F));let i,r,o=0,s=-1,a=-1;if(X.forEach((c,u)=>{let{count:d,width:g}=c;if(d>0){let u=0;for(let e=d;e--&&c.glyphAt(e).glyphObj.isWhitespace;)u++;let b=0,x=0;if("center"===S)b=(U-g)/2;else if("right"===S)b=U-g;else if("justify"===S&&c.isSoftWrapped){let e=0;for(let t=d-u;t--;)c.glyphAt(t).glyphObj.isWhitespace&&e++;x=(U-g)/e}if(x||b){let e=0;for(let t=0;t<d;t++){let n=c.glyphAt(t);const i=n.glyphObj;n.x+=b+e,0!==x&&i.isWhitespace&&t<d-u&&(e+=x,n.width+=x)}}const _=t.getReorderSegments(h,e,c.glyphAt(0).charIndex,c.glyphAt(c.count-1).charIndex);for(let e=0;e<_.length;e++){const[t,n]=_[e];let i=1/0,r=-1/0;for(let e=0;e<d;e++)if(c.glyphAt(e).charIndex>=t){let t=e,o=e;for(;o<d;o++){let e=c.glyphAt(o);if(e.charIndex>n)break;o<d-u&&(i=Math.min(i,e.x),r=Math.max(r,e.x+e.width))}for(let e=t;e<o;e++){const t=c.glyphAt(e);t.x=r-(t.x+t.width-i)}break}}let w;const M=e=>w=e;for(let g=0;g<d;g++){const u=c.glyphAt(g);w=u.glyphObj;const d=w.index,b=1&e.levels[u.charIndex];if(b){const e=t.getMirroredCharacter(h[u.charIndex]);e&&u.fontData.fontObj.forEachGlyph(e,0,0,M)}if(R){const{charIndex:e,fontData:t}=u,n=u.x+$,i=u.x+u.width+$;D[4*e]=b?i:n,D[4*e+1]=b?n:i,D[4*e+2]=c.baseline+t.caretBottom+q,D[4*e+3]=c.baseline+t.caretTop+q;const r=e-s;r>1&&l(D,s,r),s=e}if(I){const{charIndex:e}=u;for(;e>a;)a++,I.hasOwnProperty(a)&&(r=I[a])}if(!w.isWhitespace&&!w.isEmpty){const e=o++,{fontSizeMult:t,src:s,index:a}=u.fontData,l=v[s]||(v[s]={});l[d]||(l[d]={path:w.path,pathBounds:[w.xMin,w.yMin,w.xMax,w.yMax]});const h=u.x+$,g=u.y+c.baseline+q;m[2*e]=h,m[2*e+1]=g;const b=h+w.xMin*t,x=g+w.yMin*t,_=h+w.xMax*t,S=g+w.yMax*t;b<k[0]&&(k[0]=b),x<k[1]&&(k[1]=x),_>k[2]&&(k[2]=_),S>k[3]&&(k[3]=S),e%N===0&&(i={start:e,end:e,rect:[n,n,-n,-n]},z.push(i)),i.end++;const M=i.rect;if(b<M[0]&&(M[0]=b),x<M[1]&&(M[1]=x),_>M[2]&&(M[2]=_),S>M[3]&&(M[3]=S),p[e]=d,f[e]=a,I){const t=3*e;y[t]=r>>16&255,y[t+1]=r>>8&255,y[t+2]=255&r}}}}}),D){const e=h.length-s;e>1&&l(D,s,e)}}const Z=[];B.forEach(e=>{let{index:t,src:n,unitsPerEm:i,ascender:r,descender:o,lineHeight:s,capHeight:a,xHeight:l}=e;Z[t]={src:n,unitsPerEm:i,ascender:r,descender:o,lineHeight:s,capHeight:a,xHeight:l}}),O.typesetting=c()-V,d({glyphIds:p,glyphFontIndices:f,glyphPositions:m,glyphData:v,fontData:Z,caretPositions:D,glyphColors:y,chunkedBounds:z,fontSize:g,topBaseline:q+X[0].baseline,blockBounds:[$,q-Y,$+U,q],visibleBounds:k,timings:O})})}function a(e){let t=e.match(/^([\d.]+)%$/),n=t?parseFloat(t[1]):NaN;return isNaN(n)?0:n/100}function l(e,t,n){const i=e[4*t],r=e[4*t+1],o=e[4*t+2],s=e[4*t+3],a=(r-i)/n;for(let l=0;l<n;l++){const n=4*(t+l);e[n]=i+a*l,e[n+1]=i+a*(l+1),e[n+2]=o,e[n+3]=s}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(e){let t=u.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new u;return t.data=this.data.splice(e*d.length),t}},u.flyweight=d.reduce((e,t,n,i)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*d.length+n]},set(e){this.data[this.index*d.length+n]=e}}),e),{data:null,index:0}),{typeset:s,measure:function(e,t){s({...e,metricsOnly:!0},e=>{const[n,i,r,o]=e.blockBounds;t({width:r-n,height:o-i})})}}},Tw,hw],init:(e,t,n)=>e(t,n())}),Qw=lw({name:"Typesetter",dependencies:[Jw],init:e=>function(t){return new Promise(n=>{e.typeset(t,n)})},getTransferables(e){const t=[];for(let n in e)e[n]&&e[n].buffer&&t.push(e[n].buffer);return t}}),eS=Qw.onMainThread;const tS={};const nS="aTroikaGlyphBounds",iS="aTroikaGlyphIndex";class rS extends dg{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Qs,this.boundingBox=new Ls}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,("number"!==typeof e||e<1)&&(e=1);let t=function(e){let t=tS[e];return t||(t=tS[e]=new pc(1,1,e,e).translate(.5,.5,0)),t}(e);["position","normal","uv"].forEach(e=>{this.attributes[e]=t.attributes[e].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,i,r){this.updateAttributeData(nS,e,4),this.updateAttributeData(iS,t,1),this.updateAttributeData("aTroikaGlyphColor",r,3),this._blockBounds=n,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:i,floor:r,min:o,max:s,sin:a,cos:l}=Math,c=i/2,u=2*i,d=Math.abs(t),h=e[0]/d,p=e[2]/d,f=r((h+c)/u)!==r((p+c)/u)?-d:o(a(h)*d,a(p)*d),m=r((h-c)/u)!==r((p-c)/u)?d:s(a(h)*d,a(p)*d),g=r((h+i)/u)!==r((p+i)/u)?2*d:s(d-l(h)*d,d-l(p)*d);n.min.set(f,e[1],t<0?-g:0),n.max.set(m,e[3],t<0?0:g)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(iS).count,n=this._chunkedBounds;if(n)for(let i=n.length;i--;){t=n[i].end;let r=n[i].rect;if(r[1]<e.w&&r[3]>e.y&&r[0]<e.z&&r[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const i=this.getAttribute(e);t?i&&i.array.length===t.length?(i.array.set(t),i.needsUpdate=!0):(this.setAttribute(e,new Lh(t,n)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}function oS(e){const t=_w(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Qo},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Ss(0,0,0,0)},uTroikaClipRect:{value:new Ss(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Qo},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Za},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new es},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter(e){let{vertexShader:t,fragmentShader:n}=e,i=/\buniform\s+vec3\s+diffuse\b/;return i.test(n)&&(n=n.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(t)||(t=t.replace(pw,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:n}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const sS=new el({color:16777215,side:hn,transparent:!0}),aS=8421504,lS=new la,cS=new Rs,uS=new Rs,dS=[],hS=new Rs,pS="+x+y";function fS(e){return Array.isArray(e)?e[0]:e}let mS=()=>{const e=new Gl(new pc(1,1),sS);return mS=()=>e,e},gS=()=>{const e=new Gl(new pc(1,1,32,1),sS);return gS=()=>e,e};const vS={type:"syncstart"},yS={type:"synccomplete"},bS=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],xS=bS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class _S extends Gl{constructor(){super(new rS,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=aS,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=pS,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(vS),Xw({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(e=>e&&e())})),this.dispatchEvent(yS),e&&e()})))}onBeforeRender(e,t,n,i,r,o){this.sync(),r.isTroikaTextMaterial&&this._prepareForRender(r)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return oS(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=sS.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let t=e._outlineMtl;return t||(t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),t.isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),[t,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return fS(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return fS(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:e,blockBounds:r}=i;n.uTroikaSDFTexture.value=e,n.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),n.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,n.uTroikaSDFExponent.value=i.sdfExponent,n.uTroikaTotalBounds.value.fromArray(r),n.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let o,s,a,l=0,c=0,u=0,d=0,h=0;if(t){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:n,outlineBlur:i,outlineOpacity:r}=this;l=this._parsePercent(e)||0,c=Math.max(0,this._parsePercent(i)||0),o=r,d=this._parsePercent(t)||0,h=this._parsePercent(n)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(a=this.strokeColor,n.uTroikaStrokeColor.value.set(null==a?aS:a),s=this.strokeOpacity,null==s&&(s=1)),o=this.fillOpacity;n.uTroikaEdgeOffset.value=l,n.uTroikaPositionOffset.value.set(d,h),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=u,n.uTroikaStrokeOpacity.value=s,n.uTroikaFillOpacity.value=null==o?1:o,n.uTroikaCurveRadius.value=this.curveRadius||0;let p=this.clipRect;if(p&&Array.isArray(p)&&4===p.length)n.uTroikaClipRect.value.fromArray(p);else{const e=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(r[0]-e,r[1]-e,r[2]+e,r[3]+e)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const r=t?this.outlineColor||0:this.color;if(null==r)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new Za;r===t._input&&"object"!==typeof r||t.set(t._input=r)}let o=this.orientation||pS;if(o!==e._orientation){let t=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let i=o!==pS&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(i){let[,e,n,r,o]=i;cS.set(0,0,0)[n]="-"===e?1:-1,uS.set(0,0,0)[o]="-"===r?-1:1,lS.lookAt(hS,cS.cross(uS),uS),t.setFromMatrix4(lS)}else t.identity();e._orientation=o}}_parsePercent(e){if("string"===typeof e){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo;t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qo;return cS.copy(e),this.localPositionToTextCoords(this.worldToLocal(cS),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:i}=this;if(n){const r=n.blockBounds,o=i?gS():mS(),s=o.geometry,{position:a,uv:l}=s.attributes;for(let e=0;e<l.count;e++){let t=r[0]+l.getX(e)*(r[2]-r[0]);const n=r[1]+l.getY(e)*(r[3]-r[1]);let o=0;i&&(o=i-Math.cos(t/i)*i,t=Math.sin(t/i)*i),a.setXYZ(e,t,n,o)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,dS.length=0,o.raycast(e,dS);for(let e=0;e<dS.length;e++)dS[e].object=this,t.push(dS[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,xS.forEach(t=>{this[t]=e[t]}),this}clone(){return(new this.constructor).copy(this)}}bS.forEach(e=>{const t="_private_"+e;Object.defineProperty(_S.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})});new Ls,new Za;new WeakMap;new WeakMap;const wS=t.forwardRef((e,n)=>{let{sdfGlyphSize:i=64,anchorX:r="center",anchorY:o="middle",font:s,fontSize:a=1,children:l,characters:c,onSync:u,...d}=e;const h=Yy(e=>{let{invalidate:t}=e;return t}),[p]=t.useState(()=>new _S),[f,m]=t.useMemo(()=>{const e=[];let n="";return t.Children.forEach(l,t=>{"string"===typeof t||"number"===typeof t?n+=t:e.push(t)}),[e,n]},[l]);return Kv(()=>new Promise(e=>function(e,t){let{font:n,characters:i,sdfGlyphSize:r}=e;Xw({font:n,sdfGlyphSize:r,text:Array.isArray(i)?i.join("\n"):""+i},t)}({font:s,characters:c},e)),["troika-text",s,c]),t.useLayoutEffect(()=>{p.sync(()=>{h(),u&&u(p)})}),t.useEffect(()=>()=>p.dispose(),[p]),t.createElement("primitive",Ob({object:p,ref:n,font:s,text:m,anchorX:r,anchorY:o,fontSize:a,sdfGlyphSize:i},d),f)}),SS=e=>{var n,i,o,s,a,l;let{object:c,objects:u}=e;const d=(0,t.useRef)(null),h=(0,t.useRef)(null),{selectObject:p,hoverObject:f,selectedObjectId:m,hoveredObjectId:g,showObjectNames:v}=z_(),y=m===c.id,b=g===c.id,x="Radar"===c.mesh,_=(0,t.useMemo)(()=>x&&c.components?c.components.find(e=>"Radar"===e.name):null,[x,c.components]),w=null!==(n=null===_||void 0===_||null===(i=_.fields)||void 0===i||null===(o=i.find(e=>"range"===e.name))||void 0===o?void 0:o.value)&&void 0!==n?n:1,S=null!==(s=null===_||void 0===_||null===(a=_.fields)||void 0===a||null===(l=a.find(e=>"fov"===e.name))||void 0===l?void 0:l.value)&&void 0!==s?s:45,M=(0,t.useMemo)(()=>{if(!x)return 0;const e=S/2*(Math.PI/180);return w*Math.tan(e)},[x,w,S]),E=(0,t.useMemo)(()=>{if(!x)return null;const e=new rf(M,w,4,1,!0);return e.rotateY(Math.PI/4),e.translate(0,-w/2,0),e},[x,M,w]),C=(0,t.useMemo)(()=>{if(!x)return null;const e=1.05*w,t=new rf(1.05*M,e,4,1,!0);return t.rotateY(Math.PI/4),t.translate(0,-e/2,0),t},[x,M,w]),T=(0,t.useMemo)(()=>{if(x)return null;if(("mesh"===c.type||"transmitter"===c.type||"receiver"===c.type)&&c.mesh){if("Custom"===c.mesh&&c.meshData){const e=new Cl,t=new Float32Array(c.meshData.vertices.flat());e.setAttribute("position",new ll(t,3));const n=new Uint32Array(c.meshData.faces.flat());e.setIndex(new ll(n,1)),e.computeVertexNormals();const i=c.meshData.center;return e.translate(-i[0],-i[1],-i[2]),e}switch(c.mesh){case"Sphere":return new Yf(1,32,32);case"Cube":default:return new Xl(1,1,1);case"Cylinder":return new nf(.5,.5,1,32);case"Plane":return new pc(1,1);case"Torus":return new qf(.7,.3,16,100);case"Transmitter":case"Receiver":return new Yf(.1,16,16)}}return null},[x,c.type,c.mesh,c.meshData]),A=(0,t.useMemo)(()=>x?null:c.material?"transmitter"===c.type||"receiver"===c.type?new el({color:c.material.color}):new im({color:c.material.color,metalness:c.material.metalness,roughness:c.material.roughness}):new im,[x,c.material,c.type]),P=(0,t.useMemo)(()=>x?null:new el({color:y?16746496:16755200,side:dn,transparent:!0,opacity:y?1:.6}),[x,y]);return x?(0,r.jsxs)("group",{name:c.id,position:c.transform.position,rotation:c.transform.rotation,scale:c.transform.scale,onClick:e=>{e.stopPropagation(),p(c.id)},onPointerOver:e=>{e.stopPropagation(),f(c.id)},onPointerOut:e=>{e.stopPropagation(),f(null)},children:[(0,r.jsxs)("mesh",{visible:c.visible,children:[(0,r.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,r.jsx)("meshBasicMaterial",{color:"#ffff00"})]}),E&&(0,r.jsx)("mesh",{rotation:[-Math.PI/2,0,0],visible:c.visible,geometry:E,children:(0,r.jsx)("meshBasicMaterial",{color:"#ffff00",wireframe:!0})}),(y||b)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{visible:c.visible,children:[(0,r.jsx)("sphereGeometry",{args:[.105,16,16]}),(0,r.jsx)("meshBasicMaterial",{color:y?16746496:16755200,transparent:!0,opacity:y?1:.6})]}),C&&(0,r.jsx)("mesh",{rotation:[-Math.PI/2,0,0],visible:c.visible,geometry:C,children:(0,r.jsx)("meshBasicMaterial",{color:y?16746496:16755200,wireframe:!0,transparent:!0,opacity:y?1:.6})})]}),v&&c.visible&&(0,r.jsx)(Q_,{follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:(0,r.jsx)(wS,{position:[0,.3,0],fontSize:.2,scale:[1/c.transform.scale.x,1/c.transform.scale.y,1/c.transform.scale.z],color:"#ffffff",anchorX:"center",anchorY:"middle",renderOrder:999,"material-depthTest":!1,"material-depthWrite":!1,fontWeight:"bold",outlineWidth:.02,outlineColor:"#000000",children:c.name})}),u&&Object.values(u).filter(e=>e.parent_id===c.id).map(e=>(0,r.jsx)(SS,{object:e,objects:u},e.id))]}):T&&A?(0,r.jsxs)("group",{name:c.id,position:c.transform.position,rotation:c.transform.rotation,scale:"transmitter"===c.type||"receiver"===c.type?[1,1,1]:c.transform.scale,children:[(y||b)&&P&&(0,r.jsx)("mesh",{ref:h,geometry:T,material:P,visible:c.visible,scale:[1.05,1.05,1.05]}),(0,r.jsx)("mesh",{ref:d,geometry:T,material:A,visible:c.visible,castShadow:!0,receiveShadow:!0,onClick:e=>{e.stopPropagation(),p(c.id)},onPointerOver:e=>{e.stopPropagation(),f(c.id)},onPointerOut:e=>{e.stopPropagation(),f(null)}}),v&&c.visible&&(0,r.jsx)(Q_,{follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:(0,r.jsx)(wS,{position:[0,0,0],fontSize:.2,scale:[1/("transmitter"===c.type||"receiver"===c.type?1:c.transform.scale.x),1/("transmitter"===c.type||"receiver"===c.type?1:c.transform.scale.y),1/("transmitter"===c.type||"receiver"===c.type?1:c.transform.scale.z)],color:"#ffffff",anchorX:"center",anchorY:"middle",renderOrder:999,"material-depthTest":!1,"material-depthWrite":!1,fontWeight:"bold",outlineWidth:.02,outlineColor:"#000000",children:c.name})}),u&&Object.values(u).filter(e=>e.parent_id===c.id).map(e=>(0,r.jsx)(SS,{object:e,objects:u},e.id))]}):null},MS=SS,ES=new Ls,CS=new Rs;class TS extends dg{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new vl([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new vl([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new ev(t,6,1);return this.setAttribute("instanceStart",new eh(n,3,0)),this.setAttribute("instanceEnd",new eh(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new ev(t,2*n,1);return this.setAttribute("instanceColorStart",new eh(i,n,0)),this.setAttribute("instanceColorEnd",new eh(i,n,n)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Jf(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ls);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),ES.setFromBufferAttribute(t),this.boundingBox.union(ES))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Qs),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let r=0,o=e.count;r<o;r++)CS.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(CS)),CS.fromBufferAttribute(t,r),i=Math.max(i,n.distanceToSquared(CS));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class AS extends Kl{constructor(e){super({type:"LineMaterial",uniforms:Zl.clone(Zl.merge([mc.common,mc.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Qo(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${$b>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const PS=$b>=125?"uv1":"uv2",DS=new Ss,kS=new Rs,RS=new Rs,NS=new Ss,IS=new Ss,LS=new Ss,OS=new Rs,zS=new la,US=new dv,FS=new Rs,jS=new Ls,BS=new Qs,VS=new Ss;let HS,GS;function WS(e,t,n){return VS.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),VS.multiplyScalar(1/VS.w),VS.x=GS/n.width,VS.y=GS/n.height,VS.applyMatrix4(e.projectionMatrixInverse),VS.multiplyScalar(1/VS.w),Math.abs(Math.max(VS.x,VS.y))}class XS extends Gl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new TS,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new AS({color:16777215*Math.random()})),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,s=0,a=t.count;o<a;o++,s+=2)kS.fromBufferAttribute(t,o),RS.fromBufferAttribute(n,o),i[s]=0===s?0:i[s-1],i[s+1]=i[s]+kS.distanceTo(RS);const r=new ev(i,2,1);return e.setAttribute("instanceDistanceStart",new eh(r,1,0)),e.setAttribute("instanceDistanceEnd",new eh(r,1,1)),this}raycast(e,t){const n=this.material.worldUnits,i=e.camera;null!==i||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=void 0!==e.params.Line2&&e.params.Line2.threshold||0;HS=e.ray;const o=this.matrixWorld,s=this.geometry,a=this.material;let l,c;if(GS=a.linewidth+r,null===s.boundingSphere&&s.computeBoundingSphere(),BS.copy(s.boundingSphere).applyMatrix4(o),n)l=.5*GS;else{l=WS(i,Math.max(i.near,BS.distanceToPoint(HS.origin)),a.resolution)}if(BS.radius+=l,!1!==HS.intersectsSphere(BS)){if(null===s.boundingBox&&s.computeBoundingBox(),jS.copy(s.boundingBox).applyMatrix4(o),n)c=.5*GS;else{c=WS(i,Math.max(i.near,jS.distanceToPoint(HS.origin)),a.resolution)}jS.expandByScalar(c),!1!==HS.intersectsBox(jS)&&(n?function(e,t){const n=e.matrixWorld,i=e.geometry,r=i.attributes.instanceStart,o=i.attributes.instanceEnd;for(let s=0,a=Math.min(i.instanceCount,r.count);s<a;s++){US.start.fromBufferAttribute(r,s),US.end.fromBufferAttribute(o,s),US.applyMatrix4(n);const i=new Rs,a=new Rs;HS.distanceSqToSegment(US.start,US.end,a,i),a.distanceTo(i)<.5*GS&&t.push({point:a,pointOnLine:i,distance:HS.origin.distanceTo(a),object:e,face:null,faceIndex:s,uv:null,[PS]:null})}}(this,t):function(e,t,n){const i=t.projectionMatrix,r=e.material.resolution,o=e.matrixWorld,s=e.geometry,a=s.attributes.instanceStart,l=s.attributes.instanceEnd,c=Math.min(s.instanceCount,a.count),u=-t.near;HS.at(1,LS),LS.w=1,LS.applyMatrix4(t.matrixWorldInverse),LS.applyMatrix4(i),LS.multiplyScalar(1/LS.w),LS.x*=r.x/2,LS.y*=r.y/2,LS.z=0,OS.copy(LS),zS.multiplyMatrices(t.matrixWorldInverse,o);for(let d=0,h=c;d<h;d++){if(NS.fromBufferAttribute(a,d),IS.fromBufferAttribute(l,d),NS.w=1,IS.w=1,NS.applyMatrix4(zS),IS.applyMatrix4(zS),NS.z>u&&IS.z>u)continue;if(NS.z>u){const e=NS.z-IS.z,t=(NS.z-u)/e;NS.lerp(IS,t)}else if(IS.z>u){const e=IS.z-NS.z,t=(IS.z-u)/e;IS.lerp(NS,t)}NS.applyMatrix4(i),IS.applyMatrix4(i),NS.multiplyScalar(1/NS.w),IS.multiplyScalar(1/IS.w),NS.x*=r.x/2,NS.y*=r.y/2,IS.x*=r.x/2,IS.y*=r.y/2,US.start.copy(NS),US.start.z=0,US.end.copy(IS),US.end.z=0;const t=US.closestPointToPointParameter(OS,!0);US.at(t,FS);const s=Jo.lerp(NS.z,IS.z,t),c=s>=-1&&s<=1,h=OS.distanceTo(FS)<.5*GS;if(c&&h){US.start.fromBufferAttribute(a,d),US.end.fromBufferAttribute(l,d),US.start.applyMatrix4(o),US.end.applyMatrix4(o);const t=new Rs,i=new Rs;HS.distanceSqToSegment(US.start,US.end,i,t),n.push({point:i,pointOnLine:t,distance:HS.origin.distanceTo(i),object:e,face:null,faceIndex:d,uv:null,[PS]:null})}}}(this,i,t))}}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(DS),this.material.uniforms.resolution.value.set(DS.z,DS.w))}}class YS extends TS{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setPositions(n),this}setColors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const n=e.length-t,i=new Float32Array(2*n);if(3===t)for(let r=0;r<n;r+=t)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];else for(let r=0;r<n;r+=t)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5],i[2*r+6]=e[r+6],i[2*r+7]=e[r+7];return super.setColors(i,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class $S extends XS{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new YS,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new AS({color:16777215*Math.random()})),this.isLine2=!0,this.type="Line2"}}const qS=t.forwardRef(function(e,n){let{points:i,color:r=16777215,vertexColors:o,linewidth:s,lineWidth:a,segments:l,dashed:c,...u}=e;var d,h;const p=Yy(e=>e.size),f=t.useMemo(()=>l?new XS:new $S,[l]),[m]=t.useState(()=>new AS),g=4===(null==o||null==(d=o[0])?void 0:d.length)?4:3,v=t.useMemo(()=>{const e=l?new TS:new YS,t=i.map(e=>{const t=Array.isArray(e);return e instanceof Rs||e instanceof Ss?[e.x,e.y,e.z]:e instanceof Qo?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e});if(e.setPositions(t.flat()),o){r=16777215;const t=o.map(e=>e instanceof Za?e.toArray():e);e.setColors(t.flat(),g)}return e},[i,l,o,g]);return t.useLayoutEffect(()=>{f.computeLineDistances()},[i,f]),t.useLayoutEffect(()=>{c?m.defines.USE_DASH="":delete m.defines.USE_DASH,m.needsUpdate=!0},[c,m]),t.useEffect(()=>()=>{v.dispose(),m.dispose()},[v]),t.createElement("primitive",Ob({object:f,ref:n},u),t.createElement("primitive",{object:v,attach:"geometry"}),t.createElement("primitive",Ob({object:m,attach:"material",color:r,vertexColors:Boolean(o),resolution:[p.width,p.height],linewidth:null!==(h=null!==s&&void 0!==s?s:a)&&void 0!==h?h:1,dashed:c,transparent:4===g},u)))});function ZS(e,n){const i=e+"Geometry";return t.forwardRef((e,r)=>{let{args:o,children:s,...a}=e;const l=t.useRef(null);return t.useImperativeHandle(r,()=>l.current),t.useLayoutEffect(()=>{null==n||n(l.current)}),t.createElement("mesh",Ob({ref:l},a),t.createElement(i,{attach:"geometry",args:o}),s)})}const KS=ZS("sphere"),JS=e=>{let{pathGroups:n}=e;const[i,o]=(0,t.useState)(null),s=e=>{e.stopPropagation(),o(null)};return(0,r.jsxs)(r.Fragment,{children:[n.map(e=>(0,r.jsx)("group",{children:e.paths.map((t,n)=>{const i=t.map(e=>new Rs(...e));return(0,r.jsxs)("group",{children:[(0,r.jsx)(qS,{points:i,color:e.color,lineWidth:2}),t.map((t,i)=>(0,r.jsx)(KS,{args:[.02,8,8],position:t,onPointerEnter:r=>((e,t,n,i,r)=>{e.stopPropagation(),o({position:t,groupId:n,pathIndex:i,pointIndex:r})})(r,t,e.groupId,n,i),onPointerLeave:s,children:(0,r.jsx)("meshStandardMaterial",{color:e.color,emissive:e.color,emissiveIntensity:.2})},`${e.groupId}-path-${n}-point-${i}`))]},`${e.groupId}-path-${n}`)})},e.groupId)),i&&(0,r.jsx)(Q_,{follow:!0,lockX:!1,lockY:!1,lockZ:!1,position:[i.position[0],i.position[1],i.position[2]],children:(0,r.jsx)(wS,{fontSize:.2,color:"white",anchorX:"center",anchorY:"bottom",outlineWidth:.03,outlineColor:"black",children:`[${i.position[0].toFixed(2)}, ${i.position[1].toFixed(2)}, ${i.position[2].toFixed(2)}]`})})]})},QS=e=>{let{transformControlsRef:n}=e;const{objects:i,selectedObjectId:o,transformMode:s,transformSpace:a,updateObjectTransform:l,traceData:c}=z_(),{isConnected:u}=J_(),{scene:d}=Yy(),h=(0,t.useRef)(null),p=(0,t.useRef)(!1),[f,m]=t.useState(0),g=(0,t.useRef)(null),v=L_(),y=(0,t.useRef)(void 0);(0,t.useEffect)(()=>{o&&d?requestAnimationFrame(()=>{let e=null;d.traverse(t=>{t.name===o&&"Group"===t.type&&(e=t)}),e&&(h.current=e,m(e=>e+1))}):h.current=null},[o,d]),(0,t.useEffect)(()=>{if(o&&i[o]){const e=i[o].parent_id;void 0!==y.current&&y.current!==e&&(console.log("[Scene] Parent changed for selected object, forcing gizmo update"),h.current=null,m(e=>e+1),setTimeout(()=>{requestAnimationFrame(()=>{d.traverse(e=>{e.name===o&&"Group"===e.type&&(h.current=e,m(e=>e+1))})})},50)),y.current=e}},[o,i,d]);const b=Object.values(i).filter(e=>!e.parent_id);return(0,r.jsxs)(r.Fragment,{children:[b.map(e=>(0,r.jsx)(MS,{object:e,objects:i},e.id)),c&&(0,r.jsx)(JS,{pathGroups:c}),h.current&&o&&i[o]&&(0,r.jsx)(H_,{ref:n,object:h.current,mode:s,space:a,onChange:()=>{if(h.current&&o){const e=h.current,t=new ks;e.getWorldQuaternion(t);const n=(new ya).setFromQuaternion(t,"YXZ");l(o,{position:e.position.clone(),rotation:n,scale:e.scale.clone()})}},onMouseDown:()=>{if(console.log("[Transform] Mouse down - starting drag"),p.current=!0,h.current&&o){const e=h.current,t=new ks;e.getWorldQuaternion(t);const n=(new ya).setFromQuaternion(t,"YXZ");g.current={position:e.position.toArray(),rotation:n.toArray(),scale:e.scale.toArray()},console.log("[Transform] Stored initial transform:",g.current)}},onMouseUp:()=>{if(p.current&&h.current&&o){const e=h.current,t=new ks;e.getWorldQuaternion(t);const n=(new ya).setFromQuaternion(t,"YXZ"),i={position:e.position.toArray(),rotation:n.toArray(),scale:e.scale.toArray()};if(g.current&&!v.isUndoing&&!v.isRedoing){const e=JSON.stringify(g.current.position)!==JSON.stringify(i.position)||JSON.stringify(g.current.rotation)!==JSON.stringify(i.rotation)||JSON.stringify(g.current.scale)!==JSON.stringify(i.scale);console.log("[Transform] Checking for changes:",{changed:e,oldTransform:g.current,newTransform:i,isUndoing:v.isUndoing,isRedoing:v.isRedoing}),e&&(console.log("[Transform] Recording history action"),v.pushAction({type:"update_transform",objectId:o,oldTransform:g.current,newTransform:i}))}u&&I_.updateTransform(o,{position:e.position.clone(),rotation:n,scale:e.scale.clone()})}p.current=!1,g.current=null},showZ:!("transmitter"===i[o].type||"receiver"===i[o].type)||"scale"!==s,showY:!("transmitter"===i[o].type||"receiver"===i[o].type)||"scale"!==s,showX:!("transmitter"===i[o].type||"receiver"===i[o].type)||"scale"!==s})]})},eM=N_(e=>({isExpanded:!1,panelHeight:200,setExpanded:t=>e({isExpanded:t}),setPanelHeight:t=>e({panelHeight:t})})),tM=e=>{let{isDarkTheme:n=!0}=e;const{isExpanded:i,panelHeight:o}=eM(),[s,a]=(0,t.useState)(1),[l,c]=(0,t.useState)(100),[u,d]=(0,t.useState)(!1);(0,t.useEffect)(()=>{const e=()=>{d(window.innerWidth<=768&&window.matchMedia("(orientation: portrait)").matches)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),(0,t.useEffect)(()=>{const e=e=>{const t=e,{scale:n,width:i}=t.detail;a(n),c(i)};return window.addEventListener("scaleBarUpdate",e),()=>{window.removeEventListener("scaleBarUpdate",e)}},[]);return(0,r.jsx)("div",{style:{position:"absolute",bottom:u?"20px":i?`${o+10}px`:"40px",left:"20px",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"4px",pointerEvents:"none",userSelect:"none",zIndex:10,transition:"bottom 0.3s ease"},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,r.jsxs)("div",{style:{width:`${l}px`,height:"4px",backgroundColor:n?"#ffffff":"#000000",position:"relative"},children:[(0,r.jsx)("div",{style:{position:"absolute",left:"0",top:"-4px",width:"2px",height:"12px",backgroundColor:n?"#ffffff":"#000000"}}),(0,r.jsx)("div",{style:{position:"absolute",right:"0",top:"-4px",width:"2px",height:"12px",backgroundColor:n?"#ffffff":"#000000"}})]}),(0,r.jsx)("span",{style:{color:n?"#ffffff":"#000000",fontSize:"14px",fontFamily:"Arial, sans-serif",fontWeight:"600",textShadow:n?"0 0 4px rgba(0,0,0,0.8), 0 0 2px rgba(0,0,0,0.8)":"0 0 4px rgba(255,255,255,0.8), 0 0 2px rgba(255,255,255,0.8)"},children:(h=s,h<1?`${(100*h).toFixed(0)} cm`:h<1e3?`${h} m`:`${(h/1e3).toFixed(1)} km`)})]})});var h},nM=()=>{const{camera:e,size:t}=Yy();return $y(()=>{const n=e.position.length(),i=e.fov,r=t.width/t.height,o=i*Math.PI/180,s=2*Math.tan(o/2)*n*r/t.width,a=[.1,.2,.5,1,2,5,10,20,50,100,200,500,1e3];let l=1,c=100;for(const e of a){const t=e/s;if(t>=50&&t<=200){l=e,c=t;break}}window.dispatchEvent(new CustomEvent("scaleBarUpdate",{detail:{scale:l,width:c}}))}),null},iM=e=>{let{transformControlsRef:n}=e;const{camera:i}=Yy(),o=(0,t.useRef)(),s=(0,t.useRef)(new Rs(0,0,0)),a=(0,t.useRef)(!1),[l,c]=t.useState(!1);return(0,t.useEffect)(()=>{let e;const t=setInterval(()=>{if(n.current){const i=n.current,r=e=>{c(e.value)};i.addEventListener("dragging-changed",r),e=()=>i.removeEventListener("dragging-changed",r),clearInterval(t)}},100);return()=>{clearInterval(t),e&&e()}},[n]),(0,t.useEffect)(()=>{const e=e=>{const t=e.detail.position;s.current.set(t.x,t.y,t.z),a.current=!0};return window.addEventListener("focusObject",e),()=>{window.removeEventListener("focusObject",e)}},[]),$y(()=>{if(a.current&&o.current&&i){const e=o.current,t=e.target,n=s.current,r=i.position.clone().sub(t);t.lerp(n,.1);const l=t.clone().add(r);i.position.copy(l),e.update(),t.distanceTo(s.current)<.01&&(a.current=!1)}}),(0,r.jsx)(Yb,{ref:o,makeDefault:!0,enableDamping:!0,dampingFactor:.3,enabled:!l})},rM=e=>{let{isDarkTheme:n=!0}=e;const{transformMode:i,setTransformMode:o,transformSpace:s,setTransformSpace:a,selectedObjectId:l,selectObject:c}=z_(),u=(0,t.useRef)(null);return(0,t.useEffect)(()=>{const e=e=>{switch(e.key.toLowerCase()){case"w":o("translate");break;case"e":o("rotate");break;case"r":o("scale")}},t=e=>{"CANVAS"===e.target.tagName&&e.preventDefault()};return window.addEventListener("keydown",e),window.addEventListener("contextmenu",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("contextmenu",t)}},[o]),(0,r.jsxs)("div",{className:"viewport-container",children:[(0,r.jsxs)("div",{className:"viewport-toolbar",children:[(0,r.jsx)("button",{className:"toolbar-button "+("translate"===i?"active":""),onClick:()=>o("translate"),title:"Move (W)",children:"Move"}),(0,r.jsx)("button",{className:"toolbar-button "+("rotate"===i?"active":""),onClick:()=>o("rotate"),title:"Rotate (E)",children:"Rotate"}),(0,r.jsx)("button",{className:"toolbar-button "+("scale"===i?"active":""),onClick:()=>o("scale"),title:"Scale (R)",children:"Scale"}),(0,r.jsx)("div",{className:"toolbar-separator"}),(0,r.jsx)("button",{className:"toolbar-button "+("world"===s?"active":""),onClick:()=>a("world"),title:"World Space",children:"World"}),(0,r.jsx)("button",{className:"toolbar-button "+("local"===s?"active":""),onClick:()=>a("local"),title:"Local Space",children:"Local"})]}),(0,r.jsxs)(Lb,{camera:{position:[5,5,5],fov:60},gl:{antialias:!0},shadows:!0,onPointerMissed:e=>{c(null)},children:[(0,r.jsx)("color",{attach:"background",args:[n?"#1a1a1a":"#d8d8d8"]}),(0,r.jsx)(i_,{files:"/environment.exr",background:!1,environmentIntensity:1}),(0,r.jsx)("ambientLight",{intensity:.2}),(0,r.jsx)("directionalLight",{position:[5,5,5],intensity:.8,castShadow:!0,"shadow-mapSize":[2048,2048]}),(0,r.jsx)(a_,{args:[50,50],cellSize:1,cellThickness:.5,cellColor:n?"#505050":"#2b2b2b",sectionSize:5,sectionThickness:1,sectionColor:n?"#606060":"#212121",fadeDistance:50,fadeStrength:1,followCamera:!1}),(0,r.jsx)(QS,{transformControlsRef:u}),(0,r.jsx)(iM,{transformControlsRef:u}),(0,r.jsx)(nM,{}),(0,r.jsx)(__,{alignment:"top-right",margin:[80,80],children:(0,r.jsx)(M_,{axisColors:["#ff0000","#00ff00","#0000ff"],labelColor:"white"})})]}),(0,r.jsx)(tM,{isDarkTheme:n})]})};function oM(e){if("string"===typeof e||"number"===typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,i=0;i<e.length;i++)""!==(n=oM(e[i]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const{useDebugValue:sM}=t,{useSyncExternalStoreWithSelector:aM}=T_,lM=e=>e;function cM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lM,n=arguments.length>2?arguments[2]:void 0;const i=aM(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return sM(i),i}const uM=(e,t)=>{const n=C_(e),i=function(e){return cM(n,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t)};return Object.assign(i,n),i};function dM(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,i]of e)if(!Object.is(i,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const i of n)if(!Object.prototype.hasOwnProperty.call(t,i)||!Object.is(e[i],t[i]))return!1;return!0}var hM={value:()=>{}};function pM(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new fM(i)}function fM(e){this._=e}function mM(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function gM(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=hM,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}fM.prototype=pM.prototype={constructor:fM,on:function(e,t){var n,i,r=this._,o=(i=r,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!i.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),s=-1,a=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=o[s]).type)r[n]=gM(r[n],e.name,t);else if(null==t)for(n in r)r[n]=gM(r[n],e.name,null);return this}for(;++s<a;)if((n=(e=o[s]).type)&&(n=mM(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new fM(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(i=this._[e]).length;o<n;++o)i[o].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};const vM=pM;function yM(){}function bM(e){return null==e?yM:function(){return this.querySelector(e)}}function xM(){return[]}function _M(e){return null==e?xM:function(){return this.querySelectorAll(e)}}function wM(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function SM(e){return function(){return this.matches(e)}}function MM(e){return function(t){return t.matches(e)}}var EM=Array.prototype.find;function CM(){return this.firstElementChild}var TM=Array.prototype.filter;function AM(){return Array.from(this.children)}function PM(e){return new Array(e.length)}function DM(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function kM(e,t,n,i,r,o){for(var s,a=0,l=t.length,c=o.length;a<c;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new DM(e,o[a]);for(;a<l;++a)(s=t[a])&&(r[a]=s)}function RM(e,t,n,i,r,o,s){var a,l,c,u=new Map,d=t.length,h=o.length,p=new Array(d);for(a=0;a<d;++a)(l=t[a])&&(p[a]=c=s.call(l,l.__data__,a,t)+"",u.has(c)?r[a]=l:u.set(c,l));for(a=0;a<h;++a)c=s.call(e,o[a],a,o)+"",(l=u.get(c))?(i[a]=l,l.__data__=o[a],u.delete(c)):n[a]=new DM(e,o[a]);for(a=0;a<d;++a)(l=t[a])&&u.get(p[a])===l&&(r[a]=l)}function NM(e){return e.__data__}function IM(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function LM(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}DM.prototype={constructor:DM,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var OM="http://www.w3.org/1999/xhtml";const zM={svg:"http://www.w3.org/2000/svg",xhtml:OM,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function UM(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),zM.hasOwnProperty(t)?{space:zM[t],local:e}:e}function FM(e){return function(){this.removeAttribute(e)}}function jM(e){return function(){this.removeAttributeNS(e.space,e.local)}}function BM(e,t){return function(){this.setAttribute(e,t)}}function VM(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function HM(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function GM(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function WM(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function XM(e){return function(){this.style.removeProperty(e)}}function YM(e,t,n){return function(){this.style.setProperty(e,t,n)}}function $M(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function qM(e,t){return e.style.getPropertyValue(t)||WM(e).getComputedStyle(e,null).getPropertyValue(t)}function ZM(e){return function(){delete this[e]}}function KM(e,t){return function(){this[e]=t}}function JM(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function QM(e){return e.trim().split(/^|\s+/)}function eE(e){return e.classList||new tE(e)}function tE(e){this._node=e,this._names=QM(e.getAttribute("class")||"")}function nE(e,t){for(var n=eE(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function iE(e,t){for(var n=eE(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function rE(e){return function(){nE(this,e)}}function oE(e){return function(){iE(this,e)}}function sE(e,t){return function(){(t.apply(this,arguments)?nE:iE)(this,e)}}function aE(){this.textContent=""}function lE(e){return function(){this.textContent=e}}function cE(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function uE(){this.innerHTML=""}function dE(e){return function(){this.innerHTML=e}}function hE(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function pE(){this.nextSibling&&this.parentNode.appendChild(this)}function fE(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mE(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===OM&&t.documentElement.namespaceURI===OM?t.createElement(e):t.createElementNS(n,e)}}function gE(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function vE(e){var t=UM(e);return(t.local?gE:mE)(t)}function yE(){return null}function bE(){var e=this.parentNode;e&&e.removeChild(this)}function xE(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function _E(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function wE(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,o=t.length;i<o;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function SE(e,t,n){return function(){var i,r=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=t);this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ME(e,t,n){var i=WM(e),r=i.CustomEvent;"function"===typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function EE(e,t){return function(){return ME(this,e,t)}}function CE(e,t){return function(){return ME(this,e,t.apply(this,arguments))}}tE.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var TE=[null];function AE(e,t){this._groups=e,this._parents=t}function PE(){return new AE([[document.documentElement]],TE)}AE.prototype=PE.prototype={constructor:AE,select:function(e){"function"!==typeof e&&(e=bM(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s,a=t[r],l=a.length,c=i[r]=new Array(l),u=0;u<l;++u)(o=a[u])&&(s=e.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),c[u]=s);return new AE(i,this._parents)},selectAll:function(e){e="function"===typeof e?wM(e):_M(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var s,a=t[o],l=a.length,c=0;c<l;++c)(s=a[c])&&(i.push(e.call(s,s.__data__,c,a)),r.push(s));return new AE(i,r)},selectChild:function(e){return this.select(null==e?CM:function(e){return function(){return EM.call(this.children,e)}}("function"===typeof e?e:MM(e)))},selectChildren:function(e){return this.selectAll(null==e?AM:function(e){return function(){return TM.call(this.children,e)}}("function"===typeof e?e:MM(e)))},filter:function(e){"function"!==typeof e&&(e=SM(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new AE(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,NM);var n=t?RM:kM,i=this._parents,r=this._groups;"function"!==typeof e&&(e=function(e){return function(){return e}}(e));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=i[c],d=r[c],h=d.length,p=IM(e.call(u,u&&u.__data__,c,i)),f=p.length,m=a[c]=new Array(f),g=s[c]=new Array(f);n(u,d,m,g,l[c]=new Array(h),p,t);for(var v,y,b=0,x=0;b<f;++b)if(v=m[b]){for(b>=x&&(x=b+1);!(y=g[x])&&++x<f;);v._next=y||null}}return(s=new AE(s,i))._enter=a,s._exit=l,s},enter:function(){return new AE(this._enter||this._groups.map(PM),this._parents)},exit:function(){return new AE(this._exit||this._groups.map(PM),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,o=this.exit();return"function"===typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var c,u=n[l],d=i[l],h=u.length,p=a[l]=new Array(h),f=0;f<h;++f)(c=u[f]||d[f])&&(p[f]=c);for(;l<r;++l)a[l]=n[l];return new AE(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=LM);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,c=r[o]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(t)}return new AE(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,o=t[n],s=0,a=o.length;s<a;++s)(r=o[s])&&e.call(r,r.__data__,s,o);return this},attr:function(e,t){var n=UM(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?jM:FM:"function"===typeof t?n.local?GM:HM:n.local?VM:BM)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?XM:"function"===typeof t?$M:YM)(e,t,null==n?"":n)):qM(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?ZM:"function"===typeof t?JM:KM)(e,t)):this.node()[e]},classed:function(e,t){var n=QM(e+"");if(arguments.length<2){for(var i=eE(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"===typeof t?sE:t?rE:oE)(n,t))},text:function(e){return arguments.length?this.each(null==e?aE:("function"===typeof e?cE:lE)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?uE:("function"===typeof e?hE:dE)(e)):this.node().innerHTML},raise:function(){return this.each(pE)},lower:function(){return this.each(fE)},append:function(e){var t="function"===typeof e?e:vE(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"===typeof e?e:vE(e),i=null==t?yE:"function"===typeof t?t:bM(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(bE)},clone:function(e){return this.select(e?_E:xE)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,o=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),s=o.length;if(!(arguments.length<2)){for(a=t?SE:wE,i=0;i<s;++i)this.each(a(o[i],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(i=0,l=a[c];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"===typeof t?CE:EE)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const DE=PE;function kE(e){return"string"===typeof e?new AE([[document.querySelector(e)]],[document.documentElement]):new AE([[e]],TE)}const RE={passive:!1},NE={capture:!0,passive:!1};function IE(e){e.stopImmediatePropagation()}function LE(e){e.preventDefault(),e.stopImmediatePropagation()}function OE(e){var t=e.document.documentElement,n=kE(e).on("dragstart.drag",LE,NE);"onselectstart"in t?n.on("selectstart.drag",LE,NE):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function zE(e,t){var n=e.document.documentElement,i=kE(e).on("dragstart.drag",null);t&&(i.on("click.drag",LE,NE),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function UE(e){return((e=Math.exp(e))+1/e)/2}const FE=function e(t,n,i){function r(e,r){var o,s,a=e[0],l=e[1],c=e[2],u=r[0],d=r[1],h=r[2],p=u-a,f=d-l,m=p*p+f*f;if(m<1e-12)s=Math.log(h/c)/t,o=function(e){return[a+e*p,l+e*f,c*Math.exp(t*e*s)]};else{var g=Math.sqrt(m),v=(h*h-c*c+i*m)/(2*c*n*g),y=(h*h-c*c-i*m)/(2*h*n*g),b=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(y*y+1)-y);s=(x-b)/t,o=function(e){var i=e*s,r=UE(b),o=c/(n*g)*(r*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*i+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[a+o*p,l+o*f,c*r/UE(t*i+b)]}}return o.duration=1e3*s*t/Math.SQRT2,o}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r}(Math.SQRT2,2,4);function jE(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}var BE,VE,HE=0,GE=0,WE=0,XE=0,YE=0,$E=0,qE="object"===typeof performance&&performance.now?performance:Date,ZE="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function KE(){return YE||(ZE(JE),YE=qE.now()+$E)}function JE(){YE=0}function QE(){this._call=this._time=this._next=null}function eC(e,t,n){var i=new QE;return i.restart(e,t,n),i}function tC(){YE=(XE=qE.now())+$E,HE=GE=0;try{!function(){KE(),++HE;for(var e,t=BE;t;)(e=YE-t._time)>=0&&t._call.call(void 0,e),t=t._next;--HE}()}finally{HE=0,function(){var e,t,n=BE,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:BE=t);VE=e,iC(i)}(),YE=0}}function nC(){var e=qE.now(),t=e-XE;t>1e3&&($E-=t,XE=e)}function iC(e){HE||(GE&&(GE=clearTimeout(GE)),e-YE>24?(e<1/0&&(GE=setTimeout(tC,e-qE.now()-$E)),WE&&(WE=clearInterval(WE))):(WE||(XE=qE.now(),WE=setInterval(nC,1e3)),HE=1,ZE(tC)))}function rC(e,t,n){var i=new QE;return t=null==t?0:+t,i.restart(n=>{i.stop(),e(n+t)},t,n),i}QE.prototype=eC.prototype={constructor:QE,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?KE():+n)+(null==t?0:+t),this._next||VE===this||(VE?VE._next=this:BE=this,VE=this),this._call=e,this._time=n,iC()},stop:function(){this._call&&(this._call=null,this._time=1/0,iC())}};var oC=vM("start","end","cancel","interrupt"),sC=[];function aC(e,t,n,i,r,o){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function o(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)}function s(o){var c,u,d,h;if(1!==n.state)return l();for(c in r)if((h=r[c]).name===n.name){if(3===h.state)return rC(s);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete r[c]):+c<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete r[c])}if(rC(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(o))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(d=n.tween.length),c=0,u=-1;c<d;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=h);i.length=u+1}}function a(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,s=i.length;++o<s;)i[o].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=eC(o,0,n.time)}(e,n,{name:t,index:i,group:r,on:oC,tween:sC,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function lC(e,t){var n=uC(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function cC(e,t){var n=uC(e,t);if(n.state>3)throw new Error("too late; already running");return n}function uC(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function dC(e,t){var n,i,r,o=e.__transition,s=!0;if(o){for(r in t=null==t?null:t+"",o)(n=o[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete o[r]):s=!1;s&&delete e.__transition}}function hC(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var pC,fC=180/Math.PI,mC={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function gC(e,t,n,i,r,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*fC,skewX:Math.atan(l)*fC,scaleX:s,scaleY:a}}function vC(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(o,s){var a=[],l=[];return o=e(o),s=e(s),function(e,i,r,o,s,a){if(e!==r||i!==o){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:hC(e,r)},{i:l-2,x:hC(i,o)})}else(r||o)&&s.push("translate("+r+t+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,a,l),function(e,t,n,o){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:hC(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(o.rotate,s.rotate,a,l),function(e,t,n,o){e!==t?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:hC(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(o.skewX,s.skewX,a,l),function(e,t,n,i,o,s){if(e!==n||t!==i){var a=o.push(r(o)+"scale(",null,",",null,")");s.push({i:a-4,x:hC(e,n)},{i:a-2,x:hC(t,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,a,l),o=s=null,function(e){for(var t,n=-1,i=l.length;++n<i;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var yC=vC(function(e){const t=new("function"===typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?mC:gC(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),bC=vC(function(e){return null==e?mC:(pC||(pC=document.createElementNS("http://www.w3.org/2000/svg","g")),pC.setAttribute("transform",e),(e=pC.transform.baseVal.consolidate())?gC((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):mC)},", ",")",")");function xC(e,t){var n,i;return function(){var r=cC(this,e),o=r.tween;if(o!==n)for(var s=0,a=(i=n=o).length;s<a;++s)if(i[s].name===t){(i=i.slice()).splice(s,1);break}r.tween=i}}function _C(e,t,n){var i,r;if("function"!==typeof n)throw new Error;return function(){var o=cC(this,e),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=a;break}l===c&&r.push(a)}o.tween=r}}function wC(e,t,n){var i=e._id;return e.each(function(){var e=cC(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return uC(e,i).value[t]}}function SC(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function MC(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function EC(){}var CC=.7,TC=1/CC,AC="\\s*([+-]?\\d+)\\s*",PC="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",DC="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kC=/^#([0-9a-f]{3,8})$/,RC=new RegExp(`^rgb\\(${AC},${AC},${AC}\\)$`),NC=new RegExp(`^rgb\\(${DC},${DC},${DC}\\)$`),IC=new RegExp(`^rgba\\(${AC},${AC},${AC},${PC}\\)$`),LC=new RegExp(`^rgba\\(${DC},${DC},${DC},${PC}\\)$`),OC=new RegExp(`^hsl\\(${PC},${DC},${DC}\\)$`),zC=new RegExp(`^hsla\\(${PC},${DC},${DC},${PC}\\)$`),UC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function FC(){return this.rgb().formatHex()}function jC(){return this.rgb().formatRgb()}function BC(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=kC.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?VC(t):3===n?new WC(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?HC(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?HC(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=RC.exec(e))?new WC(t[1],t[2],t[3],1):(t=NC.exec(e))?new WC(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=IC.exec(e))?HC(t[1],t[2],t[3],t[4]):(t=LC.exec(e))?HC(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=OC.exec(e))?KC(t[1],t[2]/100,t[3]/100,1):(t=zC.exec(e))?KC(t[1],t[2]/100,t[3]/100,t[4]):UC.hasOwnProperty(e)?VC(UC[e]):"transparent"===e?new WC(NaN,NaN,NaN,0):null}function VC(e){return new WC(e>>16&255,e>>8&255,255&e,1)}function HC(e,t,n,i){return i<=0&&(e=t=n=NaN),new WC(e,t,n,i)}function GC(e,t,n,i){return 1===arguments.length?((r=e)instanceof EC||(r=BC(r)),r?new WC((r=r.rgb()).r,r.g,r.b,r.opacity):new WC):new WC(e,t,n,null==i?1:i);var r}function WC(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function XC(){return`#${ZC(this.r)}${ZC(this.g)}${ZC(this.b)}`}function YC(){const e=$C(this.opacity);return`${1===e?"rgb(":"rgba("}${qC(this.r)}, ${qC(this.g)}, ${qC(this.b)}${1===e?")":`, ${e})`}`}function $C(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function qC(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ZC(e){return((e=qC(e))<16?"0":"")+e.toString(16)}function KC(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new QC(e,t,n,i)}function JC(e){if(e instanceof QC)return new QC(e.h,e.s,e.l,e.opacity);if(e instanceof EC||(e=BC(e)),!e)return new QC;if(e instanceof QC)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),s=NaN,a=o-r,l=(o+r)/2;return a?(s=t===o?(n-i)/a+6*(n<i):n===o?(i-t)/a+2:(t-n)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new QC(s,a,l,e.opacity)}function QC(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function eT(e){return(e=(e||0)%360)<0?e+360:e}function tT(e){return Math.max(0,Math.min(1,e||0))}function nT(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function iT(e,t,n,i,r){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*i+s*r)/6}SC(EC,BC,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:FC,formatHex:FC,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return JC(this).formatHsl()},formatRgb:jC,toString:jC}),SC(WC,GC,MC(EC,{brighter(e){return e=null==e?TC:Math.pow(TC,e),new WC(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?CC:Math.pow(CC,e),new WC(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new WC(qC(this.r),qC(this.g),qC(this.b),$C(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:XC,formatHex:XC,formatHex8:function(){return`#${ZC(this.r)}${ZC(this.g)}${ZC(this.b)}${ZC(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:YC,toString:YC})),SC(QC,function(e,t,n,i){return 1===arguments.length?JC(e):new QC(e,t,n,null==i?1:i)},MC(EC,{brighter(e){return e=null==e?TC:Math.pow(TC,e),new QC(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?CC:Math.pow(CC,e),new QC(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new WC(nT(e>=240?e-240:e+120,r,i),nT(e,r,i),nT(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new QC(eT(this.h),tT(this.s),tT(this.l),$C(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=$C(this.opacity);return`${1===e?"hsl(":"hsla("}${eT(this.h)}, ${100*tT(this.s)}%, ${100*tT(this.l)}%${1===e?")":`, ${e})`}`}}));const rT=e=>()=>e;function oT(e,t){return function(n){return e+n*t}}function sT(e){return 1===(e=+e)?aT:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):rT(isNaN(t)?n:t)}}function aT(e,t){var n=t-e;return n?oT(e,n):rT(isNaN(e)?t:e)}const lT=function e(t){var n=sT(t);function i(e,t){var i=n((e=GC(e)).r,(t=GC(t)).r),r=n(e.g,t.g),o=n(e.b,t.b),s=aT(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=o(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function cT(e){return function(t){var n,i,r=t.length,o=new Array(r),s=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=GC(t[n]),o[n]=i.r||0,s[n]=i.g||0,a[n]=i.b||0;return o=e(o),s=e(s),a=e(a),i.opacity=1,function(e){return i.r=o(e),i.g=s(e),i.b=a(e),i+""}}}cT(function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],s=i>0?e[i-1]:2*r-o,a=i<t-1?e[i+2]:2*o-r;return iT((n-i/t)*t,s,r,o,a)}}),cT(function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],s=e[(i+1)%t],a=e[(i+2)%t];return iT((n-i/t)*t,r,o,s,a)}});var uT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dT=new RegExp(uT.source,"g");function hT(e,t){var n,i,r,o=uT.lastIndex=dT.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=uT.exec(e))&&(i=dT.exec(t));)(r=i.index)>o&&(r=t.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:hC(n,i)})),o=dT.lastIndex;return o<t.length&&(r=t.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function pT(e,t){var n;return("number"===typeof t?hC:t instanceof BC?lT:(n=BC(t))?(t=n,lT):hT)(e,t)}function fT(e){return function(){this.removeAttribute(e)}}function mT(e){return function(){this.removeAttributeNS(e.space,e.local)}}function gT(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttribute(e);return s===o?null:s===i?r:r=t(i=s,n)}}function vT(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===i?r:r=t(i=s,n)}}function yT(e,t,n){var i,r,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l));this.removeAttribute(e)}}function bT(e,t,n){var i,r,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l));this.removeAttributeNS(e.space,e.local)}}function xT(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,r)),n}return r._value=t,r}function _T(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,r)),n}return r._value=t,r}function wT(e,t){return function(){lC(this,e).delay=+t.apply(this,arguments)}}function ST(e,t){return t=+t,function(){lC(this,e).delay=t}}function MT(e,t){return function(){cC(this,e).duration=+t.apply(this,arguments)}}function ET(e,t){return t=+t,function(){cC(this,e).duration=t}}var CT=DE.prototype.constructor;function TT(e){return function(){this.style.removeProperty(e)}}var AT=0;function PT(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function DT(){return++AT}var kT=DE.prototype;PT.prototype=function(e){return DE().transition(e)}.prototype={constructor:PT,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=bM(e));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a,l,c=i[s],u=c.length,d=o[s]=new Array(u),h=0;h<u;++h)(a=c[h])&&(l=e.call(a,a.__data__,h,c))&&("__data__"in a&&(l.__data__=a.__data__),d[h]=l,aC(d[h],t,n,h,d,uC(a,n)));return new PT(o,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=_M(e));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l,c=i[a],u=c.length,d=0;d<u;++d)if(l=c[d]){for(var h,p=e.call(l,l.__data__,d,c),f=uC(l,n),m=0,g=p.length;m<g;++m)(h=p[m])&&aC(h,t,n,m,p,f);o.push(p),s.push(l)}return new PT(o,s,t,n)},selectChild:kT.selectChild,selectChildren:kT.selectChildren,filter:function(e){"function"!==typeof e&&(e=SM(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new PT(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var l,c=t[a],u=n[a],d=c.length,h=s[a]=new Array(d),p=0;p<d;++p)(l=c[p]||u[p])&&(h[p]=l);for(;a<i;++a)s[a]=t[a];return new PT(s,this._parents,this._name,this._id)},selection:function(){return new CT(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=DT(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=uC(s,t);aC(s,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new PT(i,this._parents,e,n)},call:kT.call,nodes:kT.nodes,node:kT.node,size:kT.size,empty:kT.empty,each:kT.each,on:function(e,t){var n=this._id;return arguments.length<2?uC(this.node(),n).on.on(e):this.each(function(e,t,n){var i,r,o=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?lC:cC;return function(){var s=o(this,e),a=s.on;a!==i&&(r=(i=a).copy()).on(t,n),s.on=r}}(n,e,t))},attr:function(e,t){var n=UM(e),i="transform"===n?bC:pT;return this.attrTween(e,"function"===typeof t?(n.local?bT:yT)(n,i,wC(this,"attr."+e,t)):null==t?(n.local?mT:fT)(n):(n.local?vT:gT)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var i=UM(e);return this.tween(n,(i.local?xT:_T)(i,t))},style:function(e,t,n){var i="transform"===(e+="")?yC:pT;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var o=qM(this,e),s=(this.style.removeProperty(e),qM(this,e));return o===s?null:o===n&&s===i?r:r=t(n=o,i=s)}}(e,i)).on("end.style."+e,TT(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var i,r,o;return function(){var s=qM(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=qM(this,e)),s===l?null:s===i&&l===r?o:(r=l,o=t(i=s,a))}}(e,i,wC(this,"style."+e,t))).each(function(e,t){var n,i,r,o,s="style."+t,a="end."+s;return function(){var l=cC(this,e),c=l.on,u=null==l.value[s]?o||(o=TT(t)):void 0;c===n&&r===u||(i=(n=c).copy()).on(a,r=u),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,o=n+"";return function(){var s=qM(this,e);return s===o?null:s===i?r:r=t(i=s,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!==typeof t)throw new Error;return this.tween(i,function(e,t,n){var i,r;function o(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&function(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,o,n)),i}return o._value=t,o}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(wC(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=uC(this.node(),n).tween,o=0,s=r.length;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((null==t?xC:_C)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?wT:ST)(t,e)):uC(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?MT:ET)(t,e)):uC(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!==typeof t)throw new Error;return function(){cC(this,e).ease=t}}(t,e)):uC(this.node(),t).ease},easeVarying:function(e){if("function"!==typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!==typeof n)throw new Error;cC(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){0===--r&&o()}};n.each(function(){var n=cC(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===r&&o()})},[Symbol.iterator]:kT[Symbol.iterator]};var RT={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function NT(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}DE.prototype.interrupt=function(e){return this.each(function(){dC(this,e)})},DE.prototype.transition=function(e){var t,n;e instanceof PT?(t=e._id,e=e._name):(t=DT(),(n=RT).time=KE(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,c=0;c<l;++c)(s=a[c])&&aC(s,e,t,c,a,n||NT(s,t));return new PT(i,this._parents,e,t)};const IT=e=>()=>e;function LT(e,t){let{sourceEvent:n,target:i,transform:r,dispatch:o}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function OT(e,t,n){this.k=e,this.x=t,this.y=n}OT.prototype={constructor:OT,scale:function(e){return 1===e?this:new OT(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new OT(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zT=new OT(1,0,0);function UT(e){e.stopImmediatePropagation()}function FT(e){e.preventDefault(),e.stopImmediatePropagation()}function jT(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button}function BT(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function VT(){return this.__zoom||zT}function HT(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function GT(){return navigator.maxTouchPoints||"ontouchstart"in this}function WT(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}OT.prototype;const XT=e=>()=>e;function YT(e,t){let{sourceEvent:n,subject:i,target:r,identifier:o,active:s,x:a,y:l,dx:c,dy:u,dispatch:d}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}function $T(e){return!e.ctrlKey&&!e.button}function qT(){return this.parentNode}function ZT(e,t){return null==t?{x:e.x,y:e.y}:t}function KT(){return navigator.maxTouchPoints||"ontouchstart"in this}YT.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};const JT=(0,t.createContext)(null),QT=JT.Provider,eA=e=>`Node type "${e}" not found. Using fallback type "default".`,tA=()=>"The React Flow parent container needs a width and a height to render the graph.",nA=()=>"Only child nodes can use a parent extent.",iA=()=>"Can't create edge. An edge needs a source and a target.",rA=e=>`Marker type "${e}" doesn't exist.`,oA=(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,sA=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",aA=e=>`Edge type "${e}" not found. Using fallback type "default".`,lA=e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,cA=(()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001")();function uA(e,n){const i=(0,t.useContext)(JT);if(null===i)throw new Error(cA);return cM(i,e,n)}const dA=()=>{const e=(0,t.useContext)(JT);if(null===e)throw new Error(cA);return(0,t.useMemo)(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},hA=e=>e.userSelectionActive?"none":"all";function pA(e){let{position:n,children:i,className:r,style:o,...s}=e;const a=uA(hA),l=`${n}`.split("-");return t.createElement("div",{className:oM(["react-flow__panel",r,...l]),style:{...o,pointerEvents:a},...s},i)}function fA(e){let{proOptions:n,position:i="bottom-right"}=e;return n?.hideAttribution?null:t.createElement(pA,{position:i,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},t.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var mA=(0,t.memo)(e=>{let{x:n,y:i,label:r,labelStyle:o={},labelShowBg:s=!0,labelBgStyle:a={},labelBgPadding:l=[2,4],labelBgBorderRadius:c=2,children:u,className:d,...h}=e;const p=(0,t.useRef)(null),[f,m]=(0,t.useState)({x:0,y:0,width:0,height:0}),g=oM(["react-flow__edge-textwrapper",d]);return(0,t.useEffect)(()=>{if(p.current){const e=p.current.getBBox();m({x:e.x,y:e.y,width:e.width,height:e.height})}},[r]),"undefined"!==typeof r&&r?t.createElement("g",{transform:`translate(${n-f.width/2} ${i-f.height/2})`,className:g,visibility:f.width?"visible":"hidden",...h},s&&t.createElement("rect",{width:f.width+2*l[0],x:-l[0],y:-l[1],height:f.height+2*l[1],className:"react-flow__edge-textbg",style:a,rx:c,ry:c}),t.createElement("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:p,style:o},r),u):null});const gA=e=>({width:e.offsetWidth,height:e.offsetHeight}),vA=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(e,t),n)},yA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},t=arguments.length>1?arguments[1]:void 0;return{x:vA(e.x,t[0][0],t[1][0]),y:vA(e.y,t[0][1],t[1][1])}},bA=(e,t,n)=>e<t?vA(Math.abs(e-t),1,50)/50:e>n?-vA(Math.abs(e-n),1,50)/50:0,xA=(e,t)=>[20*bA(e.x,35,t.width-35),20*bA(e.y,35,t.height-35)],_A=e=>e.getRootNode?.()||window?.document,wA=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),SA=e=>{let{x:t,y:n,width:i,height:r}=e;return{x:t,y:n,x2:t+i,y2:n+r}},MA=e=>{let{x:t,y:n,x2:i,y2:r}=e;return{x:t,y:n,width:i-t,height:r-n}},EA=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),CA=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),i=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*i)},TA=e=>!isNaN(e)&&isFinite(e),AA=Symbol.for("internals"),PA=["Enter"," ","Escape"],DA=(e,t)=>{0};function kA(e){const t=(e=>"nativeEvent"in e)(e)?e.nativeEvent:e,n=t.composedPath?.()?.[0]||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n?.nodeName)||n?.hasAttribute("contenteditable")||!!n?.closest(".nokey")}const RA=e=>"clientX"in e,NA=(e,t)=>{const n=RA(e),i=n?e.clientX:e.touches?.[0].clientX,r=n?e.clientY:e.touches?.[0].clientY;return{x:i-(t?.left??0),y:r-(t?.top??0)}},IA=()=>"undefined"!==typeof navigator&&navigator?.userAgent?.indexOf("Mac")>=0,LA=e=>{let{id:n,path:i,labelX:r,labelY:o,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:f,interactionWidth:m=20}=e;return t.createElement(t.Fragment,null,t.createElement("path",{id:n,style:h,d:i,fill:"none",className:"react-flow__edge-path",markerEnd:p,markerStart:f}),m&&t.createElement("path",{d:i,fill:"none",strokeOpacity:0,strokeWidth:m,className:"react-flow__edge-interaction"}),s&&TA(r)&&TA(o)?t.createElement(mA,{x:r,y:o,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d}):null)};LA.displayName="BaseEdge";function OA(e,t,n){return void 0===n?n:i=>{const r=t().edges.find(t=>t.id===e);r&&n(i,{...r})}}function zA(e){let{sourceX:t,sourceY:n,targetX:i,targetY:r}=e;const o=Math.abs(i-t)/2,s=i<t?i+o:i-o,a=Math.abs(r-n)/2;return[s,r<n?r+a:r-a,o,a]}function UA(e){let{sourceX:t,sourceY:n,targetX:i,targetY:r,sourceControlX:o,sourceControlY:s,targetControlX:a,targetControlY:l}=e;const c=.125*t+.375*o+.375*a+.125*i,u=.125*n+.375*s+.375*l+.125*r;return[c,u,Math.abs(c-t),Math.abs(u-n)]}var FA,jA,BA,VA,HA,GA;function WA(e){let{pos:t,x1:n,y1:i,x2:r,y2:o}=e;return t===GA.Left||t===GA.Right?[.5*(n+r),i]:[n,.5*(i+o)]}function XA(e){let{sourceX:t,sourceY:n,sourcePosition:i=GA.Bottom,targetX:r,targetY:o,targetPosition:s=GA.Top}=e;const[a,l]=WA({pos:i,x1:t,y1:n,x2:r,y2:o}),[c,u]=WA({pos:s,x1:r,y1:o,x2:t,y2:n}),[d,h,p,f]=UA({sourceX:t,sourceY:n,targetX:r,targetY:o,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${t},${n} C${a},${l} ${c},${u} ${r},${o}`,d,h,p,f]}!function(e){e.Strict="strict",e.Loose="loose"}(FA||(FA={})),function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"}(jA||(jA={})),function(e){e.Partial="partial",e.Full="full"}(BA||(BA={})),function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"}(VA||(VA={})),function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"}(HA||(HA={})),function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"}(GA||(GA={}));const YA=(0,t.memo)(e=>{let{sourceX:n,sourceY:i,targetX:r,targetY:o,sourcePosition:s=GA.Bottom,targetPosition:a=GA.Top,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:v}=e;const[y,b,x]=XA({sourceX:n,sourceY:i,sourcePosition:s,targetX:r,targetY:o,targetPosition:a});return t.createElement(LA,{path:y,labelX:b,labelY:x,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:v})});YA.displayName="SimpleBezierEdge";const $A={[GA.Left]:{x:-1,y:0},[GA.Right]:{x:1,y:0},[GA.Top]:{x:0,y:-1},[GA.Bottom]:{x:0,y:1}},qA=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function ZA(e){let{source:t,sourcePosition:n=GA.Bottom,target:i,targetPosition:r=GA.Top,center:o,offset:s}=e;const a=$A[n],l=$A[r],c={x:t.x+a.x*s,y:t.y+a.y*s},u={x:i.x+l.x*s,y:i.y+l.y*s},d=(e=>{let{source:t,sourcePosition:n=GA.Bottom,target:i}=e;return n===GA.Left||n===GA.Right?t.x<i.x?{x:1,y:0}:{x:-1,y:0}:t.y<i.y?{x:0,y:1}:{x:0,y:-1}})({source:c,sourcePosition:n,target:u}),h=0!==d.x?"x":"y",p=d[h];let f,m,g=[];const v={x:0,y:0},y={x:0,y:0},[b,x,_,w]=zA({sourceX:t.x,sourceY:t.y,targetX:i.x,targetY:i.y});if(a[h]*l[h]===-1){f=o.x??b,m=o.y??x;const e=[{x:f,y:c.y},{x:f,y:u.y}],t=[{x:c.x,y:m},{x:u.x,y:m}];g=a[h]===p?"x"===h?e:t:"x"===h?t:e}else{const e=[{x:c.x,y:u.y}],o=[{x:u.x,y:c.y}];if(g="x"===h?a.x===p?o:e:a.y===p?e:o,n===r){const e=Math.abs(t[h]-i[h]);if(e<=s){const n=Math.min(s-1,s-e);a[h]===p?v[h]=(c[h]>t[h]?-1:1)*n:y[h]=(u[h]>i[h]?-1:1)*n}}if(n!==r){const t="x"===h?"y":"x",n=a[h]===l[t],i=c[t]>u[t],r=c[t]<u[t];(1===a[h]&&(!n&&i||n&&r)||1!==a[h]&&(!n&&r||n&&i))&&(g="x"===h?e:o)}const d={x:c.x+v.x,y:c.y+v.y},b={x:u.x+y.x,y:u.y+y.y};Math.max(Math.abs(d.x-g[0].x),Math.abs(b.x-g[0].x))>=Math.max(Math.abs(d.y-g[0].y),Math.abs(b.y-g[0].y))?(f=(d.x+b.x)/2,m=g[0].y):(f=g[0].x,m=(d.y+b.y)/2)}return[[t,{x:c.x+v.x,y:c.y+v.y},...g,{x:u.x+y.x,y:u.y+y.y},i],f,m,_,w]}function KA(e){let{sourceX:t,sourceY:n,sourcePosition:i=GA.Bottom,targetX:r,targetY:o,targetPosition:s=GA.Top,borderRadius:a=5,centerX:l,centerY:c,offset:u=20}=e;const[d,h,p,f,m]=ZA({source:{x:t,y:n},sourcePosition:i,target:{x:r,y:o},targetPosition:s,center:{x:l,y:c},offset:u}),g=d.reduce((e,t,n)=>{let i="";return i=n>0&&n<d.length-1?function(e,t,n,i){const r=Math.min(qA(e,t)/2,qA(t,n)/2,i),{x:o,y:s}=t;if(e.x===o&&o===n.x||e.y===s&&s===n.y)return`L${o} ${s}`;if(e.y===s)return`L ${o+r*(e.x<n.x?-1:1)},${s}Q ${o},${s} ${o},${s+r*(e.y<n.y?1:-1)}`;const a=e.x<n.x?1:-1;return`L ${o},${s+r*(e.y<n.y?-1:1)}Q ${o},${s} ${o+r*a},${s}`}(d[n-1],t,d[n+1],a):`${0===n?"M":"L"}${t.x} ${t.y}`,e+=i},"");return[g,h,p,f,m]}const JA=(0,t.memo)(e=>{let{sourceX:n,sourceY:i,targetX:r,targetY:o,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,sourcePosition:p=GA.Bottom,targetPosition:f=GA.Top,markerEnd:m,markerStart:g,pathOptions:v,interactionWidth:y}=e;const[b,x,_]=KA({sourceX:n,sourceY:i,sourcePosition:p,targetX:r,targetY:o,targetPosition:f,borderRadius:v?.borderRadius,offset:v?.offset});return t.createElement(LA,{path:b,labelX:x,labelY:_,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:m,markerStart:g,interactionWidth:y})});JA.displayName="SmoothStepEdge";const QA=(0,t.memo)(e=>t.createElement(JA,{...e,pathOptions:(0,t.useMemo)(()=>({borderRadius:0,offset:e.pathOptions?.offset}),[e.pathOptions?.offset])}));QA.displayName="StepEdge";const eP=(0,t.memo)(e=>{let{sourceX:n,sourceY:i,targetX:r,targetY:o,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:f,interactionWidth:m}=e;const[g,v,y]=function(e){let{sourceX:t,sourceY:n,targetX:i,targetY:r}=e;const[o,s,a,l]=zA({sourceX:t,sourceY:n,targetX:i,targetY:r});return[`M ${t},${n}L ${i},${r}`,o,s,a,l]}({sourceX:n,sourceY:i,targetX:r,targetY:o});return t.createElement(LA,{path:g,labelX:v,labelY:y,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:f,interactionWidth:m})});function tP(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function nP(e){let{pos:t,x1:n,y1:i,x2:r,y2:o,c:s}=e;switch(t){case GA.Left:return[n-tP(n-r,s),i];case GA.Right:return[n+tP(r-n,s),i];case GA.Top:return[n,i-tP(i-o,s)];case GA.Bottom:return[n,i+tP(o-i,s)]}}function iP(e){let{sourceX:t,sourceY:n,sourcePosition:i=GA.Bottom,targetX:r,targetY:o,targetPosition:s=GA.Top,curvature:a=.25}=e;const[l,c]=nP({pos:i,x1:t,y1:n,x2:r,y2:o,c:a}),[u,d]=nP({pos:s,x1:r,y1:o,x2:t,y2:n,c:a}),[h,p,f,m]=UA({sourceX:t,sourceY:n,targetX:r,targetY:o,sourceControlX:l,sourceControlY:c,targetControlX:u,targetControlY:d});return[`M${t},${n} C${l},${c} ${u},${d} ${r},${o}`,h,p,f,m]}eP.displayName="StraightEdge";const rP=(0,t.memo)(e=>{let{sourceX:n,sourceY:i,targetX:r,targetY:o,sourcePosition:s=GA.Bottom,targetPosition:a=GA.Top,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,pathOptions:v,interactionWidth:y}=e;const[b,x,_]=iP({sourceX:n,sourceY:i,sourcePosition:s,targetX:r,targetY:o,targetPosition:a,curvature:v?.curvature});return t.createElement(LA,{path:b,labelX:x,labelY:_,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:y})});rP.displayName="BezierEdge";const oP=(0,t.createContext)(null),sP=oP.Provider;oP.Consumer;const aP=e=>{let{source:t,sourceHandle:n,target:i,targetHandle:r}=e;return`reactflow__edge-${t}${n||""}-${i}${r||""}`},lP=(e,t)=>{if("undefined"===typeof e)return"";if("string"===typeof e)return e;return`${t?`${t}__`:""}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`},cP=(e,t)=>{if(!e.source||!e.target)return DA(0,iA()),t;let n;var i;return n="id"in(i=e)&&"source"in i&&"target"in i?{...e}:{...e,id:aP(e)},((e,t)=>t.some(t=>t.source===e.source&&t.target===e.target&&(t.sourceHandle===e.sourceHandle||!t.sourceHandle&&!e.sourceHandle)&&(t.targetHandle===e.targetHandle||!t.targetHandle&&!e.targetHandle)))(n,t)?t:t.concat(n)},uP=(e,t,n,i)=>{let{x:r,y:o}=e,[s,a,l]=t,[c,u]=i;const d={x:(r-s)/l,y:(o-a)/l};return n?{x:c*Math.round(d.x/c),y:u*Math.round(d.y/u)}:d},dP=(e,t)=>{let{x:n,y:i}=e,[r,o,s]=t;return{x:n*s+r,y:i*s+o}},hP=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],i=(e.height??0)*t[1],r={x:e.position.x-n,y:e.position.y-i};return{...r,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-i}:r}},pP=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce((e,n)=>{const{x:i,y:r}=hP(n,t).positionAbsolute;return wA(e,SA({x:i,y:r,width:n.width||0,height:n.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return MA(n)},fP=function(e,t){let[n,i,r]=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,1],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0];const l={x:(t.x-n)/r,y:(t.y-i)/r,width:t.width/r,height:t.height/r},c=[];return e.forEach(e=>{const{width:t,height:n,selectable:i=!0,hidden:r=!1}=e;if(s&&!i||r)return!1;const{positionAbsolute:u}=hP(e,a),d={x:u.x,y:u.y,width:t||0,height:n||0},h=CA(l,d);("undefined"===typeof t||"undefined"===typeof n||null===t||null===n||o&&h>0||h>=(t||0)*(n||0)||e.dragging)&&c.push(e)}),c},mP=(e,t)=>{const n=e.map(e=>e.id);return t.filter(e=>n.includes(e.source)||n.includes(e.target))},gP=function(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1;const s=t/(e.width*(1+o)),a=n/(e.height*(1+o)),l=Math.min(s,a),c=vA(l,i,r);return{x:t/2-(e.x+e.width/2)*c,y:n/2-(e.y+e.height/2)*c,zoom:c}},vP=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.transition().duration(t)};function yP(e,t,n,i){return(t[n]||[]).reduce((t,r)=>(`${e.id}-${r.id}-${n}`!==i&&t.push({id:r.id||null,type:n,nodeId:e.id,x:(e.positionAbsolute?.x??0)+r.x+r.width/2,y:(e.positionAbsolute?.y??0)+r.y+r.height/2}),t),[])}const bP={source:null,target:null,sourceHandle:null,targetHandle:null},xP=()=>({handleDomNode:null,isValid:!1,connection:bP,endHandle:null});function _P(e,t,n,i,r,o,s){const a="target"===r,l=s.querySelector(`.react-flow__handle[data-id="${e?.nodeId}-${e?.id}-${e?.type}"]`),c={...xP(),handleDomNode:l};if(l){const e=wP(void 0,l),r=l.getAttribute("data-nodeid"),s=l.getAttribute("data-handleid"),u=l.classList.contains("connectable"),d=l.classList.contains("connectableend"),h={source:a?r:n,sourceHandle:a?s:i,target:a?n:r,targetHandle:a?i:s};c.connection=h;u&&d&&(t===FA.Strict?a&&"source"===e||!a&&"target"===e:r!==n||s!==i)&&(c.endHandle={nodeId:r,handleId:s,type:e},c.isValid=o(h))}return c}function wP(e,t){return e||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function SP(e){e?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function MP(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function EP(e){let{event:t,handleId:n,nodeId:i,onConnect:r,isTarget:o,getState:s,setState:a,isValidConnection:l,edgeUpdaterType:c,onReconnectEnd:u}=e;const d=_A(t.target),{connectionMode:h,domNode:p,autoPanOnConnect:f,connectionRadius:m,onConnectStart:g,panBy:v,getNodes:y,cancelConnection:b}=s();let x,_=0;const{x:w,y:S}=NA(t),M=d?.elementFromPoint(w,S),E=wP(c,M),C=p?.getBoundingClientRect();if(!C||!E)return;let T,A=NA(t,C),P=!1,D=null,k=!1,R=null;const N=function(e){let{nodes:t,nodeId:n,handleId:i,handleType:r}=e;return t.reduce((e,t)=>{if(t[AA]){const{handleBounds:o}=t[AA];let s=[],a=[];o&&(s=yP(t,o,"source",`${n}-${i}-${r}`),a=yP(t,o,"target",`${n}-${i}-${r}`)),e.push(...s,...a)}return e},[])}({nodes:y(),nodeId:i,handleId:n,handleType:E}),I=()=>{if(!f)return;const[e,t]=xA(A,C);v({x:e,y:t}),_=requestAnimationFrame(I)};function L(e){const{transform:t}=s();A=NA(e,C);const{handle:r,validHandleResult:c}=function(e,t,n,i,r,o){const{x:s,y:a}=NA(e),l=t.elementsFromPoint(s,a).find(e=>e.classList.contains("react-flow__handle"));if(l){const e=l.getAttribute("data-nodeid");if(e){const t=wP(void 0,l),i=l.getAttribute("data-handleid"),s=o({nodeId:e,id:i,type:t});if(s){const o=r.find(n=>n.nodeId===e&&n.type===t&&n.id===i);return{handle:{id:i,type:t,nodeId:e,x:o?.x||n.x,y:o?.y||n.y},validHandleResult:s}}}}let c=[],u=1/0;if(r.forEach(e=>{const t=Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2);if(t<=i){const n=o(e);t<=u&&(t<u?c=[{handle:e,validHandleResult:n}]:t===u&&c.push({handle:e,validHandleResult:n}),u=t)}}),!c.length)return{handle:null,validHandleResult:xP()};if(1===c.length)return c[0];const d=c.some(e=>{let{validHandleResult:t}=e;return t.isValid}),h=c.some(e=>{let{handle:t}=e;return"target"===t.type});return c.find(e=>{let{handle:t,validHandleResult:n}=e;return h?"target"===t.type:!d||n.isValid})||c[0]}(e,d,uP(A,t,!1,[1,1]),m,N,e=>_P(e,h,i,n,o?"target":"source",l,d));if(x=r,P||(I(),P=!0),R=c.handleDomNode,D=c.connection,k=c.isValid,a({connectionPosition:x&&k?dP({x:x.x,y:x.y},t):A,connectionStatus:MP(!!x,k),connectionEndHandle:c.endHandle}),!x&&!k&&!R)return SP(T);D.source!==D.target&&R&&(SP(T),T=R,R.classList.add("connecting","react-flow__handle-connecting"),R.classList.toggle("valid",k),R.classList.toggle("react-flow__handle-valid",k))}function O(e){(x||R)&&D&&k&&r?.(D),s().onConnectEnd?.(e),c&&u?.(e),SP(T),b(),cancelAnimationFrame(_),P=!1,k=!1,D=null,R=null,d.removeEventListener("mousemove",L),d.removeEventListener("mouseup",O),d.removeEventListener("touchmove",L),d.removeEventListener("touchend",O)}a({connectionPosition:A,connectionStatus:null,connectionNodeId:i,connectionHandleId:n,connectionHandleType:E,connectionStartHandle:{nodeId:i,handleId:n,type:E},connectionEndHandle:null}),g?.(t,{nodeId:i,handleId:n,handleType:E}),d.addEventListener("mousemove",L),d.addEventListener("mouseup",O),d.addEventListener("touchmove",L),d.addEventListener("touchend",O)}const CP=()=>!0,TP=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),AP=(0,t.forwardRef)((e,n)=>{let{type:i="source",position:r=GA.Top,isValidConnection:o,isConnectable:s=!0,isConnectableStart:a=!0,isConnectableEnd:l=!0,id:c,onConnect:u,children:d,className:h,onMouseDown:p,onTouchStart:f,...m}=e;const g=c||null,v="target"===i,y=dA(),b=(0,t.useContext)(oP),{connectOnClick:x,noPanClassName:_}=uA(TP,dM),{connecting:w,clickConnecting:S}=uA(((e,t,n)=>i=>{const{connectionStartHandle:r,connectionEndHandle:o,connectionClickStartHandle:s}=i;return{connecting:r?.nodeId===e&&r?.handleId===t&&r?.type===n||o?.nodeId===e&&o?.handleId===t&&o?.type===n,clickConnecting:s?.nodeId===e&&s?.handleId===t&&s?.type===n}})(b,g,i),dM);b||y.getState().onError?.("010",sA());const M=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:i}=y.getState(),r={...t,...e};if(i){const{edges:e,setEdges:t}=y.getState();t(cP(r,e))}n?.(r),u?.(r)},E=e=>{if(!b)return;const t=RA(e);a&&(t&&0===e.button||!t)&&EP({event:e,handleId:g,nodeId:b,onConnect:M,isTarget:v,getState:y.getState,setState:y.setState,isValidConnection:o||y.getState().isValidConnection||CP}),t?p?.(e):f?.(e)};return t.createElement("div",{"data-handleid":g,"data-nodeid":b,"data-handlepos":r,"data-id":`${b}-${g}-${i}`,className:oM(["react-flow__handle",`react-flow__handle-${r}`,"nodrag",_,h,{source:!v,target:v,connectable:s,connectablestart:a,connectableend:l,connecting:S,connectionindicator:s&&(a&&!w||l&&w)}]),onMouseDown:E,onTouchStart:E,onClick:x?e=>{const{onClickConnectStart:t,onClickConnectEnd:n,connectionClickStartHandle:r,connectionMode:s,isValidConnection:l}=y.getState();if(!b||!r&&!a)return;if(!r)return t?.(e,{nodeId:b,handleId:g,handleType:i}),void y.setState({connectionClickStartHandle:{nodeId:b,type:i,handleId:g}});const c=_A(e.target),u=o||l||CP,{connection:d,isValid:h}=_P({nodeId:b,id:g,type:i},s,r.nodeId,r.handleId||null,r.type,u,c);h&&M(d),n?.(e),y.setState({connectionClickStartHandle:null})}:void 0,ref:n,...m},d)});AP.displayName="Handle";var PP=(0,t.memo)(AP);const DP=e=>{let{data:n,isConnectable:i,targetPosition:r=GA.Top,sourcePosition:o=GA.Bottom}=e;return t.createElement(t.Fragment,null,t.createElement(PP,{type:"target",position:r,isConnectable:i}),n?.label,t.createElement(PP,{type:"source",position:o,isConnectable:i}))};DP.displayName="DefaultNode";var kP=(0,t.memo)(DP);const RP=e=>{let{data:n,isConnectable:i,sourcePosition:r=GA.Bottom}=e;return t.createElement(t.Fragment,null,n?.label,t.createElement(PP,{type:"source",position:r,isConnectable:i}))};RP.displayName="InputNode";var NP=(0,t.memo)(RP);const IP=e=>{let{data:n,isConnectable:i,targetPosition:r=GA.Top}=e;return t.createElement(t.Fragment,null,t.createElement(PP,{type:"target",position:r,isConnectable:i}),n?.label)};IP.displayName="OutputNode";var LP=(0,t.memo)(IP);const OP=()=>null;OP.displayName="GroupNode";const zP=e=>({selectedNodes:e.getNodes().filter(e=>e.selected),selectedEdges:e.edges.filter(e=>e.selected).map(e=>({...e}))}),UP=e=>e.id;function FP(e,t){return dM(e.selectedNodes.map(UP),t.selectedNodes.map(UP))&&dM(e.selectedEdges.map(UP),t.selectedEdges.map(UP))}const jP=(0,t.memo)(e=>{let{onSelectionChange:n}=e;const i=dA(),{selectedNodes:r,selectedEdges:o}=uA(zP,FP);return(0,t.useEffect)(()=>{const e={nodes:r,edges:o};n?.(e),i.getState().onSelectionChange.forEach(t=>t(e))},[r,o,n]),null});jP.displayName="SelectionListener";const BP=e=>!!e.onSelectionChange;function VP(e){let{onSelectionChange:n}=e;const i=uA(BP);return n||i?t.createElement(jP,{onSelectionChange:n}):null}const HP=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function GP(e,n){(0,t.useEffect)(()=>{"undefined"!==typeof e&&n(e)},[e])}function WP(e,n,i){(0,t.useEffect)(()=>{"undefined"!==typeof n&&i({[e]:n})},[n])}const XP=e=>{let{nodes:n,edges:i,defaultNodes:r,defaultEdges:o,onConnect:s,onConnectStart:a,onConnectEnd:l,onClickConnectStart:c,onClickConnectEnd:u,nodesDraggable:d,nodesConnectable:h,nodesFocusable:p,edgesFocusable:f,edgesUpdatable:m,elevateNodesOnSelect:g,minZoom:v,maxZoom:y,nodeExtent:b,onNodesChange:x,onEdgesChange:_,elementsSelectable:w,connectionMode:S,snapGrid:M,snapToGrid:E,translateExtent:C,connectOnClick:T,defaultEdgeOptions:A,fitView:P,fitViewOptions:D,onNodesDelete:k,onEdgesDelete:R,onNodeDrag:N,onNodeDragStart:I,onNodeDragStop:L,onSelectionDrag:O,onSelectionDragStart:z,onSelectionDragStop:U,noPanClassName:F,nodeOrigin:j,rfId:B,autoPanOnConnect:V,autoPanOnNodeDrag:H,onError:G,connectionRadius:W,isValidConnection:X,nodeDragThreshold:Y}=e;const{setNodes:$,setEdges:q,setDefaultNodesAndEdges:Z,setMinZoom:K,setMaxZoom:J,setTranslateExtent:Q,setNodeExtent:ee,reset:te}=uA(HP,dM),ne=dA();return(0,t.useEffect)(()=>{const e=o?.map(e=>({...e,...A}));return Z(r,e),()=>{te()}},[]),WP("defaultEdgeOptions",A,ne.setState),WP("connectionMode",S,ne.setState),WP("onConnect",s,ne.setState),WP("onConnectStart",a,ne.setState),WP("onConnectEnd",l,ne.setState),WP("onClickConnectStart",c,ne.setState),WP("onClickConnectEnd",u,ne.setState),WP("nodesDraggable",d,ne.setState),WP("nodesConnectable",h,ne.setState),WP("nodesFocusable",p,ne.setState),WP("edgesFocusable",f,ne.setState),WP("edgesUpdatable",m,ne.setState),WP("elementsSelectable",w,ne.setState),WP("elevateNodesOnSelect",g,ne.setState),WP("snapToGrid",E,ne.setState),WP("snapGrid",M,ne.setState),WP("onNodesChange",x,ne.setState),WP("onEdgesChange",_,ne.setState),WP("connectOnClick",T,ne.setState),WP("fitViewOnInit",P,ne.setState),WP("fitViewOnInitOptions",D,ne.setState),WP("onNodesDelete",k,ne.setState),WP("onEdgesDelete",R,ne.setState),WP("onNodeDrag",N,ne.setState),WP("onNodeDragStart",I,ne.setState),WP("onNodeDragStop",L,ne.setState),WP("onSelectionDrag",O,ne.setState),WP("onSelectionDragStart",z,ne.setState),WP("onSelectionDragStop",U,ne.setState),WP("noPanClassName",F,ne.setState),WP("nodeOrigin",j,ne.setState),WP("rfId",B,ne.setState),WP("autoPanOnConnect",V,ne.setState),WP("autoPanOnNodeDrag",H,ne.setState),WP("onError",G,ne.setState),WP("connectionRadius",W,ne.setState),WP("isValidConnection",X,ne.setState),WP("nodeDragThreshold",Y,ne.setState),GP(n,$),GP(i,q),GP(v,K),GP(y,J),GP(C,Q),GP(b,ee),null},YP={display:"none"},$P={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},qP="react-flow__node-desc",ZP="react-flow__edge-desc",KP=e=>e.ariaLiveMessage;function JP(e){let{rfId:n}=e;const i=uA(KP);return t.createElement("div",{id:`react-flow__aria-live-${n}`,"aria-live":"assertive","aria-atomic":"true",style:$P},i)}function QP(e){let{rfId:n,disableKeyboardA11y:i}=e;return t.createElement(t.Fragment,null,t.createElement("div",{id:`${qP}-${n}`,style:YP},"Press enter or space to select a node.",!i&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),t.createElement("div",{id:`${ZP}-${n}`,style:YP},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!i&&t.createElement(JP,{rfId:n}))}var eD=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{actInsideInputWithModifier:!0};const[i,r]=(0,t.useState)(!1),o=(0,t.useRef)(!1),s=(0,t.useRef)(new Set([])),[a,l]=(0,t.useMemo)(()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter(e=>"string"===typeof e).map(e=>e.split("+")),n=t.reduce((e,t)=>e.concat(...t),[]);return[t,n]}return[[],[]]},[e]);return(0,t.useEffect)(()=>{const t="undefined"!==typeof document?document:null,i=n?.target||t;if(null!==e){const e=e=>{o.current=e.ctrlKey||e.metaKey||e.shiftKey;if((!o.current||o.current&&!n.actInsideInputWithModifier)&&kA(e))return!1;const t=nD(e.code,l);s.current.add(e[t]),tD(a,s.current,!1)&&(e.preventDefault(),r(!0))},t=e=>{if((!o.current||o.current&&!n.actInsideInputWithModifier)&&kA(e))return!1;const t=nD(e.code,l);tD(a,s.current,!0)?(r(!1),s.current.clear()):s.current.delete(e[t]),"Meta"===e.key&&s.current.clear(),o.current=!1},c=()=>{s.current.clear(),r(!1)};return i?.addEventListener("keydown",e),i?.addEventListener("keyup",t),window.addEventListener("blur",c),()=>{i?.removeEventListener("keydown",e),i?.removeEventListener("keyup",t),window.removeEventListener("blur",c)}}},[e,r]),i};function tD(e,t,n){return e.filter(e=>n||e.length===t.size).some(e=>e.every(e=>t.has(e)))}function nD(e,t){return t.includes(e)?"code":"key"}function iD(e,t,n,i){const r=e.parentNode||e.parentId;if(!r)return n;const o=t.get(r),s=hP(o,i);return iD(o,t,{x:(n.x??0)+s.x,y:(n.y??0)+s.y,z:(o[AA]?.z??0)>(n.z??0)?o[AA]?.z??0:n.z??0},i)}function rD(e,t,n){e.forEach(i=>{const r=i.parentNode||i.parentId;if(r&&!e.has(r))throw new Error(`Parent node ${r} not found`);if(r||n?.[i.id]){const{x:r,y:o,z:s}=iD(i,e,{...i.position,z:i[AA]?.z??0},t);i.positionAbsolute={x:r,y:o},i[AA].z=s,n?.[i.id]&&(i[AA].isParent=!0)}})}function oD(e,t,n,i){const r=new Map,o={},s=i?1e3:0;return e.forEach(e=>{const n=(TA(e.zIndex)?e.zIndex:0)+(e.selected?s:0),i=t.get(e.id),a={...e,positionAbsolute:{x:e.position.x,y:e.position.y}},l=e.parentNode||e.parentId;l&&(o[l]=!0);const c=i?.type&&i?.type!==e.type;Object.defineProperty(a,AA,{enumerable:!1,value:{handleBounds:c?void 0:i?.[AA]?.handleBounds,z:n}}),r.set(e.id,a)}),rD(r,n,o),r}function sD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{getNodes:n,width:i,height:r,minZoom:o,maxZoom:s,d3Zoom:a,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:d}=e(),h=t.initial&&!c&&u;if(a&&l&&(h||!t.initial)){const e=n().filter(e=>{const n=t.includeHiddenNodes?e.width&&e.height:!e.hidden;return t.nodes?.length?n&&t.nodes.some(t=>t.id===e.id):n}),c=e.every(e=>e.width&&e.height);if(e.length>0&&c){const n=pP(e,d),{x:c,y:u,zoom:h}=gP(n,i,r,t.minZoom??o,t.maxZoom??s,t.padding??.1),p=zT.translate(c,u).scale(h);return"number"===typeof t.duration&&t.duration>0?a.transform(vP(l,t.duration),p):a.transform(l,p),!0}}return!1}function aD(e,t){return e.forEach(e=>{const n=t.get(e.id);n&&t.set(n.id,{...n,[AA]:n[AA],selected:e.selected})}),new Map(t)}function lD(e,t){return t.map(t=>{const n=e.find(e=>e.id===t.id);return n&&(t.selected=n.selected),t})}function cD(e){let{changedNodes:t,changedEdges:n,get:i,set:r}=e;const{nodeInternals:o,edges:s,onNodesChange:a,onEdgesChange:l,hasDefaultNodes:c,hasDefaultEdges:u}=i();t?.length&&(c&&r({nodeInternals:aD(t,o)}),a?.(t)),n?.length&&(u&&r({edges:lD(n,s)}),l?.(n))}const uD=()=>{},dD={zoomIn:uD,zoomOut:uD,zoomTo:uD,getZoom:()=>1,setViewport:uD,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:uD,fitBounds:uD,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},hD=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection});function pD(){const e=(()=>{const e=dA(),{d3Zoom:n,d3Selection:i}=uA(hD,dM),r=(0,t.useMemo)(()=>i&&n?{zoomIn:e=>n.scaleBy(vP(i,e?.duration),1.2),zoomOut:e=>n.scaleBy(vP(i,e?.duration),1/1.2),zoomTo:(e,t)=>n.scaleTo(vP(i,t?.duration),e),getZoom:()=>e.getState().transform[2],setViewport:(t,r)=>{const[o,s,a]=e.getState().transform,l=zT.translate(t.x??o,t.y??s).scale(t.zoom??a);n.transform(vP(i,r?.duration),l)},getViewport:()=>{const[t,n,i]=e.getState().transform;return{x:t,y:n,zoom:i}},fitView:t=>sD(e.getState,t),setCenter:(t,r,o)=>{const{width:s,height:a,maxZoom:l}=e.getState(),c="undefined"!==typeof o?.zoom?o.zoom:l,u=s/2-t*c,d=a/2-r*c,h=zT.translate(u,d).scale(c);n.transform(vP(i,o?.duration),h)},fitBounds:(t,r)=>{const{width:o,height:s,minZoom:a,maxZoom:l}=e.getState(),{x:c,y:u,zoom:d}=gP(t,o,s,a,l,r?.padding??.1),h=zT.translate(c,u).scale(d);n.transform(vP(i,r?.duration),h)},project:t=>{const{transform:n,snapToGrid:i,snapGrid:r}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),uP(t,n,i,r)},screenToFlowPosition:t=>{const{transform:n,snapToGrid:i,snapGrid:r,domNode:o}=e.getState();if(!o)return t;const{x:s,y:a}=o.getBoundingClientRect(),l={x:t.x-s,y:t.y-a};return uP(l,n,i,r)},flowToScreenPosition:t=>{const{transform:n,domNode:i}=e.getState();if(!i)return t;const{x:r,y:o}=i.getBoundingClientRect(),s=dP(t,n);return{x:s.x+r,y:s.y+o}},viewportInitialized:!0}:dD,[n,i]);return r})(),n=dA(),i=(0,t.useCallback)(()=>n.getState().getNodes().map(e=>({...e})),[]),r=(0,t.useCallback)(e=>n.getState().nodeInternals.get(e),[]),o=(0,t.useCallback)(()=>{const{edges:e=[]}=n.getState();return e.map(e=>({...e}))},[]),s=(0,t.useCallback)(e=>{const{edges:t=[]}=n.getState();return t.find(t=>t.id===e)},[]),a=(0,t.useCallback)(e=>{const{getNodes:t,setNodes:i,hasDefaultNodes:r,onNodesChange:o}=n.getState(),s=t(),a="function"===typeof e?e(s):e;if(r)i(a);else if(o){const e=0===a.length?s.map(e=>({type:"remove",id:e.id})):a.map(e=>({item:e,type:"reset"}));o(e)}},[]),l=(0,t.useCallback)(e=>{const{edges:t=[],setEdges:i,hasDefaultEdges:r,onEdgesChange:o}=n.getState(),s="function"===typeof e?e(t):e;if(r)i(s);else if(o){o(0===s.length?t.map(e=>({type:"remove",id:e.id})):s.map(e=>({item:e,type:"reset"})))}},[]),c=(0,t.useCallback)(e=>{const t=Array.isArray(e)?e:[e],{getNodes:i,setNodes:r,hasDefaultNodes:o,onNodesChange:s}=n.getState();if(o){r([...i(),...t])}else if(s){const e=t.map(e=>({item:e,type:"add"}));s(e)}},[]),u=(0,t.useCallback)(e=>{const t=Array.isArray(e)?e:[e],{edges:i=[],setEdges:r,hasDefaultEdges:o,onEdgesChange:s}=n.getState();if(o)r([...i,...t]);else if(s){s(t.map(e=>({item:e,type:"add"})))}},[]),d=(0,t.useCallback)(()=>{const{getNodes:e,edges:t=[],transform:i}=n.getState(),[r,o,s]=i;return{nodes:e().map(e=>({...e})),edges:t.map(e=>({...e})),viewport:{x:r,y:o,zoom:s}}},[]),h=(0,t.useCallback)(e=>{let{nodes:t,edges:i}=e;const{nodeInternals:r,getNodes:o,edges:s,hasDefaultNodes:a,hasDefaultEdges:l,onNodesDelete:c,onEdgesDelete:u,onNodesChange:d,onEdgesChange:h}=n.getState(),p=(t||[]).map(e=>e.id),f=(i||[]).map(e=>e.id),m=o().reduce((e,t)=>{const n=t.parentNode||t.parentId,i=!p.includes(t.id)&&n&&e.find(e=>e.id===n);return("boolean"!==typeof t.deletable||t.deletable)&&(p.includes(t.id)||i)&&e.push(t),e},[]),g=s.filter(e=>"boolean"!==typeof e.deletable||e.deletable),v=g.filter(e=>f.includes(e.id));if(m||v){const e=mP(m,g),t=[...v,...e],i=t.reduce((e,t)=>(e.includes(t.id)||e.push(t.id),e),[]);if((l||a)&&(l&&n.setState({edges:s.filter(e=>!i.includes(e.id))}),a&&(m.forEach(e=>{r.delete(e.id)}),n.setState({nodeInternals:new Map(r)}))),i.length>0&&(u?.(t),h&&h(i.map(e=>({id:e,type:"remove"})))),m.length>0&&(c?.(m),d)){d(m.map(e=>({id:e.id,type:"remove"})))}}},[]),p=(0,t.useCallback)(e=>{const t=TA((i=e).width)&&TA(i.height)&&TA(i.x)&&TA(i.y);var i;const r=t?null:n.getState().nodeInternals.get(e.id);if(!t&&!r)return[null,null,t];return[t?e:EA(r),r,t]},[]),f=(0,t.useCallback)(function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;const[r,o,s]=p(e);return r?(i||n.getState().getNodes()).filter(e=>{if(!s&&(e.id===o.id||!e.positionAbsolute))return!1;const n=EA(e),i=CA(n,r);return t&&i>0||i>=r.width*r.height}):[]},[]),m=(0,t.useCallback)(function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const[i]=p(e);if(!i)return!1;const r=CA(i,t);return n&&r>0||r>=i.width*i.height},[]);return(0,t.useMemo)(()=>({...e,getNodes:i,getNode:r,getEdges:o,getEdge:s,setNodes:a,setEdges:l,addNodes:c,addEdges:u,toObject:d,deleteElements:h,getIntersectingNodes:f,isNodeIntersecting:m}),[e,i,r,o,s,a,l,c,u,d,h,f,m])}const fD={actInsideInputWithModifier:!1};const mD={position:"absolute",width:"100%",height:"100%",top:0,left:0},gD=e=>({x:e.x,y:e.y,zoom:e.k}),vD=(e,t)=>e.target.closest(`.${t}`),yD=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),bD=e=>{const t=e.ctrlKey&&IA()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t},xD=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),_D=e=>{let{onMove:n,onMoveStart:i,onMoveEnd:r,onPaneContextMenu:o,zoomOnScroll:s=!0,zoomOnPinch:a=!0,panOnScroll:l=!1,panOnScrollSpeed:c=.5,panOnScrollMode:u=jA.Free,zoomOnDoubleClick:d=!0,elementsSelectable:h,panOnDrag:p=!0,defaultViewport:f,translateExtent:m,minZoom:g,maxZoom:v,zoomActivationKeyCode:y,preventScrolling:b=!0,children:x,noWheelClassName:_,noPanClassName:w}=e;const S=(0,t.useRef)(),M=dA(),E=(0,t.useRef)(!1),C=(0,t.useRef)(!1),T=(0,t.useRef)(null),A=(0,t.useRef)({x:0,y:0,zoom:0}),{d3Zoom:P,d3Selection:D,d3ZoomHandler:k,userSelectionActive:R}=uA(xD,dM),N=eD(y),I=(0,t.useRef)(0),L=(0,t.useRef)(!1),O=(0,t.useRef)();return function(e){const n=dA();(0,t.useEffect)(()=>{let t;const i=()=>{if(!e.current)return;const t=gA(e.current);0!==t.height&&0!==t.width||n.getState().onError?.("004",tA()),n.setState({width:t.width||500,height:t.height||500})};return i(),window.addEventListener("resize",i),e.current&&(t=new ResizeObserver(()=>i()),t.observe(e.current)),()=>{window.removeEventListener("resize",i),t&&e.current&&t.unobserve(e.current)}},[])}(T),(0,t.useEffect)(()=>{if(T.current){const e=T.current.getBoundingClientRect(),t=function(){var e,t,n,i=jT,r=BT,o=WT,s=HT,a=GT,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,d=FE,h=vM("start","zoom","end"),p=0,f=10;function m(e){e.property("__zoom",VT).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",M).filter(a).on("touchstart.zoom",E).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new OT(t,e.x,e.y)}function v(e,t,n){var i=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return i===e.x&&r===e.y?e:new OT(e.k,i,r)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function b(e,t,n,i){e.on("start.zoom",function(){x(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(i).end()}).tween("zoom",function(){var e=this,o=arguments,s=x(e,o).event(i),a=r.apply(e,o),l=null==n?y(a):"function"===typeof n?n.apply(e,o):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=e.__zoom,h="function"===typeof t?t.apply(e,o):t,p=d(u.invert(l).concat(c/u.k),h.invert(l).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=p(e),n=c/t[2];e=new OT(n,l[0]-t[0]*n,l[1]-t[1]*n)}s.zoom(null,e)}})}function x(e,t,n){return!n&&e.__zooming||new _(e,t)}function _(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function w(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(i.apply(this,arguments)){var a=x(this,n).event(e),u=this.__zoom,d=Math.max(l[0],Math.min(l[1],u.k*Math.pow(2,s.apply(this,arguments)))),h=jE(e);if(a.wheel)a.mouse[0][0]===h[0]&&a.mouse[0][1]===h[1]||(a.mouse[1]=u.invert(a.mouse[0]=h)),clearTimeout(a.wheel);else{if(u.k===d)return;a.mouse=[h,u.invert(h)],dC(this),a.start()}FT(e),a.wheel=setTimeout(function(){a.wheel=null,a.end()},150),a.zoom("mouse",o(v(g(u,d),a.mouse[0],a.mouse[1]),a.extent,c))}}function S(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];if(!n&&i.apply(this,arguments)){var a=e.currentTarget,l=x(this,r,!0).event(e),u=kE(e.view).on("mousemove.zoom",function(e){if(FT(e),!l.moved){var t=e.clientX-h,n=e.clientY-f;l.moved=t*t+n*n>p}l.event(e).zoom("mouse",o(v(l.that.__zoom,l.mouse[0]=jE(e,a),l.mouse[1]),l.extent,c))},!0).on("mouseup.zoom",function(e){u.on("mousemove.zoom mouseup.zoom",null),zE(e.view,l.moved),FT(e),l.event(e).end()},!0),d=jE(e,a),h=e.clientX,f=e.clientY;OE(e.view),UT(e),l.mouse=[d,this.__zoom.invert(d)],dC(this),l.start()}}function M(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(i.apply(this,arguments)){var a=this.__zoom,l=jE(e.changedTouches?e.changedTouches[0]:e,this),d=a.invert(l),h=a.k*(e.shiftKey?.5:2),p=o(v(g(a,h),l,d),r.apply(this,n),c);FT(e),u>0?kE(this).transition().duration(u).call(b,p,l,e):kE(this).call(m.transform,p,l,e)}}function E(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];if(i.apply(this,arguments)){var a,l,c,u,d=n.touches,h=d.length,p=x(this,o,n.changedTouches.length===h).event(n);for(UT(n),l=0;l<h;++l)u=[u=jE(c=d[l],this),this.__zoom.invert(u),c.identifier],p.touch0?p.touch1||p.touch0[2]===u[2]||(p.touch1=u,p.taps=0):(p.touch0=u,a=!0,p.taps=1+!!e);e&&(e=clearTimeout(e)),a&&(p.taps<2&&(t=u[0],e=setTimeout(function(){e=null},500)),dC(this),p.start())}}function C(e){if(this.__zooming){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r,s,a,l,u=x(this,n).event(e),d=e.changedTouches,h=d.length;for(FT(e),r=0;r<h;++r)a=jE(s=d[r],this),u.touch0&&u.touch0[2]===s.identifier?u.touch0[0]=a:u.touch1&&u.touch1[2]===s.identifier&&(u.touch1[0]=a);if(s=u.that.__zoom,u.touch1){var p=u.touch0[0],f=u.touch0[1],m=u.touch1[0],y=u.touch1[1],b=(b=m[0]-p[0])*b+(b=m[1]-p[1])*b,_=(_=y[0]-f[0])*_+(_=y[1]-f[1])*_;s=g(s,Math.sqrt(b/_)),a=[(p[0]+m[0])/2,(p[1]+m[1])/2],l=[(f[0]+y[0])/2,(f[1]+y[1])/2]}else{if(!u.touch0)return;a=u.touch0[0],l=u.touch0[1]}u.zoom("touch",o(v(s,a,l),u.extent,c))}}function T(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];if(this.__zooming){var s,a,l=x(this,r).event(e),c=e.changedTouches,u=c.length;for(UT(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),s=0;s<u;++s)a=c[s],l.touch0&&l.touch0[2]===a.identifier?delete l.touch0:l.touch1&&l.touch1[2]===a.identifier&&delete l.touch1;if(l.touch1&&!l.touch0&&(l.touch0=l.touch1,delete l.touch1),l.touch0)l.touch0[1]=this.__zoom.invert(l.touch0[0]);else if(l.end(),2===l.taps&&(a=jE(a,this),Math.hypot(t[0]-a[0],t[1]-a[1])<f)){var d=kE(this).on("dblclick.zoom");d&&d.apply(this,arguments)}}}return m.transform=function(e,t,n,i){var r=e.selection?e.selection():e;r.property("__zoom",VT),e!==r?b(e,t,n,i):r.interrupt().each(function(){x(this,arguments).event(i).start().zoom(null,"function"===typeof t?t.apply(this,arguments):t).end()})},m.scaleBy=function(e,t,n,i){m.scaleTo(e,function(){return this.__zoom.k*("function"===typeof t?t.apply(this,arguments):t)},n,i)},m.scaleTo=function(e,t,n,i){m.transform(e,function(){var e=r.apply(this,arguments),i=this.__zoom,s=null==n?y(e):"function"===typeof n?n.apply(this,arguments):n,a=i.invert(s),l="function"===typeof t?t.apply(this,arguments):t;return o(v(g(i,l),s,a),e,c)},n,i)},m.translateBy=function(e,t,n,i){m.transform(e,function(){return o(this.__zoom.translate("function"===typeof t?t.apply(this,arguments):t,"function"===typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)},null,i)},m.translateTo=function(e,t,n,i,s){m.transform(e,function(){var e=r.apply(this,arguments),s=this.__zoom,a=null==i?y(e):"function"===typeof i?i.apply(this,arguments):i;return o(zT.translate(a[0],a[1]).scale(s.k).translate("function"===typeof t?-t.apply(this,arguments):-t,"function"===typeof n?-n.apply(this,arguments):-n),e,c)},i,s)},_.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=kE(this.that).datum();h.call(e,this.that,new LT(e,{sourceEvent:this.sourceEvent,target:m,type:e,transform:this.that.__zoom,dispatch:h}),t)}},m.wheelDelta=function(e){return arguments.length?(s="function"===typeof e?e:IT(+e),m):s},m.filter=function(e){return arguments.length?(i="function"===typeof e?e:IT(!!e),m):i},m.touchable=function(e){return arguments.length?(a="function"===typeof e?e:IT(!!e),m):a},m.extent=function(e){return arguments.length?(r="function"===typeof e?e:IT([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):r},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(e){return arguments.length?(o=e,m):o},m.duration=function(e){return arguments.length?(u=+e,m):u},m.interpolate=function(e){return arguments.length?(d=e,m):d},m.on=function(){var e=h.on.apply(h,arguments);return e===h?m:e},m.clickDistance=function(e){return arguments.length?(p=(e=+e)*e,m):Math.sqrt(p)},m.tapDistance=function(e){return arguments.length?(f=+e,m):f},m}().scaleExtent([g,v]).translateExtent(m),n=kE(T.current).call(t),i=zT.translate(f.x,f.y).scale(vA(f.zoom,g,v)),r=[[0,0],[e.width,e.height]],o=t.constrain()(i,r,m);t.transform(n,o),t.wheelDelta(bD),M.setState({d3Zoom:t,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[o.x,o.y,o.k],domNode:T.current.closest(".react-flow")})}},[]),(0,t.useEffect)(()=>{D&&P&&(!l||N||R?"undefined"!==typeof k&&D.on("wheel.zoom",function(e,t){if(!b&&"wheel"===e.type&&!e.ctrlKey||vD(e,_))return null;e.preventDefault(),k.call(this,e,t)},{passive:!1}):D.on("wheel.zoom",e=>{if(vD(e,_))return!1;e.preventDefault(),e.stopImmediatePropagation();const t=D.property("__zoom").k||1;if(e.ctrlKey&&a){const n=jE(e),i=bD(e),r=t*Math.pow(2,i);return void P.scaleTo(D,r,n,e)}const o=1===e.deltaMode?20:1;let s=u===jA.Vertical?0:e.deltaX*o,l=u===jA.Horizontal?0:e.deltaY*o;!IA()&&e.shiftKey&&u!==jA.Vertical&&(s=e.deltaY*o,l=0),P.translateBy(D,-s/t*c,-l/t*c,{internal:!0});const d=gD(D.property("__zoom")),{onViewportChangeStart:h,onViewportChange:p,onViewportChangeEnd:f}=M.getState();clearTimeout(O.current),L.current||(L.current=!0,i?.(e,d),h?.(d)),L.current&&(n?.(e,d),p?.(d),O.current=setTimeout(()=>{r?.(e,d),f?.(d),L.current=!1},150))},{passive:!1}))},[R,l,u,D,P,k,N,a,b,_,i,n,r]),(0,t.useEffect)(()=>{P&&P.on("start",e=>{if(!e.sourceEvent||e.sourceEvent.internal)return null;I.current=e.sourceEvent?.button;const{onViewportChangeStart:t}=M.getState(),n=gD(e.transform);E.current=!0,A.current=n,"mousedown"===e.sourceEvent?.type&&M.setState({paneDragging:!0}),t?.(n),i?.(e.sourceEvent,n)})},[P,i]),(0,t.useEffect)(()=>{P&&(R&&!E.current?P.on("zoom",null):R||P.on("zoom",e=>{const{onViewportChange:t}=M.getState();if(M.setState({transform:[e.transform.x,e.transform.y,e.transform.k]}),C.current=!(!o||!yD(p,I.current??0)),(n||t)&&!e.sourceEvent?.internal){const i=gD(e.transform);t?.(i),n?.(e.sourceEvent,i)}}))},[R,P,n,p,o]),(0,t.useEffect)(()=>{P&&P.on("end",e=>{if(!e.sourceEvent||e.sourceEvent.internal)return null;const{onViewportChangeEnd:t}=M.getState();if(E.current=!1,M.setState({paneDragging:!1}),o&&yD(p,I.current??0)&&!C.current&&o(e.sourceEvent),C.current=!1,(r||t)&&(n=A.current,i=e.transform,n.x!==i.x||n.y!==i.y||n.zoom!==i.k)){const n=gD(e.transform);A.current=n,clearTimeout(S.current),S.current=setTimeout(()=>{t?.(n),r?.(e.sourceEvent,n)},l?150:0)}var n,i})},[P,l,p,r,o]),(0,t.useEffect)(()=>{P&&P.filter(e=>{const t=N||s,n=a&&e.ctrlKey;if((!0===p||Array.isArray(p)&&p.includes(1))&&1===e.button&&"mousedown"===e.type&&(vD(e,"react-flow__node")||vD(e,"react-flow__edge")))return!0;if(!p&&!t&&!l&&!d&&!a)return!1;if(R)return!1;if(!d&&"dblclick"===e.type)return!1;if(vD(e,_)&&"wheel"===e.type)return!1;if(vD(e,w)&&("wheel"!==e.type||l&&"wheel"===e.type&&!N))return!1;if(!a&&e.ctrlKey&&"wheel"===e.type)return!1;if(!t&&!l&&!n&&"wheel"===e.type)return!1;if(!p&&("mousedown"===e.type||"touchstart"===e.type))return!1;if(Array.isArray(p)&&!p.includes(e.button)&&"mousedown"===e.type)return!1;const i=Array.isArray(p)&&p.includes(e.button)||!e.button||e.button<=1;return(!e.ctrlKey||"wheel"===e.type)&&i})},[R,P,s,a,l,d,p,h,N]),t.createElement("div",{className:"react-flow__renderer",ref:T,style:mD},x)},wD=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function SD(){const{userSelectionActive:e,userSelectionRect:n}=uA(wD,dM);return e&&n?t.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:n.width,height:n.height,transform:`translate(${n.x}px, ${n.y}px)`}}):null}function MD(e,t){const n=t.parentNode||t.parentId,i=e.find(e=>e.id===n);if(i){const e=t.position.x+t.width-i.width,n=t.position.y+t.height-i.height;if(e>0||n>0||t.position.x<0||t.position.y<0){if(i.style={...i.style}||{},i.style.width=i.style.width??i.width,i.style.height=i.style.height??i.height,e>0&&(i.style.width+=e),n>0&&(i.style.height+=n),t.position.x<0){const e=Math.abs(t.position.x);i.position.x=i.position.x-e,i.style.width+=e,t.position.x=0}if(t.position.y<0){const e=Math.abs(t.position.y);i.position.y=i.position.y-e,i.style.height+=e,t.position.y=0}i.width=i.style.width,i.height=i.style.height}}}function ED(e,t){if(e.some(e=>"reset"===e.type))return e.filter(e=>"reset"===e.type).map(e=>e.item);const n=e.filter(e=>"add"===e.type).map(e=>e.item);return t.reduce((t,n)=>{const i=e.filter(e=>e.id===n.id);if(0===i.length)return t.push(n),t;const r={...n};for(const e of i)if(e)switch(e.type){case"select":r.selected=e.selected;break;case"position":"undefined"!==typeof e.position&&(r.position=e.position),"undefined"!==typeof e.positionAbsolute&&(r.positionAbsolute=e.positionAbsolute),"undefined"!==typeof e.dragging&&(r.dragging=e.dragging),r.expandParent&&MD(t,r);break;case"dimensions":"undefined"!==typeof e.dimensions&&(r.width=e.dimensions.width,r.height=e.dimensions.height),"undefined"!==typeof e.updateStyle&&(r.style={...r.style||{},...e.dimensions}),"boolean"===typeof e.resizing&&(r.resizing=e.resizing),r.expandParent&&MD(t,r);break;case"remove":return t}return t.push(r),t},n)}function CD(e,t){return ED(e,t)}const TD=(e,t)=>({id:e,type:"select",selected:t});function AD(e,t){return e.reduce((e,n)=>{const i=t.includes(n.id);return!n.selected&&i?(n.selected=!0,e.push(TD(n.id,!0))):n.selected&&!i&&(n.selected=!1,e.push(TD(n.id,!1))),e},[])}const PD=(e,t)=>n=>{n.target===t.current&&e?.(n)},DD=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),kD=(0,t.memo)(e=>{let{isSelecting:n,selectionMode:i=BA.Full,panOnDrag:r,onSelectionStart:o,onSelectionEnd:s,onPaneClick:a,onPaneContextMenu:l,onPaneScroll:c,onPaneMouseEnter:u,onPaneMouseMove:d,onPaneMouseLeave:h,children:p}=e;const f=(0,t.useRef)(null),m=dA(),g=(0,t.useRef)(0),v=(0,t.useRef)(0),y=(0,t.useRef)(),{userSelectionActive:b,elementsSelectable:x,dragging:_}=uA(DD,dM),w=()=>{m.setState({userSelectionActive:!1,userSelectionRect:null}),g.current=0,v.current=0},S=e=>{a?.(e),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},M=c?e=>c(e):void 0,E=x&&(n||b);return t.createElement("div",{className:oM(["react-flow__pane",{dragging:_,selection:n}]),onClick:E?void 0:PD(S,f),onContextMenu:PD(e=>{Array.isArray(r)&&r?.includes(2)?e.preventDefault():l?.(e)},f),onWheel:PD(M,f),onMouseEnter:E?void 0:u,onMouseDown:E?e=>{const{resetSelectedElements:t,domNode:i}=m.getState();if(y.current=i?.getBoundingClientRect(),!x||!n||0!==e.button||e.target!==f.current||!y.current)return;const{x:r,y:s}=NA(e,y.current);t(),m.setState({userSelectionRect:{width:0,height:0,startX:r,startY:s,x:r,y:s}}),o?.(e)}:void 0,onMouseMove:E?e=>{const{userSelectionRect:t,nodeInternals:r,edges:o,transform:s,onNodesChange:a,onEdgesChange:l,nodeOrigin:c,getNodes:u}=m.getState();if(!n||!y.current||!t)return;m.setState({userSelectionActive:!0,nodesSelectionActive:!1});const d=NA(e,y.current),h=t.startX??0,p=t.startY??0,f={...t,x:d.x<h?d.x:h,y:d.y<p?d.y:p,width:Math.abs(d.x-h),height:Math.abs(d.y-p)},b=u(),x=fP(r,f,s,i===BA.Partial,!0,c),_=mP(x,o).map(e=>e.id),w=x.map(e=>e.id);if(g.current!==w.length){g.current=w.length;const e=AD(b,w);e.length&&a?.(e)}if(v.current!==_.length){v.current=_.length;const e=AD(o,_);e.length&&l?.(e)}m.setState({userSelectionRect:f})}:d,onMouseUp:E?e=>{if(0!==e.button)return;const{userSelectionRect:t}=m.getState();!b&&t&&e.target===f.current&&S?.(e),m.setState({nodesSelectionActive:g.current>0}),w(),s?.(e)}:void 0,onMouseLeave:E?e=>{b&&(m.setState({nodesSelectionActive:g.current>0}),s?.(e)),w()}:h,ref:f,style:mD},p,t.createElement(SD,null))});function RD(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const i=t.get(n);return!!i&&(!!i.selected||RD(i,t))}function ND(e,t,n){let i=e;do{if(i?.matches(t))return!0;if(i===n.current)return!1;i=i.parentElement}while(i);return!1}function ID(e,t,n,i){return Array.from(e.values()).filter(n=>(n.selected||n.id===i)&&(!n.parentNode||n.parentId||!RD(n,e))&&(n.draggable||t&&"undefined"===typeof n.draggable)).map(e=>({id:e.id,position:e.position||{x:0,y:0},positionAbsolute:e.positionAbsolute||{x:0,y:0},distance:{x:n.x-(e.positionAbsolute?.x??0),y:n.y-(e.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:e.extent,parentNode:e.parentNode||e.parentId,parentId:e.parentNode||e.parentId,width:e.width,height:e.height,expandParent:e.expandParent}))}function LD(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],o=arguments.length>5?arguments[5]:void 0;const s=function(e,t){return t&&"parent"!==t?[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]:t}(e,e.extent||i);let a=s;const l=e.parentNode||e.parentId;if("parent"!==e.extent||e.expandParent){if(e.extent&&l&&"parent"!==e.extent){const t=n.get(l),{x:i,y:o}=hP(t,r).positionAbsolute;a=[[e.extent[0][0]+i,e.extent[0][1]+o],[e.extent[1][0]+i,e.extent[1][1]+o]]}}else if(l&&e.width&&e.height){const t=n.get(l),{x:i,y:o}=hP(t,r).positionAbsolute;a=t&&TA(i)&&TA(o)&&TA(t.width)&&TA(t.height)?[[i+e.width*r[0],o+e.height*r[1]],[i+t.width-e.width+e.width*r[0],o+t.height-e.height+e.height*r[1]]]:a}else o?.("005",nA()),a=s;let c={x:0,y:0};if(l){const e=n.get(l);c=hP(e,r).positionAbsolute}const u=a&&"parent"!==a?yA(t,a):t;return{position:{x:u.x-c.x,y:u.y-c.y},positionAbsolute:u}}function OD(e){let{nodeId:t,dragItems:n,nodeInternals:i}=e;const r=n.map(e=>({...i.get(e.id),position:e.position,positionAbsolute:e.positionAbsolute}));return[t?r.find(e=>e.id===t):r[0],r]}kD.displayName="Pane";const zD=(e,t,n,i)=>{const r=t.querySelectorAll(e);if(!r||!r.length)return null;const o=Array.from(r),s=t.getBoundingClientRect(),a=s.width*i[0],l=s.height*i[1];return o.map(e=>{const t=e.getBoundingClientRect();return{id:e.getAttribute("data-handleid"),position:e.getAttribute("data-handlepos"),x:(t.left-s.left-a)/n,y:(t.top-s.top-l)/n,...gA(e)}})};function UD(e,t,n){return void 0===n?n:i=>{const r=t().nodeInternals.get(e);r&&n(i,{...r})}}function FD(e){let{id:t,store:n,unselect:i=!1,nodeRef:r}=e;const{addSelectedNodes:o,unselectNodesAndEdges:s,multiSelectionActive:a,nodeInternals:l,onError:c}=n.getState(),u=l.get(t);u?(n.setState({nodesSelectionActive:!1}),u.selected?(i||u.selected&&a)&&(s({nodes:[u],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):o([t])):c?.("012",lA(t))}function jD(e){return(t,n,i)=>e?.(t,i)}function BD(e){let{nodeRef:n,disabled:i=!1,noDragClassName:r,handleSelector:o,nodeId:s,isSelectable:a,selectNodesOnDrag:l}=e;const c=dA(),[u,d]=(0,t.useState)(!1),h=(0,t.useRef)([]),p=(0,t.useRef)({x:null,y:null}),f=(0,t.useRef)(0),m=(0,t.useRef)(null),g=(0,t.useRef)({x:0,y:0}),v=(0,t.useRef)(null),y=(0,t.useRef)(!1),b=(0,t.useRef)(!1),x=(0,t.useRef)(!1),_=function(){const e=dA(),n=(0,t.useCallback)(t=>{let{sourceEvent:n}=t;const{transform:i,snapGrid:r,snapToGrid:o}=e.getState(),s=n.touches?n.touches[0].clientX:n.clientX,a=n.touches?n.touches[0].clientY:n.clientY,l={x:(s-i[0])/i[2],y:(a-i[1])/i[2]};return{xSnapped:o?r[0]*Math.round(l.x/r[0]):l.x,ySnapped:o?r[1]*Math.round(l.y/r[1]):l.y,...l}},[]);return n}();return(0,t.useEffect)(()=>{if(n?.current){const e=kE(n.current),t=e=>{let{x:t,y:n}=e;const{nodeInternals:i,onNodeDrag:r,onSelectionDrag:o,updateNodePositions:a,nodeExtent:l,snapGrid:u,snapToGrid:f,nodeOrigin:m,onError:g}=c.getState();p.current={x:t,y:n};let y=!1,b={x:0,y:0,x2:0,y2:0};if(h.current.length>1&&l){const e=pP(h.current,m);b=SA(e)}if(h.current=h.current.map(e=>{const r={x:t-e.distance.x,y:n-e.distance.y};f&&(r.x=u[0]*Math.round(r.x/u[0]),r.y=u[1]*Math.round(r.y/u[1]));const o=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];h.current.length>1&&l&&!e.extent&&(o[0][0]=e.positionAbsolute.x-b.x+l[0][0],o[1][0]=e.positionAbsolute.x+(e.width??0)-b.x2+l[1][0],o[0][1]=e.positionAbsolute.y-b.y+l[0][1],o[1][1]=e.positionAbsolute.y+(e.height??0)-b.y2+l[1][1]);const s=LD(e,r,i,o,m,g);return y=y||e.position.x!==s.position.x||e.position.y!==s.position.y,e.position=s.position,e.positionAbsolute=s.positionAbsolute,e}),!y)return;a(h.current,!0,!0),d(!0);const x=s?r:jD(o);if(x&&v.current){const[e,t]=OD({nodeId:s,dragItems:h.current,nodeInternals:i});x(v.current,e,t)}},u=()=>{if(!m.current)return;const[e,n]=xA(g.current,m.current);if(0!==e||0!==n){const{transform:i,panBy:r}=c.getState();p.current.x=(p.current.x??0)-e/i[2],p.current.y=(p.current.y??0)-n/i[2],r({x:e,y:n})&&t(p.current)}f.current=requestAnimationFrame(u)},w=e=>{const{nodeInternals:t,multiSelectionActive:i,nodesDraggable:r,unselectNodesAndEdges:o,onNodeDragStart:u,onSelectionDragStart:d}=c.getState();b.current=!0;const f=s?u:jD(d);l&&a||i||!s||t.get(s)?.selected||o(),s&&a&&l&&FD({id:s,store:c,nodeRef:n});const m=_(e);if(p.current=m,h.current=ID(t,r,m,s),f&&h.current){const[n,i]=OD({nodeId:s,dragItems:h.current,nodeInternals:t});f(e.sourceEvent,n,i)}};if(!i){const i=function(){var e,t,n,i,r=$T,o=qT,s=ZT,a=KT,l={},c=vM("start","drag","end"),u=0,d=0;function h(e){e.on("mousedown.drag",p).filter(a).on("touchstart.drag",g).on("touchmove.drag",v,RE).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(s,a){if(!i&&r.call(this,s,a)){var l=b(this,o.call(this,s,a),s,a,"mouse");l&&(kE(s.view).on("mousemove.drag",f,NE).on("mouseup.drag",m,NE),OE(s.view),IE(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function f(i){if(LE(i),!n){var r=i.clientX-e,o=i.clientY-t;n=r*r+o*o>d}l.mouse("drag",i)}function m(e){kE(e.view).on("mousemove.drag mouseup.drag",null),zE(e.view,n),LE(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var n,i,s=e.changedTouches,a=o.call(this,e,t),l=s.length;for(n=0;n<l;++n)(i=b(this,a,e,t,s[n].identifier,s[n]))&&(IE(e),i("start",e,s[n]))}}function v(e){var t,n,i=e.changedTouches,r=i.length;for(t=0;t<r;++t)(n=l[i[t].identifier])&&(LE(e),n("drag",e,i[t]))}function y(e){var t,n,r=e.changedTouches,o=r.length;for(i&&clearTimeout(i),i=setTimeout(function(){i=null},500),t=0;t<o;++t)(n=l[r[t].identifier])&&(IE(e),n("end",e,r[t]))}function b(e,t,n,i,r,o){var a,d,p,f=c.copy(),m=jE(o||n,t);if(null!=(p=s.call(e,new YT("beforestart",{sourceEvent:n,target:h,identifier:r,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),i)))return a=p.x-m[0]||0,d=p.y-m[1]||0,function n(o,s,c){var g,v=m;switch(o){case"start":l[r]=n,g=u++;break;case"end":delete l[r],--u;case"drag":m=jE(c||s,t),g=u}f.call(o,e,new YT(o,{sourceEvent:s,subject:p,target:h,identifier:r,active:g,x:m[0]+a,y:m[1]+d,dx:m[0]-v[0],dy:m[1]-v[1],dispatch:f}),i)}}return h.filter=function(e){return arguments.length?(r="function"===typeof e?e:XT(!!e),h):r},h.container=function(e){return arguments.length?(o="function"===typeof e?e:XT(e),h):o},h.subject=function(e){return arguments.length?(s="function"===typeof e?e:XT(e),h):s},h.touchable=function(e){return arguments.length?(a="function"===typeof e?e:XT(!!e),h):a},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,h):Math.sqrt(d)},h}().on("start",e=>{const{domNode:t,nodeDragThreshold:n}=c.getState();0===n&&w(e),x.current=!1;const i=_(e);p.current=i,m.current=t?.getBoundingClientRect()||null,g.current=NA(e.sourceEvent,m.current)}).on("drag",e=>{const n=_(e),{autoPanOnNodeDrag:i,nodeDragThreshold:r}=c.getState();if("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1&&(x.current=!0),!x.current){if(!y.current&&b.current&&i&&(y.current=!0,u()),!b.current){const t=n.xSnapped-(p?.current?.x??0),i=n.ySnapped-(p?.current?.y??0);Math.sqrt(t*t+i*i)>r&&w(e)}(p.current.x!==n.xSnapped||p.current.y!==n.ySnapped)&&h.current&&b.current&&(v.current=e.sourceEvent,g.current=NA(e.sourceEvent,m.current),t(n))}}).on("end",e=>{if(b.current&&!x.current&&(d(!1),y.current=!1,b.current=!1,cancelAnimationFrame(f.current),h.current)){const{updateNodePositions:t,nodeInternals:n,onNodeDragStop:i,onSelectionDragStop:r}=c.getState(),o=s?i:jD(r);if(t(h.current,!1,!1),o){const[t,i]=OD({nodeId:s,dragItems:h.current,nodeInternals:n});o(e.sourceEvent,t,i)}}}).filter(e=>{const t=e.target;return!e.button&&(!r||!ND(t,`.${r}`,n))&&(!o||ND(t,o,n))});return e.call(i),()=>{e.on(".drag",null)}}e.on(".drag",null)}},[n,i,r,o,a,c,s,l,_]),u}function VD(){const e=dA();return(0,t.useCallback)(t=>{const{nodeInternals:n,nodeExtent:i,updateNodePositions:r,getNodes:o,snapToGrid:s,snapGrid:a,onError:l,nodesDraggable:c}=e.getState(),u=o().filter(e=>e.selected&&(e.draggable||c&&"undefined"===typeof e.draggable)),d=s?a[0]:5,h=s?a[1]:5,p=t.isShiftPressed?4:1,f=t.x*d*p,m=t.y*h*p;r(u.map(e=>{if(e.positionAbsolute){const t={x:e.positionAbsolute.x+f,y:e.positionAbsolute.y+m};s&&(t.x=a[0]*Math.round(t.x/a[0]),t.y=a[1]*Math.round(t.y/a[1]));const{positionAbsolute:r,position:o}=LD(e,t,n,i,void 0,l);e.position=o,e.positionAbsolute=r}return e}),!0,!1)},[])}const HD={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var GD=e=>{const n=n=>{let{id:i,type:r,data:o,xPos:s,yPos:a,xPosOrigin:l,yPosOrigin:c,selected:u,onClick:d,onMouseEnter:h,onMouseMove:p,onMouseLeave:f,onContextMenu:m,onDoubleClick:g,style:v,className:y,isDraggable:b,isSelectable:x,isConnectable:_,isFocusable:w,selectNodesOnDrag:S,sourcePosition:M,targetPosition:E,hidden:C,resizeObserver:T,dragHandle:A,zIndex:P,isParent:D,noDragClassName:k,noPanClassName:R,initialized:N,disableKeyboardA11y:I,ariaLabel:L,rfId:O,hasHandleBounds:z}=n;const U=dA(),F=(0,t.useRef)(null),j=(0,t.useRef)(null),B=(0,t.useRef)(M),V=(0,t.useRef)(E),H=(0,t.useRef)(r),G=x||b||d||h||p||f,W=VD(),X=UD(i,U.getState,h),Y=UD(i,U.getState,p),$=UD(i,U.getState,f),q=UD(i,U.getState,m),Z=UD(i,U.getState,g);(0,t.useEffect)(()=>()=>{j.current&&(T?.unobserve(j.current),j.current=null)},[]),(0,t.useEffect)(()=>{if(F.current&&!C){const e=F.current;N&&z&&j.current===e||(j.current&&T?.unobserve(j.current),T?.observe(e),j.current=e)}},[C,N,z]),(0,t.useEffect)(()=>{const e=H.current!==r,t=B.current!==M,n=V.current!==E;F.current&&(e||t||n)&&(e&&(H.current=r),t&&(B.current=M),n&&(V.current=E),U.getState().updateNodeDimensions([{id:i,nodeElement:F.current,forceUpdate:!0}]))},[i,r,M,E]);const K=BD({nodeRef:F,disabled:C||!b,noDragClassName:k,handleSelector:A,nodeId:i,isSelectable:x,selectNodesOnDrag:S});return C?null:t.createElement("div",{className:oM(["react-flow__node",`react-flow__node-${r}`,{[R]:b},y,{selected:u,selectable:x,parent:D,dragging:K}]),ref:F,style:{zIndex:P,transform:`translate(${l}px,${c}px)`,pointerEvents:G?"all":"none",visibility:N?"visible":"hidden",...v},"data-id":i,"data-testid":`rf__node-${i}`,onMouseEnter:X,onMouseMove:Y,onMouseLeave:$,onContextMenu:q,onClick:e=>{const{nodeDragThreshold:t}=U.getState();if(x&&(!S||!b||t>0)&&FD({id:i,store:U,nodeRef:F}),d){const t=U.getState().nodeInternals.get(i);t&&d(e,{...t})}},onDoubleClick:Z,onKeyDown:w?e=>{if(!kA(e)&&!I)if(PA.includes(e.key)&&x){const t="Escape"===e.key;FD({id:i,store:U,unselect:t,nodeRef:F})}else b&&u&&Object.prototype.hasOwnProperty.call(HD,e.key)&&(U.setState({ariaLiveMessage:`Moved selected node ${e.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~a}`}),W({x:HD[e.key].x,y:HD[e.key].y,isShiftPressed:e.shiftKey}))}:void 0,tabIndex:w?0:void 0,role:w?"button":void 0,"aria-describedby":I?void 0:`${qP}-${O}`,"aria-label":L},t.createElement(sP,{value:i},t.createElement(e,{id:i,data:o,type:r,xPos:s,yPos:a,selected:u,isConnectable:_,sourcePosition:M,targetPosition:E,dragging:K,dragHandle:A,zIndex:P})))};return n.displayName="NodeWrapper",(0,t.memo)(n)};const WD=e=>{const t=e.getNodes().filter(e=>e.selected);return{...pP(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};var XD=(0,t.memo)(function(e){let{onSelectionContextMenu:n,noPanClassName:i,disableKeyboardA11y:r}=e;const o=dA(),{width:s,height:a,x:l,y:c,transformString:u,userSelectionActive:d}=uA(WD,dM),h=VD(),p=(0,t.useRef)(null);if((0,t.useEffect)(()=>{r||p.current?.focus({preventScroll:!0})},[r]),BD({nodeRef:p}),d||!s||!a)return null;const f=n?e=>{const t=o.getState().getNodes().filter(e=>e.selected);n(e,t)}:void 0;return t.createElement("div",{className:oM(["react-flow__nodesselection","react-flow__container",i]),style:{transform:u}},t.createElement("div",{ref:p,className:"react-flow__nodesselection-rect",onContextMenu:f,tabIndex:r?void 0:-1,onKeyDown:r?void 0:e=>{Object.prototype.hasOwnProperty.call(HD,e.key)&&h({x:HD[e.key].x,y:HD[e.key].y,isShiftPressed:e.shiftKey})},style:{width:s,height:a,top:c,left:l}}))});const YD=e=>e.nodesSelectionActive,$D=e=>{let{children:n,onPaneClick:i,onPaneMouseEnter:r,onPaneMouseMove:o,onPaneMouseLeave:s,onPaneContextMenu:a,onPaneScroll:l,deleteKeyCode:c,onMove:u,onMoveStart:d,onMoveEnd:h,selectionKeyCode:p,selectionOnDrag:f,selectionMode:m,onSelectionStart:g,onSelectionEnd:v,multiSelectionKeyCode:y,panActivationKeyCode:b,zoomActivationKeyCode:x,elementsSelectable:_,zoomOnScroll:w,zoomOnPinch:S,panOnScroll:M,panOnScrollSpeed:E,panOnScrollMode:C,zoomOnDoubleClick:T,panOnDrag:A,defaultViewport:P,translateExtent:D,minZoom:k,maxZoom:R,preventScrolling:N,onSelectionContextMenu:I,noWheelClassName:L,noPanClassName:O,disableKeyboardA11y:z}=e;const U=uA(YD),F=eD(p),j=eD(b),B=j||A,V=j||M,H=F||f&&!0!==B;return(e=>{let{deleteKeyCode:n,multiSelectionKeyCode:i}=e;const r=dA(),{deleteElements:o}=pD(),s=eD(n,fD),a=eD(i);(0,t.useEffect)(()=>{if(s){const{edges:e,getNodes:t}=r.getState(),n=t().filter(e=>e.selected),i=e.filter(e=>e.selected);o({nodes:n,edges:i}),r.setState({nodesSelectionActive:!1})}},[s]),(0,t.useEffect)(()=>{r.setState({multiSelectionActive:a})},[a])})({deleteKeyCode:c,multiSelectionKeyCode:y}),t.createElement(_D,{onMove:u,onMoveStart:d,onMoveEnd:h,onPaneContextMenu:a,elementsSelectable:_,zoomOnScroll:w,zoomOnPinch:S,panOnScroll:V,panOnScrollSpeed:E,panOnScrollMode:C,zoomOnDoubleClick:T,panOnDrag:!F&&B,defaultViewport:P,translateExtent:D,minZoom:k,maxZoom:R,zoomActivationKeyCode:x,preventScrolling:N,noWheelClassName:L,noPanClassName:O},t.createElement(kD,{onSelectionStart:g,onSelectionEnd:v,onPaneClick:i,onPaneMouseEnter:r,onPaneMouseMove:o,onPaneMouseLeave:s,onPaneContextMenu:a,onPaneScroll:l,panOnDrag:B,isSelecting:!!H,selectionMode:m},n,U&&t.createElement(XD,{onSelectionContextMenu:I,noPanClassName:O,disableKeyboardA11y:z})))};$D.displayName="FlowRenderer";var qD=(0,t.memo)($D);function ZD(e){const t={input:GD(e.input||NP),default:GD(e.default||kP),output:GD(e.output||LP),group:GD(e.group||OP)},n=Object.keys(e).filter(e=>!["input","default","output","group"].includes(e)).reduce((t,n)=>(t[n]=GD(e[n]||kP),t),{});return{...t,...n}}const KD=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),JD=e=>{const{nodesDraggable:n,nodesConnectable:i,nodesFocusable:r,elementsSelectable:o,updateNodeDimensions:s,onError:a}=uA(KD,dM),l=function(e){const n=uA((0,t.useCallback)(t=>e?fP(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[e]));return n}(e.onlyRenderVisibleElements),c=(0,t.useRef)(),u=(0,t.useMemo)(()=>{if("undefined"===typeof ResizeObserver)return null;const e=new ResizeObserver(e=>{const t=e.map(e=>({id:e.target.getAttribute("data-id"),nodeElement:e.target,forceUpdate:!0}));s(t)});return c.current=e,e},[]);return(0,t.useEffect)(()=>()=>{c?.current?.disconnect()},[]),t.createElement("div",{className:"react-flow__nodes",style:mD},l.map(s=>{let l=s.type||"default";e.nodeTypes[l]||(a?.("003",eA(l)),l="default");const c=e.nodeTypes[l]||e.nodeTypes.default,d=!!(s.draggable||n&&"undefined"===typeof s.draggable),h=!!(s.selectable||o&&"undefined"===typeof s.selectable),p=!!(s.connectable||i&&"undefined"===typeof s.connectable),f=!!(s.focusable||r&&"undefined"===typeof s.focusable),m=e.nodeExtent?yA(s.positionAbsolute,e.nodeExtent):s.positionAbsolute,g=m?.x??0,v=m?.y??0,y=(e=>{let{x:t,y:n,width:i,height:r,origin:o}=e;return i&&r?o[0]<0||o[1]<0||o[0]>1||o[1]>1?{x:t,y:n}:{x:t-i*o[0],y:n-r*o[1]}:{x:t,y:n}})({x:g,y:v,width:s.width??0,height:s.height??0,origin:e.nodeOrigin});return t.createElement(c,{key:s.id,id:s.id,className:s.className,style:s.style,type:l,data:s.data,sourcePosition:s.sourcePosition||GA.Bottom,targetPosition:s.targetPosition||GA.Top,hidden:s.hidden,xPos:g,yPos:v,xPosOrigin:y.x,yPosOrigin:y.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!s.selected,isDraggable:d,isSelectable:h,isConnectable:p,isFocusable:f,resizeObserver:u,dragHandle:s.dragHandle,zIndex:s[AA]?.z??0,isParent:!!s[AA]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!s.width&&!!s.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:s.ariaLabel,hasHandleBounds:!!s[AA]?.handleBounds})}))};JD.displayName="NodeRenderer";var QD=(0,t.memo)(JD);const ek=(e,t,n)=>n===GA.Left?e-t:n===GA.Right?e+t:e,tk=(e,t,n)=>n===GA.Top?e-t:n===GA.Bottom?e+t:e,nk="react-flow__edgeupdater",ik=e=>{let{position:n,centerX:i,centerY:r,radius:o=10,onMouseDown:s,onMouseEnter:a,onMouseOut:l,type:c}=e;return t.createElement("circle",{onMouseDown:s,onMouseEnter:a,onMouseOut:l,className:oM([nk,`${nk}-${c}`]),cx:ek(i,o,n),cy:tk(r,o,n),r:o,stroke:"transparent",fill:"transparent"})},rk=()=>!0;var ok=e=>{const n=n=>{let{id:i,className:r,type:o,data:s,onClick:a,onEdgeDoubleClick:l,selected:c,animated:u,label:d,labelStyle:h,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,style:v,source:y,target:b,sourceX:x,sourceY:_,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,elementsSelectable:C,hidden:T,sourceHandleId:A,targetHandleId:P,onContextMenu:D,onMouseEnter:k,onMouseMove:R,onMouseLeave:N,reconnectRadius:I,onReconnect:L,onReconnectStart:O,onReconnectEnd:z,markerEnd:U,markerStart:F,rfId:j,ariaLabel:B,isFocusable:V,isReconnectable:H,pathOptions:G,interactionWidth:W,disableKeyboardA11y:X}=n;const Y=(0,t.useRef)(null),[$,q]=(0,t.useState)(!1),[Z,K]=(0,t.useState)(!1),J=dA(),Q=(0,t.useMemo)(()=>`url('#${lP(F,j)}')`,[F,j]),ee=(0,t.useMemo)(()=>`url('#${lP(U,j)}')`,[U,j]);if(T)return null;const te=OA(i,J.getState,l),ne=OA(i,J.getState,D),ie=OA(i,J.getState,k),re=OA(i,J.getState,R),oe=OA(i,J.getState,N),se=(e,t)=>{if(0!==e.button)return;const{edges:n,isValidConnection:r}=J.getState(),o=t?b:y,s=(t?P:A)||null,a=t?"target":"source",l=r||rk,c=t,u=n.find(e=>e.id===i);K(!0),O?.(e,u,a);EP({event:e,handleId:s,nodeId:o,onConnect:e=>L?.(u,e),isTarget:c,getState:J.getState,setState:J.setState,isValidConnection:l,edgeUpdaterType:a,onReconnectEnd:e=>{K(!1),z?.(e,u,a)}})},ae=()=>q(!0),le=()=>q(!1),ce=!C&&!a;return t.createElement("g",{className:oM(["react-flow__edge",`react-flow__edge-${o}`,r,{selected:c,animated:u,inactive:ce,updating:$}]),onClick:e=>{const{edges:t,addSelectedEdges:n,unselectNodesAndEdges:r,multiSelectionActive:o}=J.getState(),s=t.find(e=>e.id===i);s&&(C&&(J.setState({nodesSelectionActive:!1}),s.selected&&o?(r({nodes:[],edges:[s]}),Y.current?.blur()):n([i])),a&&a(e,s))},onDoubleClick:te,onContextMenu:ne,onMouseEnter:ie,onMouseMove:re,onMouseLeave:oe,onKeyDown:V?e=>{if(!X&&PA.includes(e.key)&&C){const{unselectNodesAndEdges:t,addSelectedEdges:n,edges:r}=J.getState();"Escape"===e.key?(Y.current?.blur(),t({edges:[r.find(e=>e.id===i)]})):n([i])}}:void 0,tabIndex:V?0:void 0,role:V?"button":"img","data-testid":`rf__edge-${i}`,"aria-label":null===B?void 0:B||`Edge from ${y} to ${b}`,"aria-describedby":V?`${ZP}-${j}`:void 0,ref:Y},!Z&&t.createElement(e,{id:i,source:y,target:b,selected:c,animated:u,label:d,labelStyle:h,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,data:s,style:v,sourceX:x,sourceY:_,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,sourceHandleId:A,targetHandleId:P,markerStart:Q,markerEnd:ee,pathOptions:G,interactionWidth:W}),H&&t.createElement(t.Fragment,null,("source"===H||!0===H)&&t.createElement(ik,{position:M,centerX:x,centerY:_,radius:I,onMouseDown:e=>se(e,!0),onMouseEnter:ae,onMouseOut:le,type:"source"}),("target"===H||!0===H)&&t.createElement(ik,{position:E,centerX:w,centerY:S,radius:I,onMouseDown:e=>se(e,!1),onMouseEnter:ae,onMouseOut:le,type:"target"})))};return n.displayName="EdgeWrapper",(0,t.memo)(n)};function sk(e){const t={default:ok(e.default||rP),straight:ok(e.bezier||eP),step:ok(e.step||QA),smoothstep:ok(e.step||JA),simplebezier:ok(e.simplebezier||YA)},n=Object.keys(e).filter(e=>!["default","bezier"].includes(e)).reduce((t,n)=>(t[n]=ok(e[n]||rP),t),{});return{...t,...n}}function ak(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=(n?.x||0)+t.x,r=(n?.y||0)+t.y,o=n?.width||t.width,s=n?.height||t.height;switch(e){case GA.Top:return{x:i+o/2,y:r};case GA.Right:return{x:i+o,y:r+s/2};case GA.Bottom:return{x:i+o/2,y:r+s};case GA.Left:return{x:i,y:r+s/2}}}function lk(e,t){return e?1!==e.length&&t?t&&e.find(e=>e.id===t)||null:e[0]:null}function ck(e){const t=e?.[AA]?.handleBounds||null,n=t&&e?.width&&e?.height&&"undefined"!==typeof e?.positionAbsolute?.x&&"undefined"!==typeof e?.positionAbsolute?.y;return[{x:e?.positionAbsolute?.x||0,y:e?.positionAbsolute?.y||0,width:e?.width||0,height:e?.height||0},t,!!n]}const uk=[{level:0,isMaxLevel:!0,edges:[]}];function dk(e,n,i){const r=uA((0,t.useCallback)(t=>e?t.edges.filter(e=>{const i=n.get(e.source),r=n.get(e.target);return i?.width&&i?.height&&r?.width&&r?.height&&function(e){let{sourcePos:t,targetPos:n,sourceWidth:i,sourceHeight:r,targetWidth:o,targetHeight:s,width:a,height:l,transform:c}=e;const u={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y),x2:Math.max(t.x+i,n.x+o),y2:Math.max(t.y+r,n.y+s)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);const d=SA({x:(0-c[0])/c[2],y:(0-c[1])/c[2],width:a/c[2],height:l/c[2]}),h=Math.max(0,Math.min(d.x2,u.x2)-Math.max(d.x,u.x)),p=Math.max(0,Math.min(d.y2,u.y2)-Math.max(d.y,u.y));return Math.ceil(h*p)>0}({sourcePos:i.positionAbsolute||{x:0,y:0},targetPos:r.positionAbsolute||{x:0,y:0},sourceWidth:i.width,sourceHeight:i.height,targetWidth:r.width,targetHeight:r.height,width:t.width,height:t.height,transform:t.transform})}):t.edges,[e,n]));return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=-1;const r=e.reduce((e,r)=>{const o=TA(r.zIndex);let s=o?r.zIndex:0;if(n){const e=t.get(r.target),n=t.get(r.source),i=r.selected||e?.selected||n?.selected,a=Math.max(n?.[AA]?.z||0,e?.[AA]?.z||0,1e3);s=(o?r.zIndex:0)+(i?a:0)}return e[s]?e[s].push(r):e[s]=[r],i=s>i?s:i,e},{}),o=Object.entries(r).map(e=>{let[t,n]=e;const r=+t;return{edges:n,level:r,isMaxLevel:r===i}});return 0===o.length?uk:o}(r,n,i)}const hk={[HA.Arrow]:e=>{let{color:n="none",strokeWidth:i=1}=e;return t.createElement("polyline",{style:{stroke:n,strokeWidth:i},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"})},[HA.ArrowClosed]:e=>{let{color:n="none",strokeWidth:i=1}=e;return t.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:i},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})}};const pk=e=>{let{id:n,type:i,color:r,width:o=12.5,height:s=12.5,markerUnits:a="strokeWidth",strokeWidth:l,orient:c="auto-start-reverse"}=e;const u=function(e){const n=dA();return(0,t.useMemo)(()=>Object.prototype.hasOwnProperty.call(hk,e)?hk[e]:(n.getState().onError?.("009",rA(e)),null),[e])}(i);return u?t.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${o}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:c,refX:"0",refY:"0"},t.createElement(u,{color:r,strokeWidth:l})):null},fk=e=>{let{defaultColor:n,rfId:i}=e;const r=uA((0,t.useCallback)((e=>{let{defaultColor:t,rfId:n}=e;return e=>{const i=[];return e.edges.reduce((e,r)=>([r.markerStart,r.markerEnd].forEach(r=>{if(r&&"object"===typeof r){const o=lP(r,n);i.includes(o)||(e.push({id:o,color:r.color||t,...r}),i.push(o))}}),e),[]).sort((e,t)=>e.id.localeCompare(t.id))}})({defaultColor:n,rfId:i}),[n,i]),(e,t)=>!(e.length!==t.length||e.some((e,n)=>e.id!==t[n].id)));return t.createElement("defs",null,r.map(e=>t.createElement(pk,{id:e.id,key:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient})))};fk.displayName="MarkerDefinitions";var mk=(0,t.memo)(fk);const gk=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),vk=e=>{let{defaultMarkerColor:n,onlyRenderVisibleElements:i,elevateEdgesOnSelect:r,rfId:o,edgeTypes:s,noPanClassName:a,onEdgeContextMenu:l,onEdgeMouseEnter:c,onEdgeMouseMove:u,onEdgeMouseLeave:d,onEdgeClick:h,onEdgeDoubleClick:p,onReconnect:f,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,children:y,disableKeyboardA11y:b}=e;const{edgesFocusable:x,edgesUpdatable:_,elementsSelectable:w,width:S,height:M,connectionMode:E,nodeInternals:C,onError:T}=uA(gk,dM),A=dk(i,C,r);return S?t.createElement(t.Fragment,null,A.map(e=>{let{level:i,edges:r,isMaxLevel:y}=e;return t.createElement("svg",{key:i,style:{zIndex:i},width:S,height:M,className:"react-flow__edges react-flow__container"},y&&t.createElement(mk,{defaultColor:n,rfId:o}),t.createElement("g",null,r.map(e=>{const[n,i,r]=ck(C.get(e.source)),[y,S,M]=ck(C.get(e.target));if(!r||!M)return null;let A=e.type||"default";s[A]||(T?.("011",aA(A)),A="default");const P=s[A]||s.default,D=E===FA.Strict?S.target:(S.target??[]).concat(S.source??[]),k=lk(i.source,e.sourceHandle),R=lk(D,e.targetHandle),N=k?.position||GA.Bottom,I=R?.position||GA.Top,L=!!(e.focusable||x&&"undefined"===typeof e.focusable),O=e.reconnectable||e.updatable,z="undefined"!==typeof f&&(O||_&&"undefined"===typeof O);if(!k||!R)return T?.("008",oA(k,e)),null;const{sourceX:U,sourceY:F,targetX:j,targetY:B}=((e,t,n,i,r,o)=>{const s=ak(n,e,t),a=ak(o,i,r);return{sourceX:s.x,sourceY:s.y,targetX:a.x,targetY:a.y}})(n,k,N,y,R,I);return t.createElement(P,{key:e.id,id:e.id,className:oM([e.className,a]),type:A,data:e.data,selected:!!e.selected,animated:!!e.animated,hidden:!!e.hidden,label:e.label,labelStyle:e.labelStyle,labelShowBg:e.labelShowBg,labelBgStyle:e.labelBgStyle,labelBgPadding:e.labelBgPadding,labelBgBorderRadius:e.labelBgBorderRadius,style:e.style,source:e.source,target:e.target,sourceHandleId:e.sourceHandle,targetHandleId:e.targetHandle,markerEnd:e.markerEnd,markerStart:e.markerStart,sourceX:U,sourceY:F,targetX:j,targetY:B,sourcePosition:N,targetPosition:I,elementsSelectable:w,onContextMenu:l,onMouseEnter:c,onMouseMove:u,onMouseLeave:d,onClick:h,onEdgeDoubleClick:p,onReconnect:f,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,rfId:o,ariaLabel:e.ariaLabel,isFocusable:L,isReconnectable:z,pathOptions:"pathOptions"in e?e.pathOptions:void 0,interactionWidth:e.interactionWidth,disableKeyboardA11y:b})})))}),y):null};vk.displayName="EdgeRenderer";var yk=(0,t.memo)(vk);const bk=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function xk(e){let{children:n}=e;const i=uA(bk);return t.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:i}},n)}const _k={[GA.Left]:GA.Right,[GA.Right]:GA.Left,[GA.Top]:GA.Bottom,[GA.Bottom]:GA.Top},wk=e=>{let{nodeId:n,handleType:i,style:r,type:o=VA.Bezier,CustomComponent:s,connectionStatus:a}=e;const{fromNode:l,handleId:c,toX:u,toY:d,connectionMode:h}=uA((0,t.useCallback)(e=>({fromNode:e.nodeInternals.get(n),handleId:e.connectionHandleId,toX:(e.connectionPosition.x-e.transform[0])/e.transform[2],toY:(e.connectionPosition.y-e.transform[1])/e.transform[2],connectionMode:e.connectionMode}),[n]),dM),p=l?.[AA]?.handleBounds;let f=p?.[i];if(h===FA.Loose&&(f=f||p?.["source"===i?"target":"source"]),!l||!f)return null;const m=c?f.find(e=>e.id===c):f[0],g=m?m.x+m.width/2:(l.width??0)/2,v=m?m.y+m.height/2:l.height??0,y=(l.positionAbsolute?.x??0)+g,b=(l.positionAbsolute?.y??0)+v,x=m?.position,_=x?_k[x]:null;if(!x||!_)return null;if(s)return t.createElement(s,{connectionLineType:o,connectionLineStyle:r,fromNode:l,fromHandle:m,fromX:y,fromY:b,toX:u,toY:d,fromPosition:x,toPosition:_,connectionStatus:a});let w="";const S={sourceX:y,sourceY:b,sourcePosition:x,targetX:u,targetY:d,targetPosition:_};return o===VA.Bezier?[w]=iP(S):o===VA.Step?[w]=KA({...S,borderRadius:0}):o===VA.SmoothStep?[w]=KA(S):o===VA.SimpleBezier?[w]=XA(S):w=`M${y},${b} ${u},${d}`,t.createElement("path",{d:w,fill:"none",className:"react-flow__connection-path",style:r})};wk.displayName="ConnectionLine";const Sk=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function Mk(e){let{containerStyle:n,style:i,type:r,component:o}=e;const{nodeId:s,handleType:a,nodesConnectable:l,width:c,height:u,connectionStatus:d}=uA(Sk,dM);return!!(s&&a&&c&&l)?t.createElement("svg",{style:n,width:c,height:u,className:"react-flow__edges react-flow__connectionline react-flow__container"},t.createElement("g",{className:oM(["react-flow__connection",d])},t.createElement(wk,{nodeId:s,handleType:a,style:i,type:r,CustomComponent:o,connectionStatus:d}))):null}function Ek(e,n){(0,t.useRef)(null),dA();return(0,t.useMemo)(()=>n(e),[e])}const Ck=e=>{let{nodeTypes:n,edgeTypes:i,onMove:r,onMoveStart:o,onMoveEnd:s,onInit:a,onNodeClick:l,onEdgeClick:c,onNodeDoubleClick:u,onEdgeDoubleClick:d,onNodeMouseEnter:h,onNodeMouseMove:p,onNodeMouseLeave:f,onNodeContextMenu:m,onSelectionContextMenu:g,onSelectionStart:v,onSelectionEnd:y,connectionLineType:b,connectionLineStyle:x,connectionLineComponent:_,connectionLineContainerStyle:w,selectionKeyCode:S,selectionOnDrag:M,selectionMode:E,multiSelectionKeyCode:C,panActivationKeyCode:T,zoomActivationKeyCode:A,deleteKeyCode:P,onlyRenderVisibleElements:D,elementsSelectable:k,selectNodesOnDrag:R,defaultViewport:N,translateExtent:I,minZoom:L,maxZoom:O,preventScrolling:z,defaultMarkerColor:U,zoomOnScroll:F,zoomOnPinch:j,panOnScroll:B,panOnScrollSpeed:V,panOnScrollMode:H,zoomOnDoubleClick:G,panOnDrag:W,onPaneClick:X,onPaneMouseEnter:Y,onPaneMouseMove:$,onPaneMouseLeave:q,onPaneScroll:Z,onPaneContextMenu:K,onEdgeContextMenu:J,onEdgeMouseEnter:Q,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:ie,onReconnectEnd:re,reconnectRadius:oe,noDragClassName:se,noWheelClassName:ae,noPanClassName:le,elevateEdgesOnSelect:ce,disableKeyboardA11y:ue,nodeOrigin:de,nodeExtent:he,rfId:pe}=e;const fe=Ek(n,ZD),me=Ek(i,sk);return function(e){const n=pD(),i=(0,t.useRef)(!1);(0,t.useEffect)(()=>{!i.current&&n.viewportInitialized&&e&&(setTimeout(()=>e(n),1),i.current=!0)},[e,n.viewportInitialized])}(a),t.createElement(qD,{onPaneClick:X,onPaneMouseEnter:Y,onPaneMouseMove:$,onPaneMouseLeave:q,onPaneContextMenu:K,onPaneScroll:Z,deleteKeyCode:P,selectionKeyCode:S,selectionOnDrag:M,selectionMode:E,onSelectionStart:v,onSelectionEnd:y,multiSelectionKeyCode:C,panActivationKeyCode:T,zoomActivationKeyCode:A,elementsSelectable:k,onMove:r,onMoveStart:o,onMoveEnd:s,zoomOnScroll:F,zoomOnPinch:j,zoomOnDoubleClick:G,panOnScroll:B,panOnScrollSpeed:V,panOnScrollMode:H,panOnDrag:W,defaultViewport:N,translateExtent:I,minZoom:L,maxZoom:O,onSelectionContextMenu:g,preventScrolling:z,noDragClassName:se,noWheelClassName:ae,noPanClassName:le,disableKeyboardA11y:ue},t.createElement(xk,null,t.createElement(yk,{edgeTypes:me,onEdgeClick:c,onEdgeDoubleClick:d,onlyRenderVisibleElements:D,onEdgeContextMenu:J,onEdgeMouseEnter:Q,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:ie,onReconnectEnd:re,reconnectRadius:oe,defaultMarkerColor:U,noPanClassName:le,elevateEdgesOnSelect:!!ce,disableKeyboardA11y:ue,rfId:pe},t.createElement(Mk,{style:x,type:b,component:_,containerStyle:w})),t.createElement("div",{className:"react-flow__edgelabel-renderer"}),t.createElement(QD,{nodeTypes:fe,onNodeClick:l,onNodeDoubleClick:u,onNodeMouseEnter:h,onNodeMouseMove:p,onNodeMouseLeave:f,onNodeContextMenu:m,selectNodesOnDrag:R,onlyRenderVisibleElements:D,noPanClassName:le,noDragClassName:se,disableKeyboardA11y:ue,nodeOrigin:de,nodeExtent:he,rfId:pe})))};Ck.displayName="GraphView";var Tk=(0,t.memo)(Ck);const Ak=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Pk={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:Ak,nodeExtent:Ak,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:FA.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:DA,isValidConnection:void 0},Dk=()=>{return e=(e,t)=>({...Pk,setNodes:n=>{const{nodeInternals:i,nodeOrigin:r,elevateNodesOnSelect:o}=t();e({nodeInternals:oD(n,i,r,o)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:i={}}=t();e({edges:n.map(e=>({...i,...e}))})},setDefaultNodesAndEdges:(n,i)=>{const r="undefined"!==typeof n,o="undefined"!==typeof i,s=r?oD(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:s,edges:o?i:[],hasDefaultNodes:r,hasDefaultEdges:o})},updateNodeDimensions:n=>{const{onNodesChange:i,nodeInternals:r,fitViewOnInit:o,fitViewOnInitDone:s,fitViewOnInitOptions:a,domNode:l,nodeOrigin:c}=t(),u=l?.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:h}=new window.DOMMatrixReadOnly(d.transform),p=n.reduce((e,t)=>{const n=r.get(t.id);if(n?.hidden)r.set(n.id,{...n,[AA]:{...n[AA],handleBounds:void 0}});else if(n){const i=gA(t.nodeElement);i.width&&i.height&&(n.width!==i.width||n.height!==i.height||t.forceUpdate)&&(r.set(n.id,{...n,[AA]:{...n[AA],handleBounds:{source:zD(".source",t.nodeElement,h,c),target:zD(".target",t.nodeElement,h,c)}},...i}),e.push({id:n.id,type:"dimensions",dimensions:i}))}return e},[]);rD(r,c);const f=s||o&&!s&&sD(t,{initial:!0,...a});e({nodeInternals:new Map(r),fitViewOnInitDone:f}),p?.length>0&&i?.(p)},updateNodePositions:function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{triggerNodeChanges:r}=t(),o=e.map(e=>{const t={id:e.id,type:"position",dragging:i};return n&&(t.positionAbsolute=e.positionAbsolute,t.position=e.position),t});r(o)},triggerNodeChanges:n=>{const{onNodesChange:i,nodeInternals:r,hasDefaultNodes:o,nodeOrigin:s,getNodes:a,elevateNodesOnSelect:l}=t();if(n?.length){if(o){const t=oD(CD(n,a()),r,s,l);e({nodeInternals:t})}i?.(n)}},addSelectedNodes:n=>{const{multiSelectionActive:i,edges:r,getNodes:o}=t();let s,a=null;i?s=n.map(e=>TD(e,!0)):(s=AD(o(),n),a=AD(r,[])),cD({changedNodes:s,changedEdges:a,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:i,edges:r,getNodes:o}=t();let s,a=null;i?s=n.map(e=>TD(e,!0)):(s=AD(r,n),a=AD(o(),[])),cD({changedNodes:a,changedEdges:s,get:t,set:e})},unselectNodesAndEdges:function(){let{nodes:n,edges:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{edges:r,getNodes:o}=t(),s=i||r;cD({changedNodes:(n||o()).map(e=>(e.selected=!1,TD(e.id,!1))),changedEdges:s.map(e=>TD(e.id,!1)),get:t,set:e})},setMinZoom:n=>{const{d3Zoom:i,maxZoom:r}=t();i?.scaleExtent([n,r]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:i,minZoom:r}=t();i?.scaleExtent([r,n]),e({maxZoom:n})},setTranslateExtent:n=>{t().d3Zoom?.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:i}=t();cD({changedNodes:i().filter(e=>e.selected).map(e=>TD(e.id,!1)),changedEdges:n.filter(e=>e.selected).map(e=>TD(e.id,!1)),get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:i}=t();i.forEach(e=>{e.positionAbsolute=yA(e.position,n)}),e({nodeExtent:n,nodeInternals:new Map(i)})},panBy:e=>{const{transform:n,width:i,height:r,d3Zoom:o,d3Selection:s,translateExtent:a}=t();if(!o||!s||!e.x&&!e.y)return!1;const l=zT.translate(n[0]+e.x,n[1]+e.y).scale(n[2]),c=[[0,0],[i,r]],u=o?.constrain()(l,c,a);return o.transform(s,u),n[0]!==u.x||n[1]!==u.y||n[2]!==u.k},cancelConnection:()=>e({connectionNodeId:Pk.connectionNodeId,connectionHandleId:Pk.connectionHandleId,connectionHandleType:Pk.connectionHandleType,connectionStatus:Pk.connectionStatus,connectionStartHandle:Pk.connectionStartHandle,connectionEndHandle:Pk.connectionEndHandle}),reset:()=>e({...Pk})}),t=Object.is,e?uM(e,t):uM;var e,t},kk=e=>{let{children:n}=e;const i=(0,t.useRef)(null);return i.current||(i.current=Dk()),t.createElement(QT,{value:i.current},n)};kk.displayName="ReactFlowProvider";const Rk=e=>{let{children:n}=e;return(0,t.useContext)(JT)?t.createElement(t.Fragment,null,n):t.createElement(kk,null,n)};Rk.displayName="ReactFlowWrapper";const Nk={input:NP,default:kP,output:LP,group:OP},Ik={default:rP,straight:eP,step:QA,smoothstep:JA,simplebezier:YA},Lk=[0,0],Ok=[15,15],zk={x:0,y:0,zoom:1},Uk={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},Fk=(0,t.forwardRef)((e,n)=>{let{nodes:i,edges:r,defaultNodes:o,defaultEdges:s,className:a,nodeTypes:l=Nk,edgeTypes:c=Ik,onNodeClick:u,onEdgeClick:d,onInit:h,onMove:p,onMoveStart:f,onMoveEnd:m,onConnect:g,onConnectStart:v,onConnectEnd:y,onClickConnectStart:b,onClickConnectEnd:x,onNodeMouseEnter:_,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:E,onNodeDragStart:C,onNodeDrag:T,onNodeDragStop:A,onNodesDelete:P,onEdgesDelete:D,onSelectionChange:k,onSelectionDragStart:R,onSelectionDrag:N,onSelectionDragStop:I,onSelectionContextMenu:L,onSelectionStart:O,onSelectionEnd:z,connectionMode:U=FA.Strict,connectionLineType:F=VA.Bezier,connectionLineStyle:j,connectionLineComponent:B,connectionLineContainerStyle:V,deleteKeyCode:H="Backspace",selectionKeyCode:G="Shift",selectionOnDrag:W=!1,selectionMode:X=BA.Full,panActivationKeyCode:Y="Space",multiSelectionKeyCode:$=(IA()?"Meta":"Control"),zoomActivationKeyCode:q=(IA()?"Meta":"Control"),snapToGrid:Z=!1,snapGrid:K=Ok,onlyRenderVisibleElements:J=!1,selectNodesOnDrag:Q=!0,nodesDraggable:ee,nodesConnectable:te,nodesFocusable:ne,nodeOrigin:ie=Lk,edgesFocusable:re,edgesUpdatable:oe,elementsSelectable:se,defaultViewport:ae=zk,minZoom:le=.5,maxZoom:ce=2,translateExtent:ue=Ak,preventScrolling:de=!0,nodeExtent:he,defaultMarkerColor:pe="#b1b1b7",zoomOnScroll:fe=!0,zoomOnPinch:me=!0,panOnScroll:ge=!1,panOnScrollSpeed:ve=.5,panOnScrollMode:ye=jA.Free,zoomOnDoubleClick:be=!0,panOnDrag:xe=!0,onPaneClick:_e,onPaneMouseEnter:we,onPaneMouseMove:Se,onPaneMouseLeave:Me,onPaneScroll:Ee,onPaneContextMenu:Ce,children:Te,onEdgeContextMenu:Ae,onEdgeDoubleClick:Pe,onEdgeMouseEnter:De,onEdgeMouseMove:ke,onEdgeMouseLeave:Re,onEdgeUpdate:Ne,onEdgeUpdateStart:Ie,onEdgeUpdateEnd:Le,onReconnect:Oe,onReconnectStart:ze,onReconnectEnd:Ue,reconnectRadius:Fe=10,edgeUpdaterRadius:je=10,onNodesChange:Be,onEdgesChange:Ve,noDragClassName:He="nodrag",noWheelClassName:Ge="nowheel",noPanClassName:We="nopan",fitView:Xe=!1,fitViewOptions:Ye,connectOnClick:$e=!0,attributionPosition:qe,proOptions:Ze,defaultEdgeOptions:Ke,elevateNodesOnSelect:Je=!0,elevateEdgesOnSelect:Qe=!1,disableKeyboardA11y:et=!1,autoPanOnConnect:tt=!0,autoPanOnNodeDrag:nt=!0,connectionRadius:it=20,isValidConnection:rt,onError:ot,style:st,id:at,nodeDragThreshold:lt,...ct}=e;const ut=at||"1";return t.createElement("div",{...ct,style:{...st,...Uk},ref:n,className:oM(["react-flow",a]),"data-testid":"rf__wrapper",id:at},t.createElement(Rk,null,t.createElement(Tk,{onInit:h,onMove:p,onMoveStart:f,onMoveEnd:m,onNodeClick:u,onEdgeClick:d,onNodeMouseEnter:_,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:E,nodeTypes:l,edgeTypes:c,connectionLineType:F,connectionLineStyle:j,connectionLineComponent:B,connectionLineContainerStyle:V,selectionKeyCode:G,selectionOnDrag:W,selectionMode:X,deleteKeyCode:H,multiSelectionKeyCode:$,panActivationKeyCode:Y,zoomActivationKeyCode:q,onlyRenderVisibleElements:J,selectNodesOnDrag:Q,defaultViewport:ae,translateExtent:ue,minZoom:le,maxZoom:ce,preventScrolling:de,zoomOnScroll:fe,zoomOnPinch:me,zoomOnDoubleClick:be,panOnScroll:ge,panOnScrollSpeed:ve,panOnScrollMode:ye,panOnDrag:xe,onPaneClick:_e,onPaneMouseEnter:we,onPaneMouseMove:Se,onPaneMouseLeave:Me,onPaneScroll:Ee,onPaneContextMenu:Ce,onSelectionContextMenu:L,onSelectionStart:O,onSelectionEnd:z,onEdgeContextMenu:Ae,onEdgeDoubleClick:Pe,onEdgeMouseEnter:De,onEdgeMouseMove:ke,onEdgeMouseLeave:Re,onReconnect:Oe??Ne,onReconnectStart:ze??Ie,onReconnectEnd:Ue??Le,reconnectRadius:Fe??je,defaultMarkerColor:pe,noDragClassName:He,noWheelClassName:Ge,noPanClassName:We,elevateEdgesOnSelect:Qe,rfId:ut,disableKeyboardA11y:et,nodeOrigin:ie,nodeExtent:he}),t.createElement(XP,{nodes:i,edges:r,defaultNodes:o,defaultEdges:s,onConnect:g,onConnectStart:v,onConnectEnd:y,onClickConnectStart:b,onClickConnectEnd:x,nodesDraggable:ee,nodesConnectable:te,nodesFocusable:ne,edgesFocusable:re,edgesUpdatable:oe,elementsSelectable:se,elevateNodesOnSelect:Je,minZoom:le,maxZoom:ce,nodeExtent:he,onNodesChange:Be,onEdgesChange:Ve,snapToGrid:Z,snapGrid:K,connectionMode:U,translateExtent:ue,connectOnClick:$e,defaultEdgeOptions:Ke,fitView:Xe,fitViewOptions:Ye,onNodesDelete:P,onEdgesDelete:D,onNodeDragStart:C,onNodeDrag:T,onNodeDragStop:A,onSelectionDrag:N,onSelectionDragStart:R,onSelectionDragStop:I,noPanClassName:We,nodeOrigin:ie,rfId:ut,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,onError:ot,connectionRadius:it,isValidConnection:rt,nodeDragThreshold:lt}),t.createElement(VP,{onSelectionChange:k}),Te,t.createElement(fA,{proOptions:Ze,position:qe}),t.createElement(QP,{rfId:ut,disableKeyboardA11y:et})))});Fk.displayName="ReactFlow";const jk=e=>e.getNodes();function Bk(e){return n=>{const[i,r]=(0,t.useState)(n),o=(0,t.useCallback)(t=>r(n=>e(t,n)),[]);return[i,r,o]}}const Vk=Bk(CD),Hk=Bk(function(e,t){return ED(e,t)});var Gk;function Wk(e){let{color:n,dimensions:i,lineWidth:r}=e;return t.createElement("path",{stroke:n,strokeWidth:r,d:`M${i[0]/2} 0 V${i[1]} M0 ${i[1]/2} H${i[0]}`})}function Xk(e){let{color:n,radius:i}=e;return t.createElement("circle",{cx:i,cy:i,r:i,fill:n})}!function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"}(Gk||(Gk={}));const Yk={[Gk.Dots]:"#91919a",[Gk.Lines]:"#eee",[Gk.Cross]:"#e2e2e2"},$k={[Gk.Dots]:1,[Gk.Lines]:1,[Gk.Cross]:6},qk=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Zk(e){let{id:n,variant:i=Gk.Dots,gap:r=20,size:o,lineWidth:s=1,offset:a=2,color:l,style:c,className:u}=e;const d=(0,t.useRef)(null),{transform:h,patternId:p}=uA(qk,dM),f=l||Yk[i],m=o||$k[i],g=i===Gk.Dots,v=i===Gk.Cross,y=Array.isArray(r)?r:[r,r],b=[y[0]*h[2]||1,y[1]*h[2]||1],x=m*h[2],_=v?[x,x]:b,w=g?[x/a,x/a]:[_[0]/a,_[1]/a];return t.createElement("svg",{className:oM(["react-flow__background",u]),style:{...c,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:d,"data-testid":"rf__background"},t.createElement("pattern",{id:p+n,x:h[0]%b[0],y:h[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${w[0]},-${w[1]})`},g?t.createElement(Xk,{color:f,radius:x/a}):t.createElement(Wk,{dimensions:_,color:f,lineWidth:s})),t.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${p+n})`}))}Zk.displayName="Background";var Kk=(0,t.memo)(Zk);function Jk(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},t.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function Qk(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},t.createElement("path",{d:"M0 0h32v4.2H0z"}))}function eR(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},t.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function tR(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},t.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function nR(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},t.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const iR=e=>{let{children:n,className:i,...r}=e;return t.createElement("button",{type:"button",className:oM(["react-flow__controls-button",i]),...r},n)};iR.displayName="ControlButton";const rR=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),oR=e=>{let{style:n,showZoom:i=!0,showFitView:r=!0,showInteractive:o=!0,fitViewOptions:s,onZoomIn:a,onZoomOut:l,onFitView:c,onInteractiveChange:u,className:d,children:h,position:p="bottom-left"}=e;const f=dA(),[m,g]=(0,t.useState)(!1),{isInteractive:v,minZoomReached:y,maxZoomReached:b}=uA(rR,dM),{zoomIn:x,zoomOut:_,fitView:w}=pD();if((0,t.useEffect)(()=>{g(!0)},[]),!m)return null;return t.createElement(pA,{className:oM(["react-flow__controls",d]),position:p,style:n,"data-testid":"rf__controls"},i&&t.createElement(t.Fragment,null,t.createElement(iR,{onClick:()=>{x(),a?.()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:b},t.createElement(Jk,null)),t.createElement(iR,{onClick:()=>{_(),l?.()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},t.createElement(Qk,null))),r&&t.createElement(iR,{className:"react-flow__controls-fitview",onClick:()=>{w(s),c?.()},title:"fit view","aria-label":"fit view"},t.createElement(eR,null)),o&&t.createElement(iR,{className:"react-flow__controls-interactive",onClick:()=>{f.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),u?.(!v)},title:"toggle interactivity","aria-label":"toggle interactivity"},v?t.createElement(nR,null):t.createElement(tR,null)),h)};oR.displayName="Controls";var sR=(0,t.memo)(oR);const aR={float:"#84d684",vector2:"#8fc93a",vector3:"#f4b942",vector4:"#e18335",bool:"#a78bfa",boolean:"#a78bfa",string:"#60a5fa",color:"#ff6b6b",texture2D:"#FF6E6E",matrix:"#8FC93F"},lR=e=>{var t,n,i,o,s,a;let{data:l,selected:c}=e;const{getNode:u,setNodes:d}=pD();if("parameter"===l.nodeType){var h,p,f,m;const e=aR[(null===(h=l.outputs)||void 0===h||null===(p=h[0])||void 0===p?void 0:p.type)||"float"]||"#999";return(0,r.jsxs)("div",{className:"shader-node",style:{background:l.isDarkTheme?"#1a1a1a":"#f8f8f8",border:"1px solid "+(c?"#4a9eff":l.isDarkTheme?"#3a3a3a":"#e0e0e0"),borderRadius:"8px",padding:"8px 12px",minWidth:"150px",display:"flex",alignItems:"center",gap:"10px",boxShadow:c?"0 0 0 1px #4a9eff":"0 2px 4px rgba(0,0,0,0.1)"},children:[l.isDifferentiable&&(0,r.jsx)("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#4488ff",flexShrink:0},children:"\u2202"}),(0,r.jsx)("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:e,border:"2px solid "+(l.isDarkTheme?"#0a0a0a":"#fff"),flexShrink:0}}),(0,r.jsx)("span",{style:{fontSize:"12px",color:l.isDarkTheme?"#e0e0e0":"#333",flex:1},children:l.label}),(0,r.jsx)("span",{style:{fontSize:"10px",color:l.isDarkTheme?"#666":"#999",textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",background:l.isDarkTheme?"#2a2a2a":"#f0f0f0",borderRadius:"4px"},children:(null===(f=l.outputs)||void 0===f||null===(m=f[0])||void 0===m?void 0:m.type)||"float"}),(0,r.jsx)(PP,{type:"source",position:GA.Right,id:"output-0",style:{background:e,width:"12px",height:"12px",border:"2px solid "+(l.isDarkTheme?"#1a1a1a":"#fff"),right:"-6px",top:"50%",transform:"translateY(-50%)",zIndex:100}})]})}const g={math:"#2a3f5f",input:"#3d2e4f",output:"#4a3a5f",constant:"#2e4f3f",utility:"#4f3e2e"}[l.nodeType]||"#2a3f5f";return(0,r.jsxs)("div",{className:"shader-node",onContextMenu:e=>{e.stopPropagation(),e.preventDefault()},style:{background:l.isDarkTheme?"#1a1a1a":"#f8f8f8",border:"2px solid "+(c?"#4a9eff":l.isDarkTheme?"#3a3a3a":"#e0e0e0"),borderRadius:"8px",minWidth:"200px",boxShadow:c?"0 0 0 1px #4a9eff":"0 2px 4px rgba(0,0,0,0.1)",overflow:"hidden"},children:[(0,r.jsxs)("div",{className:"node-header",style:{background:l.isDarkTheme?"rgba(50, 50, 50, 0.8)":"rgba(250, 250, 250, 0.8)",color:l.isDarkTheme?"#e0e0e0":"#333",padding:"10px 12px",borderBottom:"1px solid "+(l.isDarkTheme?"#2a2a2a":"#e0e0e0"),fontSize:"13px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:[(0,r.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:g,opacity:.7,flexShrink:0}}),(0,r.jsx)("span",{children:l.label})]}),(0,r.jsx)("div",{className:"node-body",style:{position:"relative"},children:null!==(t=l.inputs)&&void 0!==t&&t.length&&null!==(n=l.outputs)&&void 0!==n&&n.length?(()=>{const e=Math.max(l.inputs.length,l.outputs.length),t=[];for(let n=0;n<e;n++){const i=l.inputs[n],o=l.outputs[n];t.push((0,r.jsxs)("div",{style:{display:"flex",position:"relative",minHeight:"32px",borderBottom:n<e-1?"1px solid "+(l.isDarkTheme?"#1a1a1a":"#e8e8e8"):"none"},children:[(0,r.jsx)("div",{style:{flex:1,display:"flex",alignItems:"center",padding:"6px 12px 6px 20px",background:l.isDarkTheme?"#2d2d2d":"#f5f5f5",position:"relative"},children:i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(PP,{type:"target",position:GA.Left,id:`input-${n}`,style:{background:aR[i.type]||"#999",width:"12px",height:"12px",border:"2px solid "+(l.isDarkTheme?"#0a0a0a":"#fff"),left:"-6px",top:"50%",transform:"translateY(-50%)",zIndex:100}}),(0,r.jsxs)("span",{style:{fontSize:"11px",color:l.isDarkTheme?"#aaa":"#666",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,r.jsx)("span",{children:i.name}),(0,r.jsx)("span",{style:{fontSize:"9px",color:aR[i.type]||"#999",opacity:.7,fontWeight:"bold",textTransform:"uppercase",marginLeft:"auto"},children:i.type})]})]})}),(0,r.jsx)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"6px 20px 6px 12px",background:l.isDarkTheme?"#1f1f1f":"#e8e8e8",position:"relative"},children:o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{style:{fontSize:"11px",color:l.isDarkTheme?"#bbb":"#555",display:"flex",alignItems:"center",justifyContent:"flex-start",width:"100%"},children:[(0,r.jsx)("span",{style:{fontSize:"9px",color:aR[o.type]||"#999",opacity:.7,fontWeight:"bold",textTransform:"uppercase",marginRight:"6px"},children:o.type}),(0,r.jsx)("span",{children:o.name})]}),(0,r.jsx)(PP,{type:"source",position:GA.Right,id:`output-${n}`,style:{background:aR[o.type]||"#999",width:"12px",height:"12px",border:"2px solid "+(l.isDarkTheme?"#0a0a0a":"#fff"),right:"-6px",top:"50%",transform:"translateY(-50%)",zIndex:100}})]})})]},`row-${n}`))}return t})():(0,r.jsxs)(r.Fragment,{children:[l.inputs&&!(null!==(i=l.outputs)&&void 0!==i&&i.length)&&l.inputs.map((e,t)=>{var n;return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"6px 12px 6px 20px",background:l.isDarkTheme?"#2d2d2d":"#f5f5f5",borderBottom:t<((null===(n=l.inputs)||void 0===n?void 0:n.length)||0)-1?"1px solid "+(l.isDarkTheme?"#1a1a1a":"#e8e8e8"):"none",position:"relative"},children:[(0,r.jsx)(PP,{type:"target",position:GA.Left,id:`input-${t}`,style:{background:aR[e.type]||"#999",width:"12px",height:"12px",border:"2px solid "+(l.isDarkTheme?"#0a0a0a":"#fff"),left:"-6px",top:"50%",transform:"translateY(-50%)",zIndex:100}}),(0,r.jsxs)("span",{style:{fontSize:"11px",color:l.isDarkTheme?"#aaa":"#666",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)("span",{style:{fontSize:"9px",color:aR[e.type]||"#999",opacity:.7,fontWeight:"bold",textTransform:"uppercase"},children:e.type})]})]},`input-${t}`)}),l.outputs&&!(null!==(o=l.inputs)&&void 0!==o&&o.length)&&l.outputs.map((e,t)=>{var n;return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"6px 20px 6px 12px",background:l.isDarkTheme?"#1f1f1f":"#e8e8e8",borderBottom:t<((null===(n=l.outputs)||void 0===n?void 0:n.length)||0)-1?"1px solid "+(l.isDarkTheme?"#1a1a1a":"#e8e8e8"):"none",position:"relative"},children:[(0,r.jsxs)("span",{style:{fontSize:"11px",color:l.isDarkTheme?"#bbb":"#555",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,r.jsx)("span",{style:{fontSize:"9px",color:aR[e.type]||"#999",opacity:.7,fontWeight:"bold",textTransform:"uppercase"},children:e.type}),(0,r.jsx)("span",{children:e.name})]}),(0,r.jsx)(PP,{type:"source",position:GA.Right,id:`output-${t}`,style:{background:aR[e.type]||"#999",width:"12px",height:"12px",border:"2px solid "+(l.isDarkTheme?"#0a0a0a":"#fff"),right:"-6px",top:"50%",transform:"translateY(-50%)",zIndex:100}})]},`output-${t}`)}),!(null!==(s=l.inputs)&&void 0!==s&&s.length)&&!(null!==(a=l.outputs)&&void 0!==a&&a.length)&&(0,r.jsx)("div",{style:{padding:"12px",textAlign:"center",color:l.isDarkTheme?"#888":"#aaa",fontSize:"11px"},children:void 0!==l.value?(0,r.jsx)("input",{type:"text",value:l.value,onChange:e=>{const t=u(l.label);t&&d(n=>n.map(n=>n.id===t.id?{...n,data:{...n.data,value:e.target.value}}:n))},style:{background:"transparent",border:"1px solid "+(l.isDarkTheme?"#3a3a3a":"#ddd"),borderRadius:"4px",padding:"4px 8px",color:l.isDarkTheme?"#fff":"#000",fontSize:"11px",width:"100%",outline:"none"}}):"Empty"})]})})]})},cR=e=>{let{data:n,selected:i,id:o}=e;const{setNodes:s,getNode:a,getNodes:l}=pD(),{setNodes:c,isSyncing:u}=$_(),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(n.label),[m,g]=(0,t.useState)({width:400,height:300}),v=(0,t.useRef)(null),[y,b]=(0,t.useState)(!1),[x,_]=(0,t.useState)(""),w=(0,t.useRef)({width:0,height:0}),S=(0,t.useRef)({x:0,y:0}),M=(0,t.useRef)({x:0,y:0}),E=()=>{h(!1),s(e=>{const t=e.map(e=>e.id===o?{...e,data:{...e.data,label:p}}:e);return u||setTimeout(()=>c(t),0),t})},C=(e,t)=>{e.stopPropagation(),e.preventDefault(),b(!0),_(t),w.current={width:m.width,height:m.height},S.current={x:e.clientX,y:e.clientY};const n=a(o);n&&(M.current={x:n.position.x,y:n.position.y});let i=!1;const r=e=>{i||(i=!0,requestAnimationFrame(()=>{i=!1;const n=e.clientX-S.current.x,r=e.clientY-S.current.y;let a=w.current.width,l=w.current.height,c=M.current.x,u=M.current.y;if(t.includes("right")&&(a=Math.max(300,w.current.width+n)),t.includes("left")){const e=-n;a=Math.max(300,w.current.width+e),w.current.width+e>=300&&(c=M.current.x+n)}if(t.includes("bottom")&&(l=Math.max(200,w.current.height+r)),t.includes("top")){const e=-r;l=Math.max(200,w.current.height+e),w.current.height+e>=200&&(u=M.current.y+r)}g({width:a,height:l}),s(e=>e.map(e=>e.id===o?{...e,position:{x:c,y:u},style:{...e.style,width:a,height:l},width:a,height:l}:e))}))},d=()=>{b(!1),_(""),setTimeout(()=>{const e=l();u||c(e)},50),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",d)};return(0,t.useEffect)(()=>{var e;null!==(e=n.value)&&void 0!==e&&e.width&&g({width:n.value.width,height:n.value.height})},[n.value]),(0,r.jsxs)("div",{ref:v,className:"group-node",style:{width:m.width,height:m.height,background:n.isDarkTheme?"rgba(40, 40, 40, 0.3)":"rgba(240, 240, 240, 0.3)",border:"2px dashed "+(i?"#4a9eff":n.isDarkTheme?"rgba(100, 100, 100, 0.5)":"rgba(180, 180, 180, 0.5)"),borderRadius:"8px",position:"relative",pointerEvents:"none",cursor:y?"grabbing":"default"},children:[(0,r.jsxs)("div",{className:"group-header",style:{background:n.isDarkTheme?"rgba(50, 50, 50, 0.8)":"rgba(250, 250, 250, 0.8)",borderBottom:"1px solid "+(n.isDarkTheme?"rgba(80, 80, 80, 0.5)":"rgba(200, 200, 200, 0.5)"),padding:"8px 12px",borderRadius:"6px 6px 0 0",display:"flex",alignItems:"center",gap:"8px",cursor:"move",pointerEvents:"auto"},children:[(0,r.jsx)("span",{style:{color:n.isDarkTheme?"#666":"#999",fontSize:"14px",letterSpacing:"2px",userSelect:"none"},children:"\u22ee\u22ee"}),d?(0,r.jsx)("input",{type:"text",value:p,onChange:e=>{f(e.target.value)},onKeyDown:e=>{"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),E())},onBlur:E,autoFocus:!0,style:{background:"transparent",border:"1px solid "+(n.isDarkTheme?"#444":"#ddd"),borderRadius:"4px",padding:"2px 6px",color:n.isDarkTheme?"#e0e0e0":"#333",fontSize:"14px",fontWeight:"600",outline:"none",width:"auto",minWidth:"100px"}}):(0,r.jsx)("span",{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault(),h(!0),f(n.label)},style:{color:n.isDarkTheme?"#e0e0e0":"#333",fontSize:"14px",fontWeight:"600",cursor:"text",textAlign:"left"},children:n.label})]}),(0,r.jsx)("div",{style:{position:"absolute",top:-5,left:10,right:10,height:10,cursor:"ns-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"top")}),(0,r.jsx)("div",{style:{position:"absolute",bottom:-5,left:10,right:10,height:10,cursor:"ns-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"bottom")}),(0,r.jsx)("div",{style:{position:"absolute",left:-5,top:10,bottom:10,width:10,cursor:"ew-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"left")}),(0,r.jsx)("div",{style:{position:"absolute",right:-5,top:10,bottom:10,width:10,cursor:"ew-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"right")}),(0,r.jsx)("div",{style:{position:"absolute",top:-5,left:-5,width:15,height:15,cursor:"nwse-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"top-left")}),(0,r.jsx)("div",{style:{position:"absolute",top:-5,right:-5,width:15,height:15,cursor:"nesw-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"top-right")}),(0,r.jsx)("div",{style:{position:"absolute",bottom:-5,left:-5,width:15,height:15,cursor:"nesw-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"bottom-left")}),(0,r.jsx)("div",{style:{position:"absolute",bottom:-5,right:-5,width:15,height:15,cursor:"nwse-resize",pointerEvents:"auto"},onMouseDown:e=>C(e,"bottom-right")})]})},uR=e=>{let{data:n,selected:i,id:o}=e;const{setNodes:s,getNodes:a}=pD(),{setNodes:l,isSyncing:c}=$_(),[u,d]=(0,t.useState)(n.value||""),[h,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(!1),g=(0,t.useRef)(null);t.useEffect(()=>{void 0===n.value||n.value===u||h||d(n.value)},[n.value]);const v=(0,t.useCallback)(()=>{p(!1),s(e=>{const t=e.map(e=>e.id===o?{...e,data:{...e.data,value:u}}:e);return c||setTimeout(()=>l(t),0),t})},[o,u,s,l,c]),y=(0,t.useCallback)(()=>{p(!0),setTimeout(()=>{g.current&&g.current.select()},0)},[]),b=(0,t.useCallback)(e=>{var t,n;e.stopPropagation(),e.preventDefault(),m(!0);const i=e.clientX,r=e.clientY,u=a().find(e=>e.id===o),d="number"===typeof(null===u||void 0===u||null===(t=u.style)||void 0===t?void 0:t.width)?u.style.width:250,h="number"===typeof(null===u||void 0===u||null===(n=u.style)||void 0===n?void 0:n.height)?u.style.height:150;let p=!1;const f=e=>{p||(p=!0,requestAnimationFrame(()=>{p=!1;const t=e.clientX-i,n=e.clientY-r;s(e=>e.map(e=>{if(e.id===o){const i=Math.max(150,d+t),r=Math.max(100,h+n);return{...e,style:{...e.style,width:i,height:r}}}return e}))}))},g=()=>{m(!1),setTimeout(()=>{const e=a();c||l(e)},50),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",g)},[o,s,a,l,c]);return(0,r.jsxs)("div",{className:h?"nodrag":"",style:{background:n.isDarkTheme?"#2a2a2a":"#fffbf0",border:"2px solid "+(i?"#4a9eff":n.isDarkTheme?"#444":"#e0d090"),borderRadius:"8px",width:"100%",height:"100%",minWidth:"150px",minHeight:"100px",padding:"12px",boxShadow:i?"0 0 0 1px #4a9eff":"0 2px 4px rgba(0,0,0,0.1)",position:"relative",boxSizing:"border-box",pointerEvents:f?"none":"auto"},children:[h?(0,r.jsx)("textarea",{ref:g,value:u,onChange:e=>d(e.target.value),onBlur:v,onKeyDown:e=>{"Escape"===e.key&&v(),e.stopPropagation()},style:{width:"100%",height:"100%",background:"transparent",border:"none",padding:"0",fontSize:"13px",color:n.isDarkTheme?"#e0e0e0":"#333",outline:"none",resize:"none",fontFamily:"inherit"},autoFocus:!0}):(0,r.jsx)("div",{onDoubleClick:y,style:{width:"100%",height:"100%",fontSize:"13px",color:n.isDarkTheme?"#ccc":"#444",whiteSpace:"pre-wrap",wordBreak:"break-word",cursor:"default",overflow:"auto",userSelect:"none"},children:u||"Double-click to edit..."}),(0,r.jsx)("div",{className:"nodrag",onMouseDown:b,style:{position:"absolute",bottom:0,right:0,width:0,height:0,borderStyle:"solid",borderWidth:"0 0 16px 16px",borderColor:`transparent transparent ${n.isDarkTheme?"#555":"#bbb"} transparent`,cursor:"se-resize",opacity:.5,transition:"opacity 0.2s"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.8"},onMouseLeave:e=>{e.currentTarget.style.opacity="0.5"}})]})};class dR{static initialize(){this.initialized||(this.register(hR),this.register(pR),this.register(fR),this.initialized=!0)}static register(e){this.components.set(e.name,e)}static get(e){return this.initialize(),this.components.get(e)}static getAll(){return this.initialize(),Array.from(this.components.values())}}dR.components=new Map,dR.initialized=!1;const hR={name:"transform",displayName:"Transform",fields:[{name:"position",displayName:"Position",type:"vector3",value:[0,0,0]},{name:"rotation",displayName:"Rotation",type:"vector3",value:[0,0,0]},{name:"scale",displayName:"Scale",type:"vector3",value:[1,1,1]}]},pR={name:"material",displayName:"Material",fields:[{name:"color",displayName:"Color",type:"color",value:"#808080"},{name:"metalness",displayName:"Metalness",type:"float",value:.5,min:0,max:1,step:.01},{name:"roughness",displayName:"Roughness",type:"float",value:.5,min:0,max:1,step:.01},{name:"permittivity",displayName:"Permittivity",type:"float",value:1,min:.1,max:100,step:.1}]},fR={name:"mesh",displayName:"Mesh",fields:[{name:"type",displayName:"Type",type:"string",value:"Custom"},{name:"visible",displayName:"Visible",type:"boolean",value:!0}]};function mR(e){const t=[];if(e.transform){const n={...hR};n.fields=n.fields.map(t=>({...t,value:e.transform[t.name]||t.value})),t.push(n)}if(e.components&&Array.isArray(e.components))for(const n of e.components){if("Transform"===n.name||"transform"===n.name)continue;const e={name:n.name,displayName:n.display_name||n.name,fields:[],buttons:n.buttons||[]};n.fields&&Array.isArray(n.fields)?e.fields=n.fields.map(e=>{var t,i,r,o,s;return{name:e.name,displayName:e.display_name||e.name,type:e.field_type||e.type||"string",value:null!==(t=null!==(i=null===(r=n.values)||void 0===r?void 0:r[e.name])&&void 0!==i?i:e.default_value)&&void 0!==t?t:e.value,min:null!==(o=e.min_value)&&void 0!==o?o:e.min,max:null!==(s=e.max_value)&&void 0!==s?s:e.max,step:e.step}}):n.values&&Object.entries(n.values).forEach(t=>{let[n,i]=t,r="string";"boolean"===typeof i?r="boolean":"number"===typeof i?r="float":Array.isArray(i)?2===i.length?r="vector2":3===i.length?r="vector3":4===i.length&&(r="vector4"):"string"===typeof i&&i.startsWith("#")&&(r="color"),e.fields.push({name:n,displayName:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:r,value:i})}),e.fields.length>0&&t.push(e)}else{if(e.material){const n={...pR};n.fields=n.fields.map(t=>({...t,value:e.material[t.name]||t.value})),t.push(n)}const n={...fR};n.fields=[{name:"type",displayName:"Type",type:"string",value:e.mesh||"Custom"},{name:"visible",displayName:"Visible",type:"boolean",value:!1!==e.visible}],t.push(n)}return t}const gR=e=>{let{field:t,nodeId:n,componentName:i,showValue:o=!0,mode:s="absolute",onModeChange:a}=e;const l=`input-${i}-${t.name}`;return(0,r.jsxs)("div",{className:"field-row",children:[(0,r.jsx)(PP,{type:"target",position:GA.Left,id:l,style:{background:(c=t.type,aR[c]||aR.float),position:"absolute",left:"-6px",top:"50%",transform:"translateY(-50%)",width:"12px",height:"12px",border:"2px solid #1a1a1a",zIndex:100},className:"field-handle"}),(0,r.jsxs)("div",{className:"field-content",children:[(0,r.jsx)("div",{className:"field-label",children:t.displayName}),o&&(0,r.jsxs)("div",{className:"field-value",children:["vector3"===t.type&&Array.isArray(t.value)&&(0,r.jsxs)("span",{className:"vector-value",children:["[",t.value.map(e=>e.toFixed(2)).join(", "),"]"]}),"vector2"===t.type&&Array.isArray(t.value)&&(0,r.jsxs)("span",{className:"vector-value",children:["[",t.value.map(e=>e.toFixed(2)).join(", "),"]"]}),"vector4"===t.type&&Array.isArray(t.value)&&(0,r.jsxs)("span",{className:"vector-value",children:["[",t.value.map(e=>e.toFixed(2)).join(", "),"]"]}),"float"===t.type&&(0,r.jsx)("span",{className:"float-value",children:t.value.toFixed(2)}),"color"===t.type&&(0,r.jsx)("div",{className:"color-value",style:{backgroundColor:t.value}}),"boolean"===t.type&&(0,r.jsx)("span",{className:"boolean-value",children:t.value?"\u2713":"\u2717"}),"string"===t.type&&(0,r.jsx)("span",{className:"string-value",children:t.value})]}),a&&(0,r.jsxs)("div",{className:"field-mode-toggle",children:[(0,r.jsx)("button",{className:"mode-btn "+("absolute"===s?"active":""),onClick:()=>a(t.name,"absolute"),title:"Absolute value",children:"Abs"}),(0,r.jsx)("button",{className:"mode-btn "+("relative"===s?"active":""),onClick:()=>a(t.name,"relative"),title:"Relative value",children:"Rel"})]})]})]});var c},vR=e=>{let{component:t,nodeId:n,isExpanded:i=!0,onToggle:o,onRemove:s,fieldModes:a={},onFieldModeChange:l,showToggle:c=!0,removable:u=!1}=e;const d=c&&!i&&t.fields.length>0;d&&t.fields[0].type;return(0,r.jsxs)("div",{className:"component-section",children:[(0,r.jsxs)("div",{className:c?"component-header":"component-group-header",style:{position:"relative"},children:[d&&t.fields.map((e,n)=>{const i=`input-${t.name}-${e.name}`,o=t.fields.length,s=1===o?"50%":20+60/(o-1)*n+"%";return(0,r.jsx)(PP,{type:"target",position:GA.Left,id:i,style:{background:aR[e.type]||aR.float,position:"absolute",left:"-6px",top:s,transform:"translateY(-50%)",width:"10px",height:"10px",border:"2px solid #1a1a1a",zIndex:100},className:"field-handle collapsed-handle"},i)}),c&&(0,r.jsx)("span",{className:"component-toggle "+(i?"expanded":""),onClick:o,children:"\u25b6"}),(0,r.jsx)("span",{className:c?"component-name":"component-group-name",children:t.displayName}),u&&s&&(0,r.jsx)("button",{className:"remove-component-btn",onClick:s,title:"Remove component",children:"\xd7"})]}),(i||!c)&&(0,r.jsx)("div",{className:"component-fields",children:t.fields.map(e=>{const i=`${t.name}-${e.name}`,o=a[i]||"absolute";return(0,r.jsx)(gR,{field:e,nodeId:n,componentName:t.name,showValue:!0,mode:o,onModeChange:l?(e,n)=>l(`${t.name}-${e}`,n):void 0},e.name)})})]})};function yR(e){let{data:n,id:i,selected:o}=e;const{setNodes:s}=pD(),a=z_(e=>e.objects),[l,c]=(0,t.useState)(new Set(n.components.filter(e=>e.expanded).map(e=>e.name))),[u,d]=(0,t.useState)(n.fieldModes||{});(0,t.useEffect)(()=>{const e=a[n.objectId];if(e){const t=mR(e).map(e=>({...e,expanded:l.has(e.name)}));s(n=>n.map(n=>n.id===i?{...n,data:{...n.data,components:t,objectName:e.name||"Object",objectType:e.mesh||"Custom"}}:n))}},[a,n.objectId,i,s,l]);const h=(0,t.useCallback)((e,t)=>{const n={...u,[e]:t};d(n),s(e=>e.map(e=>e.id===i?{...e,data:{...e.data,fieldModes:n}}:e))},[u,i,s]),p=(0,t.useCallback)(e=>{c(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),s(e=>e.map(e=>{if(e.id===i){const t=n.components.map(e=>({...e,expanded:r.has(e.name)}));return{...e,data:{...e.data,components:t}}}return e})),n.onComponentToggle&&n.onComponentToggle(e,!t.has(e)),r})},[i,n,s]);return(0,r.jsxs)("div",{className:"object-node "+(o?"selected":""),children:[(0,r.jsxs)("div",{className:"object-node-header",children:[(0,r.jsx)("div",{className:"object-node-title",children:n.objectName}),(0,r.jsx)("div",{className:"object-node-type",children:n.objectType})]}),(0,r.jsx)("div",{className:"object-node-components",children:n.components.map((e,t)=>(0,r.jsx)(vR,{component:e,nodeId:i,isExpanded:l.has(e.name),onToggle:()=>p(e.name),fieldModes:u,onFieldModeChange:h,showToggle:!0,removable:!1},e.name))})]})}function bR(e){let{data:n,id:i,selected:o}=e;const{setNodes:s}=pD(),a=z_(e=>e.objects),[l,c]=(0,t.useState)(n.filterBy||"name"),[u,d]=(0,t.useState)(n.filterValue||""),[h,p]=(0,t.useState)(n.selectedComponents||["transform"]),[f,m]=(0,t.useState)(!1),[g,v]=(0,t.useState)(!1),[y,b]=(0,t.useState)(u),[x,_]=(0,t.useState)(n.fieldModes||{}),[w,S]=(0,t.useState)([hR,pR,fR]),[M,E]=(0,t.useState)(new Set(h)),[C,T]=(0,t.useState)(""),A=(0,t.useCallback)(()=>u?Object.entries(a).filter(e=>{let[t,n]=e;if("name"===l){const e=u.replace(/\*/g,".*");return new RegExp(`^${e}$`,"i").test(n.name||"")}return!1}):[],[a,l,u])().length,P=(0,t.useCallback)(e=>{s(t=>t.map(t=>t.id===i?{...t,data:{...t.data,...e,components:w.filter(t=>h.includes(t.name)||e.selectedComponents&&e.selectedComponents.includes(t.name))}}:t))},[i,s,w,h]);(0,t.useEffect)(()=>{const e=e=>{if(console.log("[ObjectGroupNode] Received component definitions:",e),e.definitions&&Array.isArray(e.definitions)){const t=[];t.push(hR),e.definitions.forEach(e=>{if("Transform"===e.name||"transform"===e.name)return;const n={name:e.name,displayName:e.display_name||e.name,fields:[],buttons:e.buttons||[]};e.fields&&Array.isArray(e.fields)&&(n.fields=e.fields.map(e=>{var t,n,i;return{name:e.name,displayName:e.display_name||e.name,type:e.field_type||e.type||"string",value:null!==(t=e.default_value)&&void 0!==t?t:e.value,min:null!==(n=e.min_value)&&void 0!==n?n:e.min,max:null!==(i=e.max_value)&&void 0!==i?i:e.max,step:e.step}})),(n.fields.length>0||n.name)&&t.push(n)}),console.log("[ObjectGroupNode] Processed components:",t),S(t),P({components:t.filter(e=>h.includes(e.name))})}};return I_.on("component_definitions",e),I_.getComponentDefinitions(),()=>{I_.off("component_definitions",e)}},[h,P]);const D=(0,t.useCallback)((e,t)=>{const n={...x,[e]:t};_(n),P({fieldModes:n})},[x,P]),k=e=>{c(e),P({filterBy:e})},R=()=>{d(y),P({filterValue:y}),v(!1)};return(0,r.jsxs)("div",{className:"object-group-node "+(o?"selected":""),children:[(0,r.jsxs)("div",{className:"object-group-header",children:[(0,r.jsx)("div",{className:"object-group-title",children:"Object Group"}),(0,r.jsxs)("div",{className:"object-count",children:[A," objects"]})]}),(0,r.jsxs)("div",{className:"filter-section",children:[(0,r.jsxs)("div",{className:"filter-row",children:[(0,r.jsx)("span",{className:"filter-label",children:"Filter by:"}),(0,r.jsxs)("div",{className:"toggle-group",children:[(0,r.jsx)("button",{className:"toggle-btn "+("name"===l?"active":""),onClick:()=>k("name"),children:"Name"}),(0,r.jsx)("button",{className:"toggle-btn "+("tag"===l?"active":""),onClick:()=>k("tag"),children:"Tag"})]})]}),(0,r.jsx)("div",{className:"filter-value-row",children:g?(0,r.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),onBlur:R,onKeyDown:e=>{"Enter"===e.key&&R(),"Escape"===e.key&&(b(u),v(!1))},className:"filter-input",placeholder:"name"===l?"e.g., Cube*":"e.g., enemy",autoFocus:!0}):(0,r.jsx)("div",{className:"filter-value",onClick:()=>{v(!0),b(u)},children:u||(0,r.jsx)("span",{className:"placeholder",children:"Click to set filter..."})})})]}),(0,r.jsx)("div",{className:"component-groups",children:h.map(e=>{const t=w.find(t=>t.name===e);return t?(0,r.jsx)(vR,{component:t,nodeId:i,isExpanded:M.has(e),onToggle:()=>{return t=e,void E(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},fieldModes:x,onFieldModeChange:D,showToggle:!0,removable:!0,onRemove:()=>(e=>{const t=h.filter(t=>t!==e);p(t),P({selectedComponents:t}),E(t=>{const n=new Set(t);return n.delete(e),n})})(e)},e):null})}),(0,r.jsxs)("div",{className:"add-component-section",style:{position:"relative"},children:[(0,r.jsx)("button",{className:"add-component-full-button",onClick:()=>{m(!f),T("")},children:(0,r.jsx)("span",{children:"Add Component"})}),f&&(0,r.jsxs)("div",{className:"component-dropdown-menu",children:[(0,r.jsx)("input",{type:"text",className:"component-search-input",placeholder:"Search components...",value:C,onChange:e=>T(e.target.value),autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,r.jsxs)("div",{className:"component-list",children:[w.filter(e=>!h.includes(e.name)).filter(e=>e.displayName.toLowerCase().includes(C.toLowerCase())).map(e=>(0,r.jsx)("div",{className:"component-menu-item",onClick:()=>(e=>{if(!h.includes(e)){const t=[...h,e];p(t),P({selectedComponents:t}),E(t=>new Set([...Array.from(t),e]))}m(!1),T("")})(e.name),children:e.displayName},e.name)),0===w.filter(e=>!h.includes(e.name)).filter(e=>e.displayName.toLowerCase().includes(C.toLowerCase())).length&&(0,r.jsx)("div",{className:"component-menu-empty",children:C?"No matching components":"All components added"})]})]})]})]})}const xR=e=>{let{id:n,sourceX:i,sourceY:o,targetX:s,targetY:a,sourcePosition:l,targetPosition:c,style:u={},markerEnd:d,source:h,sourceHandleId:p,target:f,targetHandleId:m,selected:g}=e;const v=uA(jk,dM),[y,b]=(0,t.useState)(!1),[x,_]=(0,t.useState)(0),w=v.find(e=>e.id===h),S=(0,t.useMemo)(()=>{if(!w)return!1;const e=w.data;return"parameter"===e.nodeType&&e.isDifferentiable},[w]);(0,t.useEffect)(()=>{_(y?1:0)},[y]);const[M]=iP({sourceX:i,sourceY:o,targetX:s,targetY:a,sourcePosition:l,targetPosition:c}),E=(()=>{var e;if(!w||!p)return"#999";const t=w.data;if("parameter"===t.nodeType&&null!==(e=t.outputs)&&void 0!==e&&e[0]){return{float:"#84E4E7",vector2:"#9EE74D",vector3:"#F9E659",vector4:"#FB529F",bool:"#9B9B9B",texture2D:"#FF6E6E",matrix:"#8FC93F"}[t.outputs[0].type]||"#999"}const n=parseInt(p.split("-")[1]||"0");if(t.outputs&&t.outputs[n]){return{float:"#84E4E7",vector2:"#9EE74D",vector3:"#F9E659",vector4:"#FB529F",bool:"#9B9B9B",texture2D:"#FF6E6E",matrix:"#8FC93F"}[t.outputs[n].type]||"#999"}return"#999"})();(()=>{var e;if(!w||!p)return"";const t=w.data;if("parameter"===t.nodeType&&null!==(e=t.outputs)&&void 0!==e&&e[0])return t.outputs[0].type;const n=parseInt(p.split("-")[1]||"0");t.outputs&&t.outputs[n]&&t.outputs[n].type})();return(0,r.jsxs)(r.Fragment,{children:[g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:M,style:{stroke:"#0066ff",strokeWidth:16,fill:"none",opacity:.4,filter:"blur(8px)",pointerEvents:"none",animation:"edgeGlow 2s ease-in-out infinite"}}),(0,r.jsx)("path",{d:M,style:{stroke:"#0066ff",strokeWidth:8,fill:"none",opacity:.5,filter:"blur(3px)",pointerEvents:"none"}})]}),y&&!g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:M,style:{stroke:E,strokeWidth:12,fill:"none",opacity:.3,filter:"blur(6px)",pointerEvents:"none",animation:"edgeGlow 2s ease-in-out infinite"}}),(0,r.jsx)("path",{d:M,style:{stroke:E,strokeWidth:6,fill:"none",opacity:.4,filter:"blur(2px)",pointerEvents:"none"}})]}),(0,r.jsx)("path",{d:M,style:{stroke:"transparent",strokeWidth:20,fill:"none",cursor:"pointer",pointerEvents:"stroke"},onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1)}),(0,r.jsx)("path",{id:n,className:"react-flow__edge-path",d:M,style:{...u,stroke:g?"#0066ff":E,strokeWidth:g||y?3:2,transition:"stroke-width 0.2s ease, stroke 0.2s ease",cursor:"pointer",pointerEvents:"none"},markerEnd:d}),S&&(0,r.jsx)("path",{d:M,style:{stroke:g?"#0099ff":"#4488ff",strokeWidth:g?10:8,strokeDasharray:"10 5",fill:"none",opacity:g?.8:.6,pointerEvents:"none"},className:"differentiable-edge-overlay",children:(0,r.jsx)("animate",{attributeName:"stroke-dashoffset",values:"0;15",dur:g?"0.8s":"1s",repeatCount:"indefinite"})})]})},_R=e=>{let{isDarkTheme:n,onCreate:i,parameters:o,setParameters:s,onDeleteParameter:a,differentiableParams:l,setDifferentiableParams:c}=e;const[u,d]=(0,t.useState)(!1),[h,p]=(0,t.useState)(null),[f,m]=(0,t.useState)(""),[g,v]=(0,t.useState)(!1),[y,b]=(0,t.useState)(null),x=(0,t.useRef)(null),_=(0,t.useRef)(null),w=[{type:"float",label:"Float",defaultValue:0,color:aR.float},{type:"vector2",label:"Vector2",defaultValue:"(0, 0)",color:aR.vector2},{type:"vector3",label:"Vector3",defaultValue:"(0, 0, 0)",color:aR.vector3},{type:"vector4",label:"Vector4",defaultValue:"(0, 0, 0, 0)",color:aR.vector4},{type:"bool",label:"Boolean",defaultValue:!1,color:aR.bool}],S=()=>{if(h&&f.trim()){let e=f.trim();const t=o.some(t=>t.id!==h&&t.name===e);if(t){let t=1,n=`${e}_(${t})`;for(;o.some(e=>e.id!==h&&e.name===n);)t++,n=`${e}_(${t})`;e=n}s(o.map(t=>t.id===h?{...t,name:e}:t))}p(null),m("")};return(0,r.jsxs)("div",{style:{position:"absolute",left:"20px",top:"20px",bottom:"20px",width:"240px",maxHeight:"400px",background:n?"rgba(30, 30, 30, 0.95)":"rgba(245, 245, 245, 0.95)",border:"1px solid "+(n?"#333":"#ddd"),borderRadius:"8px",display:"flex",flexDirection:"column",zIndex:10,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",backdropFilter:"blur(10px)"},children:[(0,r.jsxs)("div",{style:{padding:"8px 12px",borderBottom:"1px solid "+(n?"#333":"#ddd"),borderRadius:"8px 8px 0 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("span",{style:{fontSize:"14px",fontWeight:"600",color:n?"#e0e0e0":"#333"},children:"Hyper Parameter Definition"}),(0,r.jsx)("button",{ref:_,onClick:()=>d(!u),style:{background:n?"#3a3a3a":"#e0e0e0",border:"none",borderRadius:"4px",padding:"4px 8px",color:n?"#e0e0e0":"#333",fontSize:"18px",cursor:"pointer",lineHeight:1},children:"+"})]}),u&&(0,r.jsx)("div",{style:{position:"absolute",top:"50px",right:"12px",background:n?"rgba(42, 42, 42, 0.98)":"rgba(255, 255, 255, 0.98)",border:"1px solid "+(n?"#444":"#ddd"),borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,overflow:"hidden",backdropFilter:"blur(10px)",minWidth:"160px"},children:(0,r.jsx)("div",{style:{padding:"4px"},children:w.map(e=>(0,r.jsxs)("div",{onClick:()=>(e=>{const t=w.find(t=>t.type===e);if(!t)return;const n=t.label.replace(" ",""),i=o.filter(e=>e.name.startsWith(`${n}_`)).map(e=>{const t=e.name.match(new RegExp(`^${n}_(\\d+)`));return t?parseInt(t[1],10):0}),r=i.length>0?Math.max(...i)+1:1,a={id:`param_${Date.now()}`,name:`${n}_${r}`,type:e,value:t.defaultValue,differentiable:!1};s([...o,a]),d(!1)})(e.type),style:{padding:"10px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",fontSize:"12px",color:n?"#e0e0e0":"#333",transition:"all 0.2s",borderRadius:"4px",margin:"2px"},onMouseEnter:e=>{e.currentTarget.style.background=n?"#3a3a3a":"#f0f0f0",e.currentTarget.style.transform="translateX(2px)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.transform="translateX(0)"},children:[(0,r.jsx)("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:e.color,border:"2px solid "+(n?"#1a1a1a":"#fff"),flexShrink:0}}),(0,r.jsx)("span",{style:{flex:1},children:e.label}),(0,r.jsx)("span",{style:{fontSize:"10px",color:n?"#666":"#999",textTransform:"uppercase"},children:e.type})]},e.type))})}),(0,r.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"12px"},children:0===o.length?(0,r.jsxs)("div",{style:{textAlign:"center",color:n?"#666":"#999",fontSize:"12px",padding:"20px"},children:["No parameters added yet.",(0,r.jsx)("br",{}),"Click + to add parameters."]}):o.map(e=>{const t=w.find(t=>t.type===e.type);return(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",gap:"8px"},children:(0,r.jsxs)("div",{onMouseDown:t=>((e,t)=>{if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const r=e.clientX,o=e.clientY;let s=!1;const a=e=>{const i=Math.abs(e.clientX-r),a=Math.abs(e.clientY-o);if(!s&&(i>5||a>5)){s=!0,v(!0),b(t);const i=document.createElement("div");i.className="parameter-drag-preview",i.style.cssText=`\n          position: fixed !important;\n          pointer-events: none !important;\n          z-index: 999999 !important;\n          visibility: hidden !important;\n          background: ${n?"#2a2a2a":"#ffffff"};\n          border: 1px solid ${n?"#444":"#ddd"};\n          border-radius: 8px;\n          padding: 6px 12px;\n          font-size: 12px;\n          color: ${n?"#e0e0e0":"#333333"};\n          box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          white-space: nowrap;\n        `;const r=aR[t.type]||"#999";i.innerHTML=`\n          <div style="width: 8px; height: 8px; background: ${r}; border-radius: 50%;"></div>\n          <span>${t.name}</span>\n        `,document.body.appendChild(i);const o=i.getBoundingClientRect(),a=o.width,l=o.height;i.style.left=e.clientX-a/2+"px",i.style.top=e.clientY-l/2+"px",i.style.visibility="visible",x.current=i}if(s&&x.current){const t=x.current.getBoundingClientRect();x.current.style.left=e.clientX-t.width/2+"px",x.current.style.top=e.clientY-t.height/2+"px"}},c=e=>{if(document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",c),x.current&&x.current.parentNode&&(x.current.parentNode.removeChild(x.current),x.current=null),!s)return v(!1),void b(null);const r=document.elementFromPoint(e.clientX,e.clientY),o=null===r||void 0===r?void 0:r.closest(".react-flow__pane, .react-flow__renderer");if(o){const r=o.closest(".react-flow");if(!r)return;const s=r.getBoundingClientRect(),a={x:e.clientX-s.left,y:e.clientY-s.top},c={label:t.name,nodeType:"parameter",parameterId:t.id,outputs:[{name:"Out",type:t.type}],isDarkTheme:n,isDifferentiable:l.has(t.id)};i(c,a)}v(!1),b(null)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",c)})(t,e),style:{background:n?"#1a1a1a":"#f8f8f8",border:"1px solid "+(g&&(null===y||void 0===y?void 0:y.id)===e.id?"#4a9eff":n?"#3a3a3a":"#e0e0e0"),borderRadius:"8px",padding:"8px 12px",cursor:g&&(null===y||void 0===y?void 0:y.id)===e.id?"grabbing":"grab",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s",opacity:g&&(null===y||void 0===y?void 0:y.id)===e.id?.5:1,flex:1},onMouseEnter:t=>{g&&(null===y||void 0===y?void 0:y.id)===e.id||(t.currentTarget.style.borderColor=n?"#4a4a4a":"#ccc",t.currentTarget.style.transform="translateX(2px)")},onMouseLeave:t=>{g&&(null===y||void 0===y?void 0:y.id)===e.id||(t.currentTarget.style.borderColor=n?"#3a3a3a":"#e0e0e0",t.currentTarget.style.transform="translateX(0)")},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",flex:1},children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{const t=o.find(t=>t.id===e);if(!t)return;const n=!t.differentiable;s(t=>t.map(t=>t.id===e?{...t,differentiable:n}:t)),c(t=>{const i=new Set(t);return n?i.add(e):i.delete(e),i})})(e.id)},onMouseDown:e=>e.stopPropagation(),style:{background:e.differentiable?"#4488ff":"transparent",border:"1px solid "+(e.differentiable?"#4488ff":n?"#4a4a4a":"#ccc"),borderRadius:"4px",padding:"2px 6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",color:e.differentiable?"#fff":n?"#aaa":"#666",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",flexShrink:0},title:"Toggle Partial Derivative",children:"\u2202"}),(0,r.jsx)("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:(null===t||void 0===t?void 0:t.color)||"#999",border:"2px solid "+(n?"#0a0a0a":"#fff"),flexShrink:0}}),h===e.id?(0,r.jsx)("input",{type:"text",value:f,onChange:e=>m(e.target.value),onBlur:S,onKeyDown:e=>{"Enter"===e.key&&S(),"Escape"===e.key&&(p(null),m(""))},style:{background:"transparent",border:"1px solid "+(n?"#4a4a4a":"#ccc"),borderRadius:"4px",padding:"2px 6px",fontSize:"12px",color:n?"#e0e0e0":"#333",outline:"none",flex:1},autoFocus:!0}):(0,r.jsx)("span",{onClick:()=>((e,t)=>{p(e),m(t)})(e.id,e.name),style:{fontSize:"12px",color:n?"#e0e0e0":"#333",flex:1,cursor:"text"},children:e.name}),(0,r.jsx)("span",{style:{fontSize:"10px",color:n?"#666":"#999",textTransform:"uppercase",letterSpacing:"0.5px",padding:"2px 6px",background:n?"#2a2a2a":"#f0f0f0",borderRadius:"4px"},children:e.type})]}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),a(e.id)},onMouseDown:e=>e.stopPropagation(),style:{background:"transparent",border:"none",color:n?"#666":"#999",fontSize:"14px",lineHeight:1,cursor:"pointer",padding:"0 4px",transition:"color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.color="#ff4444"},onMouseLeave:e=>{e.currentTarget.style.color=n?"#666":"#999"},children:"\xd7"})]})},e.id)})})]})},wR={category:"Organization",items:[{label:"Group",nodeType:"group"},{label:"Note",nodeType:"note",value:""},{label:"Object Group",nodeType:"objectGroup",filterBy:"name",filterValue:"",selectedComponents:["transform"]}]},SR=[{category:"Math",items:[{label:"Add",inputs:[{name:"A",type:"float"},{name:"B",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Subtract",inputs:[{name:"A",type:"float"},{name:"B",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Multiply",inputs:[{name:"A",type:"float"},{name:"B",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Divide",inputs:[{name:"A",type:"float"},{name:"B",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Power",inputs:[{name:"A",type:"float"},{name:"B",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Sqrt",inputs:[{name:"In",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Abs",inputs:[{name:"In",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Lerp",inputs:[{name:"A",type:"float"},{name:"B",type:"float"},{name:"T",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"},{label:"Clamp",inputs:[{name:"In",type:"float"},{name:"Min",type:"float"},{name:"Max",type:"float"}],outputs:[{name:"Out",type:"float"}],nodeType:"math"}]},{category:"Constants",items:[{label:"Float",value:0,outputs:[{name:"Out",type:"float"}],nodeType:"constant"},{label:"Vector2",value:"(0, 0)",outputs:[{name:"Out",type:"vector2"}],nodeType:"constant"},{label:"Vector3",value:"(0, 0, 0)",outputs:[{name:"Out",type:"vector3"}],nodeType:"constant"},{label:"Vector4",value:"(0, 0, 0, 0)",outputs:[{name:"Out",type:"vector4"}],nodeType:"constant"},{label:"Bool",value:!1,outputs:[{name:"Out",type:"bool"}],nodeType:"constant"}]},{category:"Organization",items:[{label:"Group",nodeType:"group"},{label:"Note",nodeType:"note",value:""},{label:"Object Group",nodeType:"objectGroup",filterBy:"name",filterValue:"",selectedComponents:["transform"]}]},{category:"Input",items:[{label:"Time",outputs:[{name:"Time",type:"float"},{name:"Sine",type:"float"},{name:"Cosine",type:"float"}],nodeType:"input"},{label:"UV",outputs:[{name:"UV",type:"vector2"}],nodeType:"input"},{label:"Position",outputs:[{name:"World",type:"vector3"},{name:"Object",type:"vector3"},{name:"View",type:"vector3"}],nodeType:"input"},{label:"Normal",outputs:[{name:"World",type:"vector3"},{name:"Object",type:"vector3"},{name:"View",type:"vector3"}],nodeType:"input"}]},{category:"Utility",items:[{label:"Split",inputs:[{name:"In",type:"vector3"}],outputs:[{name:"R",type:"float"},{name:"G",type:"float"},{name:"B",type:"float"}],nodeType:"utility"},{label:"Combine",inputs:[{name:"R",type:"float"},{name:"G",type:"float"},{name:"B",type:"float"}],outputs:[{name:"Out",type:"vector3"}],nodeType:"utility"},{label:"Swizzle",inputs:[{name:"In",type:"vector4"}],outputs:[{name:"Out",type:"vector4"}],nodeType:"utility"}]},{category:"Objects",items:[{label:"Object Group",nodeType:"objectGroup",filterBy:"name",filterValue:"",selectedComponents:["transform"]}]}],MR={Math:"\u2211","Math/Operators":"\xb1","Math/Functions":"\u0192","Math/Trigonometry":"\u2220","Math/Exponential":"e\u02e3",Constants:"#",Organization:"\u25a1",Input:"\u2192","Input/Constants":"#",Utility:"\u2699","Utility/Random":"?","Utility/Noise":"~","Utility/Time":"\u23f1",Objects:"\u25c8",Vector:"\u2192","Vector/Input":"\u27f6","Vector/Construction":"\u2295","Vector/Math":"\u2207",Logic:"\u22bb","Logic/Comparison":"\u2265","Logic/Boolean":"\u2227","Logic/Control":"\u22a2",Color:"\ud83c\udfa8","Color/Input":"\u25c9","Color/Operations":"\u25d0",Custom:"\u2726"},ER=e=>{let{x:n,y:i,onClose:o,onCreate:s,isDarkTheme:a}=e;const[l,c]=(0,t.useState)(""),[u,d]=(0,t.useState)("Math"),h=(0,t.useRef)(null),p=$_(e=>e.nodeDefinitions),f=t.useMemo(()=>{if(p.length>0){return p.some(e=>"Organization"===e.category)?p.map(e=>"Organization"===e.category?{...e,items:[...wR.items,...e.items]}:e):[...p,wR]}return SR},[p]),m=l?f.map(e=>({...e,items:e.items.filter(e=>e.label.toLowerCase().includes(l.toLowerCase()))})).filter(e=>e.items.length>0):f,g=l?m:m.filter(e=>e.category===u);return(0,t.useEffect)(()=>{var e;const t=null===(e=h.current)||void 0===e?void 0:e.querySelector("input");null===t||void 0===t||t.focus();const n=e=>{"Escape"===e.key&&o()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[o]),(0,r.jsxs)("div",{ref:h,style:{position:"absolute",top:i,left:n,background:a?"rgba(42, 42, 42, 0.98)":"rgba(255, 255, 255, 0.98)",border:"1px solid "+(a?"#444":"#ddd"),borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,width:"280px",maxHeight:"380px",display:"flex",flexDirection:"column",backdropFilter:"blur(10px)",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{style:{padding:"8px",borderBottom:"1px solid "+(a?"#3a3a3a":"#e0e0e0")},children:(0,r.jsx)("input",{type:"text",placeholder:"Search nodes...",value:l,onChange:e=>c(e.target.value),style:{width:"100%",padding:"6px 10px",background:a?"#1a1a1a":"#f5f5f5",border:"1px solid "+(a?"#3a3a3a":"#ddd"),borderRadius:"4px",color:a?"#fff":"#000",fontSize:"12px",outline:"none"}})}),!l&&(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",padding:"6px 6px 2px",gap:"3px",borderBottom:"1px solid "+(a?"#3a3a3a":"#e0e0e0")},children:f.map(e=>(0,r.jsxs)("button",{onClick:()=>d(e.category),style:{padding:"4px 8px",background:u===e.category?a?"#3a3a3a":"#e8e8e8":"transparent",border:"1px solid "+(u===e.category?a?"#4a4a4a":"#d0d0d0":"transparent"),borderRadius:"4px",color:u===e.category?a?"#fff":"#000":a?"#888":"#666",fontSize:"11px",fontWeight:u===e.category?"600":"400",cursor:"pointer",transition:"all 0.2s",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"3px",marginBottom:"2px"},onMouseEnter:t=>{u!==e.category&&(t.currentTarget.style.background=a?"#2a2a2a":"#f0f0f0",t.currentTarget.style.borderColor=a?"#3a3a3a":"#e0e0e0")},onMouseLeave:t=>{u!==e.category&&(t.currentTarget.style.background="transparent",t.currentTarget.style.borderColor="transparent")},children:[(0,r.jsx)("span",{style:{fontSize:"12px"},children:MR[e.category]||"\u2022"}),e.category]},e.category))}),(0,r.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"6px"},children:g.map(e=>(0,r.jsxs)("div",{children:[l&&(0,r.jsx)("div",{style:{fontSize:"10px",fontWeight:"600",padding:"4px 4px 2px",color:a?"#888":"#666",textTransform:"uppercase",letterSpacing:"0.5px",borderTop:g.indexOf(e)>0?"1px solid "+(a?"#3a3a3a":"#e0e0e0"):"none",marginTop:g.indexOf(e)>0?"4px":"0"},children:e.category}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"3px"},children:e.items.map(e=>{let t="#666";if(e.outputs&&e.outputs[0]){const n=e.outputs[0].type;t={float:"#84E4E7",vector2:"#9EE74D",vector3:"#F9E659",vector4:"#FB529F",bool:"#9B9B9B"}[n]||"#666"}else"group"===e.nodeType?t="#888":"note"===e.nodeType&&(t="#f4e842");return(0,r.jsxs)("div",{onClick:()=>{s(e),o()},style:{padding:"6px 8px",cursor:"pointer",borderRadius:"4px",background:a?"#1a1a1a":"#f8f8f8",border:"1px solid "+(a?"#3a3a3a":"#e0e0e0"),color:a?"#ffffff":"#000000",fontSize:"11px",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"6px"},onMouseEnter:e=>{e.currentTarget.style.background=a?"#2a2a2a":"#f0f0f0",e.currentTarget.style.borderColor=t,e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.background=a?"#1a1a1a":"#f8f8f8",e.currentTarget.style.borderColor=a?"#3a3a3a":"#e0e0e0",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[(0,r.jsx)("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:t,flexShrink:0}}),(0,r.jsx)("span",{style:{flex:1},children:e.label})]},e.label)})})]},e.category))}),(0,r.jsx)("div",{style:{padding:"4px 8px",borderTop:"1px solid "+(a?"#3a3a3a":"#e0e0e0"),fontSize:"10px",color:a?"#666":"#999",textAlign:"center"},children:"Right-click to create \u2022 Esc to close"})]})},CR=e=>{let{x:t,y:n,nodeId:i,onClose:o,onDelete:s,onDuplicate:a,isDarkTheme:l}=e;const c=[{label:"Duplicate",action:()=>a(i),icon:"\ud83d\udccb"},{label:"Delete",action:()=>s(i),icon:"\ud83d\uddd1\ufe0f",color:"#ff4444"}];return(0,r.jsx)("div",{style:{position:"absolute",top:n,left:t,background:l?"#2a2a2a":"#ffffff",border:"1px solid "+(l?"#444":"#ddd"),borderRadius:"8px",padding:"4px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3,minWidth:"150px"},onClick:e=>e.stopPropagation(),children:c.map(e=>(0,r.jsxs)("div",{onClick:()=>{e.action(),o()},style:{padding:"8px 12px",cursor:"pointer",borderRadius:"4px",color:e.color||(l?"#ffffff":"#000000"),fontSize:"12px",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>{e.currentTarget.style.background=l?"#3a3a3a":"#f0f0f0"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:[(0,r.jsx)("span",{children:e.icon}),(0,r.jsx)("span",{children:e.label})]},e.label))})},TR=e=>{let{code:t,isDarkTheme:n=!0}=e;const i=(e=>{const t={keyword:n?"#569cd6":"#0000ff",builtin:n?"#dcdcaa":"#795da3",string:n?"#ce9178":"#a31515",number:n?"#b5cea8":"#098658",function:n?"#dcdcaa":"#795da3",decorator:n?"#c586c0":"#a71d5d",default:n?"#d4d4d4":"#333333"};let i=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");const r=[];[{regex:/\b(def|return|import|from|if|else|elif|for|while|in|and|or|not|is|None|True|False|class|try|except|finally|with|as|pass|break|continue|lambda|yield|global|nonlocal|assert|del|raise)\b/g,className:"keyword"},{regex:/\b(print|len|range|enumerate|zip|map|filter|sorted|reversed|abs|sum|min|max|round|int|float|str|bool|list|dict|set|tuple|type|isinstance|hasattr|getattr|setattr|open|file|input|eval|exec)\b/g,className:"builtin"},{regex:/"""[\s\S]*?"""|'''[\s\S]*?'''/g,className:"string"},{regex:/"(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*'/g,className:"string"},{regex:/\b\d+\.?\d*([eE][+-]?\d+)?\b/g,className:"number"},{regex:/\b([a-zA-Z_]\w*)\s*(?=\()/g,className:"function"},{regex:/@\w+/g,className:"decorator"}].forEach(n=>{let i,{regex:o,className:s}=n;for(;null!==(i=o.exec(e));){const e=i.index,n=e+i[0].length,o=`<span style="color: ${t[s]}">${i[0].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</span>`;r.push({start:e,end:n,text:o})}}),r.sort((e,t)=>t.start-e.start);let o=i;const s=[];return r.forEach(e=>{let{start:t,end:n,text:i}=e;const r=s.some(e=>{let[i,r]=e;return t>=i&&t<r||n>i&&n<=r||t<i&&n>r});if(!r){const e=o.substring(0,t),r=o.substring(n);o.substring(t,n);o=e+i+r,s.push([t,n])}}),o})(t);return(0,r.jsx)("pre",{style:{margin:0,padding:0,fontSize:"13px",lineHeight:"1.6",fontFamily:'"JetBrains Mono", "Fira Code", "SF Mono", Monaco, "Courier New", monospace',color:n?"#d4d4d4":"#333333",whiteSpace:"pre",wordBreak:"normal",overflowWrap:"normal",tabSize:4,userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",msUserSelect:"text",cursor:"text"},onMouseDown:e=>{e.stopPropagation()},dangerouslySetInnerHTML:{__html:i}})},AR={shader:lR,group:cR,note:uR,object:(0,t.memo)(yR),objectGroup:(0,t.memo)(bR)},PR={default:xR},DR=e=>{let{isDarkTheme:n}=e;const i=(0,t.useRef)(null),o=$_(),{nodes:s,edges:a,parameters:l,differentiableParams:c,setNodes:u,setEdges:d,setParameters:h,setDifferentiableParams:p,hasReceivedInitialState:f}=o;t.useEffect(()=>{J_.getState().isConnected||0!==s.length||f||o.setInitialStateFromBackend({})},[s.length,f]);const[m,g]=(0,t.useState)(null),[v,y]=(0,t.useState)(null),[b,x]=(0,t.useState)(null),[_,w]=(0,t.useState)(!1),[S,M]=(0,t.useState)(""),[E,C]=(0,t.useState)(null),[T,A]=(0,t.useState)(!1),P=(0,t.useRef)(null),D=t.useMemo(()=>s.map(e=>({...e,data:{...e.data,isDarkTheme:n}})),[]),[k,R,N]=Vk(D),[I,L,O]=Hk(a),z=t.useRef(!1),U=t.useRef(null),F=t.useRef(!1),j=(0,t.useCallback)(e=>{e.some(e=>"position"===e.type&&(!0===e.dragging||void 0!==e.position));e.some(e=>"position"===e.type&&!0===e.dragging)&&(F.current=!0);const t=e.some(e=>"position"===e.type&&!1===e.dragging);if(t&&(F.current=!1),N(e),!z.current&&!o.isSyncing&&!F.current){U.current&&clearTimeout(U.current);const e=t?100:300;U.current=setTimeout(()=>{R(e=>(u(e),e)),U.current=null},e)}},[N,R,u,o.isSyncing]),B=(0,t.useCallback)(e=>{O(e),z.current||o.isSyncing||(U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{L(e=>(d(e),e)),U.current=null},300))},[O,L,d,o.isSyncing]);t.useEffect(()=>{if(o.isSyncing&&!F.current){if(z.current=!0,s!==k){const e=s.map(e=>({...e,data:{...e.data,isDarkTheme:n}}));R(e)}a!==I&&L(a),setTimeout(()=>{z.current=!1},100)}},[o.isSyncing,s,a,n]),t.useEffect(()=>{R(e=>e.map(e=>({...e,data:{...e.data,isDarkTheme:n}})))},[n]);const V=(0,t.useCallback)(e=>{const t=k.find(t=>t.id===e.source),n=k.find(t=>t.id===e.target);if(!t||!n)return!1;const i=(e,t,n)=>{if(!e)return null;if(e.includes("-")&&("object"===t.type||"objectGroup"===t.type)){const n=e.split("-");if(n.length>=3){const e=n[1],i=n.slice(2).join("-");if(t.data.components){const n=t.data.components.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(n&&n.fields){const e=n.fields.find(e=>e.name===i);if(e){let t=e.type;return"bool"===t&&(t="boolean"),t}}}}}const i=parseInt(e.split("-")[1]||"0");var r,o,s,a;return n?null===(r=t.data.outputs)||void 0===r||null===(o=r[i])||void 0===o?void 0:o.type:null===(s=t.data.inputs)||void 0===s||null===(a=s[i])||void 0===a?void 0:a.type},r=i(e.sourceHandle,t,!0),o=i(e.targetHandle,n,!1);var s;if(!r||!o)return console.warn("Could not determine port types:",{sourceHandle:e.sourceHandle,targetHandle:e.targetHandle,sourceType:r,targetType:o,sourceNode:null===t||void 0===t?void 0:t.type,targetNode:null===n||void 0===n?void 0:n.type,targetNodeData:null===n||void 0===n?void 0:n.data,targetComponents:null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.components}),!1;const a=e=>"bool"===e?"boolean":e,l=a(r),c=a(o);return l===c||("float"===l&&("vector2"===c||"vector3"===c||"vector4"===c)||("vector2"===l&&("vector3"===c||"vector4"===c)||"vector3"===l&&"vector4"===c))},[k,I]),H=(0,t.useCallback)(e=>{X.current=!0;const t=k.find(t=>t.id===e.source),n=k.find(t=>t.id===e.target);if(t&&n){const n=(e,t,n)=>{if(!e)return"float";if(e.includes("-")&&("object"===t.type||"objectGroup"===t.type)){const n=e.split("-");if(n.length>=3){const e=n[1],i=n.slice(2).join("-");if(t.data.components){const n=t.data.components.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(n&&n.fields){const e=n.fields.find(e=>e.name===i);if(e)return"bool"===e.type?"boolean":e.type}}}}const i=parseInt(e.split("-")[1]||"0");var r,o,s,a;return n?(null===(r=t.data.outputs)||void 0===r||null===(o=r[i])||void 0===o?void 0:o.type)||"float":(null===(s=t.data.inputs)||void 0===s||null===(a=s[i])||void 0===a?void 0:a.type)||"float"},i=n(e.sourceHandle,t,!0),r=aR[i]||aR.float||"#999";L(t=>{let n=t;e.target&&e.targetHandle&&(n=t.filter(t=>!(t.target===e.target&&t.targetHandle===e.targetHandle)));const i=cP({...e,animated:!0,style:{stroke:r,strokeWidth:2}},n);return o.isSyncing||setTimeout(()=>d(i),0),i})}else L(t=>{let n=t;e.target&&e.targetHandle&&(n=t.filter(t=>!(t.target===e.target&&t.targetHandle===e.targetHandle)));const i=cP(e,n);return o.isSyncing||setTimeout(()=>d(i),0),i})},[L,k,d,o.isSyncing]),G=((0,t.useCallback)(()=>{u(k),d(I),console.log("Node editor saved")},[k,I,u,d]),(0,t.useCallback)(async()=>{u(k),d(I),console.log("Node editor saved and compiling..."),A(!0),w(!0);const e=e=>{A(!1),e.success?M(e.code):M(`# Compilation Error\n# ${e.error}\n\n${e.trace||""}`)};I_.on("node_graph_compiled",e),I_.compileNodeGraph(k,I),setTimeout(()=>{I_.off("node_graph_compiled",e)},1e4)},[k,I,u,d])),W=(0,t.useCallback)(()=>{if(w(e=>!e),!_&&!S){A(!0);const e=e=>{A(!1),e.success?M(e.code):M(`# Compilation Error\n# ${e.error}\n\n${e.trace||""}`)};I_.on("node_graph_compiled",e),I_.compileNodeGraph(k,I),setTimeout(()=>{I_.off("node_graph_compiled",e)},1e4)}},[_,S,k,I]),X=(0,t.useRef)(!1),Y=(0,t.useCallback)((e,t)=>{X.current=!1,C({nodeId:t.nodeId,handleId:t.handleId,handleType:t.handleType})},[]),$=(0,t.useCallback)(e=>{setTimeout(()=>{if(!X.current){if(!e.target.closest(".react-flow__handle")&&m&&E){var t;const n=null===(t=i.current)||void 0===t?void 0:t.getBoundingClientRect();if(n){const t={x:e.clientX-n.left,y:e.clientY-n.top};y(t),x(null)}}}C(null)},50)},[m,E]),q=(0,t.useCallback)(e=>{var t;e.preventDefault();const n=null===(t=i.current)||void 0===t?void 0:t.getBoundingClientRect();n&&m&&(y({x:e.clientX-n.left,y:e.clientY-n.top}),x(null))},[m]),Z=(0,t.useCallback)((e,t)=>{var n;e.preventDefault(),e.stopPropagation();const r=null===(n=i.current)||void 0===n?void 0:n.getBoundingClientRect();r&&(x({x:e.clientX-r.left,y:e.clientY-r.top,nodeId:t.id}),y(null))},[]),K=(0,t.useCallback)(()=>{y(null),x(null)},[]),J=(0,t.useCallback)((e,t)=>{F.current=!0},[]),Q=(0,t.useCallback)((e,t)=>{F.current=!1,o.isSyncing||(U.current&&clearTimeout(U.current),setTimeout(()=>{R(e=>(u(e),e))},50));const n=k.filter(e=>e.selected||e.id===t.id),i=k.filter(e=>"group"===e.type);R(e=>{let t=[...e];for(const o of n){const e=t.find(e=>e.id===o.id);if(!e)continue;let n=e.position.x,a=e.position.y;const l=e.parentNode;if(l){const t=i.find(e=>e.id===l);t&&(n=t.position.x+e.position.x,a=t.position.y+e.position.y)}let c=!1;for(const o of i){var r,s;if(o.id===e.id)continue;const i={x:o.position.x,y:o.position.y,width:"number"===typeof(null===(r=o.style)||void 0===r?void 0:r.width)?o.style.width:400,height:"number"===typeof(null===(s=o.style)||void 0===s?void 0:s.height)?o.style.height:300},l=n+(e.width||200)/2,u=a+(e.height||60)/2;if(l>=i.x&&l<=i.x+i.width&&u>=i.y&&u<=i.y+i.height){c=!0,t=t.map(t=>t.id===e.id?{...t,parentNode:o.id,extent:void 0,position:{x:n-o.position.x,y:a-o.position.y}}:t);break}}!c&&l&&(t=t.map(t=>t.id===e.id?{...t,parentNode:void 0,extent:void 0,position:{x:n,y:a}}:t))}return o.isSyncing||setTimeout(()=>u(t),0),t})},[k,R,u,o.isSyncing]),ee=(0,t.useCallback)((e,t)=>{if(!m)return;let i;if(t){const e=m.project(t);i={x:e.x-100,y:e.y-30}}else i=v?m.project({x:v.x,y:v.y}):{x:400,y:200};const r="group"===e.nodeType?"group":"note"===e.nodeType?"note":"object"===e.nodeType?"object":"objectGroup"===e.nodeType?"objectGroup":"shader",s={id:`node_${Date.now()}`,type:r,position:i,data:{...e,isDarkTheme:n},..."group"===e.nodeType?{style:{width:400,height:300},dragHandle:".group-header",zIndex:-1}:"note"===e.nodeType?{style:{width:250,height:150}}:"object"===e.nodeType?{style:{width:280,height:"auto"}}:"objectGroup"===e.nodeType?{style:{width:320,height:"auto"}}:{}};R(e=>{const t=[...e,s];return o.isSyncing||setTimeout(()=>u(t),0),t}),E&&E.nodeId&&setTimeout(()=>{var t,n;const i={source:"source"===E.handleType?E.nodeId:s.id,target:"source"===E.handleType?s.id:E.nodeId,sourceHandle:"source"===E.handleType?E.handleId:null!==(t=e.outputs)&&void 0!==t&&t[0]?"output-0":null,targetHandle:"source"===E.handleType?null!==(n=e.inputs)&&void 0!==n&&n[0]?"input-0":null:E.handleId};i.source&&i.target&&H(i),C(null)},0)},[m,v,n,R,u,o.isSyncing,E,H]),te=(0,t.useCallback)(e=>{R(t=>{const n=t.filter(t=>t.id!==e);return o.isSyncing||setTimeout(()=>u(n),0),n}),L(t=>{const n=t.filter(t=>t.source!==e&&t.target!==e);return o.isSyncing||setTimeout(()=>d(n),0),n})},[R,L,u,d,o.isSyncing]),ne=(0,t.useCallback)(e=>{const t=k.find(t=>t.id===e);if(!t)return;const n={...t,id:`node_${Date.now()}`,position:{x:t.position.x+50,y:t.position.y+50}};R(e=>{const t=[...e,n];return o.isSyncing||setTimeout(()=>u(t),0),t})},[k,R,u,o.isSyncing]),ie=(0,t.useCallback)(e=>{h(t=>t.filter(t=>t.id!==e)),R(t=>t.filter(t=>t.data.parameterId!==e));const t=k.filter(t=>t.data.parameterId===e).map(e=>e.id);L(e=>e.filter(e=>!t.includes(e.source)&&!t.includes(e.target)))},[k,R,L,h]);(0,t.useEffect)(()=>{R(e=>e.map(e=>{if(e.data.parameterId){const i=l.find(t=>t.id===e.data.parameterId);if(i){var t,n;const r=c.has(i.id);if(e.data.label!==i.name||r&&!(null!==(t=e.className)&&void 0!==t&&t.includes("differentiable-source"))||!r&&(null===(n=e.className)||void 0===n?void 0:n.includes("differentiable-source")))return{...e,data:{...e.data,label:i.name,isDifferentiable:r},className:r?"differentiable-source":""}}}return e}))},[l,c,R]),(0,t.useEffect)(()=>{const e=new Set(k.filter(e=>e.data.parameterId&&c.has(e.data.parameterId)).map(e=>e.id)),t=new Set,n=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;i.has(e)||(i.add(e),I.forEach(r=>{r.source===e&&(t.add(r.id),n(r.target,i))}))};e.forEach(e=>n(e)),L(e=>e.map(e=>{var n,i;const r=t.has(e.id);return{...e,type:"default",data:{...e.data,isDifferentiable:r},animated:!1,style:{stroke:(null===(n=e.style)||void 0===n?void 0:n.stroke)||"#999",strokeWidth:(null===(i=e.style)||void 0===i?void 0:i.strokeWidth)||2,...e.style}}}))},[c,k,I.length,L]),(0,t.useEffect)(()=>{const e=e=>{if("Delete"===e.key||"Backspace"===e.key){const e=k.filter(e=>e.selected);e.forEach(e=>te(e.id));I.filter(e=>e.selected).length>0&&L(e=>{const t=e.filter(e=>!e.selected);return o.isSyncing||setTimeout(()=>d(t),0),t})}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[k,I,te,L,d,o.isSyncing]),(0,t.useEffect)(()=>{const e=e=>{const t=e,{nodeData:n,position:i}=t.detail;console.log("[NodeEditor] Received createNodeFromHierarchy event:",n,i),ee(n,i)};return window.addEventListener("createNodeFromHierarchy",e),()=>{window.removeEventListener("createNodeFromHierarchy",e)}},[ee]),(0,t.useEffect)(()=>{const e=P.current;if(!e)return;const t=e=>{e.stopPropagation()};return e.addEventListener("wheel",t,{passive:!1}),()=>{e.removeEventListener("wheel",t)}},[_]);const re=(0,t.useCallback)(e=>{const t=Array.from(e.dataTransfer.types);(t.includes("application/reactflow")||t.includes("text/plain")||t.includes("text"))&&!t.includes("dockview")&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},[]),oe=(0,t.useCallback)(e=>{const t=Array.from(e.dataTransfer.types);(t.includes("application/reactflow")||t.includes("text/plain")||t.includes("text"))&&!t.includes("dockview")&&e.preventDefault()},[]),se=(0,t.useCallback)(e=>{var t;const n=null===(t=i.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;let r=e.dataTransfer.getData("application/reactflow");if(r||(r=e.dataTransfer.getData("text/plain")),r||(r=e.dataTransfer.getData("text")),r){e.preventDefault(),e.stopPropagation();try{const t=JSON.parse(r);if(!m)return;let i;i=m.screenToFlowPosition?m.screenToFlowPosition({x:e.clientX,y:e.clientY}):m.project({x:e.clientX-n.left,y:e.clientY-n.top}),ee(t,i)}catch(Pb){console.error("Failed to parse node data:",Pb)}}},[m,ee]);return t.useEffect(()=>{const e=()=>{F.current&&(F.current=!1)};return window.addEventListener("mouseup",e),()=>{window.removeEventListener("mouseup",e)}},[]),(0,r.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)("div",{style:{height:"40px",background:n?"#2a2a2a":"#f0f0f0",borderBottom:"1px solid "+(n?"#3a3a3a":"#e0e0e0"),display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 12px",flexShrink:0},children:[(0,r.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,r.jsxs)("button",{onClick:G,disabled:T,style:{padding:"6px 12px",background:n?"#3a3a3a":"#ffffff",border:"1px solid "+(n?"#4a4a4a":"#d0d0d0"),borderRadius:"4px",color:n?"#e0e0e0":"#333",cursor:T?"wait":"pointer",fontSize:"13px",fontWeight:500,display:"flex",alignItems:"center",gap:"6px",opacity:T?.7:1},onMouseEnter:e=>{T||(e.currentTarget.style.background=n?"#4a4a4a":"#f8f8f8")},onMouseLeave:e=>{T||(e.currentTarget.style.background=n?"#3a3a3a":"#ffffff")},title:"Save and compile the node graph (Ctrl+S)",children:[(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,r.jsx)("path",{d:"M2 1a1 1 0 00-1 1v12a1 1 0 001 1h12a1 1 0 001-1V4.414a1 1 0 00-.293-.707l-2.414-2.414A1 1 0 0011.586 1H2zm1 1h8v3.5A1.5 1.5 0 019.5 7h-5A1.5 1.5 0 013 5.5V2zm7 0h1.586L13 3.414V4h-3V2zM3 9h10v5H3V9z"})}),T?"Compiling...":"Save & Compile"]})}),(0,r.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,r.jsxs)("button",{onClick:W,style:{padding:"6px 12px",background:_?n?"#4a9eff":"#0066cc":n?"#3a3a3a":"#ffffff",border:"1px solid "+(_?n?"#5aaeff":"#0077dd":n?"#4a4a4a":"#d0d0d0"),borderRadius:"4px",color:_?"#ffffff":n?"#e0e0e0":"#333",cursor:"pointer",fontSize:"13px",fontWeight:500,display:"flex",alignItems:"center",gap:"6px"},onMouseEnter:e=>{_||(e.currentTarget.style.background=n?"#4a4a4a":"#f8f8f8")},onMouseLeave:e=>{_||(e.currentTarget.style.background=n?"#3a3a3a":"#ffffff")},title:_?"Hide code panel":"Show code panel",children:[(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8 2a.5.5 0 01.5.5v11a.5.5 0 01-1 0v-11A.5.5 0 018 2zM3 8a.5.5 0 01.5-.5h3a.5.5 0 010 1h-3A.5.5 0 013 8zm6.5-.5a.5.5 0 000 1h3a.5.5 0 000-1h-3z"})}),"Code"]})})]}),(0,r.jsxs)("div",{style:{flex:1,display:"flex",position:"relative"},children:[(0,r.jsxs)("div",{ref:i,style:{flex:_?"1 1 60%":"1",background:n?"#1a1a1a":"#f5f5f5",position:"relative"},children:[(0,r.jsxs)(Fk,{nodes:[...k].sort((e,t)=>"group"===e.type&&"group"!==t.type?-1:"group"!==e.type&&"group"===t.type?1:0),edges:I,onNodesChange:j,onEdgesChange:B,onConnect:H,onConnectStart:Y,onConnectEnd:$,isValidConnection:V,onInit:e=>{g(e)},nodeTypes:AR,edgeTypes:PR,onPaneClick:K,onPaneContextMenu:q,onNodeContextMenu:Z,onNodeDragStart:J,onNodeDragStop:Q,onDrop:se,onDragOver:re,onDragEnter:oe,fitView:!1,selectionOnDrag:!0,panOnDrag:[1,2],panOnScroll:!1,selectionMode:BA.Partial,selectNodesOnDrag:!0,attributionPosition:"bottom-left",proOptions:{hideAttribution:!0},deleteKeyCode:"Delete",children:[(0,r.jsx)(Kk,{variant:Gk.Dots,gap:20,size:1,color:n?"#333":"#ccc"}),(0,r.jsx)(sR,{position:"top-right",style:{top:"0px",right:"0px",background:n?"#2a2a2a":"#ffffff",border:"1px solid "+(n?"#3a3a3a":"#e0e0e0"),borderRadius:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",display:"flex",flexDirection:"row"},showZoom:!0,showFitView:!0,showInteractive:!0})]}),(0,r.jsx)(_R,{isDarkTheme:n,onCreate:ee,parameters:l,setParameters:h,onDeleteParameter:ie,differentiableParams:c,setDifferentiableParams:p})]}),(0,r.jsx)("div",{className:"code-panel-container",style:{flex:_?"0 0 40%":"0 0 0",borderLeft:_?"1px solid "+(n?"#3a3a3a":"#e0e0e0"):"none",background:n?"#1e1e1e":"#ffffff",display:"flex",flexDirection:"column",minWidth:_?"300px":"0",maxWidth:_?"600px":"0",overflow:"hidden",transition:"flex 0.3s cubic-bezier(0.4, 0, 0.2, 1), min-width 0.3s cubic-bezier(0.4, 0, 0.2, 1), max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1), border 0.3s ease"},onMouseDown:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),onScroll:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),onPointerMove:e=>e.stopPropagation(),children:_&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{padding:"12px 16px",borderBottom:"1px solid "+(n?"#3a3a3a":"#e0e0e0"),background:n?"#252525":"#f8f8f8",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,r.jsx)("h3",{style:{margin:0,fontSize:"14px",fontWeight:600,color:n?"#e0e0e0":"#333"},children:"Compiled Python Code"})}),(0,r.jsx)("div",{ref:P,className:"code-panel-content "+(n?"dark":""),style:{flex:1,padding:"16px",overflowY:"auto",overflowX:"auto",background:n?"#1e1e1e":"#ffffff",position:"relative"},onMouseDown:e=>{e.stopPropagation()},onWheel:e=>{e.stopPropagation()},onScroll:e=>{e.stopPropagation()},children:S?(0,r.jsx)("div",{className:"code-highlight",style:{userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",msUserSelect:"text",cursor:"text",pointerEvents:"auto"},onMouseDown:e=>{e.stopPropagation()},children:(0,r.jsx)(TR,{code:S,isDarkTheme:n})}):(0,r.jsx)("div",{style:{color:n?"#888":"#999",fontStyle:"italic",fontSize:"13px",fontFamily:'"JetBrains Mono", "Fira Code", "SF Mono", Monaco, "Courier New", monospace'},children:T?"Compiling...":'Click "Save & Compile" to compile the node graph'})})]})})]}),v&&(0,r.jsx)(ER,{x:v.x,y:v.y,onClose:()=>y(null),onCreate:ee,isDarkTheme:n}),b&&(0,r.jsx)(CR,{x:b.x,y:b.y,nodeId:b.nodeId,onClose:()=>x(null),onDelete:te,onDuplicate:ne,isDarkTheme:n})]})},kR=e=>(0,r.jsx)(kk,{children:(0,r.jsx)(DR,{...e})}),RR=e=>{let{node:t,level:n,selectedObjectId:i,expandedNodes:o,onToggleExpand:s,onSelectObject:a,onDoubleClickObject:l,onToggleVisibility:c,onMouseDown:u,draggedNode:d,dragOverNode:h,isDragging:p,getObjectIcon:f}=e;const{objects:m}=z_(),g=t.children&&t.children.length>0,v=o.has(t.id),y=d===t.id,b=h===t.id,x=m[t.id];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"hierarchy-row",children:[(0,r.jsx)("button",{className:"visibility-toggle "+(t.visible?"":"hidden"),onClick:e=>c(e,t.id),title:t.visible?"Hide":"Show",children:t.visible?(0,r.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,r.jsx)("circle",{cx:"12",cy:"12",r:"3"})]}):(0,r.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),(0,r.jsx)("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})}),(0,r.jsxs)("div",{className:`hierarchy-item ${i===t.id?"selected":""} ${y&&p?"dragging":""} ${b?"drag-over":""}`,style:{paddingLeft:16*n+8+"px",cursor:p?"grabbing":"grab"},onClick:()=>!p&&a(t.id),onDoubleClick:()=>!p&&l(t.id),onMouseDown:e=>u(e,t.id),"data-node-id":t.id,children:[g&&(0,r.jsx)("button",{className:"expand-toggle "+(v?"expanded":""),onClick:e=>{e.stopPropagation(),s(t.id)},children:"\u25b6"}),!g&&(0,r.jsx)("span",{className:"expand-spacer"}),(0,r.jsx)("span",{className:"hierarchy-icon",children:f((null===x||void 0===x?void 0:x.mesh)||"")}),(0,r.jsx)("span",{className:"hierarchy-name",children:t.name})]})]}),g&&v&&(0,r.jsx)("div",{className:"hierarchy-children",children:t.children.map(e=>(0,r.jsx)(RR,{node:e,level:n+1,selectedObjectId:i,expandedNodes:o,onToggleExpand:s,onSelectObject:a,onDoubleClickObject:l,onToggleVisibility:c,onMouseDown:u,draggedNode:d,dragOverNode:h,isDragging:p,getObjectIcon:f},e.id))})]})},NR=()=>{const{objects:e,selectedObjectId:n,selectObject:i,toggleObjectVisibility:o,getObjectHierarchy:s,deleteSelectedObjects:a}=z_(),{isConnected:l}=J_(),[c,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)(new Set),[p,f]=(0,t.useState)(null),[m,g]=(0,t.useState)(null),[v,y]=(0,t.useState)(!1),[b,x]=(0,t.useState)(!1),[_,w]=(0,t.useState)(null),[S,M]=(0,t.useState)({x:0,y:0}),[E,C]=(0,t.useState)(""),T=(0,t.useRef)(null),A=((0,t.useRef)(null),(0,t.useRef)(!1)),P=e=>{i(e)},D=t=>{const n=e[t];n&&window.dispatchEvent(new CustomEvent("focusObject",{detail:{position:n.transform.position}}))},k=(e,t)=>{e.stopPropagation(),o(t)},R=e=>{switch(e){case"Transmitter":case"Receiver":case"Radar":return"";default:return"\u2ffb"}};(0,t.useEffect)(()=>{const e=e=>{T.current&&!T.current.contains(e.target)&&u(!1)};return c&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[c]),(0,t.useEffect)(()=>{const e=e=>{"Escape"===e.key&&b&&(console.log("[Drag] Cancelled by Escape key"),x(!1),f(null),w(null),g(null),y(!1))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),x(!1),f(null),w(null),g(null),y(!1)}},[b]);const N=t=>{if(!l){const e=document.createElement("div");return e.style.cssText="\n        position: fixed;\n        top: 120px;\n        left: 50%;\n        transform: translateX(-50%);\n        background-color: #ff4444;\n        color: white;\n        padding: 12px 16px;\n        border-radius: 6px;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 10000;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n        animation: slideDown 0.3s ease-out;\n      ",e.textContent="Cannot create object: Please connect to server first",document.body.appendChild(e),void setTimeout(()=>{e.parentNode&&e.remove()},3e3)}u(!1);const n=[0,0,0];let r={id:`${t}-${Date.now()}`,visible:!0,transform:{position:n,rotation:[0,0,0],scale:[1,1,1]}};switch(t){case"cube":r={...r,name:`Cube ${Object.values(e).filter(e=>e.name.startsWith("Cube")).length+1}`,mesh:"Cube",type:"mesh",material:{color:"#808080",metalness:.5,roughness:.5,permittivity:1}};break;case"sphere":r={...r,name:`Sphere ${Object.values(e).filter(e=>e.name.startsWith("Sphere")).length+1}`,mesh:"Sphere",type:"mesh",material:{color:"#808080",metalness:.5,roughness:.5,permittivity:1}};break;case"transmitter":r={...r,name:`Transmitter ${Object.values(e).filter(e=>e.name.startsWith("Transmitter")).length+1}`,mesh:"Transmitter",type:"transmitter",material:{color:"#0080ff",metalness:0,roughness:1,permittivity:1}};break;case"receiver":r={...r,name:`Receiver ${Object.values(e).filter(e=>e.name.startsWith("Receiver")).length+1}`,mesh:"Receiver",type:"receiver",material:{color:"#ffff00",metalness:0,roughness:1,permittivity:1}};break;case"radar":r={...r,name:`Radar ${Object.values(e).filter(e=>e.name.startsWith("Radar")).length+1}`,mesh:"Radar",type:"radar"}}I_.createObject(r),setTimeout(()=>i(r.id),100)},I=e=>{h(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},L=(t,n)=>{if(0!==t.button)return;if(A.current)return;t.preventDefault(),t.stopPropagation();const i=t.clientX,r=t.clientY;let o=!1,s=null;const a=t=>{const a=Math.abs(t.clientX-i),l=Math.abs(t.clientY-r);if(!o&&(a>5||l>5)){o=!0,x(!0),f(n),M({x:t.clientX,y:t.clientY}),console.log("[Drag] Started dragging:",n);const i=e[n];i&&(s=document.createElement("div"),s.className="hierarchy-drag-preview",s.style.cssText=`\n            position: fixed !important;\n            pointer-events: none !important;\n            z-index: 999999 !important;\n            left: ${t.clientX+15}px !important;\n            top: ${t.clientY-15}px !important;\n          `,s.innerHTML=`\n            <span class="hierarchy-icon">${R(i.mesh||"")}</span>\n            <span>${i.name}</span>\n          `,document.body.appendChild(s),console.log("[Drag] Created preview element:",s,"for",i.name))}if(o){M({x:t.clientX,y:t.clientY}),s&&(s.style.left=`${t.clientX+15}px`,s.style.top=t.clientY-15+"px");const e=document.elementFromPoint(t.clientX,t.clientY),i=null===e||void 0===e?void 0:e.closest(".hierarchy-item");if(i){const e=i.getAttribute("data-node-id");e&&e!==m&&e!==n&&(g(e),y(!1))}else null!==e&&void 0!==e&&e.closest(".hierarchy-content")?(g(null),y(!0)):(g(null),y(!1))}},l=t=>{if(document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),s&&s.parentNode&&s.parentNode.removeChild(s),!o)return void console.log("[Click] Node clicked:",n);console.log("[Drag] Mouse up - finishing drag"),A.current=!0;const i=document.elementFromPoint(t.clientX,t.clientY),r=null===i||void 0===i?void 0:i.closest(".react-flow__pane, .react-flow__renderer");if(r){console.log("[Drop] Dropping onto Node Editor:",n);const i=r.closest(".react-flow");if(!i)return console.log("[Drop] Could not find React Flow wrapper"),x(!1),f(null),w(null),g(null),y(!1),void setTimeout(()=>{A.current=!1},100);const o=i.getBoundingClientRect(),s={x:t.clientX-o.left,y:t.clientY-o.top},a=e[n];if(a){const e=mR(a),t={nodeType:"object",objectId:n,objectName:a.name||"Object",objectType:a.mesh||"Custom",components:e},i=new CustomEvent("createNodeFromHierarchy",{detail:{nodeData:t,position:s}});window.dispatchEvent(i)}return x(!1),f(null),w(null),g(null),y(!1),void setTimeout(()=>{A.current=!1},100)}const c=null===i||void 0===i?void 0:i.closest(".hierarchy-item");if(c){const t=c.getAttribute("data-node-id");if(t&&t!==n){console.log("[Drop] Dropping",n,"onto",t);const i=(t,n)=>{const r=e[t];return!(!r||!r.parent_id)&&(r.parent_id===n||i(r.parent_id,n))};if(i(t,n))console.log("[Drop] Cancelled - would create circular reference");else{var u;const i=(null===(u=e[n])||void 0===u?void 0:u.parent_id)||null,r=L_.getState();r.isUndoing||r.isRedoing||r.pushAction({type:"update_parent",objectId:n,oldParentId:i,newParentId:t,oldTransform:null,newTransform:null}),I_.updateParent(n,t)}}}else if(null!==i&&void 0!==i&&i.closest(".hierarchy-content")){var d;console.log("[Drop] Dropping",n,"to root");const t=(null===(d=e[n])||void 0===d?void 0:d.parent_id)||null,i=L_.getState();i.isUndoing||i.isRedoing||null===t||i.pushAction({type:"update_parent",objectId:n,oldParentId:t,newParentId:null,oldTransform:null,newTransform:null}),I_.updateParent(n,null)}x(!1),f(null),w(null),g(null),y(!1),setTimeout(()=>{A.current=!1},100)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)},O=s(),z=((e,t)=>{if(!t)return e;const n=t.toLowerCase(),i=e=>{const t=e.name.toLowerCase().includes(n),r=e.children?e.children.map(i).filter(Boolean):[];return t||r.length>0?(r.length>0&&!t&&h(t=>{const n=new Set(t);return n.add(e.id),n}),{...e,children:r}):null};return e.map(i).filter(Boolean)})(O,E);p&&e[p]&&e[p].name;return(0,r.jsx)("div",{className:"panel hierarchy-panel "+(b?"dragging":""),children:(0,r.jsxs)("div",{className:"hierarchy-content-wrapper",children:[(0,r.jsxs)("div",{className:"hierarchy-toolbar",children:[(0,r.jsx)("input",{type:"text",className:"hierarchy-search",placeholder:"Search objects...",value:E,onChange:e=>C(e.target.value)}),(0,r.jsx)("div",{className:"hierarchy-actions",children:(0,r.jsxs)("div",{className:"add-button-container",ref:T,children:[(0,r.jsx)("button",{className:"hierarchy-action-btn",onClick:()=>u(!c),disabled:!l,title:"Add new object",children:"+"}),c&&(0,r.jsxs)("div",{className:"add-menu-dropdown",children:[(0,r.jsxs)("button",{className:"add-menu-item",onClick:()=>N("cube"),children:[(0,r.jsx)("span",{className:"menu-icon",children:"\u25c6"})," Cube"]}),(0,r.jsxs)("button",{className:"add-menu-item",onClick:()=>N("sphere"),children:[(0,r.jsx)("span",{className:"menu-icon",children:"\u25cf"})," Sphere"]}),(0,r.jsx)("div",{className:"add-menu-separator"}),(0,r.jsx)("button",{className:"add-menu-item",onClick:()=>N("transmitter"),children:"Transmitter"}),(0,r.jsx)("button",{className:"add-menu-item",onClick:()=>N("receiver"),children:"Receiver"}),(0,r.jsx)("button",{className:"add-menu-item",onClick:()=>N("radar"),children:"Radar"})]})]})})]}),(0,r.jsxs)("div",{className:"hierarchy-content "+(v?"drag-over":""),style:{cursor:b?"grabbing":"default"},onClick:e=>{e.target===e.currentTarget&&i(null)},children:[z.map(e=>(0,r.jsx)(RR,{node:e,level:0,selectedObjectId:n,expandedNodes:d,onToggleExpand:I,onSelectObject:P,onDoubleClickObject:D,onToggleVisibility:k,onMouseDown:L,draggedNode:p,dragOverNode:m,isDragging:b,getObjectIcon:R},e.id)),0===O.length&&(0,r.jsx)("div",{className:"hierarchy-empty",children:"No objects in scene"}),O.length>0&&0===z.length&&(0,r.jsxs)("div",{className:"hierarchy-empty",children:['No objects match "',E,'"']})]})]})})},IR=e=>{let{value:n,onChange:i,onDragStart:o,onDragEnd:s,onFinish:a,min:l=-1/0,max:c=1/0,step:u=.1,label:d,precision:h=2,suffix:p=""}=e;const[f,m]=(0,t.useState)(!1),[g,v]=(0,t.useState)(!1),[y,b]=(0,t.useState)(n.toFixed(h)),x=(0,t.useRef)(null),_=(0,t.useRef)(null),w=(0,t.useRef)(0),S=(0,t.useRef)(0),M=(0,t.useRef)(0);(0,t.useEffect)(()=>{f||b(n.toFixed(h))},[n,h,f]);return(0,r.jsxs)("div",{className:"draggable-number-input",children:[d&&(0,r.jsx)("span",{className:"input-label",children:d}),(0,r.jsxs)("div",{ref:_,className:`input-container ${g?"dragging":""} ${f?"editing":""}`,onMouseDown:e=>{if(f)return;e.preventDefault(),v(!0),w.current=e.clientX,S.current=n,M.current=n,document.body.style.cursor="ew-resize",null===o||void 0===o||o();const t=e=>{const t=e.clientX-w.current,n=e.shiftKey?.01:.1,r=S.current+t*u*n,o=Math.max(l,Math.min(c,r));M.current=o,i(o)},r=()=>{v(!1),document.body.style.cursor="",document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",r),null===s||void 0===s||s(),null===a||void 0===a||a(M.current)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",r)},onDoubleClick:()=>{m(!0),setTimeout(()=>{var e;null===(e=x.current)||void 0===e||e.select()},0)},children:[(0,r.jsx)("input",{ref:x,type:"text",value:y,onChange:e=>{b(e.target.value)},onBlur:()=>{const e=parseFloat(y);if(isNaN(e))b(n.toFixed(h));else{const t=Math.max(l,Math.min(c,e));t!==n&&(null===o||void 0===o||o(),i(t),setTimeout(()=>{null===s||void 0===s||s(),null===a||void 0===a||a(t)},0))}m(!1)},onKeyDown:e=>{var t;"Enter"===e.key?null===(t=x.current)||void 0===t||t.blur():"Escape"===e.key&&(b(n.toFixed(h)),m(!1))},disabled:!f,className:"number-input"}),p&&(0,r.jsx)("span",{className:"input-suffix",children:p}),!f&&(0,r.jsx)("div",{className:"drag-overlay"})]})]})},LR=e=>{let{selectedObjectId:n}=e;const{objects:i,updateObjectTransform:o}=z_(),{isConnected:s}=J_(),a=L_(),l=n?i[n]:null,[c,u]=(0,t.useState)(!0),d=(0,t.useRef)(!1),h=(0,t.useRef)(null),[p,f]=(0,t.useState)({position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}});(0,t.useEffect)(()=>{l&&f({position:{x:l.transform.position.x,y:l.transform.position.y,z:l.transform.position.z},rotation:{x:l.transform.rotation.x*(180/Math.PI),y:l.transform.rotation.y*(180/Math.PI),z:l.transform.rotation.z*(180/Math.PI)},scale:{x:l.transform.scale.x,y:l.transform.scale.y,z:l.transform.scale.z}})},[l]);const m=()=>{d.current=!0,l&&(h.current={position:l.transform.position.toArray(),rotation:l.transform.rotation.toArray(),scale:l.transform.scale.toArray()})},g=()=>{if(d.current&&n&&h.current&&l){const e={position:l.transform.position.toArray(),rotation:l.transform.rotation.toArray(),scale:l.transform.scale.toArray()};!(JSON.stringify(h.current.position)!==JSON.stringify(e.position)||JSON.stringify(h.current.rotation)!==JSON.stringify(e.rotation)||JSON.stringify(h.current.scale)!==JSON.stringify(e.scale))||a.isUndoing||a.isRedoing||a.pushAction({type:"update_transform",objectId:n,oldTransform:h.current,newTransform:e})}d.current=!1,h.current=null},v=(e,t)=>i=>((e,t,i)=>{if(n&&s){const r={...p};r[e]={...r[e],[t]:i},I_.updateTransform(n,{position:new Rs(r.position.x,r.position.y,r.position.z),rotation:new ya(r.rotation.x*Math.PI/180,r.rotation.y*Math.PI/180,r.rotation.z*Math.PI/180),scale:new Rs(r.scale.x,r.scale.y,r.scale.z)})}})(e,t,i),y=(e,t,i)=>{const r=i;if(f(n=>({...n,[e]:{...n[e],[t]:r}})),n)if("position"===e){const e=new Rs("x"===t?r:p.position.x,"y"===t?r:p.position.y,"z"===t?r:p.position.z);o(n,{position:e})}else if("rotation"===e){const e=new ya("x"===t?r*(Math.PI/180):p.rotation.x*(Math.PI/180),"y"===t?r*(Math.PI/180):p.rotation.y*(Math.PI/180),"z"===t?r*(Math.PI/180):p.rotation.z*(Math.PI/180),"YXZ");o(n,{rotation:e})}else if("scale"===e){const e=new Rs("x"===t?r:p.scale.x,"y"===t?r:p.scale.y,"z"===t?r:p.scale.z);o(n,{scale:e})}};return l?(0,r.jsxs)("div",{className:"property-section",children:[(0,r.jsxs)("div",{className:"property-section-header",onClick:()=>u(!c),children:[(0,r.jsx)("span",{className:"property-section-toggle "+(c?"expanded":""),children:"\u25b6"}),(0,r.jsx)("span",{className:"property-section-title",children:"Transform"})]}),c&&(0,r.jsxs)("div",{className:"property-section-content",children:[(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Position"}),(0,r.jsxs)("div",{className:"vector-input",children:[(0,r.jsx)(IR,{label:"X",value:p.position.x,onChange:e=>y("position","x",e),onDragStart:m,onDragEnd:g,onFinish:v("position","x"),step:.1,precision:2}),(0,r.jsx)(IR,{label:"Y",value:p.position.y,onChange:e=>y("position","y",e),onDragStart:m,onDragEnd:g,onFinish:v("position","y"),step:.1,precision:2}),(0,r.jsx)(IR,{label:"Z",value:p.position.z,onChange:e=>y("position","z",e),onDragStart:m,onDragEnd:g,onFinish:v("position","z"),step:.1,precision:2})]})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Quaternion"}),(0,r.jsxs)("div",{className:"quaternion-input",style:{pointerEvents:"none",opacity:.7},children:[(0,r.jsxs)("div",{className:"quaternion-value",children:[(0,r.jsx)("label",{children:"X"}),(0,r.jsx)("input",{type:"text",value:(new ks).setFromEuler(new ya(p.rotation.x*(Math.PI/180),p.rotation.y*(Math.PI/180),p.rotation.z*(Math.PI/180),"YXZ")).x.toFixed(3),readOnly:!0,className:"readonly-input"})]}),(0,r.jsxs)("div",{className:"quaternion-value",children:[(0,r.jsx)("label",{children:"Y"}),(0,r.jsx)("input",{type:"text",value:(new ks).setFromEuler(new ya(p.rotation.x*(Math.PI/180),p.rotation.y*(Math.PI/180),p.rotation.z*(Math.PI/180),"YXZ")).y.toFixed(3),readOnly:!0,className:"readonly-input"})]}),(0,r.jsxs)("div",{className:"quaternion-value",children:[(0,r.jsx)("label",{children:"Z"}),(0,r.jsx)("input",{type:"text",value:(new ks).setFromEuler(new ya(p.rotation.x*(Math.PI/180),p.rotation.y*(Math.PI/180),p.rotation.z*(Math.PI/180),"YXZ")).z.toFixed(3),readOnly:!0,className:"readonly-input"})]}),(0,r.jsxs)("div",{className:"quaternion-value",children:[(0,r.jsx)("label",{children:"W"}),(0,r.jsx)("input",{type:"text",value:(new ks).setFromEuler(new ya(p.rotation.x*(Math.PI/180),p.rotation.y*(Math.PI/180),p.rotation.z*(Math.PI/180),"YXZ")).w.toFixed(3),readOnly:!0,className:"readonly-input"})]})]})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Rotation"}),(0,r.jsxs)("div",{className:"vector-input",children:[(0,r.jsx)(IR,{label:"X",value:p.rotation.x,onChange:e=>y("rotation","x",e),onDragStart:m,onDragEnd:g,onFinish:v("rotation","x"),step:1,precision:1,suffix:"\xb0"}),(0,r.jsx)(IR,{label:"Y",value:p.rotation.y,onChange:e=>y("rotation","y",e),onDragStart:m,onDragEnd:g,onFinish:v("rotation","y"),step:1,precision:1,suffix:"\xb0"}),(0,r.jsx)(IR,{label:"Z",value:p.rotation.z,onChange:e=>y("rotation","z",e),onDragStart:m,onDragEnd:g,onFinish:v("rotation","z"),step:1,precision:1,suffix:"\xb0"})]})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Scale"}),(0,r.jsxs)("div",{className:"vector-input",children:[(0,r.jsx)(IR,{label:"X",value:p.scale.x,onChange:e=>y("scale","x",e),onDragStart:m,onDragEnd:g,onFinish:v("scale","x"),step:.1,precision:2,min:.01}),(0,r.jsx)(IR,{label:"Y",value:p.scale.y,onChange:e=>y("scale","y",e),onDragStart:m,onDragEnd:g,onFinish:v("scale","y"),step:.1,precision:2,min:.01}),(0,r.jsx)(IR,{label:"Z",value:p.scale.z,onChange:e=>y("scale","z",e),onDragStart:m,onDragEnd:g,onFinish:v("scale","z"),step:.1,precision:2,min:.01})]})]})]})]}):null};function OR(){return(OR=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function zR(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t.indexOf(n=o[i])>=0||(r[n]=e[n]);return r}function UR(e){var n=(0,t.useRef)(e),i=(0,t.useRef)(function(e){n.current&&n.current(e)});return n.current=e,i.current}var FR=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e<t?t:e},jR=function(e){return"touches"in e},BR=function(e){return e&&e.ownerDocument.defaultView||self},VR=function(e,t,n){var i=e.getBoundingClientRect(),r=jR(t)?function(e,t){for(var n=0;n<e.length;n++)if(e[n].identifier===t)return e[n];return e[0]}(t.touches,n):t;return{left:FR((r.pageX-(i.left+BR(e).pageXOffset))/i.width),top:FR((r.pageY-(i.top+BR(e).pageYOffset))/i.height)}},HR=function(e){!jR(e)&&e.preventDefault()},GR=t.memo(function(e){var n=e.onMove,i=e.onKey,r=zR(e,["onMove","onKey"]),o=(0,t.useRef)(null),s=UR(n),a=UR(i),l=(0,t.useRef)(null),c=(0,t.useRef)(!1),u=(0,t.useMemo)(function(){var e=function(e){HR(e),(jR(e)?e.touches.length>0:e.buttons>0)&&o.current?s(VR(o.current,e,l.current)):n(!1)},t=function(){return n(!1)};function n(n){var i=c.current,r=BR(o.current),s=n?r.addEventListener:r.removeEventListener;s(i?"touchmove":"mousemove",e),s(i?"touchend":"mouseup",t)}return[function(e){var t=e.nativeEvent,i=o.current;if(i&&(HR(t),!function(e,t){return t&&!jR(e)}(t,c.current)&&i)){if(jR(t)){c.current=!0;var r=t.changedTouches||[];r.length&&(l.current=r[0].identifier)}i.focus(),s(VR(i,t,l.current)),n(!0)}},function(e){var t=e.which||e.keyCode;t<37||t>40||(e.preventDefault(),a({left:39===t?.05:37===t?-.05:0,top:40===t?.05:38===t?-.05:0}))},n]},[a,s]),d=u[0],h=u[1],p=u[2];return(0,t.useEffect)(function(){return p},[p]),t.createElement("div",OR({},r,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:o,onKeyDown:h,tabIndex:0,role:"slider"}))}),WR=function(e){return e.filter(Boolean).join(" ")},XR=function(e){var n=e.color,i=e.left,r=e.top,o=void 0===r?.5:r,s=WR(["react-colorful__pointer",e.className]);return t.createElement("div",{className:s,style:{top:100*o+"%",left:100*i+"%"}},t.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:n}}))},YR=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n},$R=(Math.PI,function(e){return nN(qR(e))}),qR=function(e){return"#"===e[0]&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?YR(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:8===e.length?YR(parseInt(e.substring(6,8),16)/255,2):1}},ZR=function(e){return tN(QR(e))},KR=function(e){var t=e.s,n=e.v,i=e.a,r=(200-t)*n/100;return{h:YR(e.h),s:YR(r>0&&r<200?t*n/100/(r<=100?r:200-r)*100:0),l:YR(r/2),a:YR(i,2)}},JR=function(e){var t=KR(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},QR=function(e){var t=e.h,n=e.s,i=e.v,r=e.a;t=t/360*6,n/=100,i/=100;var o=Math.floor(t),s=i*(1-n),a=i*(1-(t-o)*n),l=i*(1-(1-t+o)*n),c=o%6;return{r:YR(255*[i,a,s,s,l,i][c]),g:YR(255*[l,i,i,a,s,s][c]),b:YR(255*[s,s,l,i,i,a][c]),a:YR(r,2)}},eN=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},tN=function(e){var t=e.r,n=e.g,i=e.b,r=e.a,o=r<1?eN(YR(255*r)):"";return"#"+eN(t)+eN(n)+eN(i)+o},nN=function(e){var t=e.r,n=e.g,i=e.b,r=e.a,o=Math.max(t,n,i),s=o-Math.min(t,n,i),a=s?o===t?(n-i)/s:o===n?2+(i-t)/s:4+(t-n)/s:0;return{h:YR(60*(a<0?a+6:a)),s:YR(o?s/o*100:0),v:YR(o/255*100),a:r}},iN=t.memo(function(e){var n=e.hue,i=e.onChange,r=WR(["react-colorful__hue",e.className]);return t.createElement("div",{className:r},t.createElement(GR,{onMove:function(e){i({h:360*e.left})},onKey:function(e){i({h:FR(n+360*e.left,0,360)})},"aria-label":"Hue","aria-valuenow":YR(n),"aria-valuemax":"360","aria-valuemin":"0"},t.createElement(XR,{className:"react-colorful__hue-pointer",left:n/360,color:JR({h:n,s:100,v:100,a:1})})))}),rN=t.memo(function(e){var n=e.hsva,i=e.onChange,r={backgroundColor:JR({h:n.h,s:100,v:100,a:1})};return t.createElement("div",{className:"react-colorful__saturation",style:r},t.createElement(GR,{onMove:function(e){i({s:100*e.left,v:100-100*e.top})},onKey:function(e){i({s:FR(n.s+100*e.left,0,100),v:FR(n.v-100*e.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+YR(n.s)+"%, Brightness "+YR(n.v)+"%"},t.createElement(XR,{className:"react-colorful__saturation-pointer",top:1-n.v/100,left:n.s/100,color:JR(n)})))}),oN=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0},sN=function(e,t){return e.toLowerCase()===t.toLowerCase()||oN(qR(e),qR(t))};function aN(e,n,i){var r=UR(i),o=(0,t.useState)(function(){return e.toHsva(n)}),s=o[0],a=o[1],l=(0,t.useRef)({color:n,hsva:s});(0,t.useEffect)(function(){if(!e.equal(n,l.current.color)){var t=e.toHsva(n);l.current={hsva:t,color:n},a(t)}},[n,e]),(0,t.useEffect)(function(){var t;oN(s,l.current.hsva)||e.equal(t=e.fromHsva(s),l.current.color)||(l.current={hsva:s,color:t},r(t))},[s,e,r]);var c=(0,t.useCallback)(function(e){a(function(t){return Object.assign({},t,e)})},[]);return[s,c]}var lN,cN="undefined"!=typeof window?t.useLayoutEffect:t.useEffect,uN=new Map,dN=function(e){cN(function(){var t=e.current?e.current.ownerDocument:document;if(void 0!==t&&!uN.has(t)){var i=t.createElement("style");i.innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}',uN.set(t,i);var r=lN||n.nc;r&&i.setAttribute("nonce",r),t.head.appendChild(i)}},[])},hN=function(e){var n=e.className,i=e.colorModel,r=e.color,o=void 0===r?i.defaultColor:r,s=e.onChange,a=zR(e,["className","colorModel","color","onChange"]),l=(0,t.useRef)(null);dN(l);var c=aN(i,o,s),u=c[0],d=c[1],h=WR(["react-colorful",n]);return t.createElement("div",OR({},a,{ref:l,className:h}),t.createElement(rN,{hsva:u,onChange:d}),t.createElement(iN,{hue:u.h,onChange:d,className:"react-colorful__last-control"}))},pN={defaultColor:"000",toHsva:$R,fromHsva:function(e){return ZR({h:e.h,s:e.s,v:e.v,a:1})},equal:sN},fN=function(e){return t.createElement(hN,OR({},e,{colorModel:pN}))},mN=/^#?([0-9A-F]{3,8})$/i,gN=function(e){var n=e.color,i=void 0===n?"":n,r=e.onChange,o=e.onBlur,s=e.escape,a=e.validate,l=e.format,c=e.process,u=zR(e,["color","onChange","onBlur","escape","validate","format","process"]),d=(0,t.useState)(function(){return s(i)}),h=d[0],p=d[1],f=UR(r),m=UR(o),g=(0,t.useCallback)(function(e){var t=s(e.target.value);p(t),a(t)&&f(c?c(t):t)},[s,c,a,f]),v=(0,t.useCallback)(function(e){a(e.target.value)||p(s(i)),m(e)},[i,s,a,m]);return(0,t.useEffect)(function(){p(s(i))},[i,s]),t.createElement("input",OR({},u,{value:l?l(h):h,spellCheck:"false",onChange:g,onBlur:v}))},vN=function(e){return"#"+e},yN=function(e){var n=e.prefixed,i=e.alpha,r=zR(e,["prefixed","alpha"]),o=(0,t.useCallback)(function(e){return e.replace(/([^0-9A-F]+)/gi,"").substring(0,i?8:6)},[i]),s=(0,t.useCallback)(function(e){return function(e,t){var n=mN.exec(e),i=n?n[1].length:0;return 3===i||6===i||!!t&&4===i||!!t&&8===i}(e,i)},[i]);return t.createElement(gN,OR({},r,{escape:o,format:n?vN:void 0,process:vN,validate:s}))};const bN=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:128,g:128,b:128}},xN=e=>{let{value:n,onChange:i,onChangeStart:o,onChangeEnd:s,label:a}=e;const[l,c]=(0,t.useState)(!1),[u,d]=(0,t.useState)(n||"#808080"),[h,p]=(0,t.useState)(()=>bN(n||"#808080")),[f,m]=(0,t.useState)({top:0,left:0}),g=(0,t.useRef)(null),v=(0,t.useRef)(null);(0,t.useEffect)(()=>{!l&&n&&(d(n),p(bN(n)))},[n,l]),(0,t.useEffect)(()=>{p(bN(u))},[u]),(0,t.useEffect)(()=>{if(l&&g.current){const e=g.current.getBoundingClientRect(),t=380,n=250;let i=e.bottom+8,r=e.left;i+t>window.innerHeight&&(i=e.top-t-8),r+n>window.innerWidth&&(r=window.innerWidth-n-16),m({top:i,left:r})}},[l]),(0,t.useEffect)(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&g.current&&!g.current.contains(e.target)&&x()},t=e=>{"Escape"===e.key&&l&&x()};return l&&(document.addEventListener("mousedown",e),document.addEventListener("keydown",t)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[l]);const y=e=>{d(e)},b=(e,t)=>{const n=parseInt(t,10);if(isNaN(n))return;const i=Math.max(0,Math.min(255,n)),r={...h,[e]:i};p(r);const o=((e,t,n)=>{const i=e=>{const t=Math.max(0,Math.min(255,Math.round(e))).toString(16);return 1===t.length?"0"+t:t};return`#${i(e)}${i(t)}${i(n)}`})(r.r,r.g,r.b);d(o)},x=()=>{d(n||"#808080"),p(bN(n||"#808080")),c(!1)},_=(e=>/^#[0-9A-F]{6}$/i.test(e))(n)?n:"#808080";return(0,r.jsxs)("div",{className:"color-picker-container",children:[a&&(0,r.jsx)("span",{className:"color-picker-label",children:a}),(0,r.jsxs)("div",{className:"color-picker-wrapper",children:[(0,r.jsxs)("div",{ref:g,className:"color-picker-button",onClick:()=>{l?c(!1):(d(n||"#808080"),p(bN(n||"#808080")),o&&(console.log("[ColorPicker] Opening picker, calling onChangeStart"),o()),c(!0))},children:[(0,r.jsx)("div",{className:"color-preview",style:{backgroundColor:_}}),(0,r.jsx)("span",{className:"color-value",children:_})]}),l&&(0,Lt.createPortal)((0,r.jsx)("div",{className:"color-picker-overlay",style:{top:f.top,left:f.left},ref:v,children:(0,r.jsxs)("div",{className:"color-picker-content",children:[(0,r.jsx)(fN,{color:u,onChange:y}),(0,r.jsxs)("div",{className:"color-picker-inputs",children:[(0,r.jsxs)("div",{className:"color-picker-hex-input",children:[(0,r.jsx)("label",{children:"Hex:"}),(0,r.jsx)(yN,{color:u,onChange:y,prefixed:!0})]}),(0,r.jsxs)("div",{className:"color-picker-rgb-inputs",children:[(0,r.jsxs)("div",{className:"rgb-input-group",children:[(0,r.jsx)("label",{children:"R:"}),(0,r.jsx)("input",{type:"number",min:"0",max:"255",value:h.r,onChange:e=>b("r",e.target.value)})]}),(0,r.jsxs)("div",{className:"rgb-input-group",children:[(0,r.jsx)("label",{children:"G:"}),(0,r.jsx)("input",{type:"number",min:"0",max:"255",value:h.g,onChange:e=>b("g",e.target.value)})]}),(0,r.jsxs)("div",{className:"rgb-input-group",children:[(0,r.jsx)("label",{children:"B:"}),(0,r.jsx)("input",{type:"number",min:"0",max:"255",value:h.b,onChange:e=>b("b",e.target.value)})]})]})]}),(0,r.jsx)("div",{className:"color-picker-preview-row",children:(0,r.jsxs)("div",{className:"color-preview-comparison",children:[(0,r.jsx)("div",{className:"color-preview-old",style:{backgroundColor:_},title:"Current"}),(0,r.jsx)("div",{className:"color-preview-arrow",children:"\u2192"}),(0,r.jsx)("div",{className:"color-preview-new",style:{backgroundColor:u},title:"New"})]})}),(0,r.jsxs)("div",{className:"color-picker-actions",children:[(0,r.jsx)("button",{className:"color-picker-btn color-picker-cancel",onClick:x,children:"Cancel"}),(0,r.jsx)("button",{className:"color-picker-btn color-picker-confirm",onClick:()=>{console.log("[ColorPicker] Confirm clicked, applying color:",u),console.log("[ColorPicker] Calling onChange with:",u),i(u),c(!1)},children:"Apply"})]})]})}),document.body)]})]})},_N=e=>{let{component:n,onFieldChange:i,onFieldChangeStart:o,onFieldChangeEnd:s,onRemoveComponent:a,onButtonClick:l,isExpanded:c=!0}=e;const[u,d]=(0,t.useState)(c),[h,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)({x:0,y:0}),g=(0,t.useRef)(null);(0,t.useEffect)(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&p(!1)};return h&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[h]);const v=e=>{const t=t=>{i(n.name,e.name,t)},a=()=>{o&&o(n.name,e.name)},l=()=>{s&&s(n.name,e.name)},c=t=>{s&&s(n.name,e.name,t)};switch(e.type){case"color":return(0,r.jsx)(xN,{value:"string"===typeof e.value?e.value:"#808080",onChange:e=>{t(e),c(e)},onChangeStart:a});case"boolean":return(0,r.jsx)("input",{type:"checkbox",checked:e.value||!1,onChange:e=>{const n=e.target.checked;t(n),c(n)},className:"checkbox-input"});case"string":default:return(0,r.jsx)("input",{type:"text",value:e.value||"",onChange:e=>t(e.target.value),onBlur:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:"text-input"});case"float":return void 0!==e.min&&void 0!==e.max?(0,r.jsxs)("div",{className:"material-input-group",children:[(0,r.jsx)("input",{type:"range",min:e.min,max:e.max,step:e.step||.01,value:e.value||0,onChange:e=>t(parseFloat(e.target.value)),onMouseDown:a,onMouseUp:l,onTouchStart:a,onTouchEnd:l,className:"slider-input"}),(0,r.jsx)("span",{className:"slider-value",children:"number"===typeof e.value?e.value.toFixed(2):"0.00"})]}):(0,r.jsx)(IR,{label:"",value:e.value||0,onChange:t,onDragStart:a,onDragEnd:l,onFinish:c,step:e.step||.1,precision:2,min:e.min,max:e.max});case"vector2":const n=Array.isArray(e.value)?e.value:[0,0];return(0,r.jsxs)("div",{className:"vector-input",children:[(0,r.jsx)(IR,{label:"X",value:n[0]||0,onChange:e=>t([e,n[1]]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2}),(0,r.jsx)(IR,{label:"Y",value:n[1]||0,onChange:e=>t([n[0],e]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2})]});case"vector3":const i=Array.isArray(e.value)?e.value:[0,0,0];return(0,r.jsxs)("div",{className:"vector-input",children:[(0,r.jsx)(IR,{label:"X",value:i[0]||0,onChange:e=>t([e,i[1],i[2]]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2}),(0,r.jsx)(IR,{label:"Y",value:i[1]||0,onChange:e=>t([i[0],e,i[2]]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2}),(0,r.jsx)(IR,{label:"Z",value:i[2]||0,onChange:e=>t([i[0],i[1],e]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2})]});case"vector4":const o=Array.isArray(e.value)?e.value:[0,0,0,0];return(0,r.jsxs)("div",{className:"quaternion-input",children:[(0,r.jsx)(IR,{label:"X",value:o[0]||0,onChange:e=>t([e,o[1],o[2],o[3]]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2}),(0,r.jsx)(IR,{label:"Y",value:o[1]||0,onChange:e=>t([o[0],e,o[2],o[3]]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2}),(0,r.jsx)(IR,{label:"Z",value:o[2]||0,onChange:e=>t([o[0],o[1],e,o[3]]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2}),(0,r.jsx)(IR,{label:"W",value:o[3]||0,onChange:e=>t([o[0],o[1],o[2],e]),onDragStart:a,onDragEnd:l,step:e.step||.1,precision:2})]})}};return"transform"===n.name||"Transform"===n.name?null:(0,r.jsxs)("div",{className:"property-section",children:[(0,r.jsxs)("div",{className:"property-section-header",onClick:()=>d(!u),onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),m({x:e.clientX,y:e.clientY}),p(!0)},children:[(0,r.jsx)("span",{className:"property-section-toggle "+(u?"expanded":""),children:"\u25b6"}),(0,r.jsx)("span",{className:"property-section-title",children:n.displayName})]}),u&&(0,r.jsxs)("div",{className:"property-section-content",children:[n.fields.map(e=>(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:e.displayName}),v(e)]},e.name)),n.buttons&&n.buttons.length>0&&(0,r.jsx)("div",{className:"component-buttons",children:n.buttons.map(e=>(0,r.jsxs)("button",{className:"component-button",title:e.description,onClick:()=>l&&l(n.name,e.name),children:[e.icon&&(0,r.jsx)("span",{className:"button-icon",children:e.icon}),e.displayName||e.display_name]},e.name))})]}),h&&Lt.createPortal((0,r.jsxs)("div",{ref:g,className:"component-context-menu",style:{position:"fixed",left:f.x,top:f.y,zIndex:1e4},onMouseDown:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"context-menu-item disabled",children:"Copy"}),(0,r.jsx)("div",{className:"context-menu-item disabled",children:"Paste"}),(0,r.jsx)("div",{className:"context-menu-divider"}),(0,r.jsx)("div",{className:"context-menu-item",onClick:()=>{a&&a(n.name),p(!1)},children:"Remove"})]}),document.body)]})},wN=()=>{var e;const{selectedObjectId:n,objects:i,updateObjectMaterial:o}=z_(),{isConnected:s}=J_(),a=n?i[n]:null,l=L_(),[c,u]=(0,t.useState)([]),[d,h]=(0,t.useState)({}),[p,f]=(0,t.useState)(!1),[m,g]=(0,t.useState)([]),[v,y]=(0,t.useState)(""),[b,x]=(0,t.useState)(0),[_,w]=((0,t.useRef)({}),(0,t.useState)(!1)),[S,M]=(0,t.useState)(""),[E,C]=(0,t.useState)(""),T=(0,t.useRef)(null),A=(0,t.useRef)(null),P=t.useCallback(()=>{if(n&&a){if(a.components&&Array.isArray(a.components)){const e=[];a.components.forEach(t=>{if("Transform"===t.name||"transform"===t.name)return;const n={name:t.name,displayName:t.display_name||t.name,fields:[],buttons:t.buttons||[]};t.fields&&Array.isArray(t.fields)?n.fields=t.fields.map(e=>{var n,i,r,o,s;return{name:e.name,displayName:e.display_name||e.name,type:e.field_type||e.type||"string",value:null!==(n=null!==(i=null===(r=t.values)||void 0===r?void 0:r[e.name])&&void 0!==i?i:e.default_value)&&void 0!==n?n:e.value,min:null!==(o=e.min_value)&&void 0!==o?o:e.min,max:null!==(s=e.max_value)&&void 0!==s?s:e.max,step:e.step}}):t.values&&Object.entries(t.values).forEach(e=>{let[t,i]=e,r="string";"boolean"===typeof i?r="boolean":"number"===typeof i?r="float":Array.isArray(i)?2===i.length?r="vector2":3===i.length?r="vector3":4===i.length&&(r="vector4"):"string"===typeof i&&i.startsWith("#")&&(r="color"),n.fields.push({name:t,displayName:t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:r,value:i})}),n.fields.length>0&&e.push(n)}),u(e)}}else u([])},[n,a]);(0,t.useEffect)(()=>{P(),a&&C(a.tag||"")},[n]),(0,t.useEffect)(()=>{if(null!==a&&void 0!==a&&a.components){const e=new Set(a.components.map(e=>e.name)),t=new Set(c.map(e=>e.name)),n=Array.from(e).some(e=>!t.has(e)),i=Array.from(t).some(t=>!e.has(t));(n||i)&&P()}},[null===a||void 0===a||null===(e=a.components)||void 0===e?void 0:e.length,P]),(0,t.useEffect)(()=>{a&&void 0!==a.tag&&C(a.tag)},[null===a||void 0===a?void 0:a.tag]),(0,t.useEffect)(()=>{null!==a&&void 0!==a&&a.components&&c.length>0&&u(e=>{const t=e.map(e=>{var t;const n=null===(t=a.components)||void 0===t?void 0:t.find(t=>t.name===e.name);if(n&&n.values){let t=!1;const i=e.fields.map(i=>{const r=n.values[i.name];return void 0!==r&&JSON.stringify(r)!==JSON.stringify(i.value)?(t=!0,console.log(`[PropertiesPanel] Updating ${e.name}.${i.name}: ${i.value} -> ${r}`),{...i,value:r}):i});if(t)return{...e,fields:i,buttons:n.buttons||e.buttons||[]}}return e});return t})},[null===a||void 0===a?void 0:a.components]),(0,t.useEffect)(()=>{const e=e=>{if(console.log("[PropertiesPanel] Received component definitions:",e),e.definitions&&Array.isArray(e.definitions)){const t=e.definitions.map(e=>e.name).filter(e=>"Transform"!==e&&"transform"!==e);console.log("[PropertiesPanel] Available components:",t),t.length>0?(g(t),x(0)):b<3&&s&&(console.log(`[PropertiesPanel] Empty component list, retrying (${b+1}/3)...`),setTimeout(()=>{x(e=>e+1),I_.getComponentDefinitions()},2e3))}};return I_.on("component_definitions",e),()=>{I_.off("component_definitions",e)}},[b,s]);const D=(e,t,i)=>{var r;if(!n||!a)return;u(n=>n.map(n=>n.name===e?{...n,fields:n.fields.map(e=>e.name===t?{...e,value:i}:e)}:n));const o=null===(r=a.components)||void 0===r?void 0:r.map(n=>n.name===e?{...n,values:{...n.values||{},[t]:i}}:n);if(o){const t={...a,components:o};if("Material"===e||"material"===e){const n=o.find(t=>t.name===e);var s,l,c;if(n&&n.values)t.material={color:n.values.color||"#808080",metalness:null!==(s=n.values.metalness)&&void 0!==s?s:.5,roughness:null!==(l=n.values.roughness)&&void 0!==l?l:.5,permittivity:null!==(c=n.values.permittivity)&&void 0!==c?c:1}}z_.getState().updateObject(t)}},k=(e,t)=>{console.log(`[PropertiesPanel] handleComponentFieldChangeStart: ${e}.${t}`);const n=c.find(t=>t.name===e);if(n){const i=n.fields.find(e=>e.name===t);i&&h(n=>({...n,[`${e}.${t}`]:i.value}))}},R=e=>{n&&s&&("Transform"!==e&&"Material"!==e?I_.removeComponent(n,e):console.warn(`Cannot remove essential component: ${e}`))},N=(e,t)=>{n&&s&&(console.log(`[PropertiesPanel] Button clicked: ${e}.${t}`),I_.clickComponentButton(n,e,t))},I=()=>{if(n&&S.trim()&&S!==(null===a||void 0===a?void 0:a.name)){const e={...a,name:S.trim()};z_.getState().updateObject(e),I_.updateObjectName(n,S.trim())}w(!1)},L=()=>{if(n&&E!==(null===a||void 0===a?void 0:a.tag)){const e={...a,tag:E};z_.getState().updateObject(e),I_.updateObjectTag(n,E)}},O=(e,t,i)=>{if(!n||!s)return;console.log(`[PropertiesPanel] handleComponentFieldChangeEnd: ${e}.${t}`,void 0!==i?`with value: ${i}`:"");let r=i;if(void 0===r){const n=c.find(t=>t.name===e);if(n){const e=n.fields.find(e=>e.name===t);e&&(r=e.value)}}if(void 0!==r){console.log(`[PropertiesPanel] Sending to server: ${e}.${t} = ${r}`);const i=d[`${e}.${t}`];if(void 0!==i&&!l.isUndoing&&!l.isRedoing){JSON.stringify(i),JSON.stringify(r)}I_.updateComponent(n,e,t,r)}else console.warn(`[PropertiesPanel] No value to send for ${e}.${t}`);h(n=>{const i={...n};return delete i[`${e}.${t}`],i})};return a?(0,r.jsxs)("div",{className:"properties-content",children:[(0,r.jsx)("div",{className:"properties-header-bar",children:(0,r.jsxs)("div",{className:"header-bar-content",children:[(0,r.jsxs)("div",{className:"header-left",children:[(0,r.jsx)("span",{className:"object-type",children:a.type}),_?(0,r.jsx)("input",{ref:T,type:"text",className:"header-name-input",value:S,onChange:e=>M(e.target.value),onBlur:I,onKeyDown:e=>{"Enter"===e.key?I():"Escape"===e.key&&(w(!1),M((null===a||void 0===a?void 0:a.name)||""))}}):(0,r.jsx)("span",{className:"object-name",onDoubleClick:()=>{a&&(M(a.name),w(!0),setTimeout(()=>{var e;null===(e=T.current)||void 0===e||e.select()},0))},title:"Double-click to edit",children:a.name})]}),(0,r.jsxs)("div",{className:"header-tag-group",children:[(0,r.jsx)("span",{className:"header-tag-label",children:"Tag"}),(0,r.jsx)("input",{ref:A,type:"text",className:"header-tag-input",value:E,onChange:e=>{const t=e.target.value;C(t)},onBlur:L,onKeyDown:e=>{"Enter"===e.key&&(L(),e.currentTarget.blur())}})]})]})}),(0,r.jsx)("div",{style:{padding:"0 10px"},children:(0,r.jsx)(LR,{selectedObjectId:n})}),c.map(e=>(0,r.jsx)("div",{style:{padding:"0 10px"},children:(0,r.jsx)(_N,{component:e,onFieldChange:D,onFieldChangeStart:k,onFieldChangeEnd:O,onRemoveComponent:R,onButtonClick:N})},e.name)),(0,r.jsxs)("div",{className:"add-component-section",children:[(0,r.jsx)("button",{className:"add-component-button",onClick:()=>{f(!p),y("")},children:(0,r.jsx)("span",{children:"Add Component"})}),p&&(0,r.jsxs)("div",{className:"component-dropdown",children:[(0,r.jsx)("input",{type:"text",className:"component-search",placeholder:"Search components...",value:v,onChange:e=>y(e.target.value),autoFocus:!0}),(0,r.jsx)("div",{className:"component-list",children:m.length>0?m.filter(e=>!c.some(t=>t.name===e)).filter(e=>e.toLowerCase().includes(v.toLowerCase())).map(e=>(0,r.jsx)("div",{className:"component-dropdown-item",onClick:()=>{(e=>{if(!n||!s)return;const t=c.find(t=>t.name===e);t?console.warn(`Component ${e} already exists on object`):(I_.addComponent(n,e),f(!1))})(e),y("")},children:e},e)):(0,r.jsx)("div",{className:"component-dropdown-item disabled",children:"No components available"})})]})]})]}):(0,r.jsx)("div",{className:"properties-content",children:(0,r.jsx)("div",{className:"no-selection",style:{padding:"20px"},children:"No object selected"})})},SN=e=>{let{isDarkTheme:n,dockviewApi:i}=e;const{parameters:o,setParameters:s}=$_(),[a,l]=(0,t.useState)({}),c=(0,t.useRef)({}),u=e=>{if(void 0!==a[e.id])return a[e.id];if("float"===e.type)return"number"===typeof e.value?e.value:0;if("bool"===e.type)return"boolean"===typeof e.value&&e.value;if(e.type.startsWith("vector")){if("string"===typeof e.value){const t=e.value.replace(/[()]/g,"").split(",").map(e=>parseFloat(e.trim())||0),n=parseInt(e.type.slice(-1));return{x:t[0]||0,y:t[1]||0,z:n>=3?t[2]||0:void 0,w:n>=4?t[3]||0:void 0}}if(Array.isArray(e.value)){const t=parseInt(e.type.slice(-1));return{x:e.value[0]||0,y:e.value[1]||0,z:t>=3?e.value[2]||0:void 0,w:t>=4?e.value[3]||0:void 0}}{const t=parseInt(e.type.slice(-1));return{x:0,y:0,z:t>=3?0:void 0,w:t>=4?0:void 0}}}return e.value},d=(e,t)=>{s(n=>n.map(n=>n.id===e?{...n,value:t}:n)),I_.isConnected()&&I_.updateNodeEditor(void 0,void 0,o.map(n=>n.id===e?{...n,value:t}:n),void 0)},h=e=>{const t=o.find(t=>t.id===e);t&&(c.current[e]=u(t))},p=e=>{delete c.current[e]},f=e=>{const t=u(e);return(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:e.name}),(0,r.jsx)(IR,{value:t,onChange:t=>((e,t)=>{l(n=>({...n,[e]:t}))})(e.id,t),onFinish:t=>((e,t)=>{d(e,t),l(t=>{const n={...t};return delete n[e],n})})(e.id,t),onDragStart:()=>h(e.id),onDragEnd:()=>p(e.id),min:-1/0,max:1/0,step:.01})]})},m=e=>{const t=u(e);return(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:e.name}),(0,r.jsx)("input",{type:"checkbox",className:"checkbox-input",checked:t,onChange:t=>d(e.id,t.target.checked)})]})},g=e=>{const t=u(e),n=parseInt(e.type.slice(-1)),i=["x","y","z","w"].slice(0,n);return(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:e.name}),(0,r.jsx)("div",{className:"vector-input",style:{gridTemplateColumns:`repeat(${n}, 1fr)`},children:i.map(n=>(0,r.jsx)(IR,{label:n.toUpperCase(),value:t[n]||0,onChange:t=>((e,t,n)=>{const i=o.find(t=>t.id===e);if(!i)return;const r={...u(i),[t]:n};l(t=>({...t,[e]:r}))})(e.id,n,t),onFinish:t=>((e,t,n)=>{const i=o.find(t=>t.id===e);if(!i)return;const r={...u(i),[t]:n},s=parseInt(i.type.slice(-1)),a=[r.x,r.y];s>=3&&void 0!==r.z&&a.push(r.z),s>=4&&void 0!==r.w&&a.push(r.w),d(e,a),l(t=>{const n={...t};return delete n[e],n})})(e.id,n,t),onDragStart:()=>h(e.id),onDragEnd:()=>p(e.id),min:-1/0,max:1/0,step:.01,precision:2},`${e.id}-${n}`))})]})};if(0===o.length)return(0,r.jsx)("div",{className:"properties-content",children:(0,r.jsx)("div",{className:"no-selection",style:{padding:"20px",textAlign:"center",color:n?"#666":"#999"},children:"No parameters defined"})});return(0,r.jsxs)("div",{className:"properties-content",children:[(0,r.jsx)("div",{className:"properties-header-bar",style:{minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"flex-start",padding:"0 12px"},children:(0,r.jsx)("button",{className:"edit-button",onClick:()=>{if(i){const e=i.getPanel("nodeEditor");e&&e.api.setActive()}},style:{padding:"4px 12px",fontSize:"11px",background:n?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.05)",border:"1px solid "+(n?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.1)"),borderRadius:"4px",color:n?"#e0e0e0":"#333",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background=n?"rgba(74, 158, 255, 0.2)":"rgba(74, 158, 255, 0.1)",e.currentTarget.style.borderColor="rgba(74, 158, 255, 0.5)"},onMouseLeave:e=>{e.currentTarget.style.background=n?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.05)",e.currentTarget.style.borderColor=n?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.1)"},children:"Edit"})}),(0,r.jsx)("div",{className:"property-section",children:(0,r.jsx)("div",{className:"property-section-content",style:{paddingTop:"8px"},children:o.map(e=>"float"===e.type?(0,r.jsx)(t.Fragment,{children:f(e)},e.id):"bool"===e.type?(0,r.jsx)(t.Fragment,{children:m(e)},e.id):e.type.startsWith("vector")?(0,r.jsx)(t.Fragment,{children:g(e)},e.id):null)})})]})},MN=()=>{const[e,n]=(0,t.useState)(75),[i,o]=(0,t.useState)(1);return(0,r.jsxs)("div",{className:"settings-content",children:[(0,r.jsxs)("div",{className:"property-section",children:[(0,r.jsx)("h3",{className:"section-header",children:"General Settings"}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Grid Size"}),(0,r.jsx)("input",{type:"number",defaultValue:10,className:"number-input",min:1,max:100})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Snap to Grid"}),(0,r.jsxs)("label",{className:"checkbox-wrapper",children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox-input",defaultChecked:!1}),(0,r.jsx)("span",{className:"checkbox-custom"})]})]})]}),(0,r.jsxs)("div",{className:"property-section",children:[(0,r.jsx)("h3",{className:"section-header",children:"Viewport Settings"}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Field of View"}),(0,r.jsxs)("div",{className:"slider-group",children:[(0,r.jsx)("input",{type:"range",min:"30",max:"120",value:e,onChange:e=>n(Number(e.target.value)),className:"slider-input"}),(0,r.jsxs)("span",{className:"slider-value",children:[e,"\xb0"]})]})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Camera Speed"}),(0,r.jsxs)("div",{className:"slider-group",children:[(0,r.jsx)("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:i,onChange:e=>o(Number(e.target.value)),className:"slider-input"}),(0,r.jsxs)("span",{className:"slider-value",children:[i.toFixed(1),"x"]})]})]})]}),(0,r.jsxs)("div",{className:"property-section",children:[(0,r.jsx)("h3",{className:"section-header",children:"Performance"}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Shadow Quality"}),(0,r.jsxs)("select",{className:"select-input",children:[(0,r.jsx)("option",{children:"Low"}),(0,r.jsx)("option",{children:"Medium"}),(0,r.jsx)("option",{children:"High"}),(0,r.jsx)("option",{children:"Ultra"})]})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Anti-aliasing"}),(0,r.jsxs)("label",{className:"checkbox-wrapper",children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox-input",defaultChecked:!0}),(0,r.jsx)("span",{className:"checkbox-custom"})]})]})]}),(0,r.jsxs)("div",{className:"property-section",children:[(0,r.jsx)("h3",{className:"section-header",children:"Editor"}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Auto-save"}),(0,r.jsxs)("label",{className:"checkbox-wrapper",children:[(0,r.jsx)("input",{type:"checkbox",className:"checkbox-input",defaultChecked:!0}),(0,r.jsx)("span",{className:"checkbox-custom"})]})]}),(0,r.jsxs)("div",{className:"property-group",children:[(0,r.jsx)("label",{className:"property-label",children:"Auto-save Interval"}),(0,r.jsx)("input",{type:"number",defaultValue:30,className:"number-input",min:10,max:300,step:10}),(0,r.jsx)("span",{className:"property-unit",children:"seconds"})]})]})]})},EN=()=>{const[e,n]=(0,t.useState)(0),[i,o]=(0,t.useState)(!1),[s,a]=(0,t.useState)(null),[l,c]=(0,t.useState)([{track:0,frames:[10,30,50,80]},{track:1,frames:[5,60,100]},{track:2,frames:[0,70]}]),u=(0,t.useRef)(null),d=(0,t.useRef)(null);(0,t.useEffect)(()=>{var e;const t=null===(e=u.current)||void 0===e?void 0:e.querySelector(".timeline-tracks"),n=d.current;if(!t||!n)return;const i=()=>{n&&(n.scrollLeft=t.scrollLeft)},r=()=>{t&&(t.scrollLeft=n.scrollLeft)};return t.addEventListener("scroll",i),n.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",i),n.removeEventListener("scroll",r)}},[]);const h=(e,t,n)=>{e.stopPropagation(),a({track:t,index:n})};(0,t.useEffect)(()=>{const e=e=>{if(!s||!u.current)return;const t=u.current.querySelector(".timeline-tracks");if(!t)return;const n=t.getBoundingClientRect(),i=t.scrollLeft||0,r=e.clientX-n.left-120+i,o=Math.round(r/10),a=Math.max(0,Math.min(240,o));c(e=>{const t=[...e];return t[s.track].frames[s.index]=a,t})},t=()=>{a(null)};return s&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[s]);return(0,t.useEffect)(()=>{const e=e=>{if(!i||!u.current)return;const t=u.current.querySelector(".timeline-tracks");if(!t)return;const r=t.getBoundingClientRect(),o=t.scrollLeft||0,s=e.clientX-r.left-120+o,a=Math.round(s/10),l=Math.max(0,Math.min(240,a));n(l)},t=()=>{o(!1)};return i&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[i,240]),(0,r.jsx)("div",{className:"timeline-panel-container",children:(0,r.jsxs)("div",{className:"timeline-content",children:[(0,r.jsxs)("div",{className:"timeline-toolbar",children:[(0,r.jsx)("button",{className:"timeline-button",title:"Previous Frame",children:(0,r.jsx)("span",{className:"timeline-icon",children:"\u25c0\u25c0"})}),(0,r.jsx)("button",{className:"timeline-button",title:"Play",children:(0,r.jsx)("span",{className:"timeline-icon",children:"\u25b6"})}),(0,r.jsx)("button",{className:"timeline-button",title:"Next Frame",children:(0,r.jsx)("span",{className:"timeline-icon",children:"\u25b6\u25b6"})}),(0,r.jsxs)("div",{className:"timeline-frame-info",children:[(0,r.jsx)("span",{className:"frame-label",children:"Frame:"}),(0,r.jsx)("input",{type:"number",value:e,onChange:e=>n(parseInt(e.target.value)||0),className:"frame-input",min:0,max:240}),(0,r.jsx)("span",{className:"frame-separator",children:"/"}),(0,r.jsx)("span",{className:"frame-total",children:240})]})]}),(0,r.jsxs)("div",{className:"timeline-tracks-container",ref:u,children:[(0,r.jsxs)("div",{className:"timeline-ruler-container",children:[(0,r.jsx)("div",{className:"ruler-header"}),(0,r.jsx)("div",{className:"timeline-ruler",ref:d,children:(0,r.jsx)("div",{className:"ruler-content",children:Array.from({length:241},(e,t)=>(0,r.jsxs)("div",{className:"ruler-mark",onClick:()=>n(t),style:{left:10*t+"px",position:"absolute"},children:[(0,r.jsx)("div",{className:"ruler-tick "+(t%10===0?"major":"minor")}),t%10===0&&(0,r.jsx)("span",{className:"ruler-number",children:t})]},t))})})]}),(0,r.jsxs)("div",{className:"timeline-tracks",children:[(0,r.jsxs)("div",{className:"timeline-track",children:[(0,r.jsx)("div",{className:"track-header",children:(0,r.jsx)("span",{className:"track-name",children:"Transform"})}),(0,r.jsx)("div",{className:"track-content",children:(0,r.jsx)("div",{className:"track-keys",children:l[0].frames.map((e,t)=>(0,r.jsx)("div",{className:"keyframe "+(0===(null===s||void 0===s?void 0:s.track)&&(null===s||void 0===s?void 0:s.index)===t?"dragging":""),style:{left:10*e+"px"},onMouseDown:e=>h(e,0,t)},t))})})]}),(0,r.jsxs)("div",{className:"timeline-track",children:[(0,r.jsx)("div",{className:"track-header",children:(0,r.jsx)("span",{className:"track-name",children:"Material"})}),(0,r.jsx)("div",{className:"track-content",children:(0,r.jsx)("div",{className:"track-keys",children:l[1].frames.map((e,t)=>(0,r.jsx)("div",{className:"keyframe "+(1===(null===s||void 0===s?void 0:s.track)&&(null===s||void 0===s?void 0:s.index)===t?"dragging":""),style:{left:10*e+"px"},onMouseDown:e=>h(e,1,t)},t))})})]}),(0,r.jsxs)("div",{className:"timeline-track",children:[(0,r.jsx)("div",{className:"track-header",children:(0,r.jsx)("span",{className:"track-name",children:"Visibility"})}),(0,r.jsx)("div",{className:"track-content",children:(0,r.jsx)("div",{className:"track-keys",children:l[2].frames.map((e,t)=>(0,r.jsx)("div",{className:"keyframe "+(2===(null===s||void 0===s?void 0:s.track)&&(null===s||void 0===s?void 0:s.index)===t?"dragging":""),style:{left:10*e+"px"},onMouseDown:e=>h(e,2,t)},t))})})]}),(0,r.jsxs)("div",{className:"timeline-scrubber "+(i?"dragging":""),style:{left:120+10*e+"px"},onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),o(!0)},children:[(0,r.jsx)("div",{className:"scrubber-head"}),(0,r.jsx)("div",{className:"scrubber-line"})]})]})]})]})})};function CN(e){return e+.5|0}const TN=(e,t,n)=>Math.max(Math.min(e,n),t);function AN(e){return TN(CN(2.55*e),0,255)}function PN(e){return TN(CN(255*e),0,255)}function DN(e){return TN(CN(e/2.55)/100,0,1)}function kN(e){return TN(CN(100*e),0,100)}const RN={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},NN=[..."0123456789ABCDEF"],IN=e=>NN[15&e],LN=e=>NN[(240&e)>>4]+NN[15&e],ON=e=>(240&e)>>4===(15&e);function zN(e){var t=(e=>ON(e.r)&&ON(e.g)&&ON(e.b)&&ON(e.a))(e)?IN:LN;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}const UN=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function FN(e,t,n){const i=t*Math.min(n,1-n),r=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t+e/30)%12;return n-i*Math.max(Math.min(r-3,9-r,1),-1)};return[r(0),r(8),r(4)]}function jN(e,t,n){const i=function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(i+e/60)%6;return n-n*t*Math.max(Math.min(r,4-r,1),0)};return[i(5),i(3),i(1)]}function BN(e,t,n){const i=FN(e,1,.5);let r;for(t+n>1&&(r=1/(t+n),t*=r,n*=r),r=0;r<3;r++)i[r]*=1-t-n,i[r]+=t;return i}function VN(e){const t=e.r/255,n=e.g/255,i=e.b/255,r=Math.max(t,n,i),o=Math.min(t,n,i),s=(r+o)/2;let a,l,c;return r!==o&&(c=r-o,l=s>.5?c/(2-r-o):c/(r+o),a=function(e,t,n,i,r){return e===r?(t-n)/i+(t<n?6:0):t===r?(n-e)/i+2:(e-t)/i+4}(t,n,i,c,r),a=60*a+.5),[0|a,l||0,s]}function HN(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(PN)}function GN(e,t,n){return HN(FN,e,t,n)}function WN(e){return(e%360+360)%360}function XN(e){const t=UN.exec(e);let n,i=255;if(!t)return;t[5]!==n&&(i=t[6]?AN(+t[5]):PN(+t[5]));const r=WN(+t[2]),o=+t[3]/100,s=+t[4]/100;return n="hwb"===t[1]?function(e,t,n){return HN(BN,e,t,n)}(r,o,s):"hsv"===t[1]?function(e,t,n){return HN(jN,e,t,n)}(r,o,s):GN(r,o,s),{r:n[0],g:n[1],b:n[2],a:i}}const YN={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},$N={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let qN;function ZN(e){qN||(qN=function(){const e={},t=Object.keys($N),n=Object.keys(YN);let i,r,o,s,a;for(i=0;i<t.length;i++){for(s=a=t[i],r=0;r<n.length;r++)o=n[r],a=a.replace(o,YN[o]);o=parseInt($N[s],16),e[a]=[o>>16&255,o>>8&255,255&o]}return e}(),qN.transparent=[0,0,0,0]);const t=qN[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}const KN=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const JN=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,QN=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function eI(e,t,n){if(e){let i=VN(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,0===t?360:1)),i=GN(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function tI(e,t){return e?Object.assign(t||{},e):e}function nI(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=PN(e[3]))):(t=tI(e,{r:0,g:0,b:0,a:1})).a=PN(t.a),t}function iI(e){return"r"===e.charAt(0)?function(e){const t=KN.exec(e);let n,i,r,o=255;if(t){if(t[7]!==n){const e=+t[7];o=t[8]?AN(e):TN(255*e,0,255)}return n=+t[1],i=+t[3],r=+t[5],n=255&(t[2]?AN(n):TN(n,0,255)),i=255&(t[4]?AN(i):TN(i,0,255)),r=255&(t[6]?AN(r):TN(r,0,255)),{r:n,g:i,b:r,a:o}}}(e):XN(e)}class rI{constructor(e){if(e instanceof rI)return e;const t=typeof e;let n;"object"===t?n=nI(e):"string"===t&&(n=function(e){var t,n=e.length;return"#"===e[0]&&(4===n||5===n?t={r:255&17*RN[e[1]],g:255&17*RN[e[2]],b:255&17*RN[e[3]],a:5===n?17*RN[e[4]]:255}:7!==n&&9!==n||(t={r:RN[e[1]]<<4|RN[e[2]],g:RN[e[3]]<<4|RN[e[4]],b:RN[e[5]]<<4|RN[e[6]],a:9===n?RN[e[7]]<<4|RN[e[8]]:255})),t}(e)||ZN(e)||iI(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=tI(this._rgb);return e&&(e.a=DN(e.a)),e}set rgb(e){this._rgb=nI(e)}rgbString(){return this._valid?function(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${DN(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}(this._rgb):void 0}hexString(){return this._valid?zN(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=VN(e),n=t[0],i=kN(t[1]),r=kN(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${r}%, ${DN(e.a)})`:`hsl(${n}, ${i}%, ${r}%)`}(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,i=e.rgb;let r;const o=t===r?.5:t,s=2*o-1,a=n.a-i.a,l=((s*a===-1?s:(s+a)/(1+s*a))+1)/2;r=1-l,n.r=255&l*n.r+r*i.r+.5,n.g=255&l*n.g+r*i.g+.5,n.b=255&l*n.b+r*i.b+.5,n.a=o*n.a+(1-o)*i.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,n){const i=QN(DN(e.r)),r=QN(DN(e.g)),o=QN(DN(e.b));return{r:PN(JN(i+n*(QN(DN(t.r))-i))),g:PN(JN(r+n*(QN(DN(t.g))-r))),b:PN(JN(o+n*(QN(DN(t.b))-o))),a:e.a+n*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new rI(this.rgb)}alpha(e){return this._rgb.a=PN(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=CN(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return eI(this._rgb,2,e),this}darken(e){return eI(this._rgb,2,-e),this}saturate(e){return eI(this._rgb,1,e),this}desaturate(e){return eI(this._rgb,1,-e),this}rotate(e){return function(e,t){var n=VN(e);n[0]=WN(n[0]+t),n=GN(n),e.r=n[0],e.g=n[1],e.b=n[2]}(this._rgb,e),this}}function oI(){}const sI=(()=>{let e=0;return()=>e++})();function aI(e){return null===e||void 0===e}function lI(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function cI(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function uI(e){return("number"===typeof e||e instanceof Number)&&isFinite(+e)}function dI(e,t){return uI(e)?e:t}function hI(e,t){return"undefined"===typeof e?t:e}const pI=(e,t)=>"string"===typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function fI(e,t,n){if(e&&"function"===typeof e.call)return e.apply(n,t)}function mI(e,t,n,i){let r,o,s;if(lI(e))if(o=e.length,i)for(r=o-1;r>=0;r--)t.call(n,e[r],r);else for(r=0;r<o;r++)t.call(n,e[r],r);else if(cI(e))for(s=Object.keys(e),o=s.length,r=0;r<o;r++)t.call(n,e[s[r]],s[r])}function gI(e,t){let n,i,r,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(r=e[n],o=t[n],r.datasetIndex!==o.datasetIndex||r.index!==o.index)return!1;return!0}function vI(e){if(lI(e))return e.map(vI);if(cI(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let r=0;for(;r<i;++r)t[n[r]]=vI(e[n[r]]);return t}return e}function yI(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function bI(e,t,n,i){if(!yI(e))return;const r=t[e],o=n[e];cI(r)&&cI(o)?xI(r,o,i):t[e]=vI(o)}function xI(e,t,n){const i=lI(t)?t:[t],r=i.length;if(!cI(e))return e;const o=(n=n||{}).merger||bI;let s;for(let a=0;a<r;++a){if(s=i[a],!cI(s))continue;const t=Object.keys(s);for(let i=0,r=t.length;i<r;++i)o(t[i],e,s,n)}return e}function _I(e,t){return xI(e,t,{merger:wI})}function wI(e,t,n){if(!yI(e))return;const i=t[e],r=n[e];cI(i)&&cI(r)?_I(i,r):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=vI(r))}const SI={"":e=>e,x:e=>e.x,y:e=>e.y};function MI(e,t){const n=SI[t]||(SI[t]=function(e){const t=function(e){const t=e.split("."),n=[];let i="";for(const r of t)i+=r,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(e);return e=>{for(const n of t){if(""===n)break;e=e&&e[n]}return e}}(t));return n(e)}function EI(e){return e.charAt(0).toUpperCase()+e.slice(1)}const CI=e=>"undefined"!==typeof e,TI=e=>"function"===typeof e,AI=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};const PI=Math.PI,DI=2*PI,kI=DI+PI,RI=Number.POSITIVE_INFINITY,NI=PI/180,II=PI/2,LI=PI/4,OI=2*PI/3,zI=Math.log10,UI=Math.sign;function FI(e,t,n){return Math.abs(e-t)<n}function jI(e){const t=Math.round(e);e=FI(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(zI(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function BI(e){return!function(e){return"symbol"===typeof e||"object"===typeof e&&null!==e&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function VI(e,t,n){let i,r,o;for(i=0,r=e.length;i<r;i++)o=e[i][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function HI(e){return e*(PI/180)}function GI(e){return e*(180/PI)}function WI(e){if(!uI(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function XI(e,t){const n=t.x-e.x,i=t.y-e.y,r=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o<-.5*PI&&(o+=DI),{angle:o,distance:r}}function YI(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function $I(e,t){return(e-t+kI)%DI-PI}function qI(e){return(e%DI+DI)%DI}function ZI(e,t,n,i){const r=qI(e),o=qI(t),s=qI(n),a=qI(o-r),l=qI(s-r),c=qI(r-o),u=qI(r-s);return r===o||r===s||i&&o===s||a>l&&c<u}function KI(e,t,n){return Math.max(t,Math.min(n,e))}function JI(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function QI(e,t,n){n=n||(n=>e[n]<t);let i,r=e.length-1,o=0;for(;r-o>1;)i=o+r>>1,n(i)?o=i:r=i;return{lo:o,hi:r}}const eL=(e,t,n,i)=>QI(e,n,i?i=>{const r=e[i][t];return r<n||r===n&&e[i+1][t]===n}:i=>e[i][t]<n),tL=(e,t,n)=>QI(e,n,i=>e[i][t]>=n);const nL=["push","pop","shift","splice","unshift"];function iL(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,r=i.indexOf(t);-1!==r&&i.splice(r,1),i.length>0||(nL.forEach(t=>{delete e[t]}),delete e._chartjs)}function rL(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const oL="undefined"===typeof window?function(e){return e()}:window.requestAnimationFrame;function sL(e,t){let n=[],i=!1;return function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];n=o,i||(i=!0,oL.call(window,()=>{i=!1,e.apply(t,n)}))}}const aL=e=>"start"===e?"left":"end"===e?"right":"center",lL=(e,t,n)=>"start"===e?t:"end"===e?n:(t+n)/2;function cL(e,t,n){const i=t.length;let r=0,o=i;if(e._sorted){const{iScale:s,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,u=s.axis,{min:d,max:h,minDefined:p,maxDefined:f}=s.getUserBounds();if(p){if(r=Math.min(eL(l,u,d).lo,n?i:eL(t,u,s.getPixelForValue(d)).lo),c){const e=l.slice(0,r+1).reverse().findIndex(e=>!aI(e[a.axis]));r-=Math.max(0,e)}r=KI(r,0,i-1)}if(f){let e=Math.max(eL(l,s.axis,h,!0).hi+1,n?0:eL(t,u,s.getPixelForValue(h),!0).hi+1);if(c){const t=l.slice(e-1).findIndex(e=>!aI(e[a.axis]));e+=Math.max(0,t)}o=KI(e,r,i)-r}else o=i-r}return{start:r,count:o}}function uL(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,r={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=r,!0;const o=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,r),o}const dL=e=>0===e||1===e,hL=(e,t,n)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*DI/n),pL=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*DI/n)+1,fL={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*II),easeOutSine:e=>Math.sin(e*II),easeInOutSine:e=>-.5*(Math.cos(PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>dL(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>dL(e)?e:hL(e,.075,.3),easeOutElastic:e=>dL(e)?e:pL(e,.075,.3),easeInOutElastic(e){const t=.1125;return dL(e)?e:e<.5?.5*hL(2*e,t,.45):.5+.5*pL(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-fL.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},easeInOutBounce:e=>e<.5?.5*fL.easeInBounce(2*e):.5*fL.easeOutBounce(2*e-1)+.5};function mL(e){if(e&&"object"===typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function gL(e){return mL(e)?e:new rI(e)}function vL(e){return mL(e)?e:new rI(e).saturate(.5).darken(.1).hexString()}const yL=["x","y","borderWidth","radius","tension"],bL=["color","borderColor","backgroundColor"];const xL=new Map;function _L(e,t,n){return function(e,t){t=t||{};const n=e+JSON.stringify(t);let i=xL.get(n);return i||(i=new Intl.NumberFormat(e,t),xL.set(n,i)),i}(t,n).format(e)}const wL={values:e=>lI(e)?e:""+e,numeric(e,t,n){if(0===e)return"0";const i=this.chart.options.locale;let r,o=e;if(n.length>1){const t=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(t<1e-4||t>1e15)&&(r="scientific"),o=function(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e));return n}(e,n)}const s=zI(Math.abs(o)),a=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),l={notation:r,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),_L(e,i,l)},logarithmic(e,t,n){if(0===e)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(zI(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?wL.numeric.call(this,e,t,n):""}};var SL={formatters:wL};const ML=Object.create(null),EL=Object.create(null);function CL(e,t){if(!t)return e;const n=t.split(".");for(let i=0,r=n.length;i<r;++i){const t=n[i];e=e[t]||(e[t]=Object.create(null))}return e}function TL(e,t,n){return"string"===typeof t?xI(CL(e,t),n):xI(CL(e,""),t)}class AL{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>vL(t.backgroundColor),this.hoverBorderColor=(e,t)=>vL(t.borderColor),this.hoverColor=(e,t)=>vL(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return TL(this,e,t)}get(e){return CL(this,e)}describe(e,t){return TL(EL,e,t)}override(e,t){return TL(ML,e,t)}route(e,t,n,i){const r=CL(this,e),o=CL(this,n),s="_"+t;Object.defineProperties(r,{[s]:{value:r[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[s],t=o[i];return cI(e)?Object.assign({},t,e):hI(e,t)},set(e){this[s]=e}}})}apply(e){e.forEach(e=>e(this))}}var PL=new AL({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:bL},numbers:{type:"number",properties:yL}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:SL.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function DL(e,t,n,i,r){let o=t[r];return o||(o=t[r]=e.measureText(r).width,n.push(r)),o>i&&(i=o),i}function kL(e,t,n){const i=e.currentDevicePixelRatio,r=0!==n?Math.max(n/2,.5):0;return Math.round((t-r)*i)/i+r}function RL(e,t){(t||e)&&((t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function NL(e,t,n,i){IL(e,t,n,i,null)}function IL(e,t,n,i,r){let o,s,a,l,c,u,d,h;const p=t.pointStyle,f=t.rotation,m=t.radius;let g=(f||0)*NI;if(p&&"object"===typeof p&&(o=p.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return e.save(),e.translate(n,i),e.rotate(g),e.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void e.restore();if(!(isNaN(m)||m<=0)){switch(e.beginPath(),p){default:r?e.ellipse(n,i,r/2,m,0,0,DI):e.arc(n,i,m,0,DI),e.closePath();break;case"triangle":u=r?r/2:m,e.moveTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=OI,e.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=OI,e.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),e.closePath();break;case"rectRounded":c=.516*m,l=m-c,s=Math.cos(g+LI)*l,d=Math.cos(g+LI)*(r?r/2-c:l),a=Math.sin(g+LI)*l,h=Math.sin(g+LI)*(r?r/2-c:l),e.arc(n-d,i-a,c,g-PI,g-II),e.arc(n+h,i-s,c,g-II,g),e.arc(n+d,i+a,c,g,g+II),e.arc(n-h,i+s,c,g+II,g+PI),e.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,u=r?r/2:l,e.rect(n-u,i-l,2*u,2*l);break}g+=LI;case"rectRot":d=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(r?r/2:m),e.moveTo(n-d,i-a),e.lineTo(n+h,i-s),e.lineTo(n+d,i+a),e.lineTo(n-h,i+s),e.closePath();break;case"crossRot":g+=LI;case"cross":d=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(r?r/2:m),e.moveTo(n-d,i-a),e.lineTo(n+d,i+a),e.moveTo(n+h,i-s),e.lineTo(n-h,i+s);break;case"star":d=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(r?r/2:m),e.moveTo(n-d,i-a),e.lineTo(n+d,i+a),e.moveTo(n+h,i-s),e.lineTo(n-h,i+s),g+=LI,d=Math.cos(g)*(r?r/2:m),s=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(r?r/2:m),e.moveTo(n-d,i-a),e.lineTo(n+d,i+a),e.moveTo(n+h,i-s),e.lineTo(n-h,i+s);break;case"line":s=r?r/2:Math.cos(g)*m,a=Math.sin(g)*m,e.moveTo(n-s,i-a),e.lineTo(n+s,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(g)*(r?r/2:m),i+Math.sin(g)*m);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function LL(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function OL(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function zL(e){e.restore()}function UL(e,t,n,i,r){if(!t)return e.lineTo(n.x,n.y);if("middle"===r){const i=(t.x+n.x)/2;e.lineTo(i,t.y),e.lineTo(i,n.y)}else"after"===r!==!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function FL(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function jL(e,t,n,i,r){if(r.strikethrough||r.underline){const o=e.measureText(i),s=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,c=n+o.actualBoundingBoxDescent,u=r.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=r.decorationWidth||2,e.moveTo(s,u),e.lineTo(a,u),e.stroke()}}function BL(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function VL(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=lI(t)?t:[t],a=o.strokeWidth>0&&""!==o.strokeColor;let l,c;for(e.save(),e.font=r.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),aI(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,o),l=0;l<s.length;++l)c=s[l],o.backdrop&&BL(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),aI(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,n,i,o.maxWidth)),e.fillText(c,n,i,o.maxWidth),jL(e,n,i,c,o),i+=Number(r.lineHeight);e.restore()}function HL(e,t){const{x:n,y:i,w:r,h:o,radius:s}=t;e.arc(n+s.topLeft,i+s.topLeft,s.topLeft,1.5*PI,PI,!0),e.lineTo(n,i+o-s.bottomLeft),e.arc(n+s.bottomLeft,i+o-s.bottomLeft,s.bottomLeft,PI,II,!0),e.lineTo(n+r-s.bottomRight,i+o),e.arc(n+r-s.bottomRight,i+o-s.bottomRight,s.bottomRight,II,0,!0),e.lineTo(n+r,i+s.topRight),e.arc(n+r-s.topRight,i+s.topRight,s.topRight,0,-II,!0),e.lineTo(n+s.topLeft,i)}const GL=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,WL=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function XL(e,t){const n=(""+e).match(GL);if(!n||"normal"===n[1])return 1.2*t;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100}return t*e}const YL=e=>+e||0;function $L(e,t){const n={},i=cI(t),r=i?Object.keys(t):t,o=cI(e)?i?n=>hI(e[n],e[t[n]]):t=>e[t]:()=>e;for(const s of r)n[s]=YL(o(s));return n}function qL(e){return $L(e,{top:"y",right:"x",bottom:"y",left:"x"})}function ZL(e){return $L(e,["topLeft","topRight","bottomLeft","bottomRight"])}function KL(e){const t=qL(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function JL(e,t){e=e||{},t=t||PL.font;let n=hI(e.size,t.size);"string"===typeof n&&(n=parseInt(n,10));let i=hI(e.style,t.style);i&&!(""+i).match(WL)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const r={family:hI(e.family,t.family),lineHeight:XL(hI(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:hI(e.weight,t.weight),string:""};return r.string=function(e){return!e||aI(e.size)||aI(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(r),r}function QL(e,t,n,i){let r,o,s,a=!0;for(r=0,o=e.length;r<o;++r)if(s=e[r],void 0!==s&&(void 0!==t&&"function"===typeof s&&(s=s(t),a=!1),void 0!==n&&lI(s)&&(s=s[n%s.length],a=!1),void 0!==s))return i&&!a&&(i.cacheable=!1),s}function eO(e,t){return Object.assign(Object.create(e),t)}function tO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>e[0];const r=(arguments.length>2?arguments[2]:void 0)||e;"undefined"===typeof n&&(n=hO("_fallback",e));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:r,_fallback:n,_getTarget:i,override:i=>tO([i,...e],t,r,n)};return new Proxy(o,{deleteProperty:(t,n)=>(delete t[n],delete t._keys,delete e[0][n],!0),get:(n,i)=>sO(n,i,()=>function(e,t,n,i){let r;for(const o of t)if(r=hO(rO(o,e),n),"undefined"!==typeof r)return oO(e,r)?uO(n,i,e,r):r}(i,t,e,n)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>pO(e).includes(t),ownKeys:e=>pO(e),set(e,t,n){const r=e._storage||(e._storage=i());return e[t]=r[t]=n,delete e._keys,!0}})}function nO(e,t,n,i){const r={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:iO(e,i),setContext:t=>nO(e,t,n,i),override:r=>nO(e.override(r),t,n,i)};return new Proxy(r,{deleteProperty:(t,n)=>(delete t[n],delete e[n],!0),get:(e,t,n)=>sO(e,t,()=>function(e,t,n){const{_proxy:i,_context:r,_subProxy:o,_descriptors:s}=e;let a=i[t];TI(a)&&s.isScriptable(t)&&(a=function(e,t,n,i){const{_proxy:r,_context:o,_subProxy:s,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,s||i);a.delete(e),oO(e,l)&&(l=uO(r._scopes,r,e,l));return l}(t,a,e,n));lI(a)&&a.length&&(a=function(e,t,n,i){const{_proxy:r,_context:o,_subProxy:s,_descriptors:a}=n;if("undefined"!==typeof o.index&&i(e))return t[o.index%t.length];if(cI(t[0])){const n=t,i=r._scopes.filter(e=>e!==n);t=[];for(const l of n){const n=uO(i,r,e,l);t.push(nO(n,o,s&&s[e],a))}}return t}(t,a,e,s.isIndexable));oO(t,a)&&(a=nO(a,r,o&&o[t],s));return a}(e,t,n)),getOwnPropertyDescriptor:(t,n)=>t._descriptors.allKeys?Reflect.has(e,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,n),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,n)=>Reflect.has(e,n),ownKeys:()=>Reflect.ownKeys(e),set:(t,n,i)=>(e[n]=i,delete t[n],!0)})}function iO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:r=t.allKeys}=e;return{allKeys:r,scriptable:n,indexable:i,isScriptable:TI(n)?n:()=>n,isIndexable:TI(i)?i:()=>i}}const rO=(e,t)=>e?e+EI(t):t,oO=(e,t)=>cI(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function sO(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||"constructor"===t)return e[t];const i=n();return e[t]=i,i}function aO(e,t,n){return TI(e)?e(t,n):e}const lO=(e,t)=>!0===e?t:"string"===typeof e?MI(t,e):void 0;function cO(e,t,n,i,r){for(const o of t){const t=lO(n,o);if(t){e.add(t);const o=aO(t._fallback,n,r);if("undefined"!==typeof o&&o!==n&&o!==i)return o}else if(!1===t&&"undefined"!==typeof i&&n!==i)return null}return!1}function uO(e,t,n,i){const r=t._rootScopes,o=aO(t._fallback,n,i),s=[...e,...r],a=new Set;a.add(i);let l=dO(a,s,n,o||n,i);return null!==l&&(("undefined"===typeof o||o===n||(l=dO(a,s,o,l,i),null!==l))&&tO(Array.from(a),[""],r,o,()=>function(e,t,n){const i=e._getTarget();t in i||(i[t]={});const r=i[t];if(lI(r)&&cI(n))return n;return r||{}}(t,n,i)))}function dO(e,t,n,i,r){for(;n;)n=cO(e,t,n,i,r);return n}function hO(e,t){for(const n of t){if(!n)continue;const t=n[e];if("undefined"!==typeof t)return t}}function pO(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const n of e)for(const e of Object.keys(n).filter(e=>!e.startsWith("_")))t.add(e);return Array.from(t)}(e._scopes)),t}const fO=Number.EPSILON||1e-14,mO=(e,t)=>t<e.length&&!e[t].skip&&e[t],gO=e=>"x"===e?"y":"x";function vO(e,t,n,i){const r=e.skip?t:e,o=t,s=n.skip?t:n,a=YI(o,r),l=YI(s,o);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const d=i*c,h=i*u;return{previous:{x:o.x-d*(s.x-r.x),y:o.y-d*(s.y-r.y)},next:{x:o.x+h*(s.x-r.x),y:o.y+h*(s.y-r.y)}}}function yO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const n=gO(t),i=e.length,r=Array(i).fill(0),o=Array(i);let s,a,l,c=mO(e,0);for(s=0;s<i;++s)if(a=l,l=c,c=mO(e,s+1),l){if(c){const e=c[t]-l[t];r[s]=0!==e?(c[n]-l[n])/e:0}o[s]=a?c?UI(r[s-1])!==UI(r[s])?0:(r[s-1]+r[s])/2:r[s-1]:r[s]}!function(e,t,n){const i=e.length;let r,o,s,a,l,c=mO(e,0);for(let u=0;u<i-1;++u)l=c,c=mO(e,u+1),l&&c&&(FI(t[u],0,fO)?n[u]=n[u+1]=0:(r=n[u]/t[u],o=n[u+1]/t[u],a=Math.pow(r,2)+Math.pow(o,2),a<=9||(s=3/Math.sqrt(a),n[u]=r*s*t[u],n[u+1]=o*s*t[u])))}(e,r,o),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const i=gO(n),r=e.length;let o,s,a,l=mO(e,0);for(let c=0;c<r;++c){if(s=a,a=l,l=mO(e,c+1),!a)continue;const r=a[n],u=a[i];s&&(o=(r-s[n])/3,a[`cp1${n}`]=r-o,a[`cp1${i}`]=u-o*t[c]),l&&(o=(l[n]-r)/3,a[`cp2${n}`]=r+o,a[`cp2${i}`]=u+o*t[c])}}(e,o,t)}function bO(e,t,n){return Math.max(Math.min(e,n),t)}function xO(e,t,n,i,r){let o,s,a,l;if(t.spanGaps&&(e=e.filter(e=>!e.skip)),"monotone"===t.cubicInterpolationMode)yO(e,r);else{let n=i?e[e.length-1]:e[0];for(o=0,s=e.length;o<s;++o)a=e[o],l=vO(n,a,e[Math.min(o+1,s-(i?0:1))%s],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,n=a}t.capBezierPoints&&function(e,t){let n,i,r,o,s,a=LL(e[0],t);for(n=0,i=e.length;n<i;++n)s=o,o=a,a=n<i-1&&LL(e[n+1],t),o&&(r=e[n],s&&(r.cp1x=bO(r.cp1x,t.left,t.right),r.cp1y=bO(r.cp1y,t.top,t.bottom)),a&&(r.cp2x=bO(r.cp2x,t.left,t.right),r.cp2y=bO(r.cp2y,t.top,t.bottom)))}(e,n)}function _O(){return"undefined"!==typeof window&&"undefined"!==typeof document}function wO(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function SO(e,t,n){let i;return"string"===typeof e?(i=parseInt(e,10),-1!==e.indexOf("%")&&(i=i/100*t.parentNode[n])):i=e,i}const MO=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);const EO=["top","right","bottom","left"];function CO(e,t,n){const i={};n=n?"-"+n:"";for(let r=0;r<4;r++){const o=EO[r];i[o]=parseFloat(e[t+"-"+o+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function TO(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,r=MO(n),o="border-box"===r.boxSizing,s=CO(r,"padding"),a=CO(r,"border","width"),{x:l,y:c,box:u}=function(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:r,offsetY:o}=i;let s,a,l=!1;if(((e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot))(r,o,e.target))s=r,a=o;else{const e=t.getBoundingClientRect();s=i.clientX-e.left,a=i.clientY-e.top,l=!0}return{x:s,y:a,box:l}}(e,n),d=s.left+(u&&a.left),h=s.top+(u&&a.top);let{width:p,height:f}=t;return o&&(p-=s.width+a.width,f-=s.height+a.height),{x:Math.round((l-d)/p*n.width/i),y:Math.round((c-h)/f*n.height/i)}}const AO=e=>Math.round(10*e)/10;function PO(e,t,n,i){const r=MO(e),o=CO(r,"margin"),s=SO(r.maxWidth,e,"clientWidth")||RI,a=SO(r.maxHeight,e,"clientHeight")||RI,l=function(e,t,n){let i,r;if(void 0===t||void 0===n){const o=e&&wO(e);if(o){const e=o.getBoundingClientRect(),s=MO(o),a=CO(s,"border","width"),l=CO(s,"padding");t=e.width-l.width-a.width,n=e.height-l.height-a.height,i=SO(s.maxWidth,o,"clientWidth"),r=SO(s.maxHeight,o,"clientHeight")}else t=e.clientWidth,n=e.clientHeight}return{width:t,height:n,maxWidth:i||RI,maxHeight:r||RI}}(e,t,n);let{width:c,height:u}=l;if("content-box"===r.boxSizing){const e=CO(r,"border","width"),t=CO(r,"padding");c-=t.width+e.width,u-=t.height+e.height}c=Math.max(0,c-o.width),u=Math.max(0,i?c/i:u-o.height),c=AO(Math.min(c,s,l.maxWidth)),u=AO(Math.min(u,a,l.maxHeight)),c&&!u&&(u=AO(c/2));return(void 0!==t||void 0!==n)&&i&&l.height&&u>l.height&&(u=l.height,c=AO(Math.floor(u*i))),{width:c,height:u}}function DO(e,t,n){const i=t||1,r=Math.floor(e.height*i),o=Math.floor(e.width*i);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const s=e.canvas;return s.style&&(n||!s.style.height&&!s.style.width)&&(s.style.height=`${e.height}px`,s.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==i||s.height!==r||s.width!==o)&&(e.currentDevicePixelRatio=i,s.height=r,s.width=o,e.ctx.setTransform(i,0,0,i,0,0),!0)}const kO=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};_O()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(nV){}return e}();function RO(e,t){const n=function(e,t){return MO(e).getPropertyValue(t)}(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function NO(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function IO(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:"middle"===i?n<.5?e.y:t.y:"after"===i?n<1?e.y:t.y:n>0?t.y:e.y}}function LO(e,t,n,i){const r={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},s=NO(e,r,n),a=NO(r,o,n),l=NO(o,t,n),c=NO(s,a,n),u=NO(a,l,n);return NO(c,u,n)}function OO(e,t,n){return e?function(e,t){return{x:n=>e+e+t-n,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,n):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function zO(e,t){let n,i;"ltr"!==t&&"rtl"!==t||(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function UO(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function FO(e){return"angle"===e?{between:ZI,compare:$I,normalize:qI}:{between:JI,compare:(e,t)=>e-t,normalize:e=>e}}function jO(e){let{start:t,end:n,count:i,loop:r,style:o}=e;return{start:t%i,end:n%i,loop:r&&(n-t+1)%i===0,style:o}}function BO(e,t,n){if(!n)return[e];const{property:i,start:r,end:o}=n,s=t.length,{compare:a,between:l,normalize:c}=FO(i),{start:u,end:d,loop:h,style:p}=function(e,t,n){const{property:i,start:r,end:o}=n,{between:s,normalize:a}=FO(i),l=t.length;let c,u,{start:d,end:h,loop:p}=e;if(p){for(d+=l,h+=l,c=0,u=l;c<u&&s(a(t[d%l][i]),r,o);++c)d--,h--;d%=l,h%=l}return h<d&&(h+=l),{start:d,end:h,loop:p,style:e.style}}(e,t,n),f=[];let m,g,v,y=!1,b=null;const x=()=>y||l(r,v,m)&&0!==a(r,v),_=()=>!y||0===a(o,m)||l(o,v,m);for(let w=u,S=u;w<=d;++w)g=t[w%s],g.skip||(m=c(g[i]),m!==v&&(y=l(m,r,o),null===b&&x()&&(b=0===a(m,r)?w:S),null!==b&&_()&&(f.push(jO({start:b,end:w,loop:h,count:s,style:p})),b=null),S=w,v=m));return null!==b&&f.push(jO({start:b,end:d,loop:h,count:s,style:p})),f}function VO(e,t){const n=[],i=e.segments;for(let r=0;r<i.length;r++){const o=BO(i[r],e.points,t);o.length&&n.push(...o)}return n}function HO(e,t,n,i){return i&&i.setContext&&n?function(e,t,n,i){const r=e._chart.getContext(),o=GO(e.options),{_datasetIndex:s,options:{spanGaps:a}}=e,l=n.length,c=[];let u=o,d=t[0].start,h=d;function p(e,t,i,r){const o=a?-1:1;if(e!==t){for(e+=l;n[e%l].skip;)e-=o;for(;n[t%l].skip;)t+=o;e%l!==t%l&&(c.push({start:e%l,end:t%l,loop:i,style:r}),u=r,d=t%l)}}for(const f of t){d=a?d:f.start;let e,t=n[d%l];for(h=d+1;h<=f.end;h++){const o=n[h%l];e=GO(i.setContext(eO(r,{type:"segment",p0:t,p1:o,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:s}))),WO(e,u)&&p(d,h-1,f.loop,u),t=o,u=e}d<h-1&&p(d,h-1,f.loop,u)}return c}(e,t,n,i):t}function GO(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function WO(e,t){if(!t)return!1;const n=[],i=function(e,t){return mL(t)?(n.includes(t)||n.push(t),n.indexOf(t)):t};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function XO(e,t,n){return e.options.clip?e[n]:t[n]}function YO(e,t){const n=t._clip;if(n.disabled)return!1;const i=function(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:XO(n,t,"left"),right:XO(n,t,"right"),top:XO(i,t,"top"),bottom:XO(i,t,"bottom")}:t}(t,e.chartArea);return{left:!1===n.left?0:i.left-(!0===n.left?0:n.left),right:!1===n.right?e.width:i.right+(!0===n.right?0:n.right),top:!1===n.top?0:i.top-(!0===n.top?0:n.top),bottom:!1===n.bottom?e.height:i.bottom+(!0===n.bottom?0:n.bottom)}}class $O{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,i){const r=t.listeners[i],o=t.duration;r.forEach(i=>i({chart:e,initial:t.initial,numSteps:o,currentStep:Math.min(n-t.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=oL.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;const r=n.items;let o,s=r.length-1,a=!1;for(;s>=0;--s)o=r[s],o._active?(o._total>n.duration&&(n.duration=o._total),o.tick(e),a=!0):(r[s]=r[r.length-1],r.pop());a&&(i.draw(),this._notify(i,n,e,"progress")),r.length||(n.running=!1,this._notify(i,n,e,"complete"),n.initial=!1),t+=r.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var qO=new $O;const ZO="transparent",KO={boolean:(e,t,n)=>n>.5?t:e,color(e,t,n){const i=gL(e||ZO),r=i.valid&&gL(t||ZO);return r&&r.valid?r.mix(i,n).hexString():t},number:(e,t,n)=>e+(t-e)*n};class JO{constructor(e,t,n,i){const r=t[n];i=QL([e.to,i,r,e.from]);const o=QL([e.from,r,i]);this._active=!0,this._fn=e.fn||KO[e.type||typeof o],this._easing=fL[e.easing]||fL.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const i=this._target[this._prop],r=n-this._start,o=this._duration-r;this._start=n,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=r,this._loop=!!e.loop,this._to=QL([e.to,t,i,e.from]),this._from=QL([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,i=this._prop,r=this._from,o=this._loop,s=this._to;let a;if(this._active=r!==s&&(o||t<n),!this._active)return this._target[i]=s,void this._notify(!0);t<0?this._target[i]=r:(a=t/n%2,a=o&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[i]=this._fn(r,s,a))}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][t]()}}class QO{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!cI(e))return;const t=Object.keys(PL.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const r=e[i];if(!cI(r))return;const o={};for(const e of t)o[e]=r[e];(lI(r.properties)&&r.properties||[i]).forEach(e=>{e!==i&&n.has(e)||n.set(e,o)})})}_animateOptions(e,t){const n=t.options,i=function(e,t){if(!t)return;let n=e.options;if(!n)return void(e.options=t);n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(e,n);if(!i)return[];const r=this._createAnimations(i,n);return n.$shared&&function(e,t){const n=[],i=Object.keys(t);for(let r=0;r<i.length;r++){const t=e[i[r]];t&&t.active()&&n.push(t.wait())}return Promise.all(n)}(e.options.$animations,n).then(()=>{e.options=n},()=>{}),r}_createAnimations(e,t){const n=this._properties,i=[],r=e.$animations||(e.$animations={}),o=Object.keys(t),s=Date.now();let a;for(a=o.length-1;a>=0;--a){const l=o[a];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(e,t));continue}const c=t[l];let u=r[l];const d=n.get(l);if(u){if(d&&u.active()){u.update(d,c,s);continue}u.cancel()}d&&d.duration?(r[l]=u=new JO(d,e,l,c),i.push(u)):e[l]=c}return i}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const n=this._createAnimations(e,t);return n.length?(qO.add(this._chart,n),!0):void 0}}function ez(e,t){const n=e&&e.options||{},i=n.reverse,r=void 0===n.min?t:0,o=void 0===n.max?t:0;return{start:i?o:r,end:i?r:o}}function tz(e,t){const n=[],i=e._getSortedDatasetMetas(t);let r,o;for(r=0,o=i.length;r<o;++r)n.push(i[r].index);return n}function nz(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=e.keys,o="single"===i.mode;let s,a,l,c;if(null===t)return;let u=!1;for(s=0,a=r.length;s<a;++s){if(l=+r[s],l===n){if(u=!0,i.all)continue;break}c=e.values[l],uI(c)&&(o||0===t||UI(t)===UI(c))&&(t+=c)}return u||i.all?t:0}function iz(e,t){const n=e&&e.options.stacked;return n||void 0===n&&void 0!==t.stack}function rz(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function oz(e,t,n,i){for(const r of t.getMatchingVisibleMetas(i).reverse()){const t=e[r.index];if(n&&t>0||!n&&t<0)return r.index}return null}function sz(e,t){const{chart:n,_cachedMeta:i}=e,r=n._stacks||(n._stacks={}),{iScale:o,vScale:s,index:a}=i,l=o.axis,c=s.axis,u=function(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}(o,s,i),d=t.length;let h;for(let p=0;p<d;++p){const e=t[p],{[l]:n,[c]:o}=e;h=(e._stacks||(e._stacks={}))[c]=rz(r,u,n),h[a]=o,h._top=oz(h,s,!0,i.type),h._bottom=oz(h,s,!1,i.type);(h._visualValues||(h._visualValues={}))[a]=o}}function az(e,t){const n=e.scales;return Object.keys(n).filter(e=>n[e].axis===t).shift()}function lz(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[i]||void 0===t[i][n])return;delete t[i][n],void 0!==t[i]._visualValues&&void 0!==t[i]._visualValues[n]&&delete t[i]._visualValues[n]}}}const cz=e=>"reset"===e||"none"===e,uz=(e,t)=>t?e:Object.assign({},e);class dz{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=iz(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&lz(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),i=(e,t,n,i)=>"x"===e?t:"r"===e?i:n,r=t.xAxisID=hI(n.xAxisID,az(e,"x")),o=t.yAxisID=hI(n.yAxisID,az(e,"y")),s=t.rAxisID=hI(n.rAxisID,az(e,"r")),a=t.indexAxis,l=t.iAxisID=i(a,r,o,s),c=t.vAxisID=i(a,o,r,s);t.xScale=this.getScaleForId(r),t.yScale=this.getScaleForId(o),t.rScale=this.getScaleForId(s),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&iL(this._data,this),e._stacked&&lz(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(cI(t)){const e=this._cachedMeta;this._data=function(e,t){const{iScale:n,vScale:i}=t,r="x"===n.axis?"x":"y",o="x"===i.axis?"x":"y",s=Object.keys(e),a=new Array(s.length);let l,c,u;for(l=0,c=s.length;l<c;++l)u=s[l],a[l]={[r]:u,[o]:e[u]};return a}(t,e)}else if(n!==t){if(n){iL(n,this);const e=this._cachedMeta;lz(e),e._parsed=[]}t&&Object.isExtensible(t)&&function(e,t){e._chartjs?e._chartjs.listeners.push(t):(Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),nL.forEach(t=>{const n="_onData"+EI(t),i=e[t];Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];const s=i.apply(this,r);return e._chartjs.listeners.forEach(e=>{"function"===typeof e[n]&&e[n](...r)}),s}})}))}(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const r=t._stacked;t._stacked=iz(t.vScale,t),t.stack!==n.stack&&(i=!0,lz(t),t.stack=n.stack),this._resyncElements(e),(i||r!==t._stacked)&&(sz(this,t._parsed),t._stacked=iz(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:i}=this,{iScale:r,_stacked:o}=n,s=r.axis;let a,l,c,u=0===e&&t===i.length||n._sorted,d=e>0&&n._parsed[e-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,c=i;else{c=lI(i[e])?this.parseArrayData(n,i,e,t):cI(i[e])?this.parseObjectData(n,i,e,t):this.parsePrimitiveData(n,i,e,t);const r=()=>null===l[s]||d&&l[s]<d[s];for(a=0;a<t;++a)n._parsed[a+e]=l=c[a],u&&(r()&&(u=!1),d=l);n._sorted=u}o&&sz(this,c)}parsePrimitiveData(e,t,n,i){const{iScale:r,vScale:o}=e,s=r.axis,a=o.axis,l=r.getLabels(),c=r===o,u=new Array(i);let d,h,p;for(d=0,h=i;d<h;++d)p=d+n,u[d]={[s]:c||r.parse(l[p],p),[a]:o.parse(t[p],p)};return u}parseArrayData(e,t,n,i){const{xScale:r,yScale:o}=e,s=new Array(i);let a,l,c,u;for(a=0,l=i;a<l;++a)c=a+n,u=t[c],s[a]={x:r.parse(u[0],c),y:o.parse(u[1],c)};return s}parseObjectData(e,t,n,i){const{xScale:r,yScale:o}=e,{xAxisKey:s="x",yAxisKey:a="y"}=this._parsing,l=new Array(i);let c,u,d,h;for(c=0,u=i;c<u;++c)d=c+n,h=t[d],l[c]={x:r.parse(MI(h,s),d),y:o.parse(MI(h,a),d)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const i=this.chart,r=this._cachedMeta,o=t[e.axis];return nz({keys:tz(i,!0),values:t._stacks[e.axis]._visualValues},o,r.index,{mode:n})}updateRangeFromParsed(e,t,n,i){const r=n[t.axis];let o=null===r?NaN:r;const s=i&&n._stacks[t.axis];i&&s&&(i.values=s,o=nz(i,r,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,t){const n=this._cachedMeta,i=n._parsed,r=n._sorted&&e===n.iScale,o=i.length,s=this._getOtherScale(e),a=((e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:tz(n,!0),values:null})(t,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(e){const{min:t,max:n,minDefined:i,maxDefined:r}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:r?n:Number.POSITIVE_INFINITY}}(s);let d,h;function p(){h=i[d];const t=h[s.axis];return!uI(h[e.axis])||c>t||u<t}for(d=0;d<o&&(p()||(this.updateRangeFromParsed(l,e,h,a),!r));++d);if(r)for(d=o-1;d>=0;--d)if(!p()){this.updateRangeFromParsed(l,e,h,a);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let i,r,o;for(i=0,r=t.length;i<r;++i)o=t[i][e.axis],uI(o)&&n.push(o);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,i=t.vScale,r=this.getParsed(e);return{label:n?""+n.getLabelForValue(r[n.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,n,i,r;return cI(e)?(t=e.top,n=e.right,i=e.bottom,r=e.left):t=n=i=r=e,{top:t,right:n,bottom:i,left:r,disabled:!1===e}}(hI(this.options.clip,function(e,t,n){if(!1===n)return!1;const i=ez(e,n),r=ez(t,n);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,i=n.data||[],r=t.chartArea,o=[],s=this._drawStart||0,a=this._drawCount||i.length-s,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(e,r,s,a),c=s;c<s+a;++c){const t=i[c];t.hidden||(t.active&&l?o.push(t):t.draw(e,r))}for(c=0;c<o.length;++c)o[c].draw(e,r)}getStyle(e,t){const n=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const i=this.getDataset();let r;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];r=t.$context||(t.$context=function(e,t,n){return eO(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),r.parsed=this.getParsed(e),r.raw=i.data[e],r.index=r.dataIndex=e}else r=this.$context||(this.$context=function(e,t){return eO(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!t,r.mode=n,r}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2?arguments[2]:void 0;const i="active"===t,r=this._cachedDataOpts,o=e+"-"+t,s=r[o],a=this.enableOptionSharing&&CI(n);if(s)return uz(s,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),u=i?[`${e}Hover`,"hover",e,""]:[e,""],d=l.getOptionScopes(this.getDataset(),c),h=Object.keys(PL.elements[e]),p=l.resolveNamedOptions(d,h,()=>this.getContext(n,i,t),u);return p.$shared&&(p.$shared=a,r[o]=Object.freeze(uz(p,a))),p}_resolveAnimations(e,t,n){const i=this.chart,r=this._cachedDataOpts,o=`animation-${t}`,s=r[o];if(s)return s;let a;if(!1!==i.options.animation){const i=this.chart.config,r=i.datasetAnimationScopeKeys(this._type,t),o=i.getOptionScopes(this.getDataset(),r);a=i.createResolver(o,this.getContext(e,n,t))}const l=new QO(i,a&&a.animations);return a&&a._cacheable&&(r[o]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||cz(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),i=this._sharedOptions,r=this.getSharedOptions(n),o=this.includeOptions(t,r)||r!==i;return this.updateSharedOptions(r,t,n),{sharedOptions:r,includeOptions:o}}updateElement(e,t,n,i){cz(i)?Object.assign(e,n):this._resolveAnimations(t,i).update(e,n)}updateSharedOptions(e,t,n){e&&!cz(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,i){e.active=i;const r=this.getStyle(t,i);this._resolveAnimations(t,n,i).update(e,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[s,a,l]of this._syncList)this[s](a,l);this._syncList=[];const i=n.length,r=t.length,o=Math.min(r,i);o&&this.parse(0,o),r>i?this._insertElements(i,r-i,e):r<i&&this._removeElements(r,i-r)}_insertElements(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this._cachedMeta,r=i.data,o=e+t;let s;const a=e=>{for(e.length+=t,s=e.length-1;s>=o;s--)e[s]=e[s-t]};for(a(r),s=e;s<o;++s)r[s]=new this.dataElementType;this._parsing&&a(i._parsed),this.parse(e,t),n&&this.updateElements(r,e,t,"reset")}updateElements(e,t,n,i){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(e,t);n._stacked&&lz(n,i)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,i]=e;this[t](n,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function hz(e){const t=e.iScale,n=function(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let t=0,r=n.length;t<r;t++)i=i.concat(n[t].controller.getAllParsedValues(e));e._cache.$bar=rL(i.sort((e,t)=>e-t))}return e._cache.$bar}(t,e.type);let i,r,o,s,a=t._length;const l=()=>{32767!==o&&-32768!==o&&(CI(s)&&(a=Math.min(a,Math.abs(o-s)||a)),s=o)};for(i=0,r=n.length;i<r;++i)o=t.getPixelForValue(n[i]),l();for(s=void 0,i=0,r=t.ticks.length;i<r;++i)o=t.getPixelForTick(i),l();return a}function pz(e,t,n,i){return lI(e)?function(e,t,n,i){const r=n.parse(e[0],i),o=n.parse(e[1],i),s=Math.min(r,o),a=Math.max(r,o);let l=s,c=a;Math.abs(s)>Math.abs(a)&&(l=a,c=s),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:r,end:o,min:s,max:a}}(e,t,n,i):t[n.axis]=n.parse(e,i),t}function fz(e,t,n,i){const r=e.iScale,o=e.vScale,s=r.getLabels(),a=r===o,l=[];let c,u,d,h;for(c=n,u=n+i;c<u;++c)h=t[c],d={},d[r.axis]=a||r.parse(s[c],c),l.push(pz(h,d,o,c));return l}function mz(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function gz(e,t,n,i){let r=t.borderSkipped;const o={};if(!r)return void(e.borderSkipped=o);if(!0===r)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:s,end:a,reverse:l,top:c,bottom:u}=function(e){let t,n,i,r,o;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(r="end",o="start"):(r="start",o="end"),{start:n,end:i,reverse:t,top:r,bottom:o}}(e);"middle"===r&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?r=c:(n._bottom||0)===i?r=u:(o[vz(u,s,a,l)]=!0,r=c)),o[vz(r,s,a,l)]=!0,e.borderSkipped=o}function vz(e,t,n,i){var r,o,s;return i?(s=n,e=yz(e=(r=e)===(o=t)?s:r===s?o:r,n,t)):e=yz(e,t,n),e}function yz(e,t,n){return"start"===e?t:"end"===e?n:e}function bz(e,t,n){let{inflateAmount:i}=t;e.inflateAmount="auto"===i?1===n?.33:0:i}class xz extends dz{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,n,i){return fz(e,t,n,i)}parseArrayData(e,t,n,i){return fz(e,t,n,i)}parseObjectData(e,t,n,i){const{iScale:r,vScale:o}=e,{xAxisKey:s="x",yAxisKey:a="y"}=this._parsing,l="x"===r.axis?s:a,c="x"===o.axis?s:a,u=[];let d,h,p,f;for(d=n,h=n+i;d<h;++d)f=t[d],p={},p[r.axis]=r.parse(MI(f,l),d),u.push(pz(MI(f,c),p,o,d));return u}updateRangeFromParsed(e,t,n,i){super.updateRangeFromParsed(e,t,n,i);const r=n._custom;r&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,r.min),e.max=Math.max(e.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:i}=t,r=this.getParsed(e),o=r._custom,s=mz(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+n.getLabelForValue(r[n.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,i){const r="reset"===i,{index:o,_cachedMeta:{vScale:s}}=this,a=s.getBasePixel(),l=s.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:d}=this._getSharedOptions(t,i);for(let h=t;h<t+n;h++){const t=this.getParsed(h),n=r||aI(t[s.axis])?{base:a,head:a}:this._calculateBarValuePixels(h),p=this._calculateBarIndexPixels(h,c),f=(t._stacks||{})[s.axis],m={horizontal:l,base:n.base,enableBorderRadius:!f||mz(t._custom)||o===f._top||o===f._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};d&&(m.options=u||this.resolveDataElementOptions(h,e[h].active?"active":i));const g=m.options||e[h].options;gz(m,g,f,o),bz(m,g,c.ratio),this.updateElement(e[h],h,m,i)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter(e=>e.controller.options.grouped),r=n.options.stacked,o=[],s=this._cachedMeta.controller.getParsed(t),a=s&&s[n.axis],l=e=>{const t=e._parsed.find(e=>e[n.axis]===a),i=t&&t[e.vScale.axis];if(aI(i)||isNaN(i))return!0};for(const c of i)if((void 0===t||!l(c))&&((!1===r||-1===o.indexOf(c.stack)||void 0===r&&void 0===c.stack)&&o.push(c.stack),c.index===e))break;return o.length||o.push(void 0),o}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(n=>e[n].axis===t).shift()}_getAxis(){const e={},t=this.getFirstScaleIdForIndexAxis();for(const n of this.chart.data.datasets)e[hI("x"===this.chart.options.indexAxis?n.xAxisID:n.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,n){const i=this._getStacks(e,n),r=void 0!==t?i.indexOf(t):-1;return-1===r?i.length-1:r}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,i=[];let r,o;for(r=0,o=t.data.length;r<o;++r)i.push(n.getPixelForValue(this.getParsed(r)[n.axis],r));const s=e.barThickness;return{min:s||hz(t),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:s?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:i},options:{base:r,minBarLength:o}}=this,s=r||0,a=this.getParsed(e),l=a._custom,c=mz(l);let u,d,h=a[t.axis],p=0,f=n?this.applyStack(t,a,n):h;f!==h&&(p=f-h,f=h),c&&(h=l.barStart,f=l.barEnd-l.barStart,0!==h&&UI(h)!==UI(l.barEnd)&&(p=0),p+=h);const m=aI(r)||c?p:r;let g=t.getPixelForValue(m);if(u=this.chart.getDataVisibility(e)?t.getPixelForValue(p+f):g,d=u-g,Math.abs(d)<o){d=function(e,t,n){return 0!==e?UI(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}(d,t,s)*o,h===s&&(g-=d/2);const e=t.getPixelForDecimal(0),r=t.getPixelForDecimal(1),l=Math.min(e,r),p=Math.max(e,r);g=Math.max(Math.min(g,p),l),u=g+d,n&&!c&&(a._stacks[t.axis]._visualValues[i]=t.getValueForPixel(u)-t.getValueForPixel(g))}if(g===t.getPixelForValue(s)){const e=UI(d)*t.getLineWidthForValue(s)/2;g+=e,d-=e}return{size:d,base:g,head:u,center:u+d/2}}_calculateBarIndexPixels(e,t){const n=t.scale,i=this.options,r=i.skipNull,o=hI(i.maxBarThickness,1/0);let s,a;const l=this._getAxisCount();if(t.grouped){const n=r?this._getStackCount(e):t.stackCount,c="flex"===i.barThickness?function(e,t,n,i){const r=t.pixels,o=r[e];let s=e>0?r[e-1]:null,a=e<r.length-1?r[e+1]:null;const l=n.categoryPercentage;null===s&&(s=o-(null===a?t.end-t.start:a-o)),null===a&&(a=o+o-s);const c=o-(o-Math.min(s,a))/2*l;return{chunk:Math.abs(a-s)/2*l/i,ratio:n.barPercentage,start:c}}(e,t,i,n*l):function(e,t,n,i){const r=n.barThickness;let o,s;return aI(r)?(o=t.min*n.categoryPercentage,s=n.barPercentage):(o=r*i,s=1),{chunk:o/i,ratio:s,start:t.pixels[e]-o/2}}(e,t,i,n*l),u="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,d=this._getAxis().indexOf(hI(u,this.getFirstScaleIdForIndexAxis())),h=this._getStackIndex(this.index,this._cachedMeta.stack,r?e:void 0)+d;s=c.start+c.chunk*h+c.chunk/2,a=Math.min(o,c.chunk*c.ratio)}else s=n.getPixelForValue(this.getParsed(e)[n.axis],e),a=Math.min(o,t.min*t.ratio);return{base:s-a/2,head:s+a/2,center:s,size:a}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,i=n.length;let r=0;for(;r<i;++r)null===this.getParsed(r)[t.axis]||n[r].hidden||n[r].draw(this._ctx)}}class _z extends dz{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:i=[],_dataset:r}=t,o=this.chart._animationsDisabled;let{start:s,count:a}=cL(t,i,o);this._drawStart=s,this._drawCount=a,uL(t)&&(s=0,a=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!r._decimated,n.points=i;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!o,options:l},e),this.updateElements(i,s,a,e)}updateElements(e,t,n,i){const r="reset"===i,{iScale:o,vScale:s,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(t,i),d=o.axis,h=s.axis,{spanGaps:p,segment:f}=this.options,m=BI(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===i,v=t+n,y=e.length;let b=t>0&&this.getParsed(t-1);for(let x=0;x<y;++x){const n=e[x],p=g?n:{};if(x<t||x>=v){p.skip=!0;continue}const y=this.getParsed(x),_=aI(y[h]),w=p[d]=o.getPixelForValue(y[d],x),S=p[h]=r||_?s.getBasePixel():s.getPixelForValue(a?this.applyStack(s,y,a):y[h],x);p.skip=isNaN(w)||isNaN(S)||_,p.stop=x>0&&Math.abs(y[d]-b[d])>m,f&&(p.parsed=y,p.raw=l.data[x]),u&&(p.options=c||this.resolveDataElementOptions(x,n.active?"active":i)),g||this.updateElement(n,x,p,i),b=y}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return n;const r=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,r,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}class wz extends dz{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=t,o=this.getParsed(e),s=i.getLabelForValue(o.x),a=r.getLabelForValue(o.y);return{label:n[e]||"",value:"("+s+", "+a+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,i=this.chart._animationsDisabled;let{start:r,count:o}=cL(t,n,i);if(this._drawStart=r,this._drawCount=o,uL(t)&&(r=0,o=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:o}=t;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!o._decimated,r.points=n;const s=this.resolveDatasetElementOptions(e);s.segment=this.options.segment,this.updateElement(r,void 0,{animated:!i,options:s},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,r,o,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,i){const r="reset"===i,{iScale:o,vScale:s,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,i),u=this.getSharedOptions(c),d=this.includeOptions(i,u),h=o.axis,p=s.axis,{spanGaps:f,segment:m}=this.options,g=BI(f)?f:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||r||"none"===i;let y=t>0&&this.getParsed(t-1);for(let b=t;b<t+n;++b){const t=e[b],n=this.getParsed(b),c=v?t:{},f=aI(n[p]),x=c[h]=o.getPixelForValue(n[h],b),_=c[p]=r||f?s.getBasePixel():s.getPixelForValue(a?this.applyStack(s,n,a):n[p],b);c.skip=isNaN(x)||isNaN(_)||f,c.stop=b>0&&Math.abs(n[h]-y[h])>g,m&&(c.parsed=n,c.raw=l.data[b]),d&&(c.options=u||this.resolveDataElementOptions(b,t.active?"active":i)),v||this.updateElement(t,b,c,i),y=n}this.updateSharedOptions(u,i,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}const n=e.dataset,i=n.options&&n.options.borderWidth||0;if(!t.length)return i;const r=t[0].size(this.resolveDataElementOptions(0)),o=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(i,r,o)/2}}function Sz(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Mz{static override(e){Object.assign(Mz.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return Sz()}parse(){return Sz()}format(){return Sz()}add(){return Sz()}diff(){return Sz()}startOf(){return Sz()}endOf(){return Sz()}}var Ez=Mz;function Cz(e,t,n,i){const{controller:r,data:o,_sorted:s}=e,a=r._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&"r"!==t&&s&&o.length){const s=a._reversePixels?tL:eL;if(!i){const i=s(o,t,n);if(l){const{vScale:t}=r._cachedMeta,{_parsed:n}=e,o=n.slice(0,i.lo+1).reverse().findIndex(e=>!aI(e[t.axis]));i.lo-=Math.max(0,o);const s=n.slice(i.hi).findIndex(e=>!aI(e[t.axis]));i.hi+=Math.max(0,s)}return i}if(r._sharedOptions){const e=o[0],i="function"===typeof e.getRange&&e.getRange(t);if(i){const e=s(o,t,n-i),r=s(o,t,n+i);return{lo:e.lo,hi:r.hi}}}}return{lo:0,hi:o.length-1}}function Tz(e,t,n,i,r){const o=e.getSortedVisibleDatasetMetas(),s=n[t];for(let a=0,l=o.length;a<l;++a){const{index:e,data:n}=o[a],{lo:l,hi:c}=Cz(o[a],t,s,r);for(let t=l;t<=c;++t){const r=n[t];r.skip||i(r,e,t)}}}function Az(e,t,n,i,r){const o=[];if(!r&&!e.isPointInArea(t))return o;return Tz(e,n,t,function(n,s,a){(r||LL(n,e.chartArea,0))&&n.inRange(t.x,t.y,i)&&o.push({element:n,datasetIndex:s,index:a})},!0),o}function Pz(e,t,n,i,r,o){let s=[];const a=function(e){const t=-1!==e.indexOf("x"),n=-1!==e.indexOf("y");return function(e,i){const r=t?Math.abs(e.x-i.x):0,o=n?Math.abs(e.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}(n);let l=Number.POSITIVE_INFINITY;return Tz(e,n,t,function(n,c,u){const d=n.inRange(t.x,t.y,r);if(i&&!d)return;const h=n.getCenterPoint(r);if(!(!!o||e.isPointInArea(h))&&!d)return;const p=a(t,h);p<l?(s=[{element:n,datasetIndex:c,index:u}],l=p):p===l&&s.push({element:n,datasetIndex:c,index:u})}),s}function Dz(e,t,n,i,r,o){return o||e.isPointInArea(t)?"r"!==n||i?Pz(e,t,n,i,r,o):function(e,t,n,i){let r=[];return Tz(e,n,t,function(e,n,o){const{startAngle:s,endAngle:a}=e.getProps(["startAngle","endAngle"],i),{angle:l}=XI(e,{x:t.x,y:t.y});ZI(l,s,a)&&r.push({element:e,datasetIndex:n,index:o})}),r}(e,t,n,r):[]}function kz(e,t,n,i,r){const o=[],s="x"===n?"inXRange":"inYRange";let a=!1;return Tz(e,n,t,(e,i,l)=>{e[s]&&e[s](t[n],r)&&(o.push({element:e,datasetIndex:i,index:l}),a=a||e.inRange(t.x,t.y,r))}),i&&!a?[]:o}var Rz={evaluateInteractionItems:Tz,modes:{index(e,t,n,i){const r=TO(t,e),o=n.axis||"x",s=n.includeInvisible||!1,a=n.intersect?Az(e,r,o,i,s):Dz(e,r,o,!1,i,s),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(e=>{const t=a[0].index,n=e.data[t];n&&!n.skip&&l.push({element:n,datasetIndex:e.index,index:t})}),l):[]},dataset(e,t,n,i){const r=TO(t,e),o=n.axis||"xy",s=n.includeInvisible||!1;let a=n.intersect?Az(e,r,o,i,s):Dz(e,r,o,!1,i,s);if(a.length>0){const t=a[0].datasetIndex,n=e.getDatasetMeta(t).data;a=[];for(let e=0;e<n.length;++e)a.push({element:n[e],datasetIndex:t,index:e})}return a},point:(e,t,n,i)=>Az(e,TO(t,e),n.axis||"xy",i,n.includeInvisible||!1),nearest(e,t,n,i){const r=TO(t,e),o=n.axis||"xy",s=n.includeInvisible||!1;return Dz(e,r,o,n.intersect,i,s)},x:(e,t,n,i)=>kz(e,TO(t,e),"x",n.intersect,i),y:(e,t,n,i)=>kz(e,TO(t,e),"y",n.intersect,i)}};const Nz=["left","top","right","bottom"];function Iz(e,t){return e.filter(e=>e.pos===t)}function Lz(e,t){return e.filter(e=>-1===Nz.indexOf(e.pos)&&e.box.axis===t)}function Oz(e,t){return e.sort((e,n)=>{const i=t?n:e,r=t?e:n;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function zz(e,t){const n=function(e){const t={};for(const n of e){const{stack:e,pos:i,stackWeight:r}=n;if(!e||!Nz.includes(i))continue;const o=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}(e),{vBoxMaxWidth:i,hBoxMaxHeight:r}=t;let o,s,a;for(o=0,s=e.length;o<s;++o){a=e[o];const{fullSize:s}=a.box,l=n[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*i:s&&t.availableWidth,a.height=r):(a.width=i,a.height=c?c*r:s&&t.availableHeight)}return n}function Uz(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function Fz(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function jz(e,t,n,i){const{pos:r,box:o}=n,s=e.maxPadding;if(!cI(r)){n.size&&(e[r]-=n.size);const t=i[n.stack]||{size:0,count:1};t.size=Math.max(t.size,n.horizontal?o.height:o.width),n.size=t.size/t.count,e[r]+=n.size}o.getPadding&&Fz(s,o.getPadding());const a=Math.max(0,t.outerWidth-Uz(s,e,"left","right")),l=Math.max(0,t.outerHeight-Uz(s,e,"top","bottom")),c=a!==e.w,u=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function Bz(e,t){const n=t.maxPadding;function i(e){const i={left:0,top:0,right:0,bottom:0};return e.forEach(e=>{i[e]=Math.max(t[e],n[e])}),i}return i(e?["left","right"]:["top","bottom"])}function Vz(e,t,n,i){const r=[];let o,s,a,l,c,u;for(o=0,s=e.length,c=0;o<s;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,Bz(a.horizontal,t));const{same:s,other:d}=jz(t,n,a,i);c|=s&&r.length,u=u||d,l.fullSize||r.push(a)}return c&&Vz(r,t,n,i)||u}function Hz(e,t,n,i,r){e.top=n,e.left=t,e.right=t+i,e.bottom=n+r,e.width=i,e.height=r}function Gz(e,t,n,i){const r=n.padding;let{x:o,y:s}=t;for(const a of e){const e=a.box,l=i[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const i=t.w*c,o=l.size||e.height;CI(l.start)&&(s=l.start),e.fullSize?Hz(e,r.left,s,n.outerWidth-r.right-r.left,o):Hz(e,t.left+l.placed,s,i,o),l.start=s,l.placed+=i,s=e.bottom}else{const i=t.h*c,s=l.size||e.width;CI(l.start)&&(o=l.start),e.fullSize?Hz(e,o,r.top,s,n.outerHeight-r.bottom-r.top):Hz(e,o,t.top+l.placed,s,i),l.start=o,l.placed+=i,o=e.right}}t.x=o,t.y=s}var Wz={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;-1!==n&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const r=KL(e.options.layout.padding),o=Math.max(t-r.width,0),s=Math.max(n-r.height,0),a=function(e){const t=function(e){const t=[];let n,i,r,o,s,a;for(n=0,i=(e||[]).length;n<i;++n)r=e[n],({position:o,options:{stack:s,stackWeight:a=1}}=r),t.push({index:n,box:r,pos:o,horizontal:r.isHorizontal(),weight:r.weight,stack:s&&o+s,stackWeight:a});return t}(e),n=Oz(t.filter(e=>e.box.fullSize),!0),i=Oz(Iz(t,"left"),!0),r=Oz(Iz(t,"right")),o=Oz(Iz(t,"top"),!0),s=Oz(Iz(t,"bottom")),a=Lz(t,"x"),l=Lz(t,"y");return{fullSize:n,leftAndTop:i.concat(o),rightAndBottom:r.concat(l).concat(s).concat(a),chartArea:Iz(t,"chartArea"),vertical:i.concat(r).concat(l),horizontal:o.concat(s).concat(a)}}(e.boxes),l=a.vertical,c=a.horizontal;mI(e.boxes,e=>{"function"===typeof e.beforeLayout&&e.beforeLayout()});const u=l.reduce((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1,0)||1,d=Object.freeze({outerWidth:t,outerHeight:n,padding:r,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/u,hBoxMaxHeight:s/2}),h=Object.assign({},r);Fz(h,KL(i));const p=Object.assign({maxPadding:h,w:o,h:s,x:r.left,y:r.top},r),f=zz(l.concat(c),d);Vz(a.fullSize,p,d,f),Vz(l,p,d,f),Vz(c,p,d,f)&&Vz(l,p,d,f),function(e){const t=e.maxPadding;function n(n){const i=Math.max(t[n]-e[n],0);return e[n]+=i,i}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}(p),Gz(a.leftAndTop,p,d,f),p.x+=p.w,p.y+=p.h,Gz(a.rightAndBottom,p,d,f),e.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},mI(a.chartArea,t=>{const n=t.box;Object.assign(n,e.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class Xz{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,i){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):n)}}isAttached(e){return!0}updateConfig(e){}}class Yz extends Xz{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const $z="$chartjs",qz={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Zz=e=>null===e||""===e;const Kz=!!kO&&{passive:!0};function Jz(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,Kz)}function Qz(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function eU(e,t,n){const i=e.canvas,r=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||Qz(n.addedNodes,i),t=t&&!Qz(n.removedNodes,i);t&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}function tU(e,t,n){const i=e.canvas,r=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||Qz(n.removedNodes,i),t=t&&!Qz(n.addedNodes,i);t&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}const nU=new Map;let iU=0;function rU(){const e=window.devicePixelRatio;e!==iU&&(iU=e,nU.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function oU(e,t,n){const i=e.canvas,r=i&&wO(i);if(!r)return;const o=sL((e,t)=>{const i=r.clientWidth;n(e,t),i<r.clientWidth&&n()},window),s=new ResizeObserver(e=>{const t=e[0],n=t.contentRect.width,i=t.contentRect.height;0===n&&0===i||o(n,i)});return s.observe(r),function(e,t){nU.size||window.addEventListener("resize",rU),nU.set(e,t)}(e,o),s}function sU(e,t,n){n&&n.disconnect(),"resize"===t&&function(e){nU.delete(e),nU.size||window.removeEventListener("resize",rU)}(e)}function aU(e,t,n){const i=e.canvas,r=sL(t=>{null!==e.ctx&&n(function(e,t){const n=qz[e.type]||e.type,{x:i,y:r}=TO(e,t);return{type:n,chart:t,native:e,x:void 0!==i?i:null,y:void 0!==r?r:null}}(t,e))},e);return function(e,t,n){e&&e.addEventListener(t,n,Kz)}(i,t,r),r}class lU extends Xz{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(function(e,t){const n=e.style,i=e.getAttribute("height"),r=e.getAttribute("width");if(e[$z]={initial:{height:i,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Zz(r)){const t=RO(e,"width");void 0!==t&&(e.width=t)}if(Zz(i))if(""===e.style.height)e.height=e.width/(t||2);else{const t=RO(e,"height");void 0!==t&&(e.height=t)}}(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[$z])return!1;const n=t[$z].initial;["height","width"].forEach(e=>{const i=n[e];aI(i)?t.removeAttribute(e):t.setAttribute(e,i)});const i=n.style||{};return Object.keys(i).forEach(e=>{t.style[e]=i[e]}),t.width=t.width,delete t[$z],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),r={attach:eU,detach:tU,resize:oU}[t]||aU;i[t]=r(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),i=n[t];if(!i)return;({attach:sU,detach:sU,resize:sU}[t]||Jz)(e,t,i),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,i){return PO(e,t,n,i)}isAttached(e){const t=e&&wO(e);return!(!t||!t.isConnected)}}class cU{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return BI(this.x)&&BI(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const i={};return e.forEach(e=>{i[e]=n[e]&&n[e].active()?n[e]._to:this[e]}),i}}function uU(e,t){const n=e.options.ticks,i=function(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),r=e._maxLength/n;return Math.floor(Math.min(i,r))}(e),r=Math.min(n.maxTicksLimit||i,i),o=n.major.enabled?function(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}(t):[],s=o.length,a=o[0],l=o[s-1],c=[];if(s>r)return function(e,t,n,i){let r,o=0,s=n[0];for(i=Math.ceil(i),r=0;r<e.length;r++)r===s&&(t.push(e[r]),o++,s=n[o*i])}(t,c,o,s/r),c;const u=function(e,t,n){const i=function(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}(e),r=t.length/n;if(!i)return Math.max(r,1);const o=function(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(0|n)&&t.push(n),t.sort((e,t)=>e-t).pop(),t}(i);for(let s=0,a=o.length-1;s<a;s++){const e=o[s];if(e>r)return e}return Math.max(r,1)}(o,t,r);if(s>0){let e,n;const i=s>1?Math.round((l-a)/(s-1)):null;for(dU(t,c,u,aI(i)?0:a-i,a),e=0,n=s-1;e<n;e++)dU(t,c,u,o[e],o[e+1]);return dU(t,c,u,l,aI(i)?t.length:l+i),c}return dU(t,c,u),c}function dU(e,t,n,i,r){const o=hI(i,0),s=Math.min(hI(r,e.length),e.length);let a,l,c,u=0;for(n=Math.ceil(n),r&&(a=r-i,n=a/Math.floor(a/n)),c=o;c<0;)u++,c=Math.round(o+u*n);for(l=Math.max(o,0);l<s;l++)l===c&&(t.push(e[l]),u++,c=Math.round(o+u*n))}const hU=(e,t,n)=>"top"===t||"left"===t?e[t]+n:e[t]-n,pU=(e,t)=>Math.min(t||e,e);function fU(e,t){const n=[],i=e.length/t,r=e.length;let o=0;for(;o<r;o+=i)n.push(e[Math.floor(o)]);return n}function mU(e,t,n){const i=e.ticks.length,r=Math.min(t,i-1),o=e._startPixel,s=e._endPixel,a=1e-6;let l,c=e.getPixelForTick(r);if(!(n&&(l=1===i?Math.max(c-o,s-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(r-1))/2,c+=r<t?l:-l,c<o-a||c>s+a)))return c}function gU(e){return e.drawTicks?e.tickLength:0}function vU(e,t){if(!e.display)return 0;const n=JL(e.font,t),i=KL(e.padding);return(lI(e.text)?e.text.length:1)*n.lineHeight+i.height}function yU(e,t,n){let i=aL(e);return(n&&"right"!==t||!n&&"right"===t)&&(i=(e=>"left"===e?"right":"right"===e?"left":e)(i)),i}class bU extends cU{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:i}=this;return e=dI(e,Number.POSITIVE_INFINITY),t=dI(t,Number.NEGATIVE_INFINITY),n=dI(n,Number.POSITIVE_INFINITY),i=dI(i,Number.NEGATIVE_INFINITY),{min:dI(e,n),max:dI(t,i),minDefined:uI(e),maxDefined:uI(t)}}getMinMax(e){let t,{min:n,max:i,minDefined:r,maxDefined:o}=this.getUserBounds();if(r&&o)return{min:n,max:i};const s=this.getMatchingVisibleMetas();for(let a=0,l=s.length;a<l;++a)t=s[a].controller.getMinMax(this,e),r||(n=Math.min(n,t.min)),o||(i=Math.max(i,t.max));return n=o&&n>i?i:n,i=r&&n>i?n:i,{min:dI(n,dI(i,n)),max:dI(i,dI(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){fI(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:i,grace:r,ticks:o}=this.options,s=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,n){const{min:i,max:r}=e,o=pI(t,(r-i)/2),s=(e,t)=>n&&0===e?0:e+t;return{min:s(i,-Math.abs(o)),max:s(r,o)}}(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=s<this.ticks.length;this._convertTicksToLabels(a?fU(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=uU(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,n=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,n=!n),this._startPixel=e,this._endPixel=t,this._reversePixels=n,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){fI(this.options.afterUpdate,[this])}beforeSetDimensions(){fI(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){fI(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),fI(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){fI(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,i,r;for(n=0,i=e.length;n<i;n++)r=e[n],r.label=fI(t.callback,[r.value,n,e],this)}afterTickToLabelConversion(){fI(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){fI(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=pU(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,r=t.maxRotation;let o,s,a,l=i;if(!this._isVisible()||!t.display||i>=r||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),u=c.widest.width,d=c.highest.height,h=KI(this.chart.width-u,0,this.maxWidth);o=e.offset?this.maxWidth/n:h/(n-1),u+6>o&&(o=h/(n-(e.offset?.5:1)),s=this.maxHeight-gU(e.grid)-t.padding-vU(e.title,this.chart.options.font),a=Math.sqrt(u*u+d*d),l=GI(Math.min(Math.asin(KI((c.highest.height+6)/o,-1,1)),Math.asin(KI(s/a,-1,1))-Math.asin(KI(d/a,-1,1)))),l=Math.max(i,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){fI(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){fI(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:i,grid:r}}=this,o=this._isVisible(),s=this.isHorizontal();if(o){const o=vU(i,t.options.font);if(s?(e.width=this.maxWidth,e.height=gU(r)+o):(e.height=this.maxHeight,e.width=gU(r)+o),n.display&&this.ticks.length){const{first:t,last:i,widest:r,highest:o}=this._getLabelSizes(),a=2*n.padding,l=HI(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(s){const t=n.mirror?0:u*r.width+c*o.height;e.height=Math.min(this.maxHeight,e.height+t+a)}else{const t=n.mirror?0:c*r.width+u*o.height;e.width=Math.min(this.maxWidth,e.width+t+a)}this._calculatePadding(t,i,u,c)}}this._handleMargins(),s?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,i){const{ticks:{align:r,padding:o},position:s}=this.options,a=0!==this.labelRotation,l="top"!==s&&"x"===this.axis;if(this.isHorizontal()){const s=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,d=0;a?l?(u=i*e.width,d=n*t.height):(u=n*e.height,d=i*t.width):"start"===r?d=t.width:"end"===r?u=e.width:"inner"!==r&&(u=e.width/2,d=t.width/2),this.paddingLeft=Math.max((u-s+o)*this.width/(this.width-s),0),this.paddingRight=Math.max((d-c+o)*this.width/(this.width-c),0)}else{let n=t.height/2,i=e.height/2;"start"===r?(n=0,i=e.height):"end"===r&&(n=t.height,i=0),this.paddingTop=n+o,this.paddingBottom=i+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){fI(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,n=e.length;t<n;t++)aI(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=fU(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:i,_longestTextCache:r}=this,o=[],s=[],a=Math.floor(t/pU(t,n));let l,c,u,d,h,p,f,m,g,v,y,b=0,x=0;for(l=0;l<t;l+=a){if(d=e[l].label,h=this._resolveTickFontOptions(l),i.font=p=h.string,f=r[p]=r[p]||{data:{},gc:[]},m=h.lineHeight,g=v=0,aI(d)||lI(d)){if(lI(d))for(c=0,u=d.length;c<u;++c)y=d[c],aI(y)||lI(y)||(g=DL(i,f.data,f.gc,g,y),v+=m)}else g=DL(i,f.data,f.gc,g,d),v=m;o.push(g),s.push(v),b=Math.max(g,b),x=Math.max(v,x)}!function(e,t){mI(e,e=>{const n=e.gc,i=n.length/2;let r;if(i>t){for(r=0;r<i;++r)delete e.data[n[r]];n.splice(0,i)}})}(r,t);const _=o.indexOf(b),w=s.indexOf(x),S=e=>({width:o[e]||0,height:s[e]||0});return{first:S(0),last:S(t-1),widest:S(_),highest:S(w),widths:o,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return KI(this._alignToPixels?kL(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=function(e,t,n){return eO(e,{tick:n,index:t,type:"tick"})}(this.getContext(),e,n))}return this.$context||(this.$context=eO(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const e=this.options.ticks,t=HI(this.labelRotation),n=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),r=this._getLabelSizes(),o=e.autoSkipPadding||0,s=r?r.widest.width+o:0,a=r?r.highest.height+o:0;return this.isHorizontal()?a*n>s*i?s/n:a/i:a*i<s*n?a/n:s/i}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,i=this.options,{grid:r,position:o,border:s}=i,a=r.offset,l=this.isHorizontal(),c=this.ticks.length+(a?1:0),u=gU(r),d=[],h=s.setContext(this.getContext()),p=h.display?h.width:0,f=p/2,m=function(e){return kL(n,e,p)};let g,v,y,b,x,_,w,S,M,E,C,T;if("top"===o)g=m(this.bottom),_=this.bottom-u,S=g-f,E=m(e.top)+f,T=e.bottom;else if("bottom"===o)g=m(this.top),E=e.top,T=m(e.bottom)-f,_=g+f,S=this.top+u;else if("left"===o)g=m(this.right),x=this.right-u,w=g-f,M=m(e.left)+f,C=e.right;else if("right"===o)g=m(this.left),M=e.left,C=m(e.right)-f,x=g+f,w=this.left+u;else if("x"===t){if("center"===o)g=m((e.top+e.bottom)/2+.5);else if(cI(o)){const e=Object.keys(o)[0],t=o[e];g=m(this.chart.scales[e].getPixelForValue(t))}E=e.top,T=e.bottom,_=g+f,S=_+u}else if("y"===t){if("center"===o)g=m((e.left+e.right)/2);else if(cI(o)){const e=Object.keys(o)[0],t=o[e];g=m(this.chart.scales[e].getPixelForValue(t))}x=g-f,w=x-u,M=e.left,C=e.right}const A=hI(i.ticks.maxTicksLimit,c),P=Math.max(1,Math.ceil(c/A));for(v=0;v<c;v+=P){const e=this.getContext(v),t=r.setContext(e),i=s.setContext(e),o=t.lineWidth,c=t.color,u=i.dash||[],h=i.dashOffset,p=t.tickWidth,f=t.tickColor,m=t.tickBorderDash||[],g=t.tickBorderDashOffset;y=mU(this,v,a),void 0!==y&&(b=kL(n,y,o),l?x=w=M=C=b:_=S=E=T=b,d.push({tx1:x,ty1:_,tx2:w,ty2:S,x1:M,y1:E,x2:C,y2:T,width:o,color:c,borderDash:u,borderDashOffset:h,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,d}_computeLabelItems(e){const t=this.axis,n=this.options,{position:i,ticks:r}=n,o=this.isHorizontal(),s=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=r,d=gU(n.grid),h=d+c,p=u?-c:h,f=-HI(this.labelRotation),m=[];let g,v,y,b,x,_,w,S,M,E,C,T,A="middle";if("top"===i)_=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===i)_=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===i){const e=this._getYAxisLabelAlignment(d);w=e.textAlign,x=e.x}else if("right"===i){const e=this._getYAxisLabelAlignment(d);w=e.textAlign,x=e.x}else if("x"===t){if("center"===i)_=(e.top+e.bottom)/2+h;else if(cI(i)){const e=Object.keys(i)[0],t=i[e];_=this.chart.scales[e].getPixelForValue(t)+h}w=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===i)x=(e.left+e.right)/2-h;else if(cI(i)){const e=Object.keys(i)[0],t=i[e];x=this.chart.scales[e].getPixelForValue(t)}w=this._getYAxisLabelAlignment(d).textAlign}"y"===t&&("start"===a?A="top":"end"===a&&(A="bottom"));const P=this._getLabelSizes();for(g=0,v=s.length;g<v;++g){y=s[g],b=y.label;const e=r.setContext(this.getContext(g));S=this.getPixelForTick(g)+r.labelOffset,M=this._resolveTickFontOptions(g),E=M.lineHeight,C=lI(b)?b.length:1;const t=C/2,n=e.color,a=e.textStrokeColor,c=e.textStrokeWidth;let d,h=w;if(o?(x=S,"inner"===w&&(h=g===v-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),T="top"===i?"near"===l||0!==f?-C*E+E/2:"center"===l?-P.highest.height/2-t*E+E:-P.highest.height+E/2:"near"===l||0!==f?E/2:"center"===l?P.highest.height/2-t*E:P.highest.height-C*E,u&&(T*=-1),0===f||e.showLabelBackdrop||(x+=E/2*Math.sin(f))):(_=S,T=(1-C)*E/2),e.showLabelBackdrop){const t=KL(e.backdropPadding),n=P.heights[g],i=P.widths[g];let r=T-t.top,o=0-t.left;switch(A){case"middle":r-=n/2;break;case"bottom":r-=n}switch(w){case"center":o-=i/2;break;case"right":o-=i;break;case"inner":g===v-1?o-=i:g>0&&(o-=i/2)}d={left:o,top:r,width:i+t.width,height:n+t.height,color:e.backdropColor}}m.push({label:b,font:M,textOffset:T,options:{rotation:f,color:n,strokeColor:a,strokeWidth:c,textAlign:h,textBaseline:A,translation:[x,_],backdrop:d}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-HI(this.labelRotation))return"top"===e?"left":"right";let n="center";return"start"===t.align?n="left":"end"===t.align?n="right":"inner"===t.align&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:i,padding:r}}=this.options,o=e+r,s=this._getLabelSizes().widest.width;let a,l;return"left"===t?i?(l=this.right+r,"near"===n?a="left":"center"===n?(a="center",l+=s/2):(a="right",l+=s)):(l=this.right-o,"near"===n?a="right":"center"===n?(a="center",l-=s/2):(a="left",l=this.left)):"right"===t?i?(l=this.left+r,"near"===n?a="right":"center"===n?(a="center",l-=s/2):(a="left",l-=s)):(l=this.left+o,"near"===n?a="left":"center"===n?(a="center",l+=s/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:i,width:r,height:o}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,i,r,o),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const n=this.ticks.findIndex(t=>t.value===e);if(n>=0){return t.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(e){const t=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let r,o;const s=(e,t,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke(),n.restore())};if(t.display)for(r=0,o=i.length;r<o;++r){const e=i[r];t.drawOnChartArea&&s({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&s({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:i}}=this,r=n.setContext(this.getContext()),o=n.display?r.width:0;if(!o)return;const s=i.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,c,u,d;this.isHorizontal()?(l=kL(e,this.left,o)-o/2,c=kL(e,this.right,s)+s/2,u=d=a):(u=kL(e,this.top,o)-o/2,d=kL(e,this.bottom,s)+s/2,l=c=a),t.save(),t.lineWidth=r.width,t.strokeStyle=r.color,t.beginPath(),t.moveTo(l,u),t.lineTo(c,d),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,n=this._computeLabelArea();n&&OL(t,n);const i=this.getLabelItems(e);for(const r of i){const e=r.options,n=r.font;VL(t,r.label,0,r.textOffset,n,e)}n&&zL(t)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:i}}=this;if(!n.display)return;const r=JL(n.font),o=KL(n.padding),s=n.align;let a=r.lineHeight/2;"bottom"===t||"center"===t||cI(t)?(a+=o.bottom,lI(n.text)&&(a+=r.lineHeight*(n.text.length-1))):a+=o.top;const{titleX:l,titleY:c,maxWidth:u,rotation:d}=function(e,t,n,i){const{top:r,left:o,bottom:s,right:a,chart:l}=e,{chartArea:c,scales:u}=l;let d,h,p,f=0;const m=s-r,g=a-o;if(e.isHorizontal()){if(h=lL(i,o,a),cI(n)){const e=Object.keys(n)[0],i=n[e];p=u[e].getPixelForValue(i)+m-t}else p="center"===n?(c.bottom+c.top)/2+m-t:hU(e,n,t);d=a-o}else{if(cI(n)){const e=Object.keys(n)[0],i=n[e];h=u[e].getPixelForValue(i)-g+t}else h="center"===n?(c.left+c.right)/2-g+t:hU(e,n,t);p=lL(i,s,r),f="left"===n?-II:II}return{titleX:h,titleY:p,maxWidth:d,rotation:f}}(this,a,t,s);VL(e,n.text,0,0,r,{color:n.color,maxWidth:u,rotation:d,textAlign:yU(s,t,i),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=hI(e.grid&&e.grid.z,-1),i=hI(e.border&&e.border.z,0);return this._isVisible()&&this.draw===bU.prototype.draw?[{z:n,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let r,o;for(r=0,o=t.length;r<o;++r){const o=t[r];o[n]!==this.id||e&&o.type!==e||i.push(o)}return i}_resolveTickFontOptions(e){return JL(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class xU{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;(function(e){return"id"in e&&"defaults"in e})(t)&&(n=this.register(t));const i=this.items,r=e.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+e);return r in i||(i[r]=e,function(e,t,n){const i=xI(Object.create(null),[n?PL.get(n):{},PL.get(t),e.defaults]);PL.set(t,i),e.defaultRoutes&&function(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),r=i.pop(),o=[e].concat(i).join("."),s=t[n].split("."),a=s.pop(),l=s.join(".");PL.route(o,r,l,a)})}(t,e.defaultRoutes);e.descriptors&&PL.describe(t,e.descriptors)}(e,o,n),this.override&&PL.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,i=this.scope;n in t&&delete t[n],i&&n in PL[i]&&(delete PL[i][n],this.override&&delete ML[n])}}class _U{constructor(){this.controllers=new xU(dz,"datasets",!0),this.elements=new xU(cU,"elements"),this.plugins=new xU(Object,"plugins"),this.scales=new xU(bU,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t)}remove(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t)}addControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.controllers)}addElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.elements)}addPlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.plugins)}addScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.controllers)}removeElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.elements)}removePlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.plugins)}removeScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.scales)}_each(e,t,n){[...t].forEach(t=>{const i=n||this._getRegistryForType(t);n||i.isForType(t)||i===this.plugins&&t.id?this._exec(e,i,t):mI(t,t=>{const i=n||this._getRegistryForType(t);this._exec(e,i,t)})})}_exec(e,t,n){const i=EI(e);fI(n["before"+i],[],n),t[e](n),fI(n["after"+i],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const i=t.get(e);if(void 0===i)throw new Error('"'+e+'" is not a registered '+n+".");return i}}var wU=new _U;class SU{constructor(){this._init=[]}notify(e,t,n,i){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const r=i?this._descriptors(e).filter(i):this._descriptors(e),o=this._notify(r,e,t,n);return"afterDestroy"===t&&(this._notify(r,e,"stop"),this._notify(this._init,e,"uninstall")),o}_notify(e,t,n,i){i=i||{};for(const r of e){const e=r.plugin;if(!1===fI(e[n],[t,i,r.options],e)&&i.cancelable)return!1}return!0}invalidate(){aI(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,i=hI(n.options&&n.options.plugins,{}),r=function(e){const t={},n=[],i=Object.keys(wU.plugins.items);for(let o=0;o<i.length;o++)n.push(wU.getPlugin(i[o]));const r=e.plugins||[];for(let o=0;o<r.length;o++){const e=r[o];-1===n.indexOf(e)&&(n.push(e),t[e.id]=!0)}return{plugins:n,localIds:t}}(n);return!1!==i||t?function(e,t,n,i){let{plugins:r,localIds:o}=t;const s=[],a=e.getContext();for(const l of r){const t=l.id,r=MU(n[t],i);null!==r&&s.push({plugin:l,options:EU(e.config,{plugin:l,local:o[t]},r,a)})}return s}(e,r,i,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,i=(e,t)=>e.filter(e=>!t.some(t=>e.plugin.id===t.plugin.id));this._notify(i(t,n),e,"stop"),this._notify(i(n,t),e,"start")}}function MU(e,t){return t||!1!==e?!0===e?{}:e:null}function EU(e,t,n,i){let{plugin:r,local:o}=t;const s=e.pluginScopeKeys(r),a=e.getOptionScopes(n,s);return o&&r.defaults&&a.push(r.defaults),e.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function CU(e,t){const n=PL.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function TU(e){if("x"===e||"y"===e||"r"===e)return e}function AU(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}function PU(e){if(TU(e))return e;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n){const t=r.axis||AU(r.position)||e.length>1&&TU(e[0].toLowerCase());if(t)return t}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function DU(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function kU(e,t){const n=ML[e.type]||{scales:{}},i=t.scales||{},r=CU(e.type,t),o=Object.create(null);return Object.keys(i).forEach(t=>{const s=i[t];if(!cI(s))return console.error(`Invalid scale configuration for scale: ${t}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=PU(t,s,function(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(t=>t.xAxisID===e||t.yAxisID===e);if(n.length)return DU(e,"x",n[0])||DU(e,"y",n[0])}return{}}(t,e),PL.scales[s.type]),l=function(e,t){return e===t?"_index_":"_value_"}(a,r),c=n.scales||{};o[t]=_I(Object.create(null),[{axis:a},s,c[a],c[l]])}),e.data.datasets.forEach(n=>{const r=n.type||e.type,s=n.indexAxis||CU(r,t),a=(ML[r]||{}).scales||{};Object.keys(a).forEach(e=>{const t=function(e,t){let n=e;return"_index_"===e?n=t:"_value_"===e&&(n="x"===t?"y":"x"),n}(e,s),r=n[t+"AxisID"]||t;o[r]=o[r]||Object.create(null),_I(o[r],[{axis:t},i[r],a[e]])})}),Object.keys(o).forEach(e=>{const t=o[e];_I(t,[PL.scales[t.type],PL.scale])}),o}function RU(e){const t=e.options||(e.options={});t.plugins=hI(t.plugins,{}),t.scales=kU(e,t)}function NU(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const IU=new Map,LU=new Set;function OU(e,t){let n=IU.get(e);return n||(n=t(),IU.set(e,n),LU.add(n)),n}const zU=(e,t,n)=>{const i=MI(t,n);void 0!==i&&e.add(i)};class UU{constructor(e){this._config=function(e){return(e=e||{}).data=NU(e.data),RU(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=NU(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),RU(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return OU(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return OU(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return OU(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id;return OU(`${this.type}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let i=n.get(e);return i&&!t||(i=new Map,n.set(e,i)),i}getOptionScopes(e,t,n){const{options:i,type:r}=this,o=this._cachedScopes(e,n),s=o.get(t);if(s)return s;const a=new Set;t.forEach(t=>{e&&(a.add(e),t.forEach(t=>zU(a,e,t))),t.forEach(e=>zU(a,i,e)),t.forEach(e=>zU(a,ML[r]||{},e)),t.forEach(e=>zU(a,PL,e)),t.forEach(e=>zU(a,EL,e))});const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),LU.has(t)&&o.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,ML[t]||{},PL.datasets[t]||{},{type:t},PL,EL]}resolveNamedOptions(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const r={$shared:!0},{resolver:o,subPrefixes:s}=FU(this._resolverCache,e,i);let a=o;if(function(e,t){const{isScriptable:n,isIndexable:i}=iO(e);for(const r of t){const t=n(r),o=i(r),s=(o||t)&&e[r];if(t&&(TI(s)||jU(s))||o&&lI(s))return!0}return!1}(o,t)){r.$shared=!1;a=nO(o,n=TI(n)?n():n,this.createResolver(e,n,s))}for(const l of t)r[l]=a[l];return r}createResolver(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],i=arguments.length>3?arguments[3]:void 0;const{resolver:r}=FU(this._resolverCache,e,n);return cI(t)?nO(r,t,void 0,i):r}}function FU(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const r=n.join();let o=i.get(r);if(!o){o={resolver:tO(t,n),subPrefixes:n.filter(e=>!e.toLowerCase().includes("hover"))},i.set(r,o)}return o}const jU=e=>cI(e)&&Object.getOwnPropertyNames(e).some(t=>TI(e[t]));const BU=["top","bottom","left","right","chartArea"];function VU(e,t){return"top"===e||"bottom"===e||-1===BU.indexOf(e)&&"x"===t}function HU(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function GU(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),fI(n&&n.onComplete,[e],t)}function WU(e){const t=e.chart,n=t.options.animation;fI(n&&n.onProgress,[e],t)}function XU(e){return _O()&&"string"===typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const YU={},$U=e=>{const t=XU(e);return Object.values(YU).filter(e=>e.canvas===t).pop()};function qU(e,t,n){const i=Object.keys(e);for(const r of i){const i=+r;if(i>=t){const o=e[r];delete e[r],(n>0||i>t)&&(e[i+n]=o)}}}class ZU{static defaults=(()=>PL)();static instances=(()=>YU)();static overrides=(()=>ML)();static registry=(()=>wU)();static version="4.5.0";static getChart=(()=>$U)();static register(){wU.add(...arguments),KU()}static unregister(){wU.remove(...arguments),KU()}constructor(e,t){const n=this.config=new UU(t),i=XU(e),r=$U(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(e){return!_O()||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?Yz:lU}(i)),this.platform.updateConfig(n);const s=this.platform.acquireContext(i,o.aspectRatio),a=s&&s.canvas,l=a&&a.height,c=a&&a.width;this.id=sI(),this.ctx=s,this.canvas=a,this.width=c,this.height=l,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new SU,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let n;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return t?(clearTimeout(n),n=setTimeout(e,t,r)):e.apply(this,r),t}}(e=>this.update(e),o.resizeDelay||0),this._dataChanges=[],YU[this.id]=this,s&&a?(qO.listen(this,"complete",GU),qO.listen(this,"progress",WU),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:i,_aspectRatio:r}=this;return aI(e)?t&&r?r:i?n/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return wU}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():DO(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return RL(this.canvas,this.ctx),this}stop(){return qO.stop(this),this}resize(e,t){qO.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,i=this.canvas,r=n.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,e,t,r),s=n.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,DO(this,s,!0)&&(this.notifyPlugins("resize",{size:o}),fI(n.onResize,[this,o],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){mI(this.options.scales||{},(e,t)=>{e.id=t})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,i=Object.keys(n).reduce((e,t)=>(e[t]=!1,e),{});let r=[];t&&(r=r.concat(Object.keys(t).map(e=>{const n=t[e],i=PU(e,n),r="r"===i,o="x"===i;return{options:n,dposition:r?"chartArea":o?"bottom":"left",dtype:r?"radialLinear":o?"category":"linear"}}))),mI(r,t=>{const r=t.options,o=r.id,s=PU(o,r),a=hI(r.type,t.dtype);void 0!==r.position&&VU(r.position,s)===VU(t.dposition)||(r.position=t.dposition),i[o]=!0;let l=null;if(o in n&&n[o].type===a)l=n[o];else{l=new(wU.getScale(a))({id:o,type:a,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(r,e)}),mI(i,(e,t)=>{e||delete n[t]}),mI(n,e=>{Wz.configure(this,e,e.options),Wz.addBox(this,e)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((e,t)=>e.index-t.index),n>t){for(let e=t;e<n;++e)this._destroyDatasetMeta(e);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(HU("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((e,n)=>{0===t.filter(t=>t===e._dataset).length&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=t.length;n<i;n++){const i=t[n];let r=this.getDatasetMeta(n);const o=i.type||this.config.type;if(r.type&&r.type!==o&&(this._destroyDatasetMeta(n),r=this.getDatasetMeta(n)),r.type=o,r.indexAxis=i.indexAxis||CU(o,this.options),r.order=i.order||0,r.index=n,r.label=""+i.label,r.visible=this.isDatasetVisible(n),r.controller)r.controller.updateIndex(n),r.controller.linkScales();else{const t=wU.getController(o),{datasetElementType:i,dataElementType:s}=PL.datasets[o];Object.assign(t,{dataElementType:wU.getElement(s),datasetElementType:i&&wU.getElement(i)}),r.controller=new t(this,n),e.push(r.controller)}}return this._updateMetasets(),e}_resetElements(){mI(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:e}=this.getDatasetMeta(l),t=!i&&-1===r.indexOf(e);e.buildOrUpdateElements(t),o=Math.max(+e.getMaxOverflow(),o)}o=this._minPadding=n.layout.autoPadding?o:0,this._updateLayout(o),i||mI(r,e=>{e.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(HU("z","_idx"));const{_active:s,_lastEvent:a}=this;a?this._eventHandler(a,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){mI(this.scales,e=>{Wz.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);AI(t,n)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:r}of t){qU(e,i,"_removeElements"===n?-r:r)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=t=>new Set(e.filter(e=>e[0]===t).map((e,t)=>t+","+e.splice(1).join(","))),i=n(0);for(let r=1;r<t;r++)if(!AI(i,n(r)))return;return Array.from(i).map(e=>e.split(",")).map(e=>({method:e[1],start:+e[2],count:+e[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Wz.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],mI(this.boxes,e=>{n&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))},this),this._layers.forEach((e,t)=>{e._idx=t}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,TI(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),i={meta:n,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(qO.has(this)?this.attached&&!qO.running(this)&&qO.start(this):(this.draw(),GU({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(e,t)}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let i,r;for(i=0,r=t.length;i<r;++i){const r=t[i];e&&!r.visible||n.push(r)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n={meta:e,index:e.index,cancelable:!0},i=YO(this,e);!1!==this.notifyPlugins("beforeDatasetDraw",n)&&(i&&OL(t,i),e.controller.draw(),i&&zL(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return LL(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,i){const r=Rz.modes[t];return"function"===typeof r?r(this,e,n,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let i=n.filter(e=>e&&e._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=eO(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return"boolean"===typeof n.hidden?!n.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const i=n?"show":"hide",r=this.getDatasetMeta(e),o=r.controller._resolveAnimations(void 0,i);CI(t)?(r.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),o.update(r,{visible:n}),this.update(t=>t.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),qO.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),RL(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete YU[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(n,i)=>{t.addEventListener(this,n,i),e[n]=i},i=(e,t,n)=>{e.offsetX=t,e.offsetY=n,this._eventHandler(e)};mI(this.options.events,e=>n(e,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(n,i)=>{t.addEventListener(this,n,i),e[n]=i},i=(n,i)=>{e[n]&&(t.removeEventListener(this,n,i),delete e[n])},r=(e,t)=>{this.canvas&&this.resize(e,t)};let o;const s=()=>{i("attach",s),this.attached=!0,this.resize(),n("resize",r),n("detach",o)};o=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),n("attach",s)},t.isAttached(this.canvas)?s():o()}unbindEvents(){mI(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},mI(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const i=n?"set":"remove";let r,o,s,a;for("dataset"===t&&(r=this.getDatasetMeta(e[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),s=0,a=e.length;s<a;++s){o=e[s];const t=o&&this.getDatasetMeta(o.datasetIndex).controller;t&&t[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(e=>{let{datasetIndex:t,index:n}=e;const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[n],index:n}});!gI(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return 1===this._plugins._cache.filter(t=>t.plugin.id===e).length}_updateHoverStyles(e,t,n){const i=this.options.hover,r=(e,t)=>e.filter(e=>!t.some(t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)),o=r(t,e),s=n?e:r(e,t);o.length&&this.updateHoverStyle(o,i.mode,!1),s.length&&i.mode&&this.updateHoverStyle(s,i.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const r=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(r||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:i=[],options:r}=this,o=t,s=this._getActiveElements(e,i,n,o),a=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,n,i){return n&&"mouseout"!==e.type?i?t:e:null}(e,this._lastEvent,n,a);n&&(this._lastEvent=null,fI(r.onHover,[e,s,this],this),a&&fI(r.onClick,[e,s,this],this));const c=!gI(s,i);return(c||t)&&(this._active=s,this._updateHoverStyles(s,i,t)),this._lastEvent=l,c}_getActiveElements(e,t,n,i){if("mouseout"===e.type)return[];if(!n)return t;const r=this.options.hover;return this.getElementsAtEventForMode(e,r.mode,r,i)}}function KU(){return mI(ZU.instances,e=>e._plugins.invalidate())}function JU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;e.lineCap=hI(n.borderCapStyle,t.borderCapStyle),e.setLineDash(hI(n.borderDash,t.borderDash)),e.lineDashOffset=hI(n.borderDashOffset,t.borderDashOffset),e.lineJoin=hI(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=hI(n.borderWidth,t.borderWidth),e.strokeStyle=hI(n.borderColor,t.borderColor)}function QU(e,t,n){e.lineTo(n.x,n.y)}function eF(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.length,{start:r=0,end:o=i-1}=n,{start:s,end:a}=t,l=Math.max(r,s),c=Math.min(o,a),u=r<s&&o<s||r>a&&o>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!u?i+c-l:c-l}}function tF(e,t,n,i){const{points:r,options:o}=t,{count:s,start:a,loop:l,ilen:c}=eF(r,n,i),u=function(e){return e.stepped?UL:e.tension||"monotone"===e.cubicInterpolationMode?FL:QU}(o);let d,h,p,{move:f=!0,reverse:m}=i||{};for(d=0;d<=c;++d)h=r[(a+(m?c-d:d))%s],h.skip||(f?(e.moveTo(h.x,h.y),f=!1):u(e,p,h,m,o.stepped),p=h);return l&&(h=r[(a+(m?c:0))%s],u(e,p,h,m,o.stepped)),!!l}function nF(e,t,n,i){const r=t.points,{count:o,start:s,ilen:a}=eF(r,n,i),{move:l=!0,reverse:c}=i||{};let u,d,h,p,f,m,g=0,v=0;const y=e=>(s+(c?a-e:e))%o,b=()=>{p!==f&&(e.lineTo(g,f),e.lineTo(g,p),e.lineTo(g,m))};for(l&&(d=r[y(0)],e.moveTo(d.x,d.y)),u=0;u<=a;++u){if(d=r[y(u)],d.skip)continue;const t=d.x,n=d.y,i=0|t;i===h?(n<p?p=n:n>f&&(f=n),g=(v*g+t)/++v):(b(),e.lineTo(t,n),h=i,v=0,p=f=n),m=n}b()}function iF(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&"monotone"!==t.cubicInterpolationMode&&!t.stepped&&!n?nF:tF}const rF="function"===typeof Path2D;function oF(e,t,n,i){rF&&!t.options.segment?function(e,t,n,i){let r=t._path;r||(r=t._path=new Path2D,t.path(r,n,i)&&r.closePath()),JU(e,t.options),e.stroke(r)}(e,t,n,i):function(e,t,n,i){const{segments:r,options:o}=t,s=iF(t);for(const a of r)JU(e,o,a.style),e.beginPath(),s(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}(e,t,n,i)}class sF extends cU{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;xO(this._points,n,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const n=e.points,i=e.options.spanGaps,r=n.length;if(!r)return[];const o=!!e._loop,{start:s,end:a}=function(e,t,n,i){let r=0,o=t-1;if(n&&!i)for(;r<t&&!e[r].skip;)r++;for(;r<t&&e[r].skip;)r++;for(r%=t,n&&(o+=r);o>r&&e[o%t].skip;)o--;return o%=t,{start:r,end:o}}(n,r,o,i);return HO(e,!0===i?[{start:s,end:a,loop:o}]:function(e,t,n,i){const r=e.length,o=[];let s,a=t,l=e[t];for(s=t+1;s<=n;++s){const n=e[s%r];n.skip||n.stop?l.skip||(i=!1,o.push({start:t%r,end:(s-1)%r,loop:i}),t=a=n.stop?s:null):(a=s,l.skip&&(t=s)),l=n}return null!==a&&o.push({start:t%r,end:a%r,loop:i}),o}(n,s,a<s?a+r:a,!!e._fullLoop&&0===s&&a===r-1),n,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,i=e[t],r=this.points,o=VO(this,{property:t,start:i,end:i});if(!o.length)return;const s=[],a=function(e){return e.stepped?IO:e.tension||"monotone"===e.cubicInterpolationMode?LO:NO}(n);let l,c;for(l=0,c=o.length;l<c;++l){const{start:c,end:u}=o[l],d=r[c],h=r[u];if(d===h){s.push(d);continue}const p=a(d,h,Math.abs((i-d[t])/(h[t]-d[t])),n.stepped);p[t]=e[t],s.push(p)}return 1===s.length?s[0]:s}pathSegment(e,t,n){return iF(this)(e,this,t,n)}path(e,t,n){const i=this.segments,r=iF(this);let o=this._loop;t=t||0,n=n||this.points.length-t;for(const s of i)o&=r(e,this,s,{start:t,end:t+n-1});return!!o}draw(e,t,n,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(e.save(),oF(e,this,n,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function aF(e,t,n,i){const r=e.options,{[n]:o}=e.getProps([n],i);return Math.abs(t-o)<r.radius+r.hitRadius}class lF extends cU{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,n){const i=this.options,{x:r,y:o}=this.getProps(["x","y"],n);return Math.pow(e-r,2)+Math.pow(t-o,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return aF(this,e,"x",t)}inYRange(e,t){return aF(this,e,"y",t)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}size(e){let t=(e=e||this.options||{}).radius||0;t=Math.max(t,t&&e.hoverRadius||0);return 2*(t+(t&&e.borderWidth||0))}draw(e,t){const n=this.options;this.skip||n.radius<.1||!LL(this,t,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,NL(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function cF(e,t){const{x:n,y:i,base:r,width:o,height:s}=e.getProps(["x","y","base","width","height"],t);let a,l,c,u,d;return e.horizontal?(d=s/2,a=Math.min(n,r),l=Math.max(n,r),c=i-d,u=i+d):(d=o/2,a=n-d,l=n+d,c=Math.min(i,r),u=Math.max(i,r)),{left:a,top:c,right:l,bottom:u}}function uF(e,t,n,i){return e?0:KI(t,n,i)}function dF(e){const t=cF(e),n=t.right-t.left,i=t.bottom-t.top,r=function(e,t,n){const i=e.options.borderWidth,r=e.borderSkipped,o=qL(i);return{t:uF(r.top,o.top,0,n),r:uF(r.right,o.right,0,t),b:uF(r.bottom,o.bottom,0,n),l:uF(r.left,o.left,0,t)}}(e,n/2,i/2),o=function(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),r=e.options.borderRadius,o=ZL(r),s=Math.min(t,n),a=e.borderSkipped,l=i||cI(r);return{topLeft:uF(!l||a.top||a.left,o.topLeft,0,s),topRight:uF(!l||a.top||a.right,o.topRight,0,s),bottomLeft:uF(!l||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:uF(!l||a.bottom||a.right,o.bottomRight,0,s)}}(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:o},inner:{x:t.left+r.l,y:t.top+r.t,w:n-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,o.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(r.b,r.r))}}}}function hF(e,t,n,i){const r=null===t,o=null===n,s=e&&!(r&&o)&&cF(e,i);return s&&(r||JI(t,s.left,s.right))&&(o||JI(n,s.top,s.bottom))}function pF(e,t){e.rect(t.x,t.y,t.w,t.h)}function fF(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.x!==n.x?-t:0,r=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-i,s=(e.y+e.h!==n.y+n.h?t:0)-r;return{x:e.x+i,y:e.y+r,w:e.w+o,h:e.h+s,radius:e.radius}}class mF extends cU{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:i}}=this,{inner:r,outer:o}=dF(this),s=(a=o.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?HL:pF;var a;e.save(),o.w===r.w&&o.h===r.h||(e.beginPath(),s(e,fF(o,t,r)),e.clip(),s(e,fF(r,-t,o)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),s(e,fF(r,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,n){return hF(this,e,t,n)}inXRange(e,t){return hF(this,e,null,t)}inYRange(e,t){return hF(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],e);return{x:r?(t+i)/2:t,y:r?n:(n+i)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}function gF(e,t,n,i){if(i)return;let r=t[e],o=n[e];return"angle"===e&&(r=qI(r),o=qI(o)),{property:e,start:r,end:o}}function vF(e,t,n){for(;t>e;t--){const e=n[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function yF(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function bF(e,t){let n=[],i=!1;return lI(e)?(i=!0,n=e):n=function(e,t){const{x:n=null,y:i=null}=e||{},r=t.points,o=[];return t.segments.forEach(e=>{let{start:t,end:s}=e;s=vF(t,s,r);const a=r[t],l=r[s];null!==i?(o.push({x:a.x,y:i}),o.push({x:l.x,y:i})):null!==n&&(o.push({x:n,y:a.y}),o.push({x:n,y:l.y}))}),o}(e,t),n.length?new sF({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function xF(e){return e&&!1!==e.fill}function _F(e,t,n){let i=e[t].fill;const r=[t];let o;if(!n)return i;for(;!1!==i&&-1===r.indexOf(i);){if(!uI(i))return i;if(o=e[i],!o)return!1;if(o.visible)return i;r.push(i),i=o.fill}return!1}function wF(e,t,n){const i=function(e){const t=e.options,n=t.fill;let i=hI(n&&n.target,n);void 0===i&&(i=!!t.backgroundColor);if(!1===i||null===i)return!1;if(!0===i)return"origin";return i}(e);if(cI(i))return!isNaN(i.value)&&i;let r=parseFloat(i);return uI(r)&&Math.floor(r)===r?function(e,t,n,i){"-"!==e&&"+"!==e||(n=t+n);if(n===t||n<0||n>=i)return!1;return n}(i[0],t,r,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function SF(e,t,n){const i=[];for(let r=0;r<n.length;r++){const o=n[r],{first:s,last:a,point:l}=MF(o,t,"x");if(!(!l||s&&a))if(s)i.unshift(l);else if(e.push(l),!a)break}e.push(...i)}function MF(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const r=i[n],o=e.segments,s=e.points;let a=!1,l=!1;for(let c=0;c<o.length;c++){const e=o[c],t=s[e.start][n],i=s[e.end][n];if(JI(r,t,i)){a=r===t,l=r===i;break}}return{first:a,last:l,point:i}}class EF{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){const{x:i,y:r,radius:o}=this;return t=t||{start:0,end:DI},e.arc(i,r,o,t.end,t.start,!0),!n.bounds}interpolate(e){const{x:t,y:n,radius:i}=this,r=e.angle;return{x:t+Math.cos(r)*i,y:n+Math.sin(r)*i,angle:r}}}function CF(e){const{chart:t,fill:n,line:i}=e;if(uI(n))return function(e,t){const n=e.getDatasetMeta(t),i=n&&e.isDatasetVisible(t);return i?n.dataset:null}(t,n);if("stack"===n)return function(e){const{scale:t,index:n,line:i}=e,r=[],o=i.segments,s=i.points,a=function(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let r=0;r<i.length;r++){const e=i[r];if(e.index===t)break;e.hidden||n.unshift(e.dataset)}return n}(t,n);a.push(bF({x:null,y:t.bottom},i));for(let l=0;l<o.length;l++){const e=o[l];for(let t=e.start;t<=e.end;t++)SF(r,s[t],a)}return new sF({points:r,options:{}})}(e);if("shape"===n)return!0;const r=function(e){const t=e.scale||{};if(t.getPointPositionForValue)return function(e){const{scale:t,fill:n}=e,i=t.options,r=t.getLabels().length,o=i.reverse?t.max:t.min,s=function(e,t,n){let i;return i="start"===e?n:"end"===e?t.options.reverse?t.min:t.max:cI(e)?e.value:t.getBaseValue(),i}(n,t,o),a=[];if(i.grid.circular){const e=t.getPointPositionForValue(0,o);return new EF({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(s)})}for(let l=0;l<r;++l)a.push(t.getPointPositionForValue(l,s));return a}(e);return function(e){const{scale:t={},fill:n}=e,i=function(e,t){let n=null;return"start"===e?n=t.bottom:"end"===e?n=t.top:cI(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}(n,t);if(uI(i)){const e=t.isHorizontal();return{x:e?i:null,y:e?null:i}}return null}(e)}(e);return r instanceof EF?r:bF(r,i)}function TF(e,t,n){const i=CF(t),{chart:r,index:o,line:s,scale:a,axis:l}=t,c=s.options,u=c.fill,d=c.backgroundColor,{above:h=d,below:p=d}=u||{},f=r.getDatasetMeta(o),m=YO(r,f);i&&s.points.length&&(OL(e,n),function(e,t){const{line:n,target:i,above:r,below:o,area:s,scale:a,clip:l}=t,c=n._loop?"angle":t.axis;e.save();let u=o;o!==r&&("x"===c?(AF(e,i,s.top),DF(e,{line:n,target:i,color:r,scale:a,property:c,clip:l}),e.restore(),e.save(),AF(e,i,s.bottom)):"y"===c&&(PF(e,i,s.left),DF(e,{line:n,target:i,color:o,scale:a,property:c,clip:l}),e.restore(),e.save(),PF(e,i,s.right),u=r));DF(e,{line:n,target:i,color:u,scale:a,property:c,clip:l}),e.restore()}(e,{line:s,target:i,above:h,below:p,area:n,scale:a,axis:l,clip:m}),zL(e))}function AF(e,t,n){const{segments:i,points:r}=t;let o=!0,s=!1;e.beginPath();for(const a of i){const{start:i,end:l}=a,c=r[i],u=r[vF(i,l,r)];o?(e.moveTo(c.x,c.y),o=!1):(e.lineTo(c.x,n),e.lineTo(c.x,c.y)),s=!!t.pathSegment(e,a,{move:s}),s?e.closePath():e.lineTo(u.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function PF(e,t,n){const{segments:i,points:r}=t;let o=!0,s=!1;e.beginPath();for(const a of i){const{start:i,end:l}=a,c=r[i],u=r[vF(i,l,r)];o?(e.moveTo(c.x,c.y),o=!1):(e.lineTo(n,c.y),e.lineTo(c.x,c.y)),s=!!t.pathSegment(e,a,{move:s}),s?e.closePath():e.lineTo(n,u.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function DF(e,t){const{line:n,target:i,property:r,color:o,scale:s,clip:a}=t,l=function(e,t,n){const i=e.segments,r=e.points,o=t.points,s=[];for(const a of i){let{start:e,end:i}=a;i=vF(e,i,r);const l=gF(n,r[e],r[i],a.loop);if(!t.segments){s.push({source:a,target:l,start:r[e],end:r[i]});continue}const c=VO(t,l);for(const t of c){const e=gF(n,o[t.start],o[t.end],t.loop),i=BO(a,r,e);for(const r of i)s.push({source:r,target:t,start:{[n]:yF(l,e,"start",Math.max)},end:{[n]:yF(l,e,"end",Math.min)}})}}return s}(n,i,r);for(const{source:c,target:u,start:d,end:h}of l){const{style:{backgroundColor:t=o}={}}=c,l=!0!==i;e.save(),e.fillStyle=t,kF(e,s,a,l&&gF(r,d,h)),e.beginPath();const p=!!n.pathSegment(e,c);let f;if(l){p?e.closePath():RF(e,i,h,r);const t=!!i.pathSegment(e,u,{move:p,reverse:!0});f=p&&t,f||RF(e,i,d,r)}e.closePath(),e.fill(f?"evenodd":"nonzero"),e.restore()}}function kF(e,t,n,i){const r=t.chart.chartArea,{property:o,start:s,end:a}=i||{};if("x"===o||"y"===o){let t,i,l,c;"x"===o?(t=s,i=r.top,l=a,c=r.bottom):(t=r.left,i=s,l=r.right,c=a),e.beginPath(),n&&(t=Math.max(t,n.left),l=Math.min(l,n.right),i=Math.max(i,n.top),c=Math.min(c,n.bottom)),e.rect(t,i,l-t,c-i),e.clip()}}function RF(e,t,n,i){const r=t.interpolate(n,i);r&&e.lineTo(r.x,r.y)}var NF={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,r=[];let o,s,a,l;for(s=0;s<i;++s)o=e.getDatasetMeta(s),a=o.dataset,l=null,a&&a.options&&a instanceof sF&&(l={visible:e.isDatasetVisible(s),index:s,fill:wF(a,s,i),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,r.push(l);for(s=0;s<i;++s)l=r[s],l&&!1!==l.fill&&(l.fill=_F(r,s,n.propagate))},beforeDraw(e,t,n){const i="beforeDraw"===n.drawTime,r=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let s=r.length-1;s>=0;--s){const t=r[s].$filler;t&&(t.line.updateControlPoints(o,t.axis),i&&t.fill&&TF(e.ctx,t,o))}},beforeDatasetsDraw(e,t,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=e.getSortedVisibleDatasetMetas();for(let r=i.length-1;r>=0;--r){const t=i[r].$filler;xF(t)&&TF(e.ctx,t,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;xF(i)&&"beforeDatasetDraw"===n.drawTime&&TF(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const IF=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}};class LF extends cU{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=fI(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(t=>e.filter(t,this.chart.data))),e.sort&&(t=t.sort((t,n)=>e.sort(t,n,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const n=e.labels,i=JL(n.font),r=i.size,o=this._computeTitleHeight(),{boxWidth:s,itemHeight:a}=IF(n,r);let l,c;t.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(o,r,s,a)+10):(c=this.maxHeight,l=this._fitCols(o,i,s,a)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,i){const{ctx:r,maxWidth:o,options:{labels:{padding:s}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+s;let u=e;r.textAlign="left",r.textBaseline="middle";let d=-1,h=-c;return this.legendItems.forEach((e,p)=>{const f=n+t/2+r.measureText(e.text).width;(0===p||l[l.length-1]+f+2*s>o)&&(u+=c,l[l.length-(p>0?0:1)]=0,h+=c,d++),a[p]={left:0,top:h,row:d,width:f,height:i},l[l.length-1]+=f+s}),u}_fitCols(e,t,n,i){const{ctx:r,maxHeight:o,options:{labels:{padding:s}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=o-e;let u=s,d=0,h=0,p=0,f=0;return this.legendItems.forEach((e,o)=>{const{itemWidth:m,itemHeight:g}=function(e,t,n,i,r){const o=function(e,t,n,i){let r=e.text;r&&"string"!==typeof r&&(r=r.reduce((e,t)=>e.length>t.length?e:t));return t+n.size/2+i.measureText(r).width}(i,e,t,n),s=function(e,t,n){let i=e;"string"!==typeof t.text&&(i=OF(t,n));return i}(r,i,t.lineHeight);return{itemWidth:o,itemHeight:s}}(n,t,r,e,i);o>0&&h+g+2*s>c&&(u+=d+s,l.push({width:d,height:h}),p+=d+s,f++,d=h=0),a[o]={left:p,top:h,col:f,width:m,height:g},d=Math.max(d,m),h+=g+s}),u+=d,l.push({width:d,height:h}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:i},rtl:r}}=this,o=OO(r,this.left,this.width);if(this.isHorizontal()){let r=0,s=lL(n,this.left+i,this.right-this.lineWidths[r]);for(const a of t)r!==a.row&&(r=a.row,s=lL(n,this.left+i,this.right-this.lineWidths[r])),a.top+=this.top+e+i,a.left=o.leftForLtr(o.x(s),a.width),s+=a.width+i}else{let r=0,s=lL(n,this.top+e+i,this.bottom-this.columnSizes[r].height);for(const a of t)a.col!==r&&(r=a.col,s=lL(n,this.top+e+i,this.bottom-this.columnSizes[r].height)),a.top=s,a.left+=this.left+i,a.left=o.leftForLtr(o.x(a.left),a.width),s+=a.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;OL(e,this),this._draw(),zL(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:i}=this,{align:r,labels:o}=e,s=PL.color,a=OO(e.rtl,this.left,this.width),l=JL(o.font),{padding:c}=o,u=l.size,d=u/2;let h;this.drawTitle(),i.textAlign=a.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=IF(o,u),g=this.isHorizontal(),v=this._computeTitleHeight();h=g?{x:lL(r,this.left+c,this.right-n[0]),y:this.top+c+v,line:0}:{x:this.left+c,y:lL(r,this.top+v+c,this.bottom-t[0].height),line:0},zO(this.ctx,e.textDirection);const y=m+c;this.legendItems.forEach((b,x)=>{i.strokeStyle=b.fontColor,i.fillStyle=b.fontColor;const _=i.measureText(b.text).width,w=a.textAlign(b.textAlign||(b.textAlign=o.textAlign)),S=p+d+_;let M=h.x,E=h.y;a.setWidth(this.width),g?x>0&&M+S+c>this.right&&(E=h.y+=y,h.line++,M=h.x=lL(r,this.left+c,this.right-n[h.line])):x>0&&E+y>this.bottom&&(M=h.x=M+t[h.line].width+c,h.line++,E=h.y=lL(r,this.top+v+c,this.bottom-t[h.line].height));if(function(e,t,n){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;i.save();const r=hI(n.lineWidth,1);if(i.fillStyle=hI(n.fillStyle,s),i.lineCap=hI(n.lineCap,"butt"),i.lineDashOffset=hI(n.lineDashOffset,0),i.lineJoin=hI(n.lineJoin,"miter"),i.lineWidth=r,i.strokeStyle=hI(n.strokeStyle,s),i.setLineDash(hI(n.lineDash,[])),o.usePointStyle){const s={radius:f*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:r},l=a.xPlus(e,p/2);IL(i,s,l,t+d,o.pointStyleWidth&&p)}else{const o=t+Math.max((u-f)/2,0),s=a.leftForLtr(e,p),l=ZL(n.borderRadius);i.beginPath(),Object.values(l).some(e=>0!==e)?HL(i,{x:s,y:o,w:p,h:f,radius:l}):i.rect(s,o,p,f),i.fill(),0!==r&&i.stroke()}i.restore()}(a.x(M),E,b),M=((e,t,n,i)=>e===(i?"left":"right")?n:"center"===e?(t+n)/2:t)(w,M+p+d,g?M+S:this.right,e.rtl),function(e,t,n){VL(i,n.text,e,t+m/2,l,{strikethrough:n.hidden,textAlign:a.textAlign(n.textAlign)})}(a.x(M),E,b),g)h.x+=S+c;else if("string"!==typeof b.text){const e=l.lineHeight;h.y+=OF(b,e)+c}else h.y+=y}),UO(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=JL(t.font),i=KL(t.padding);if(!t.display)return;const r=OO(e.rtl,this.left,this.width),o=this.ctx,s=t.position,a=n.size/2,l=i.top+a;let c,u=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),c=this.top+l,u=lL(e.align,u,this.right-d);else{const t=this.columnSizes.reduce((e,t)=>Math.max(e,t.height),0);c=l+lL(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const h=lL(s,u,u+d);o.textAlign=r.textAlign(aL(s)),o.textBaseline="middle",o.strokeStyle=t.color,o.fillStyle=t.color,o.font=n.string,VL(o,t.text,h,c,n)}_computeTitleHeight(){const e=this.options.title,t=JL(e.font),n=KL(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,i,r;if(JI(e,this.left,this.right)&&JI(t,this.top,this.bottom))for(r=this.legendHitBoxes,n=0;n<r.length;++n)if(i=r[n],JI(e,i.left,i.left+i.width)&&JI(t,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(e){const t=this.options;if(!function(e,t){if(("mousemove"===e||"mouseout"===e)&&(t.onHover||t.onLeave))return!0;if(t.onClick&&("click"===e||"mouseup"===e))return!0;return!1}(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const i=this._hoveredItem,r=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(i,n);i&&!r&&fI(t.onLeave,[e,i,this],this),this._hoveredItem=n,n&&!r&&fI(t.onHover,[e,n,this],this)}else n&&fI(t.onClick,[e,n,this],this)}}function OF(e,t){return t*(e.text?e.text.length:0)}var zF={id:"legend",_element:LF,start(e,t,n){const i=e.legend=new LF({ctx:e.ctx,options:n,chart:e});Wz.configure(e,i,n),Wz.addBox(e,i)},stop(e){Wz.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;Wz.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,r=n.chart;r.isDatasetVisible(i)?(r.hide(i),t.hidden=!0):(r.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:r,color:o,useBorderRadius:s,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(e=>{const l=e.controller.getStyle(n?0:void 0),c=KL(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:o,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:s&&(a||l.borderRadius),datasetIndex:e.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class UF extends cU{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const i=lI(n.text)?n.text.length:1;this._padding=KL(n.padding);const r=i*JL(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:n,bottom:i,right:r,options:o}=this,s=o.align;let a,l,c,u=0;return this.isHorizontal()?(l=lL(s,n,r),c=t+e,a=r-n):("left"===o.position?(l=n+e,c=lL(s,i,t),u=-.5*PI):(l=r-e,c=lL(s,t,i),u=.5*PI),a=i-t),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=JL(t.font),i=n.lineHeight/2+this._padding.top,{titleX:r,titleY:o,maxWidth:s,rotation:a}=this._drawArgs(i);VL(e,t.text,0,0,n,{color:t.color,maxWidth:s,rotation:a,textAlign:aL(t.align),textBaseline:"middle",translation:[r,o]})}}var FF={id:"title",_element:UF,start(e,t,n){!function(e,t){const n=new UF({ctx:e.ctx,options:t,chart:e});Wz.configure(e,n,t),Wz.addBox(e,n),e.titleBlock=n}(e,n)},stop(e){const t=e.titleBlock;Wz.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;Wz.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;const jF={average(e){if(!e.length)return!1;let t,n,i=new Set,r=0,o=0;for(t=0,n=e.length;t<n;++t){const n=e[t].element;if(n&&n.hasValue()){const e=n.tooltipPosition();i.add(e.x),r+=e.y,++o}}if(0===o||0===i.size)return!1;const s=[...i].reduce((e,t)=>e+t)/i.size;return{x:s,y:r/o}},nearest(e,t){if(!e.length)return!1;let n,i,r,o=t.x,s=t.y,a=Number.POSITIVE_INFINITY;for(n=0,i=e.length;n<i;++n){const i=e[n].element;if(i&&i.hasValue()){const e=YI(t,i.getCenterPoint());e<a&&(a=e,r=i)}}if(r){const e=r.tooltipPosition();o=e.x,s=e.y}return{x:o,y:s}}};function BF(e,t){return t&&(lI(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function VF(e){return("string"===typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function HF(e,t){const{element:n,datasetIndex:i,index:r}=t,o=e.getDatasetMeta(i).controller,{label:s,value:a}=o.getLabelAndValue(r);return{chart:e,label:s,parsed:o.getParsed(r),raw:e.data.datasets[i].data[r],formattedValue:a,dataset:o.getDataset(),dataIndex:r,datasetIndex:i,element:n}}function GF(e,t){const n=e.chart.ctx,{body:i,footer:r,title:o}=e,{boxWidth:s,boxHeight:a}=t,l=JL(t.bodyFont),c=JL(t.titleFont),u=JL(t.footerFont),d=o.length,h=r.length,p=i.length,f=KL(t.padding);let m=f.height,g=0,v=i.reduce((e,t)=>e+t.before.length+t.lines.length+t.after.length,0);if(v+=e.beforeBody.length+e.afterBody.length,d&&(m+=d*c.lineHeight+(d-1)*t.titleSpacing+t.titleMarginBottom),v){m+=p*(t.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(v-p)*l.lineHeight+(v-1)*t.bodySpacing}h&&(m+=t.footerMarginTop+h*u.lineHeight+(h-1)*t.footerSpacing);let y=0;const b=function(e){g=Math.max(g,n.measureText(e).width+y)};return n.save(),n.font=c.string,mI(e.title,b),n.font=l.string,mI(e.beforeBody.concat(e.afterBody),b),y=t.displayColors?s+2+t.boxPadding:0,mI(i,e=>{mI(e.before,b),mI(e.lines,b),mI(e.after,b)}),y=0,n.font=u.string,mI(e.footer,b),n.restore(),g+=f.width,{width:g,height:m}}function WF(e,t,n,i){const{x:r,width:o}=n,{width:s,chartArea:{left:a,right:l}}=e;let c="center";return"center"===i?c=r<=(a+l)/2?"left":"right":r<=o/2?c="left":r>=s-o/2&&(c="right"),function(e,t,n,i){const{x:r,width:o}=i,s=n.caretSize+n.caretPadding;return"left"===e&&r+o+s>t.width||"right"===e&&r-o-s<0||void 0}(c,e,t,n)&&(c="center"),c}function XF(e,t,n){const i=n.yAlign||t.yAlign||function(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}(e,n);return{xAlign:n.xAlign||t.xAlign||WF(e,t,n,i),yAlign:i}}function YF(e,t,n,i){const{caretSize:r,caretPadding:o,cornerRadius:s}=e,{xAlign:a,yAlign:l}=n,c=r+o,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:p}=ZL(s);let f=function(e,t){let{x:n,width:i}=e;return"right"===t?n-=i:"center"===t&&(n-=i/2),n}(t,a);const m=function(e,t,n){let{y:i,height:r}=e;return"top"===t?i+=n:i-="bottom"===t?r+n:r/2,i}(t,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(u,h)+r:"right"===a&&(f+=Math.max(d,p)+r),{x:KI(f,0,i.width-t.width),y:KI(m,0,i.height-t.height)}}function $F(e,t,n){const i=KL(n.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-i.right:e.x+i.left}function qF(e){return BF([],VF(e))}function ZF(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const KF={beforeTitle:oI,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:oI,beforeBody:oI,beforeLabel:oI,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return aI(n)||(t+=n),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:oI,afterBody:oI,beforeFooter:oI,footer:oI,afterFooter:oI};function JF(e,t,n,i){const r=e[t].call(n,i);return"undefined"===typeof r?KF[t].call(n,i):r}class QF extends cU{static positioners=(()=>jF)();constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&t.options.animation&&n.animations,r=new QO(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=(e=this.chart.getContext(),t=this,n=this._tooltipItems,eO(e,{tooltip:t,tooltipItems:n,type:"tooltip"})));var e,t,n}getTitle(e,t){const{callbacks:n}=t,i=JF(n,"beforeTitle",this,e),r=JF(n,"title",this,e),o=JF(n,"afterTitle",this,e);let s=[];return s=BF(s,VF(i)),s=BF(s,VF(r)),s=BF(s,VF(o)),s}getBeforeBody(e,t){return qF(JF(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,i=[];return mI(e,e=>{const t={before:[],lines:[],after:[]},r=ZF(n,e);BF(t.before,VF(JF(r,"beforeLabel",this,e))),BF(t.lines,JF(r,"label",this,e)),BF(t.after,VF(JF(r,"afterLabel",this,e))),i.push(t)}),i}getAfterBody(e,t){return qF(JF(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,i=JF(n,"beforeFooter",this,e),r=JF(n,"footer",this,e),o=JF(n,"afterFooter",this,e);let s=[];return s=BF(s,VF(i)),s=BF(s,VF(r)),s=BF(s,VF(o)),s}_createItems(e){const t=this._active,n=this.chart.data,i=[],r=[],o=[];let s,a,l=[];for(s=0,a=t.length;s<a;++s)l.push(HF(this.chart,t[s]));return e.filter&&(l=l.filter((t,i,r)=>e.filter(t,i,r,n))),e.itemSort&&(l=l.sort((t,i)=>e.itemSort(t,i,n))),mI(l,t=>{const n=ZF(e.callbacks,t);i.push(JF(n,"labelColor",this,t)),r.push(JF(n,"labelPointStyle",this,t)),o.push(JF(n,"labelTextColor",this,t))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=l,l}update(e,t){const n=this.options.setContext(this.getContext()),i=this._active;let r,o=[];if(i.length){const e=jF[n.position].call(this,i,this._eventPosition);o=this._createItems(n),this.title=this.getTitle(o,n),this.beforeBody=this.getBeforeBody(o,n),this.body=this.getBody(o,n),this.afterBody=this.getAfterBody(o,n),this.footer=this.getFooter(o,n);const t=this._size=GF(this,n),s=Object.assign({},e,t),a=XF(this.chart,n,s),l=YF(n,s,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,r={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,i){const r=this.getCaretPosition(e,n,i);t.lineTo(r.x1,r.y1),t.lineTo(r.x2,r.y2),t.lineTo(r.x3,r.y3)}getCaretPosition(e,t,n){const{xAlign:i,yAlign:r}=this,{caretSize:o,cornerRadius:s}=n,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=ZL(s),{x:d,y:h}=e,{width:p,height:f}=t;let m,g,v,y,b,x;return"center"===r?(b=h+f/2,"left"===i?(m=d,g=m-o,y=b+o,x=b-o):(m=d+p,g=m+o,y=b-o,x=b+o),v=m):(g="left"===i?d+Math.max(a,c)+o:"right"===i?d+p-Math.max(l,u)-o:this.caretX,"top"===r?(y=h,b=y-o,m=g-o,v=g+o):(y=h+f,b=y+o,m=g+o,v=g-o),x=y),{x1:m,x2:g,x3:v,y1:y,y2:b,y3:x}}drawTitle(e,t,n){const i=this.title,r=i.length;let o,s,a;if(r){const l=OO(n.rtl,this.x,this.width);for(e.x=$F(this,n.titleAlign,n),t.textAlign=l.textAlign(n.titleAlign),t.textBaseline="middle",o=JL(n.titleFont),s=n.titleSpacing,t.fillStyle=n.titleColor,t.font=o.string,a=0;a<r;++a)t.fillText(i[a],l.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+s,a+1===r&&(e.y+=n.titleMarginBottom-s)}}_drawColorBox(e,t,n,i,r){const o=this.labelColors[n],s=this.labelPointStyles[n],{boxHeight:a,boxWidth:l}=r,c=JL(r.bodyFont),u=$F(this,"left",r),d=i.x(u),h=a<c.lineHeight?(c.lineHeight-a)/2:0,p=t.y+h;if(r.usePointStyle){const t={radius:Math.min(l,a)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},n=i.leftForLtr(d,l)+l/2,c=p+a/2;e.strokeStyle=r.multiKeyBackground,e.fillStyle=r.multiKeyBackground,NL(e,t,n,c),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,NL(e,t,n,c)}else{e.lineWidth=cI(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const t=i.leftForLtr(d,l),n=i.leftForLtr(i.xPlus(d,1),l-2),s=ZL(o.borderRadius);Object.values(s).some(e=>0!==e)?(e.beginPath(),e.fillStyle=r.multiKeyBackground,HL(e,{x:t,y:p,w:l,h:a,radius:s}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),HL(e,{x:n,y:p+1,w:l-2,h:a-2,radius:s}),e.fill()):(e.fillStyle=r.multiKeyBackground,e.fillRect(t,p,l,a),e.strokeRect(t,p,l,a),e.fillStyle=o.backgroundColor,e.fillRect(n,p+1,l-2,a-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:i}=this,{bodySpacing:r,bodyAlign:o,displayColors:s,boxHeight:a,boxWidth:l,boxPadding:c}=n,u=JL(n.bodyFont);let d=u.lineHeight,h=0;const p=OO(n.rtl,this.x,this.width),f=function(n){t.fillText(n,p.x(e.x+h),e.y+d/2),e.y+=d+r},m=p.textAlign(o);let g,v,y,b,x,_,w;for(t.textAlign=o,t.textBaseline="middle",t.font=u.string,e.x=$F(this,m,n),t.fillStyle=n.bodyColor,mI(this.beforeBody,f),h=s&&"right"!==m?"center"===o?l/2+c:l+2+c:0,b=0,_=i.length;b<_;++b){for(g=i[b],v=this.labelTextColors[b],t.fillStyle=v,mI(g.before,f),y=g.lines,s&&y.length&&(this._drawColorBox(t,e,b,p,n),d=Math.max(u.lineHeight,a)),x=0,w=y.length;x<w;++x)f(y[x]),d=u.lineHeight;mI(g.after,f)}h=0,d=u.lineHeight,mI(this.afterBody,f),e.y-=r}drawFooter(e,t,n){const i=this.footer,r=i.length;let o,s;if(r){const a=OO(n.rtl,this.x,this.width);for(e.x=$F(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=a.textAlign(n.footerAlign),t.textBaseline="middle",o=JL(n.footerFont),t.fillStyle=n.footerColor,t.font=o.string,s=0;s<r;++s)t.fillText(i[s],a.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+n.footerSpacing}}drawBackground(e,t,n,i){const{xAlign:r,yAlign:o}=this,{x:s,y:a}=e,{width:l,height:c}=n,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:p}=ZL(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(s+u,a),"top"===o&&this.drawCaret(e,t,n,i),t.lineTo(s+l-d,a),t.quadraticCurveTo(s+l,a,s+l,a+d),"center"===o&&"right"===r&&this.drawCaret(e,t,n,i),t.lineTo(s+l,a+c-p),t.quadraticCurveTo(s+l,a+c,s+l-p,a+c),"bottom"===o&&this.drawCaret(e,t,n,i),t.lineTo(s+h,a+c),t.quadraticCurveTo(s,a+c,s,a+c-h),"center"===o&&"left"===r&&this.drawCaret(e,t,n,i),t.lineTo(s,a+u),t.quadraticCurveTo(s,a,s+u,a),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,i=n&&n.x,r=n&&n.y;if(i||r){const n=jF[e.position].call(this,this._active,this._eventPosition);if(!n)return;const o=this._size=GF(this,e),s=Object.assign({},n,this._size),a=XF(t,e,s),l=YF(e,s,a,t);i._to===l.x&&r._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=o.width,this.height=o.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const o=KL(t.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&s&&(e.save(),e.globalAlpha=n,this.drawBackground(r,e,i,t),zO(e,t.textDirection),r.y+=o.top,this.drawTitle(r,e,t),this.drawBody(r,e,t),this.drawFooter(r,e,t),UO(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,i=e.map(e=>{let{datasetIndex:t,index:n}=e;const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[n],index:n}}),r=!gI(n,i),o=this._positionChanged(i,t);(r||o)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],o=this._getActiveElements(e,r,t,n),s=this._positionChanged(o,e),a=t||!gI(o,r)||s;return a&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),a}_getActiveElements(e,t,n,i){const r=this.options;if("mouseout"===e.type)return[];if(!i)return t.filter(e=>this.chart.data.datasets[e.datasetIndex]&&void 0!==this.chart.getDatasetMeta(e.datasetIndex).controller.getParsed(e.index));const o=this.chart.getElementsAtEventForMode(e,r.mode,r,n);return r.reverse&&o.reverse(),o}_positionChanged(e,t){const{caretX:n,caretY:i,options:r}=this,o=jF[r.position].call(this,e,t);return!1!==o&&(n!==o.x||i!==o.y)}}var ej={id:"tooltip",_element:QF,positioners:jF,afterInit(e,t,n){n&&(e.tooltip=new QF({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0}))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:KF},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function tj(e,t,n,i){const r=e.indexOf(t);if(-1===r)return((e,t,n,i)=>("string"===typeof t?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n))(e,t,n,i);return r!==e.lastIndexOf(t)?n:r}function nj(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class ij extends bU{static id="category";static defaults=(()=>({ticks:{callback:nj}}))();constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:n,label:i}of t)e[n]===i&&e.splice(n,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(aI(e))return null;const n=this.getLabels();return((e,t)=>null===e?null:KI(Math.round(e),0,t))(t=isFinite(t)&&n[t]===e?t:tj(n,e,hI(t,e),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(n=0),t||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,i=[];let r=this.getLabels();r=0===e&&t===r.length-1?r:r.slice(e,t+1),this._valueRange=Math.max(r.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let o=e;o<=t;o++)i.push({value:o});return i}getLabelForValue(e){return nj.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!==typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function rj(e,t){const n=[],{bounds:i,step:r,min:o,max:s,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:d}=e,h=r||1,p=c-1,{min:f,max:m}=t,g=!aI(o),v=!aI(s),y=!aI(l),b=(m-f)/(u+1);let x,_,w,S,M=jI((m-f)/p/h)*h;if(M<1e-14&&!g&&!v)return[{value:f},{value:m}];S=Math.ceil(m/M)-Math.floor(f/M),S>p&&(M=jI(S*M/p/h)*h),aI(a)||(x=Math.pow(10,a),M=Math.ceil(M*x)/x),"ticks"===i?(_=Math.floor(f/M)*M,w=Math.ceil(m/M)*M):(_=f,w=m),g&&v&&r&&function(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}((s-o)/r,M/1e3)?(S=Math.round(Math.min((s-o)/M,c)),M=(s-o)/S,_=o,w=s):y?(_=g?o:_,w=v?s:w,S=l-1,M=(w-_)/S):(S=(w-_)/M,S=FI(S,Math.round(S),M/1e3)?Math.round(S):Math.ceil(S));const E=Math.max(WI(M),WI(_));x=Math.pow(10,aI(a)?E:a),_=Math.round(_*x)/x,w=Math.round(w*x)/x;let C=0;for(g&&(d&&_!==o?(n.push({value:o}),_<o&&C++,FI(Math.round((_+C*M)*x)/x,o,oj(o,b,e))&&C++):_<o&&C++);C<S;++C){const e=Math.round((_+C*M)*x)/x;if(v&&e>s)break;n.push({value:e})}return v&&d&&w!==s?n.length&&FI(n[n.length-1].value,s,oj(s,b,e))?n[n.length-1].value=s:n.push({value:s}):v&&w!==s||n.push({value:w}),n}function oj(e,t,n){let{horizontal:i,minRotation:r}=n;const o=HI(r),s=(i?Math.sin(o):Math.cos(o))||.001,a=.75*t*(""+e).length;return Math.min(t/s,a)}class sj extends bU{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return aI(e)||("number"===typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:r}=this;const o=e=>i=t?i:e,s=e=>r=n?r:e;if(e){const e=UI(i),t=UI(r);e<0&&t<0?s(0):e>0&&t>0&&o(0)}if(i===r){let t=0===r?1:Math.abs(.05*r);s(r+t),e||o(i-t)}this.min=i,this.max=r}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:n,stepSize:i}=e;return i?(t=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,t>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${t} ticks. Limiting to 1000.`),t=1e3)):(t=this.computeTickLimit(),n=n||11),n&&(t=Math.min(n,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=rj({maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&VI(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const i=(n-t)/Math.max(e.length-1,1)/2;t-=i,n+=i}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return _L(e,this.chart.options.locale,this.options.ticks.format)}}class aj extends sj{static id="linear";static defaults=(()=>({ticks:{callback:SL.formatters.numeric}}))();determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=uI(e)?e:0,this.max=uI(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=HI(this.options.ticks.minRotation),i=(e?Math.sin(n):Math.cos(n))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,r.lineHeight/i))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}SL.formatters.logarithmic;SL.formatters.numeric;const lj={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},cj=Object.keys(lj);function uj(e,t){return e-t}function dj(e,t){if(aI(t))return null;const n=e._adapter,{parser:i,round:r,isoWeekday:o}=e._parseOpts;let s=t;return"function"===typeof i&&i(s),uI(s)||("string"===typeof i?n.parse(s,i):n.parse(s)),null===s?null:(r&&("week"!==r||!BI(o)&&!0!==o?n.startOf(s,r):n.startOf(s,"isoWeek",o)),+s)}function hj(e,t,n,i){const r=cj.length;for(let o=cj.indexOf(e);o<r-1;++o){const e=lj[cj[o]],r=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((n-t)/(r*e.size))<=i)return cj[o]}return cj[r-1]}function pj(e,t,n){if(n){if(n.length){const{lo:i,hi:r}=QI(n,t);e[n[i]>=t?n[i]:n[r]]=!0}}else e[t]=!0}function fj(e,t,n){const i=[],r={},o=t.length;let s,a;for(0;s<o;++s)t[s],r[a]=s,i.push({value:a,major:!1});return 0!==o&&n?function(e,t,n,i){const r=e._adapter,o=+r.startOf(t[0].value,i),s=t[t.length-1].value;let a,l;for(o;a<=s;+r.add(a,1,i))n[a],l>=0&&(t[l].major=!0);return t}(e,i,r,n):i}class mj extends bU{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.time||(e.time={}),i=this._adapter=new Ez(e.adapters.date);i.init(t),_I(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:dj(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:i,max:r,minDefined:o,maxDefined:s}=this.getUserBounds();function a(e){o||isNaN(e.min)||Math.min(i,e.min),s||isNaN(e.max)||Math.max(r,e.max)}o&&s||(a(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||a(this.getMinMax(!1))),uI(i)&&!isNaN(i)?i:+t.startOf(Date.now(),n),uI(r)&&!isNaN(r)?r:+t.endOf(Date.now(),n)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(e[0],e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,o=function(e,t,n){let i=0,r=e.length;for(;i<r&&e[i]<t;)0;for(;r>i&&e[r-1]>n;)0;return i>0||r<e.length?e.slice(i,r):e}(i,r,this.max);return this._unit=t.unit||(n.autoSkip?hj(t.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(e,t,n,i,r){for(let o=cj.length-1;o>=cj.indexOf(n);o--){const n=cj[o];if(lj[n].common&&e._adapter.diff(r,i,n)>=t-1)return n}return cj[n?cj.indexOf(n):0]}(this,o.length,t.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(e){for(let t=cj.indexOf(e)+1,n=cj.length;t<n;++t)if(lj[cj[t]].common)return cj[t]}(this._unit):void 0,this.initOffsets(i),e.reverse&&o.reverse(),fj(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=0,r=0;this.options.offset&&n.length&&(this.getDecimalForValue(n[0]),1===n.length?1-e:(this.getDecimalForValue(n[1])-e)/2,this.getDecimalForValue(n[n.length-1]),1===n.length?t:(t-this.getDecimalForValue(n[n.length-2]))/2);const o=n.length<3?.5:.25;KI(i,0,o),KI(r,0,o),this._offsets={start:i,end:r,factor:1/(i+1+r)}}_generate(){const e=this._adapter,t=this.min,n=this.max,i=this.options,r=i.time,o=r.unit||hj(r.minUnit,t,n,this._getLabelCapacity(t)),s=hI(i.ticks.stepSize,1),a="week"===o&&r.isoWeekday,l=BI(a)||!0===a,c={};let u,d,h=t;if(l&&+e.startOf(h,"isoWeek",a),+e.startOf(h,l?"day":o),e.diff(n,t,o)>1e5*s)throw new Error(t+" and "+n+" are too far apart with stepSize of "+s+" "+o);const p="data"===i.ticks.source&&this.getDataTimestamps();for(0;u<n;+e.add(u,s,o),d++)pj(c,u,p);return u!==n&&"ticks"!==i.bounds&&1!==d||pj(c,u,p),Object.keys(c).sort(uj).map(e=>+e)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const n=this.options.time.displayFormats,i=this._unit,r=t||n[i];return this._adapter.format(e,r)}_tickFormatFunction(e,t,n,i){const r=this.options,o=r.ticks.callback;if(o)return fI(o,[e,t,n],this);const s=r.time.displayFormats,a=this._unit,l=this._majorUnit,c=a&&s[a],u=l&&s[l],d=n[t],h=l&&u&&d&&d.major;return this._adapter.format(e,i||(h?u:c))}generateTickLabels(e){let t,n,i;for(e.length;t<n;++t)e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,i=HI(this.isHorizontal()?t.maxRotation:t.minRotation),r=Math.cos(i),o=Math.sin(i),s=this._resolveTickFontOptions(0).size;return{w:n*r+s*o,h:n*o+s*r}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,i=n[t.unit]||n.millisecond,r=this._tickFormatFunction(e,0,fj(this,[e],this._majorUnit),i),o=this._getLabelSize(r),s=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return s>0?s:1}getDataTimestamps(){let e,t,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(i.length;e<t;++e)n.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const i=this.getLabels();for(i.length;t<n;++t)e.push(dj(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return rL(e.sort(uj))}}const gj="label";function vj(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function yj(e,t){e.labels=t}function bj(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:gj;const i=[];e.datasets=t.map(t=>{const r=e.datasets.find(e=>e[n]===t[n]);return r&&t.data&&!i.includes(r)?(i.push(r),Object.assign(r,t),r):{...t}})}function xj(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gj;const n={labels:[],datasets:[]};return yj(n,e.labels),bj(n,e.datasets,t),n}function _j(e,n){const{height:i=150,width:r=300,redraw:o=!1,datasetIdKey:s,type:a,data:l,options:c,plugins:u=[],fallbackContent:d,updateMode:h,...p}=e,f=(0,t.useRef)(null),m=(0,t.useRef)(null),g=()=>{f.current&&(m.current=new ZU(f.current,{type:a,data:xj(l,s),options:c&&{...c},plugins:u}),vj(n,m.current))},v=()=>{vj(n,null),m.current&&(m.current.destroy(),m.current=null)};return(0,t.useEffect)(()=>{!o&&m.current&&c&&function(e,t){const n=e.options;n&&t&&Object.assign(n,t)}(m.current,c)},[o,c]),(0,t.useEffect)(()=>{!o&&m.current&&yj(m.current.config.data,l.labels)},[o,l.labels]),(0,t.useEffect)(()=>{!o&&m.current&&l.datasets&&bj(m.current.config.data,l.datasets,s)},[o,l.datasets]),(0,t.useEffect)(()=>{m.current&&(o?(v(),setTimeout(g)):m.current.update(h))},[o,c,l.labels,l.datasets,h]),(0,t.useEffect)(()=>{m.current&&(v(),setTimeout(g))},[a]),(0,t.useEffect)(()=>(g(),()=>v()),[]),t.createElement("canvas",{ref:f,role:"img",height:i,width:r,...p},d)}const wj=(0,t.forwardRef)(_j);function Sj(e,n){return ZU.register(n),(0,t.forwardRef)((n,i)=>t.createElement(wj,{...n,ref:i,type:e}))}const Mj=Sj("line",_z),Ej=Sj("bar",xz),Cj=Sj("scatter",wz);var Tj=n(895),Aj=n.n(Tj);const Pj=e=>e&&e.enabled&&e.modifierKey,Dj=(e,t)=>e&&t[e+"Key"],kj=(e,t)=>e&&!t[e+"Key"];function Rj(e,t,n){return void 0===e||("string"===typeof e?-1!==e.indexOf(t):"function"===typeof e&&-1!==e({chart:n}).indexOf(t))}function Nj(e,t){return"function"===typeof e&&(e=e({chart:t})),"string"===typeof e?{x:-1!==e.indexOf("x"),y:-1!==e.indexOf("y")}:{x:!1,y:!1}}function Ij(e,t,n){const{mode:i="xy",scaleMode:r,overScaleMode:o}=e||{},s=function(e,t){let{x:n,y:i}=e;const r=t.scales,o=Object.keys(r);for(let s=0;s<o.length;s++){const e=r[o[s]];if(i>=e.top&&i<=e.bottom&&n>=e.left&&n<=e.right)return e}return null}(t,n),a=Nj(i,n),l=Nj(r,n);if(o){const e=Nj(o,n);for(const t of["x","y"])e[t]&&(l[t]=a[t],a[t]=!1)}if(s&&l[s.axis])return[s];const c=[];return mI(n.scales,function(e){a[e.axis]&&c.push(e)}),c}const Lj=new WeakMap;function Oj(e){let t=Lj.get(e);return t||(t={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{},dragging:!1,panning:!1},Lj.set(e,t)),t}function zj(e,t,n,i){const r=Math.max(0,Math.min(1,(e-t)/n||0));return{min:i*r,max:i*(1-r)}}function Uj(e,t){const n=e.isHorizontal()?t.x:t.y;return e.getValueForPixel(n)}function Fj(e,t,n){const i=e.max-e.min,r=i*(t-1);return zj(Uj(e,n),e.min,i,r)}function jj(e,t,n,i,r){let o=n[i];if("original"===o){const n=e.originalScaleLimits[t.id][i];o=hI(n.options,n.scale)}return hI(o,r)}function Bj(e,t,n){let{min:i,max:r}=t,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=Oj(e.chart),{options:a}=e,l=function(e,t){return t&&(t[e.id]||t[e.axis])||{}}(e,n),{minRange:c=0}=l,u=jj(s,e,l,"min",-1/0),d=jj(s,e,l,"max",1/0);if("pan"===o&&(i<u||r>d))return!0;const h=e.max-e.min,p=o?Math.max(r-i,c):h;if(o&&p===c&&h<=c)return!0;const f=function(e,t,n){let{min:i,max:r,minLimit:o,maxLimit:s}=t;const a=(e-r+i)/2;i-=a,r+=a;const l=n.min.options??n.min.scale,c=n.max.options??n.max.scale,u=e/1e6;return FI(i,l,u)&&(i=l),FI(r,c,u)&&(r=c),i<o?(i=o,r=Math.min(o+e,s)):r>s&&(r=s,i=Math.max(s-e,o)),{min:i,max:r}}(p,{min:i,max:r,minLimit:u,maxLimit:d},s.originalScaleLimits[e.id]);return a.min=f.min,a.max=f.max,s.updatedScaleLimits[e.id]=f,e.parse(f.min)!==e.min||e.parse(f.max)!==e.max}const Vj=e=>0===e||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1);const Hj={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function Gj(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{min:r,max:o,options:s}=e,a=s.time&&s.time.round,l=Hj[a]||0,c=e.getValueForPixel(e.getPixelForValue(r+l)-t),u=e.getValueForPixel(e.getPixelForValue(o+l)-t);return!(!isNaN(c)&&!isNaN(u))||Bj(e,{min:c,max:u},n,!!i&&"pan")}function Wj(e,t,n){return Gj(e,t,n,!0)}const Xj={category:function(e,t,n,i){const r=Fj(e,t,n);return e.min===e.max&&t<1&&function(e){const t=e.getLabels().length-1;e.min>0&&(e.min-=1),e.max<t&&(e.max+=1)}(e),Bj(e,{min:e.min+Vj(r.min),max:e.max-Vj(r.max)},i,!0)},default:function(e,t,n,i){const r=Fj(e,t,n);return Bj(e,{min:e.min+r.min,max:e.max-r.max},i,!0)},logarithmic:function(e,t,n,i){const r=function(e,t,n){const i=Uj(e,n);if(void 0===i)return{min:e.min,max:e.max};const r=Math.log10(e.min),o=Math.log10(e.max),s=o-r,a=zj(Math.log10(i),r,s,s*(t-1));return{min:Math.pow(10,r+a.min),max:Math.pow(10,o-a.max)}}(e,t,n);return Bj(e,r,i,!0)}},Yj={default:function(e,t,n,i){Bj(e,function(e,t,n){const i=e.getValueForPixel(t),r=e.getValueForPixel(n);return{min:Math.min(i,r),max:Math.max(i,r)}}(e,t,n),i,!0)}},$j={category:function(e,t,n){const i=e.getLabels().length-1;let{min:r,max:o}=e;const s=Math.max(o-r,1),a=Math.round(function(e){return e.isHorizontal()?e.width:e.height}(e)/Math.max(s,10)),l=Math.round(Math.abs(t/a));let c;return t<-a?(o=Math.min(o+l,i),r=1===s?o:o-s,c=o===i):t>a&&(r=Math.max(0,r-l),o=1===s?r:r+s,c=0===r),Bj(e,{min:r,max:o},n)||c},default:Gj,logarithmic:Wj,timeseries:Wj};function qj(e,t){mI(e,(n,i)=>{t[i]||delete e[i]})}function Zj(e,t){const{scales:n}=e,{originalScaleLimits:i,updatedScaleLimits:r}=t;return mI(n,function(e){(function(e,t,n){const{id:i,options:{min:r,max:o}}=e;if(!t[i]||!n[i])return!0;const s=n[i];return s.min!==r||s.max!==o})(e,i,r)&&(i[e.id]={min:{scale:e.min,options:e.options.min},max:{scale:e.max,options:e.options.max}})}),qj(i,n),qj(r,n),i}function Kj(e,t,n,i){fI(Xj[e.type]||Xj.default,[e,t,n,i])}function Jj(e,t,n,i){fI(Yj[e.type]||Yj.default,[e,t,n,i])}function Qj(e){const t=e.chartArea;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function eB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"api";const{x:r=1,y:o=1,focalPoint:s=Qj(e)}="number"===typeof t?{x:t,y:t}:t,a=Oj(e),{options:{limits:l,zoom:c}}=a;Zj(e,a);const u=1!==r,d=1!==o;mI(Ij(c,s,e)||e.scales,function(e){e.isHorizontal()&&u?Kj(e,r,s,l):!e.isHorizontal()&&d&&Kj(e,o,s,l)}),e.update(n),fI(c.onZoom,[{chart:e,trigger:i}])}function tB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"api";const o=Oj(e),{options:{limits:s,zoom:a}}=o,{mode:l="xy"}=a;Zj(e,o);const c=Rj(l,"x",e),u=Rj(l,"y",e);mI(e.scales,function(e){e.isHorizontal()&&c?Jj(e,t.x,n.x,s):!e.isHorizontal()&&u&&Jj(e,t.y,n.y,s)}),e.update(i),fI(a.onZoom,[{chart:e,trigger:r}])}function nB(e){const t=Oj(e);let n=1,i=1;return mI(e.scales,function(e){const r=function(e,t){const n=e.originalScaleLimits[t];if(!n)return;const{min:i,max:r}=n;return hI(r.options,r.scale)-hI(i.options,i.scale)}(t,e.id);if(r){const t=Math.round(r/(e.max-e.min)*100)/100;n=Math.min(n,t),i=Math.max(i,t)}}),n<1?n:i}function iB(e,t,n,i){const{panDelta:r}=i,o=r[e.id]||0;UI(o)===UI(t)&&(t+=o);fI($j[e.type]||$j.default,[e,t,n])?r[e.id]=0:r[e.id]=t}function rB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none";const{x:r=0,y:o=0}="number"===typeof t?{x:t,y:t}:t,s=Oj(e),{options:{pan:a,limits:l}}=s,{onPan:c}=a||{};Zj(e,s);const u=0!==r,d=0!==o;mI(n||e.scales,function(e){e.isHorizontal()&&u?iB(e,r,l,s):!e.isHorizontal()&&d&&iB(e,o,l,s)}),e.update(i),fI(c,[{chart:e}])}function oB(e){const t=Oj(e);Zj(e,t);const n={};for(const i of Object.keys(e.scales)){const{min:e,max:r}=t.originalScaleLimits[i]||{min:{},max:{}};n[i]={min:e.scale,max:r.scale}}return n}function sB(e){const t=Oj(e);return t.panning||t.dragging}const aB=(e,t,n)=>Math.min(n,Math.max(t,e));function lB(e,t){const{handlers:n}=Oj(e),i=n[t];i&&i.target&&(i.target.removeEventListener(t,i),delete n[t])}function cB(e,t,n,i){const{handlers:r,options:o}=Oj(e),s=r[n];if(s&&s.target===t)return;lB(e,n),r[n]=t=>i(e,t,o),r[n].target=t;const a="wheel"!==n&&void 0;t.addEventListener(n,r[n],{passive:a})}function uB(e,t){const n=Oj(e);n.dragStart&&(n.dragging=!0,n.dragEnd=t,e.update("none"))}function dB(e,t){const n=Oj(e);n.dragStart&&"Escape"===t.key&&(lB(e,"keydown"),n.dragging=!1,n.dragStart=n.dragEnd=null,e.update("none"))}function hB(e,t){if(e.target!==t.canvas){const n=t.canvas.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}return TO(e,t)}function pB(e,t,n){const{onZoomStart:i,onZoomRejected:r}=n;if(i){if(!1===fI(i,[{chart:e,event:t,point:hB(t,e)}]))return fI(r,[{chart:e,event:t}]),!1}}function fB(e,t){if(e.legend){if(LL(TO(t,e),e.legend))return}const n=Oj(e),{pan:i,zoom:r={}}=n.options;if(0!==t.button||Dj(Pj(i),t)||kj(Pj(r.drag),t))return fI(r.onZoomRejected,[{chart:e,event:t}]);!1!==pB(e,t,r)&&(n.dragStart=t,cB(e,e.canvas.ownerDocument,"mousemove",uB),cB(e,window.document,"keydown",dB))}function mB(e,t,n,i){let{min:r,max:o,prop:s}=i;e[r]=aB(Math.min(n.begin[s],n.end[s]),t[r],t[o]),e[o]=aB(Math.max(n.begin[s],n.end[s]),t[r],t[o])}function gB(e,t,n){const i={begin:hB(t.dragStart,e),end:hB(t.dragEnd,e)};if(n){!function(e,t){let{begin:n,end:i}=e,r=i.x-n.x,o=i.y-n.y;const s=Math.abs(r/o);s>t?r=Math.sign(r)*Math.abs(o*t):s<t&&(o=Math.sign(o)*Math.abs(r/t)),i.x=n.x+r,i.y=n.y+o}(i,e.chartArea.width/e.chartArea.height)}return i}function vB(e,t,n,i){const r=Rj(t,"x",e),o=Rj(t,"y",e),{top:s,left:a,right:l,bottom:c,width:u,height:d}=e.chartArea,h={top:s,left:a,right:l,bottom:c},p=gB(e,n,i&&r&&o);r&&mB(h,e.chartArea,p,{min:"left",max:"right",prop:"x"}),o&&mB(h,e.chartArea,p,{min:"top",max:"bottom",prop:"y"});const f=h.right-h.left,m=h.bottom-h.top;return{...h,width:f,height:m,zoomX:r&&f?1+(u-f)/u:1,zoomY:o&&m?1+(d-m)/d:1}}function yB(e,t){const n=Oj(e);if(!n.dragStart)return;lB(e,"mousemove");const{mode:i,onZoomComplete:r,drag:{threshold:o=0,maintainAspectRatio:s}}=n.options.zoom,a=vB(e,i,{dragStart:n.dragStart,dragEnd:t},s),l=Rj(i,"x",e)?a.width:0,c=Rj(i,"y",e)?a.height:0,u=Math.sqrt(l*l+c*c);if(n.dragStart=n.dragEnd=null,u<=o)return n.dragging=!1,void e.update("none");tB(e,{x:a.left,y:a.top},{x:a.right,y:a.bottom},"zoom","drag"),n.dragging=!1,n.filterNextClick=!0,fI(r,[{chart:e}])}function bB(e,t){const{handlers:{onZoomComplete:n},options:{zoom:i}}=Oj(e);if(!function(e,t,n){if(kj(Pj(n.wheel),t))fI(n.onZoomRejected,[{chart:e,event:t}]);else if(!1!==pB(e,t,n)&&(t.cancelable&&t.preventDefault(),void 0!==t.deltaY))return!0}(e,t,i))return;const r=t.target.getBoundingClientRect(),o=i.wheel.speed,s=t.deltaY>=0?2-1/(1-o):1+o;eB(e,{x:s,y:s,focalPoint:{x:t.clientX-r.left,y:t.clientY-r.top}},"zoom","wheel"),fI(n,[{chart:e}])}function xB(e,t,n,i){n&&(Oj(e).handlers[t]=function(e,t){let n;return function(){return clearTimeout(n),n=setTimeout(e,t),t}}(()=>fI(n,[{chart:e}]),i))}function _B(e,t){return function(n,i){const{pan:r,zoom:o={}}=t.options;if(!r||!r.enabled)return!1;const s=i&&i.srcEvent;return!s||(!(!t.panning&&"mouse"===i.pointerType&&(kj(Pj(r),s)||Dj(Pj(o.drag),s)))||(fI(r.onPanRejected,[{chart:e,event:i}]),!1))}}function wB(e,t,n){if(t.scale){const{center:i,pointers:r}=n,o=1/t.scale*n.scale,s=n.target.getBoundingClientRect(),a=function(e,t){const n=Math.abs(e.clientX-t.clientX),i=Math.abs(e.clientY-t.clientY),r=n/i;let o,s;return r>.3&&r<1.7?o=s=!0:n>i?o=!0:s=!0,{x:o,y:s}}(r[0],r[1]),l=t.options.zoom.mode;eB(e,{x:a.x&&Rj(l,"x",e)?o:1,y:a.y&&Rj(l,"y",e)?o:1,focalPoint:{x:i.x-s.left,y:i.y-s.top}},"zoom","pinch"),t.scale=n.scale}}function SB(e,t,n){const i=t.delta;i&&(t.panning=!0,rB(e,{x:n.deltaX-i.x,y:n.deltaY-i.y},t.panScales),t.delta={x:n.deltaX,y:n.deltaY})}const MB=new WeakMap;function EB(e,t){const n=Oj(e),i=e.canvas,{pan:r,zoom:o}=t,s=new(Aj().Manager)(i);o&&o.pinch.enabled&&(s.add(new(Aj().Pinch)),s.on("pinchstart",t=>function(e,t,n){if(t.options.zoom.pinch.enabled){const i=TO(n,e);!1===fI(t.options.zoom.onZoomStart,[{chart:e,event:n,point:i}])?(t.scale=null,fI(t.options.zoom.onZoomRejected,[{chart:e,event:n}])):t.scale=1}}(e,n,t)),s.on("pinch",t=>wB(e,n,t)),s.on("pinchend",t=>function(e,t,n){t.scale&&(wB(e,t,n),t.scale=null,fI(t.options.zoom.onZoomComplete,[{chart:e}]))}(e,n,t))),r&&r.enabled&&(s.add(new(Aj().Pan)({threshold:r.threshold,enable:_B(e,n)})),s.on("panstart",t=>function(e,t,n){const{enabled:i,onPanStart:r,onPanRejected:o}=t.options.pan;if(!i)return;const s=n.target.getBoundingClientRect(),a={x:n.center.x-s.left,y:n.center.y-s.top};if(!1===fI(r,[{chart:e,event:n,point:a}]))return fI(o,[{chart:e,event:n}]);t.panScales=Ij(t.options.pan,a,e),t.delta={x:0,y:0},SB(e,t,n)}(e,n,t)),s.on("panmove",t=>SB(e,n,t)),s.on("panend",()=>function(e,t){t.delta=null,t.panning&&(t.panning=!1,t.filterNextClick=!0,fI(t.options.pan.onPanComplete,[{chart:e}]))}(e,n))),MB.set(e,s)}function CB(e){const t=MB.get(e);t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy(),MB.delete(e))}function TB(e,t,n){const i=n.zoom.drag,{dragStart:r,dragEnd:o}=Oj(e);if(i.drawTime!==t||!o)return;const{left:s,top:a,width:l,height:c}=vB(e,n.zoom.mode,{dragStart:r,dragEnd:o},i.maintainAspectRatio),u=e.ctx;u.save(),u.beginPath(),u.fillStyle=i.backgroundColor||"rgba(225,225,225,0.3)",u.fillRect(s,a,l,c),i.borderWidth>0&&(u.lineWidth=i.borderWidth,u.strokeStyle=i.borderColor||"rgba(225,225,225)",u.strokeRect(s,a,l,c)),u.restore()}var AB={id:"zoom",version:"2.2.0",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(e,t,n){Oj(e).options=n,Object.prototype.hasOwnProperty.call(n.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(n.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(n.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),Aj()&&EB(e,n),e.pan=(t,n,i)=>rB(e,t,n,i),e.zoom=(t,n)=>eB(e,t,n),e.zoomRect=(t,n,i)=>tB(e,t,n,i),e.zoomScale=(t,n,i)=>function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"api";const o=Oj(e);Zj(e,o),Bj(e.scales[t],n,void 0,!0),e.update(i),fI(o.options.zoom?.onZoom,[{chart:e,trigger:r}])}(e,t,n,i),e.resetZoom=t=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";const n=Oj(e),i=Zj(e,n);mI(e.scales,function(e){const t=e.options;i[e.id]?(t.min=i[e.id].min.options,t.max=i[e.id].max.options):(delete t.min,delete t.max),delete n.updatedScaleLimits[e.id]}),e.update(t),fI(n.options.zoom.onZoomComplete,[{chart:e}])}(e,t),e.getZoomLevel=()=>nB(e),e.getInitialScaleBounds=()=>oB(e),e.getZoomedScaleBounds=()=>function(e){const t=Oj(e),n={};for(const i of Object.keys(e.scales))n[i]=t.updatedScaleLimits[i];return n}(e),e.isZoomedOrPanned=()=>function(e){const t=oB(e);for(const n of Object.keys(e.scales)){const{min:i,max:r}=t[n];if(void 0!==i&&e.scales[n].min!==i)return!0;if(void 0!==r&&e.scales[n].max!==r)return!0}return!1}(e),e.isZoomingOrPanning=()=>sB(e)},beforeEvent(e,t){let{event:n}=t;if(sB(e))return!1;if("click"===n.type||"mouseup"===n.type){const t=Oj(e);if(t.filterNextClick)return t.filterNextClick=!1,!1}},beforeUpdate:function(e,t,n){const i=Oj(e),r=i.options;i.options=n,function(e,t){const{pan:n,zoom:i}=e,{pan:r,zoom:o}=t;return i?.zoom?.pinch?.enabled!==o?.zoom?.pinch?.enabled||n?.enabled!==r?.enabled||n?.threshold!==r?.threshold}(r,n)&&(CB(e),EB(e,n)),function(e,t){const n=e.canvas,{wheel:i,drag:r,onZoomComplete:o}=t.zoom;i.enabled?(cB(e,n,"wheel",bB),xB(e,"onZoomComplete",o,250)):lB(e,"wheel"),r.enabled?(cB(e,n,"mousedown",fB),cB(e,n.ownerDocument,"mouseup",yB)):(lB(e,"mousedown"),lB(e,"mousemove"),lB(e,"mouseup"),lB(e,"keydown"))}(e,n)},beforeDatasetsDraw(e,t,n){TB(e,"beforeDatasetsDraw",n)},afterDatasetsDraw(e,t,n){TB(e,"afterDatasetsDraw",n)},beforeDraw(e,t,n){TB(e,"beforeDraw",n)},afterDraw(e,t,n){TB(e,"afterDraw",n)},stop:function(e){!function(e){lB(e,"mousedown"),lB(e,"mousemove"),lB(e,"mouseup"),lB(e,"wheel"),lB(e,"click"),lB(e,"keydown")}(e),Aj()&&CB(e),function(e){Lj.delete(e)}(e)},panFunctions:$j,zoomFunctions:Xj,zoomRectFunctions:Yj};ZU.register(ij,aj,lF,sF,mF,FF,ej,zF,NF,AB);const PB=e=>{var n;let{data:i,title:o}=e;const s=(0,t.useRef)(null),[a,l]=(0,t.useState)(null),[c,u]=(0,t.useState)(1),[d,h]=(0,t.useState)({x:0,y:0}),[p,f]=(0,t.useState)(!1),[m,g]=(0,t.useState)({x:0,y:0});(0,t.useEffect)(()=>{var e,t;const n=s.current;if(!n||!i)return;const r=n.getContext("2d");if(!r)return;r.clearRect(0,0,n.width,n.height);const o=i.length,a=(null===(e=i[0])||void 0===e?void 0:e.length)||0;if(0===o||0===a)return;const l=Array.isArray(null===(t=i[0])||void 0===t?void 0:t[0]);r.save(),r.translate(d.x,d.y),r.scale(c,c);const u=n.width/a/c,h=n.height/o/c;if(l)for(let s=0;s<o;s++)for(let e=0;e<a;e++){const t=i[s][e];if(Array.isArray(t)&&t.length>=3){const e=Math.max(0,Math.min(255,t[0])),n=Math.max(0,Math.min(255,t[1])),i=Math.max(0,Math.min(255,t[2]));r.fillStyle=`rgb(${e}, ${n}, ${i})`}else r.fillStyle="black";r.fillRect(e*u,s*h,u,h)}else{let e=1/0,t=-1/0;for(let n=0;n<o;n++)for(let r=0;r<a;r++)e=Math.min(e,i[n][r]),t=Math.max(t,i[n][r]);for(let n=0;n<o;n++)for(let o=0;o<a;o++){const s=240*(1-(i[n][o]-e)/(t-e));r.fillStyle=`hsl(${s}, 100%, 50%)`,r.fillRect(o*u,n*h,u,h)}}r.restore()},[i,c,d]);(0,t.useEffect)(()=>{const e=s.current;if(!e)return;const t=e=>(e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1;u(e=>Math.max(.5,Math.min(5,e*t)))})(e);return e.addEventListener("wheel",t,{passive:!1}),()=>{e.removeEventListener("wheel",t)}},[]);const v=()=>{f(!1)};return(0,r.jsx)("div",{className:"heatmap-container",children:(0,r.jsxs)("div",{className:"heatmap-main",children:[(0,r.jsxs)("div",{className:"canvas-wrapper",children:[(0,r.jsx)("canvas",{ref:s,width:350,height:350,className:"heatmap-canvas",onMouseMove:e=>{var t;const n=s.current;if(!n||!i)return;const r=n.getBoundingClientRect(),o=(e.clientX-r.left-d.x)/c,a=(e.clientY-r.top-d.y)/c,u=i.length,f=(null===(t=i[0])||void 0===t?void 0:t.length)||0,g=n.width/f/c,v=n.height/u/c,y=Math.floor(a/v),b=Math.floor(o/g);if(l(y>=0&&y<u&&b>=0&&b<f?{x:b,y:y,value:i[y][b]}:null),p){const t=e.clientX-m.x,n=e.clientY-m.y;h({x:t,y:n})}},onMouseLeave:()=>l(null),onMouseDown:e=>{f(!0),g({x:e.clientX-d.x,y:e.clientY-d.y})},onMouseUp:v,onMouseOut:v}),a&&(0,r.jsxs)("div",{className:"tooltip",style:{position:"absolute",left:a.x*(350/((null===(n=i[0])||void 0===n?void 0:n.length)||1))+d.x,top:a.y*(350/i.length)+d.y,pointerEvents:"none"},children:["[",a.x,", ",a.y,"]: ",Array.isArray(a.value)?`[${a.value.map(e=>e.toFixed(0)).join(", ")}]`:"number"===typeof a.value?a.value.toFixed(3):a.value]})]}),(0,r.jsxs)("div",{className:"colorbar-vertical",children:[(0,r.jsx)("div",{className:"colorbar-gradient-vertical"}),(0,r.jsxs)("div",{className:"colorbar-labels",children:[(0,r.jsx)("span",{children:"Max"}),(0,r.jsx)("span",{children:"Min"})]})]})]})})},DB=e=>{let{data:t,title:n,xLabel:i,yLabel:o,color:s="#0066cc"}=e;const a={responsive:!0,maintainAspectRatio:!0,aspectRatio:1,plugins:{legend:{display:!1},title:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:e=>`${o}: ${e.parsed.y.toFixed(3)}`}},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"}}},scales:{x:{display:!0,title:{display:!0,text:i,color:"#999"},grid:{color:"#333",drawTicks:!0},ticks:{color:"#999"}},y:{display:!0,title:{display:!0,text:o,color:"#999"},grid:{color:"#333",drawTicks:!0},ticks:{color:"#999"}}}},l={labels:t.x.map(e=>e.toFixed(2)),datasets:[{data:t.y,borderColor:s,backgroundColor:s+"20",borderWidth:1.5,pointRadius:0,tension:0}]};return(0,r.jsx)("div",{className:"signal-plot-container",children:(0,r.jsx)(Mj,{options:a,data:l})})},kB=e=>{let{data:t,title:n,xLabel:i,yLabel:o,color:s="#4a9eff"}=e;const a={responsive:!0,maintainAspectRatio:!0,aspectRatio:1,plugins:{legend:{display:!1},title:{display:!1},tooltip:{mode:"index",intersect:!1},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"}}},scales:{x:{display:!0,title:{display:!0,text:i,color:"#999"},grid:{color:"#333",drawTicks:!0},ticks:{color:"#999"}},y:{display:!0,title:{display:!0,text:o,color:"#999"},grid:{color:"#333",drawTicks:!0},ticks:{color:"#999"}}}},l={labels:t.labels,datasets:[{data:t.values,backgroundColor:s+"80",borderColor:s,borderWidth:1}]};return(0,r.jsx)("div",{className:"signal-plot-container",children:(0,r.jsx)(Ej,{options:a,data:l})})},RB=e=>{let{data:t,title:n,xLabel:i,yLabel:o,color:s="#ff6600"}=e;const a={responsive:!0,maintainAspectRatio:!0,aspectRatio:1,plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label:e=>`(${e.parsed.x.toFixed(2)}, ${e.parsed.y.toFixed(2)})`}},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"xy"}}},scales:{x:{display:!0,title:{display:!0,text:i,color:"#999"},grid:{color:"#333",drawTicks:!0},ticks:{color:"#999"}},y:{display:!0,title:{display:!0,text:o,color:"#999"},grid:{color:"#333",drawTicks:!0},ticks:{color:"#999"}}}},l={datasets:[{data:t.x.map((e,n)=>({x:e,y:t.y[n]})),backgroundColor:s,borderColor:s,pointRadius:3,pointHoverRadius:5}]};return(0,r.jsx)("div",{className:"signal-plot-container",children:(0,r.jsx)(Cj,{options:a,data:l})})},NB=e=>{let{data:t,title:n}=e;return(0,r.jsx)("div",{className:"table-container",children:(0,r.jsx)("div",{className:"table-scroll",children:(0,r.jsxs)("table",{className:"data-table",children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{children:t.headers.map((e,t)=>(0,r.jsx)("th",{children:e},t))})}),(0,r.jsx)("tbody",{children:t.rows.map((e,t)=>(0,r.jsx)("tr",{children:e.map((e,t)=>(0,r.jsx)("td",{children:"number"===typeof e?e.toFixed(3):e},t))},t))})]})})})},IB=e=>{let{title:n,children:i,onReset:o,isFullscreen:s=!1,onFullscreen:a}=e;const[l,c]=(0,t.useState)(!1),[u,d]=(0,t.useState)(!1),h=(0,t.useRef)(null),p=(0,t.useRef)(null),f=()=>{null===a||void 0===a||a()},m=()=>{console.log("Download clicked")};return(0,t.useEffect)(()=>{const e=()=>{if(h.current){const e=h.current.offsetWidth;c(e<300)}};e();const t=new ResizeObserver(e);return h.current&&t.observe(h.current),()=>{h.current&&t.unobserve(h.current)}},[]),(0,t.useEffect)(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&d(!1)};if(u)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{ref:h,className:"grid-item "+(s?"fullscreen":""),children:[(0,r.jsx)("div",{className:"plot-top-bar",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"plot-top-bar-title",title:n,children:n}),(0,r.jsxs)("div",{className:"plot-hamburger-wrapper",ref:p,children:[(0,r.jsx)("button",{className:"plot-bar-btn hamburger-btn",onClick:()=>d(!u),title:"Menu",children:"\u2630"}),u&&(0,r.jsxs)("div",{className:"plot-dropdown-menu",children:[(0,r.jsxs)("div",{className:"menu-section",children:[(0,r.jsx)("label",{children:"Options:"}),(0,r.jsxs)("select",{className:"plot-dropdown menu-item",children:[(0,r.jsx)("option",{children:"Option 1"}),(0,r.jsx)("option",{children:"Option 2"})]})]}),(0,r.jsxs)("div",{className:"menu-section",children:[(0,r.jsx)("label",{children:"Value:"}),(0,r.jsx)("input",{type:"number",className:"plot-input menu-item",placeholder:"Value"})]}),(0,r.jsxs)("div",{className:"menu-buttons",children:[(0,r.jsx)("button",{className:"plot-bar-btn menu-btn",onClick:o,title:"Reset",children:"\u27f2 Reset"}),(0,r.jsx)("button",{className:"plot-bar-btn menu-btn "+(s?"active":""),onClick:f,title:"Fullscreen",children:"\u26f6 Fullscreen"}),(0,r.jsx)("button",{className:"plot-bar-btn menu-btn",onClick:m,title:"Download",children:"\u2b07 Download"})]})]})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"plot-top-bar-left",children:[(0,r.jsx)("span",{className:"plot-top-bar-title",title:n,children:n}),(0,r.jsxs)("div",{className:"plot-top-bar-controls",children:[(0,r.jsxs)("select",{className:"plot-dropdown",children:[(0,r.jsx)("option",{children:"Option 1"}),(0,r.jsx)("option",{children:"Option 2"})]}),(0,r.jsx)("input",{type:"number",className:"plot-input",placeholder:"Value"})]})]}),(0,r.jsxs)("div",{className:"plot-top-bar-buttons",children:[(0,r.jsx)("button",{className:"plot-bar-btn",onClick:o,title:"Reset",children:"\u27f2"}),(0,r.jsx)("button",{className:"plot-bar-btn "+(s?"active":""),onClick:f,title:"Fullscreen",children:"\u26f6"}),(0,r.jsx)("button",{className:"plot-bar-btn",onClick:m,title:"Download",children:"\u2b07"})]})]})}),(0,r.jsx)("div",{className:"plot-content",children:i})]})})},LB=()=>{const[e,n]=(0,t.useState)(100),[i,o]=(0,t.useState)(null),[s,a]=(0,t.useState)({show:!1,version:null}),l=300*e/100,{resultsData:c,resultsVersion:u,resultsHistory:d}=((0,t.useRef)(null),z_()),h=(0,t.useMemo)(()=>{const e=d.map(e=>({id:String(e.version),version:e.version,name:e.message||`v${e.version}`,timestamp:e.timestamp,tag:e.tag,tagColor:e.tagColor,plots:e.plots.map((e,t)=>({id:`plot-${t}`,type:e.type,title:e.title||`Plot ${t+1}`,data:e.data,xlabel:e.xlabel,ylabel:e.ylabel,legend:e.legend,xticks:e.xticks,yticks:e.yticks}))}));return e.reverse()},[d]),[p,f]=(0,t.useState)(0);(0,t.useEffect)(()=>{h.length>0&&f(0)},[h.length]);const m=h[p]||{plots:[]};return(0,r.jsxs)("div",{className:"results-panel",children:[(0,r.jsxs)("div",{className:"version-list",children:[(0,r.jsx)("div",{className:"version-list-header",children:(0,r.jsx)("span",{children:"Versions"})}),(0,r.jsx)("div",{className:"version-items",children:h.length>0?h.map((e,t)=>(0,r.jsx)("div",{className:"version-item "+(p===t?"selected":""),onClick:()=>f(t),title:`Version ${e.id} - ${e.plots.length} plots`,children:(0,r.jsxs)("div",{className:"version-content",children:[(0,r.jsxs)("div",{className:"version-main",children:[(0,r.jsxs)("div",{className:"version-header",children:[e.tag&&(0,r.jsx)("span",{className:"version-tag",style:{backgroundColor:e.tagColor||"#808080"},children:e.tag}),(0,r.jsx)("div",{className:"version-name",children:e.name})]}),(0,r.jsxs)("div",{className:"version-details",children:[(0,r.jsx)("span",{className:"version-time",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,r.jsxs)("span",{className:"version-info",children:[e.plots.length," plots"]})]})]}),(0,r.jsx)("button",{className:"version-delete",onClick:t=>((e,t)=>{t.stopPropagation(),a({show:!0,version:e})})(e.version,t),title:"Delete version",children:"\xd7"})]})},e.id)):(0,r.jsx)("div",{className:"version-empty",children:"No versions yet"})})]}),(0,r.jsxs)("div",{className:"results-content",children:[(0,r.jsxs)("div",{className:"results-top-bar",children:[(0,r.jsx)("div",{className:"top-bar-left",children:(0,r.jsx)("span",{className:"results-title",children:"Results Visualization"})}),(0,r.jsxs)("div",{className:"top-bar-right",children:[(0,r.jsx)("span",{className:"scale-label",children:"Plot Size"}),(0,r.jsx)("input",{type:"range",className:"scale-slider",value:e,onChange:e=>n(Number(e.target.value)),min:50,max:200,step:10}),(0,r.jsxs)("span",{className:"scale-value",children:[e,"%"]})]})]}),(0,r.jsxs)("div",{className:"visualization-container",children:[i&&(0,r.jsx)("div",{className:"fullscreen-overlay",onClick:()=>o(null)}),m.plots&&m.plots.length>0?m.plots.map((e,t)=>{var n;const s=`${e.type}-${t}`,a=i===s;return(0,r.jsx)("div",{className:"plot-wrapper "+(a?"fullscreen-in-container":""),style:{width:a?"100%":`${l}px`,height:a?"100%":`${l}px`},children:(0,r.jsxs)(IB,{title:e.title,isFullscreen:a,onFullscreen:()=>o(a?null:s),onReset:()=>{},children:["line"===e.type&&(0,r.jsx)(DB,{data:e.data,title:"",xLabel:e.xlabel||"X",yLabel:e.ylabel||"Y",color:e.data.color||"#0066cc"}),"bar"===e.type&&(0,r.jsx)(kB,{data:{labels:e.data.labels||(null===(n=e.data.x)||void 0===n?void 0:n.map((e,t)=>`Item ${t+1}`)),values:e.data.heights||e.data.y||[]},title:"",xLabel:e.xlabel||"Category",yLabel:e.ylabel||"Value",color:e.data.color||"#4a9eff"}),"scatter"===e.type&&(0,r.jsx)(RB,{data:e.data,title:"",xLabel:e.xlabel||"X",yLabel:e.ylabel||"Y",color:e.data.color||"#ff6600"}),"imshow"===e.type&&(0,r.jsx)(PB,{data:e.data.values||[],title:""}),"table"===e.type&&(0,r.jsx)(NB,{data:{headers:e.data.columns||[],rows:e.data.rows||[]},title:""})]})},s)}):(0,r.jsx)("div",{className:"no-data-message",children:"No visualization data available. Use server.results to create plots."})]})]}),s.show&&(0,r.jsx)("div",{className:"delete-modal-overlay",onClick:()=>a({show:!1,version:null}),children:(0,r.jsxs)("div",{className:"delete-modal",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{children:"Confirm Deletion"}),(0,r.jsxs)("p",{children:["Are you sure you want to delete version v",s.version,"?"]}),(0,r.jsx)("p",{className:"delete-warning",children:"This action cannot be undone."}),(0,r.jsxs)("div",{className:"delete-modal-buttons",children:[(0,r.jsx)("button",{className:"cancel-btn",onClick:()=>a({show:!1,version:null}),children:"Cancel"}),(0,r.jsx)("button",{className:"delete-btn",onClick:()=>{if(null!==s.version){J_.getState().wsService.send({type:"delete_results_version",version:s.version})}a({show:!1,version:null})},children:"Delete"})]})]})})]})},OB=()=>{const[e,n]=(0,t.useState)(""),[i,o]=(0,t.useState)([]),[s,a]=(0,t.useState)(-1),[l,c]=(0,t.useState)({log:!0,warning:!0,error:!0}),[u,d]=(0,t.useState)(null),h=(0,t.useRef)(null),p=(0,t.useRef)(null),f=z_(e=>e.consoleMessages),m=z_(e=>e.clearConsoleMessages),g=J_(e=>e.wsService),v=(0,t.useMemo)(()=>f.filter(e=>e.level&&["log","warning","error"].includes(e.level)?l[e.level]:(console.warn("Invalid message level:",e.level,e),!1)),[f,l]);(0,t.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[v]);const y=e=>{c(t=>({...t,[e]:!t[e]}))},b=e=>{try{return new Date(e).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}catch{return e}},x=e=>{switch(e){case"error":return"\u2715";case"warning":return"\u26a0";default:return"\u2022"}},_=(0,t.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation();const n=window.getSelection(),i=n&&n.toString().trim()?n.toString():`[${t.source}] ${t.message}`;d({x:e.clientX,y:e.clientY,text:i})},[]),w=(0,t.useCallback)(()=>{u&&(navigator.clipboard.writeText(u.text),d(null))},[u]);return(0,t.useEffect)(()=>{const e=()=>d(null),t=e=>{"Escape"===e.key&&d(null)};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}},[]),(0,r.jsxs)("div",{className:"console-panel",children:[(0,r.jsxs)("div",{className:"console-header",children:[(0,r.jsx)("button",{className:"console-clear-btn",onClick:()=>{m()},title:"Clear Console",children:"Clear"}),(0,r.jsxs)("div",{className:"console-filters",children:[(0,r.jsxs)("label",{className:"console-filter "+(l.log?"":"inactive"),children:[(0,r.jsx)("input",{type:"checkbox",checked:l.log,onChange:()=>y("log")}),(0,r.jsx)("span",{children:"Log"})]}),(0,r.jsxs)("label",{className:"console-filter "+(l.warning?"":"inactive"),children:[(0,r.jsx)("input",{type:"checkbox",checked:l.warning,onChange:()=>y("warning")}),(0,r.jsx)("span",{children:"Warning"})]}),(0,r.jsxs)("label",{className:"console-filter "+(l.error?"":"inactive"),children:[(0,r.jsx)("input",{type:"checkbox",checked:l.error,onChange:()=>y("error")}),(0,r.jsx)("span",{children:"Error"})]})]})]}),(0,r.jsxs)("div",{className:"console-messages",children:[0===v.length?(0,r.jsxs)("div",{className:"console-empty",children:[(0,r.jsx)("p",{children:"No console messages"}),(0,r.jsx)("p",{className:"console-hint",children:"Type /help to see available commands"})]}):v.map(e=>(0,r.jsxs)("div",{className:`console-message console-${e.level}`,onContextMenu:t=>_(t,e),children:[(0,r.jsx)("span",{className:"console-message-icon",children:x(e.level)}),(0,r.jsx)("span",{className:"console-message-time no-select",children:b(e.timestamp)}),(0,r.jsxs)("span",{className:"console-message-source",children:["[",e.source,"]"]}),(0,r.jsx)("span",{className:"console-message-text",children:e.message})]},e.id)),(0,r.jsx)("div",{ref:h})]}),(0,r.jsx)("form",{className:"console-input-wrapper",onSubmit:t=>{if(t.preventDefault(),!e.trim())return;const i=e.trim();o(e=>[...e,i]),a(-1),n(""),g.send({type:"execute_console_command",command:i})},children:(0,r.jsxs)("div",{className:"console-input-container",children:[(0,r.jsx)("span",{className:"console-prompt",children:">"}),(0,r.jsx)("input",{ref:p,type:"text",className:"console-input",value:e,onChange:e=>n(e.target.value),onKeyDown:e=>{if("ArrowUp"===e.key){if(e.preventDefault(),i.length>0){const e=s<i.length-1?s+1:s;a(e),e>=0&&n(i[i.length-1-e])}}else if("ArrowDown"===e.key)if(e.preventDefault(),s>0){const e=s-1;a(e),n(i[i.length-1-e])}else 0===s&&(a(-1),n(""))},placeholder:"Type a command (e.g., /help)",autoComplete:"off",spellCheck:!1})]})}),u&&Lt.createPortal((0,r.jsx)("div",{className:"console-context-menu",style:{position:"fixed",left:u.x,top:u.y,zIndex:1e4},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)("button",{className:"console-context-menu-item",onClick:w,children:"Copy"})}),document.body)]})},zB=e=>{var t,n;const i=null===(t=null===(n=e.params)||void 0===n?void 0:n.isDarkTheme)||void 0===t||t;return(0,r.jsx)("div",{className:"dockview-panel-content viewport-panel",children:(0,r.jsx)(rM,{isDarkTheme:i})})},UB=e=>{var t,n;const i=null===(t=null===(n=e.params)||void 0===n?void 0:n.isDarkTheme)||void 0===t||t;return(0,r.jsx)("div",{className:"dockview-panel-content node-editor-panel",children:(0,r.jsx)(kR,{isDarkTheme:i})})},FB=()=>(0,r.jsx)("div",{className:"dockview-panel-content hierarchy-panel",children:(0,r.jsx)(NR,{})}),jB=()=>(0,r.jsx)("div",{className:"dockview-panel-content properties-panel",children:(0,r.jsx)(wN,{})}),BB=e=>{var t,n;const i=null===(t=null===(n=e.params)||void 0===n?void 0:n.isDarkTheme)||void 0===t||t,o=XB.current;return(0,r.jsx)("div",{className:"dockview-panel-content hyperparameters-panel",children:(0,r.jsx)(SN,{isDarkTheme:i,dockviewApi:o})})},VB=()=>(0,r.jsx)("div",{className:"dockview-panel-content settings-panel",children:(0,r.jsx)(MN,{})}),HB=()=>(0,r.jsx)("div",{className:"dockview-panel-content timeline-panel",children:(0,r.jsx)(EN,{})}),GB=()=>(0,r.jsx)("div",{className:"dockview-panel-content results-panel-wrapper",children:(0,r.jsx)(LB,{})}),WB=()=>(0,r.jsx)("div",{className:"dockview-panel-content console-panel-wrapper",children:(0,r.jsx)(OB,{})}),XB={current:null},YB=e=>{let{isDarkTheme:n,onPanelsChange:i}=e;const o=(0,t.useRef)(null),s={viewport:zB,nodeEditor:UB,hierarchy:FB,properties:jB,hyperParameters:BB,settings:VB,timeline:HB,results:GB,console:WB};return(0,t.useEffect)(()=>{o.current&&o.current.panels.forEach(e=>{e.update({params:{isDarkTheme:n}})})},[n]),(0,t.useEffect)(()=>{const e=e=>{var t;const n=e.target;if(n.classList.contains("dv-tabs-container")||n.classList.contains("dv-tabs-and-actions-container")||null!==(t=n.parentElement)&&void 0!==t&&t.classList.contains("dv-tabs-container")&&!n.classList.contains("dv-tab"))return e.preventDefault(),e.stopPropagation(),!1};return document.addEventListener("dragstart",e,!0),()=>{document.removeEventListener("dragstart",e,!0)}},[]),(0,r.jsx)("div",{className:"dockview-container "+(n?"dark-theme":"light-theme"),children:(0,r.jsx)(Yt,{components:s,onReady:e=>{o.current=e.api,XB.current=e.api;const t=e.api.addPanel({id:"viewport",component:"viewport",title:"Viewport",params:{isDarkTheme:n}});e.api.addPanel({id:"nodeEditor",component:"nodeEditor",title:"Node Editor",params:{isDarkTheme:n},position:{referencePanel:t}});e.api.addPanel({id:"timeline",component:"timeline",title:"Timeline",position:{referencePanel:t,direction:"below"}}),e.api.addPanel({id:"hierarchy",component:"hierarchy",title:"Hierarchy",position:{referencePanel:t,direction:"left"}});const r=e.api.addPanel({id:"properties",component:"properties",title:"Properties",position:{referencePanel:t,direction:"right"}});e.api.addPanel({id:"settings",component:"settings",title:"Settings",position:{referencePanel:r}}),e.api.addPanel({id:"hyperParameters",component:"hyperParameters",title:"Hyper Parameters",position:{referencePanel:r},params:{isDarkTheme:n}}),e.api.addPanel({id:"results",component:"results",title:"Results",position:{referencePanel:r}}),e.api.addPanel({id:"console",component:"console",title:"Console",position:{referencePanel:r}}),setTimeout(()=>{var t;const n=null===(t=e.api.getPanel("timeline"))||void 0===t?void 0:t.group;n&&n.api.setSize({height:150}),window.dispatchEvent(new Event("resize")),e.api.panels.forEach(e=>{e.api.updateParameters({})})},100),t.api.setActive(),e.api.onDidActivePanelChange(e=>{});const s=()=>{const t=e.api.getPanel("results");t&&t.api.setTitle("Results");const n=e.api.getPanel("console");n&&n.api.setTitle("Console");const r=[{id:"viewport",title:"Viewport",isOpen:!!e.api.getPanel("viewport")},{id:"nodeEditor",title:"Node Editor",isOpen:!!e.api.getPanel("nodeEditor")},{id:"hierarchy",title:"Hierarchy",isOpen:!!e.api.getPanel("hierarchy")},{id:"properties",title:"Properties",isOpen:!!e.api.getPanel("properties")},{id:"hyperParameters",title:"Hyper Parameters",isOpen:!!e.api.getPanel("hyperParameters")},{id:"settings",title:"Settings",isOpen:!!e.api.getPanel("settings")},{id:"results",title:"Results",isOpen:!!e.api.getPanel("results")},{id:"console",title:"Console",isOpen:!!e.api.getPanel("console")},{id:"timeline",title:"Timeline",isOpen:!!e.api.getPanel("timeline")}];null===i||void 0===i||i(r)};e.api.onDidAddPanel(()=>s()),e.api.onDidRemovePanel(()=>s()),s();const a=localStorage.getItem("dockview-layout");if(a)try{const t=JSON.parse(a);e.api.fromJSON(t);const n=e.api.getPanel("results");n&&n.api.setTitle("Results");const i=e.api.getPanel("console");i&&i.api.setTitle("Console"),setTimeout(()=>{var t,n;const i=null===(t=e.api.getPanel("properties"))||void 0===t?void 0:t.group;if(i){const e=i.api.width;e&&e>600&&(console.warn(`Properties panel width was ${e}px, resetting to 350px`),i.api.setSize({width:350}))}const r=null===(n=e.api.getPanel("hierarchy"))||void 0===n?void 0:n.group;if(r){const e=r.api.width;e&&e>500&&(console.warn(`Hierarchy panel width was ${e}px, resetting to reasonable size`),r.api.setSize({width:250}))}window.dispatchEvent(new Event("resize"))},150)}catch(nV){console.error("Failed to restore layout:",nV)}e.api.onDidLayoutChange(()=>{(()=>{const t=e.api.getPanel("results");t&&t.api.setTitle("Results");const n=e.api.getPanel("console");n&&n.api.setTitle("Console");const i=e.api.toJSON();localStorage.setItem("dockview-layout",JSON.stringify(i))})()})},className:"dockview "+(n?"dockview-theme-dark":"dockview-theme-light"),disableFloatingGroups:!1,hideBorders:!1})})},$B="witwin-server-history",qB=e=>{let{isOpen:n,currentUrl:i,onConnect:o,onClose:s,onContinueWithoutServer:a,isForced:l=!1}=e;const[c,u]=(0,t.useState)("localhost"),[d,h]=(0,t.useState)("8000"),[p,f]=(0,t.useState)(!1),[m,g]=(0,t.useState)([]),[v,y]=(0,t.useState)({});(0,t.useEffect)(()=>{const e=localStorage.getItem($B);if(e)try{const t=JSON.parse(e);g(t)}catch(nV){console.error("Failed to parse server history:",nV)}},[n]),(0,t.useEffect)(()=>{n&&m.length>0&&b()},[n,m]),t.useEffect(()=>{if(i)try{const e=new URL(i),t=e.hostname,n=e.port||"8000";u(t),h(n)}catch{u("localhost"),h("8000")}},[i]);const b=async()=>{const e={};m.forEach(t=>{const n=`${t.address}:${t.port}`;e[n]="checking"}),y(e);for(const t of m){const e=`${t.address}:${t.port}`;await new Promise(n=>{try{const i=new WebSocket(`ws://${t.address}:${t.port}/ws`);let r=!1;const o=()=>{r||(r=!0,i.close(),n())},s=setTimeout(()=>{y(t=>({...t,[e]:"offline"})),o()},2e3);i.onopen=()=>{clearTimeout(s),y(t=>({...t,[e]:"online"})),o()},i.onerror=()=>{clearTimeout(s),y(t=>({...t,[e]:"offline"})),o()},i.onclose=()=>{clearTimeout(s),y(t=>"checking"===t[e]?{...t,[e]:"offline"}:t),o()}}catch{y(t=>({...t,[e]:"offline"})),n()}})}};if(!n)return null;const x=async()=>{f(!0);try{const e=`ws://${c}:${d}/ws`;await o(e),((e,t)=>{const n={address:e,port:t,lastConnected:Date.now()};let i=[...m];i=i.filter(n=>!(n.address===e&&n.port===t)),i.unshift(n),i=i.slice(0,5),localStorage.setItem($B,JSON.stringify(i)),g(i)})(c,d)}catch(Pb){}finally{f(!1)}},_=e=>{"Enter"===e.key&&x()},w=e=>{const t=Date.now()-e,n=Math.floor(t/6e4),i=Math.floor(t/36e5),r=Math.floor(t/864e5);return n<1?"Just now":n<60?`${n}m ago`:i<24?`${i}h ago`:`${r}d ago`};return(0,r.jsx)("div",{className:"modal-overlay",onClick:l?void 0:s,children:(0,r.jsxs)("div",{className:"modal-content server-selector-modal",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"modal-header",children:[(0,r.jsx)("h2",{children:"Connect to Server"}),!l&&(0,r.jsx)("button",{className:"modal-close",onClick:s,children:"\xd7"})]}),(0,r.jsxs)("div",{className:"modal-body",children:[(0,r.jsxs)("div",{className:"server-input-group",children:[(0,r.jsxs)("div",{className:"input-row",children:[(0,r.jsxs)("div",{className:"input-field address-field",children:[(0,r.jsx)("label",{htmlFor:"server-address",children:"Server Address:"}),(0,r.jsx)("input",{id:"server-address",type:"text",value:c,onChange:e=>u(e.target.value),onKeyDown:_,placeholder:"localhost or 192.168.1.100",disabled:p})]}),(0,r.jsxs)("div",{className:"input-field port-field",children:[(0,r.jsx)("label",{htmlFor:"server-port",children:"Port:"}),(0,r.jsx)("input",{id:"server-port",type:"text",value:d,onChange:e=>h(e.target.value.replace(/\D/g,"")),onKeyDown:_,placeholder:"8000",disabled:p})]})]}),(0,r.jsx)("p",{className:"server-help-text",children:"Enter server address and port separately"})]}),m.length>0&&(0,r.jsxs)("div",{className:"server-history",children:[(0,r.jsx)("h3",{children:"Recent Servers"}),(0,r.jsx)("div",{className:"history-list",children:m.map((e,t)=>{const n=`${e.address}:${e.port}`,i=v[n]||"checking";return(0,r.jsxs)("div",{className:"history-item "+("online"===i?"online":""),onClick:()=>(e=>{u(e.address),h(e.port)})(e),children:[(0,r.jsxs)("div",{className:"history-server",children:[(0,r.jsxs)("span",{className:"history-address",children:[e.address,":",e.port]}),(0,r.jsx)("span",{className:"history-time",children:w(e.lastConnected)})]}),(0,r.jsx)("div",{className:`status-indicator ${i}`})]},t)})})]}),(0,r.jsx)("div",{className:"tutorial-section",children:(0,r.jsxs)("p",{className:"tutorial-text",children:["Do not have a server? Follow the"," ",(0,r.jsx)("a",{href:"https://rfdigitaltwin.github.io/docs/rfdt-editor",target:"_blank",rel:"noopener noreferrer",className:"tutorial-link",children:"tutorial"})," ","to run RFDT locally."]})})]}),(0,r.jsxs)("div",{className:"modal-footer",children:[a&&(0,r.jsx)("button",{className:"continue-offline-button",onClick:a,disabled:p,children:"Continue without server"}),!l&&!a&&(0,r.jsx)("button",{className:"cancel-button",onClick:s,disabled:p,children:"Cancel"}),(0,r.jsx)("button",{className:"connect-modal-button",onClick:x,disabled:p||!c||!d,children:p?"Connecting...":"Connect"})]})]})})},ZB=e=>{let{onFileUpload:n}=e;const[i,o]=(0,t.useState)(!1),s=(0,t.useRef)(0),a=(0,t.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),l=(0,t.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),s.current++,e.dataTransfer.items&&e.dataTransfer.items.length>0){Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&o(!0)}},[]),c=(0,t.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),s.current--,0===s.current&&o(!1)},[]),u=(0,t.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),o(!1),s.current=0,e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0],i=[".obj",".ply",".stl"],r=t.name.toLowerCase().substring(t.name.lastIndexOf("."));i.includes(r)?n(t):alert(`Please upload a valid mesh file (${i.join(", ")})`)}},[n]);return t.useEffect(()=>{const e=document.getElementById("app-root");if(e)return e.addEventListener("dragenter",l),e.addEventListener("dragleave",c),e.addEventListener("dragover",a),e.addEventListener("drop",u),()=>{e.removeEventListener("dragenter",l),e.removeEventListener("dragleave",c),e.removeEventListener("dragover",a),e.removeEventListener("drop",u)}},[a,l,c,u]),i?(0,r.jsx)("div",{className:"drag-drop-overlay",children:(0,r.jsxs)("div",{className:"drag-drop-content",children:[(0,r.jsx)("div",{className:"drag-drop-icon",children:"\ud83d\udcc1"}),(0,r.jsx)("h2",{children:"Drop mesh file here"}),(0,r.jsx)("p",{children:"Supported formats: .obj, .ply, .stl"})]})}):null},KB=e=>{let{isConnected:n,serverUrl:i}=e;const[o,s]=(0,t.useState)(null),a=(0,t.useCallback)(async e=>{if(n)try{s(0);const t=new URL(i),n=`${"wss:"===t.protocol?"https:":"http:"}//${t.host}`;await(async(e,t,n)=>new Promise((i,r)=>{const o=new FormData;o.append("mesh",e),o.append("filename",e.name);const s=new XMLHttpRequest;s.upload.addEventListener("progress",e=>{if(e.lengthComputable){const t=e.loaded/e.total*100;n(t)}}),s.addEventListener("load",()=>{if(s.status>=200&&s.status<300)try{const e=JSON.parse(s.responseText);console.log("Mesh uploaded successfully:",e),i()}catch(Pb){r(new Error("Invalid server response"))}else r(new Error(`Upload failed with status: ${s.status}`))}),s.addEventListener("error",()=>{r(new Error("Network error during upload"))}),s.addEventListener("abort",()=>{r(new Error("Upload aborted"))}),s.open("POST",`${t}/upload-mesh`),s.send(o)}))(e,n,e=>{s(e)}),s(100),setTimeout(()=>s(null),1e3)}catch(Pb){console.error("Failed to upload mesh:",Pb),alert("Failed to upload mesh file"),s(null)}else alert("Please connect to a server before uploading files")},[n,i]);return(0,r.jsxs)(r.Fragment,{children:[null!==o&&(0,r.jsx)("div",{className:"upload-progress-overlay",children:(0,r.jsxs)("div",{className:"upload-progress-content",children:[(0,r.jsx)("h3",{children:"Uploading mesh..."}),(0,r.jsx)("div",{className:"progress-bar",children:(0,r.jsx)("div",{className:"progress-fill",style:{width:`${o}%`}})}),(0,r.jsxs)("p",{children:[Math.round(o),"%"]})]})}),(0,r.jsx)(ZB,{onFileUpload:a})]})},JB=!0,QB="localhost",eV="8000";const tV=function(){const{connect:e,disconnect:n,connectionStatus:i,serverUrl:s,isConnected:a}=J_(),{showObjectNames:l,toggleShowObjectNames:c,setTraceData:u,traceData:d,selectedObjectId:h,deleteSelectedObjects:p,duplicateObject:f,undo:m,redo:g,copySelectedObject:v,pasteObject:y}=z_(),[b,x]=(0,t.useState)(!1),[_,w]=(0,t.useState)(()=>"light"!==localStorage.getItem("theme")),[S,M]=(0,t.useState)(!1),[E,C]=(0,t.useState)([]);(0,t.useEffect)(()=>{const t=e=>(e.preventDefault(),!1);document.addEventListener("contextmenu",t);const n=new URLSearchParams(window.location.search),i=n.get("server"),r=n.get("port");if(i){e(`ws://${i}:${r||"8000"}/ws`).catch(()=>{console.error("Failed to connect to server from URL parameter")}),M(!0)}else if(JB){const t=`ws://${QB}:${eV}/ws`;console.log("[App] Attempting auto-connect to default server:",t),e(t).then(()=>{console.log("[App] Auto-connect successful"),M(!0)}).catch(()=>{console.log("[App] Auto-connect failed, showing server modal"),x(!0),M(!1)})}else x(!0),M(!1);return()=>{document.removeEventListener("contextmenu",t)}},[]),(0,t.useEffect)(()=>{_?(document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme"),document.body.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme"),document.body.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))},[_]);const T=(0,t.useCallback)(e=>{const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 120px;\n      left: 50%;\n      transform: translateX(-50%);\n      background-color: #ff4444;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 500;\n      z-index: 10000;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n      animation: slideDown 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},3e3)},[]),A=(0,t.useCallback)(async()=>{if(a)try{const e=new URL(s),t=`${"wss:"===e.protocol?"https:":"http:"}//${e.host}`;(await fetch(`${t}/save-scene`,{method:"POST"})).ok?console.log("Scene saved successfully"):alert("Failed to save scene")}catch(Pb){console.error("Failed to save scene:",Pb),alert("Failed to save scene")}else T("Cannot save: Please connect to server first")},[a,s,T]);return(0,t.useEffect)(()=>{const e=e=>{const t=e.target;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName){if((e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),A()),"Delete"===e.key&&h){if(e.preventDefault(),!a)return void T("Cannot delete: Please connect to server first");p()}if((e.ctrlKey||e.metaKey)&&"d"===e.key&&h){if(e.preventDefault(),!a)return void T("Cannot duplicate: Please connect to server first");f(h)}if(!e.ctrlKey&&!e.metaKey||"z"!==e.key||e.shiftKey||(e.preventDefault(),m()),((e.ctrlKey||e.metaKey)&&"y"===e.key||(e.ctrlKey||e.metaKey)&&e.shiftKey&&"z"===e.key)&&(e.preventDefault(),g()),(e.ctrlKey||e.metaKey)&&"c"===e.key&&h&&(e.preventDefault(),v()),(e.ctrlKey||e.metaKey)&&"v"===e.key){if(e.preventDefault(),!a)return void T("Cannot paste: Please connect to server first");y()}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A,h,a,p,f,m,g,v,y,T]),(0,r.jsxs)("div",{className:"app-container",id:"app-root",children:[(0,r.jsx)(o,{connectionStatus:(()=>{if("connected"===i&&s)try{const e=new URL(s);return`${e.hostname}:${e.port||"80"}`}catch{return"Connected"}switch(i){case"connecting":return"Connecting...";case"disconnected":return"Disconnected";default:return"Unknown"}})(),onTraceClick:()=>{a?(d&&u(null),I_.requestTraceData(),console.log("Trace data requested via WebSocket")):T("Cannot generate trace: Please connect to server first")},onConnectionClick:()=>{x(!0)},onSaveClick:A,isDarkTheme:_,onThemeToggle:()=>{w(!_)},showObjectNames:l,onToggleObjectNames:c,onOpenPanel:e=>{if(!XB.current)return;const t=XB.current.getPanel(e);if(t)t.api.setActive();else{const t={id:e,component:e,params:{isDarkTheme:_}},n={viewport:"Viewport",nodeEditor:"Node Editor",hierarchy:"Hierarchy",properties:"Properties",hyperParameters:"Hyper Parameters",settings:"Settings",timeline:"Timeline"};if(t.title=n[e]||e,"hierarchy"===e){const e=XB.current.getPanel("viewport");e&&(t.position={referencePanel:e,direction:"left"})}else if("properties"===e||"settings"===e||"hyperParameters"===e){const e=XB.current.getPanel("viewport");e&&(t.position={referencePanel:e,direction:"right"})}else if("timeline"===e){const e=XB.current.getPanel("viewport");e&&(t.position={referencePanel:e,direction:"below"})}else if("nodeEditor"===e){const e=XB.current.getPanel("viewport");e&&(t.position={referencePanel:e})}XB.current.addPanel(t).api.setActive()}},onResetLayout:()=>{if(!XB.current)return;localStorage.removeItem("dockview-layout");[...XB.current.panels].forEach(e=>{XB.current.removePanel(e)});const e=XB.current,t=e.addPanel({id:"viewport",component:"viewport",title:"Viewport",params:{isDarkTheme:_}});e.addPanel({id:"nodeEditor",component:"nodeEditor",title:"Node Editor",position:{referencePanel:t},params:{isDarkTheme:_}});e.addPanel({id:"hierarchy",component:"hierarchy",title:"Hierarchy",position:{referencePanel:t,direction:"left"},params:{isDarkTheme:_}});const n=e.addPanel({id:"properties",component:"properties",title:"Properties",position:{referencePanel:t,direction:"right"},params:{isDarkTheme:_}});e.addPanel({id:"settings",component:"settings",title:"Settings",position:{referencePanel:n},params:{isDarkTheme:_}}),e.addPanel({id:"hyperParameters",component:"hyperParameters",title:"Hyper Parameters",position:{referencePanel:n},params:{isDarkTheme:_}});const i=e.addPanel({id:"results",component:"results",title:"Results",position:{referencePanel:t,direction:"below"},params:{isDarkTheme:_}});e.addPanel({id:"console",component:"console",title:"Console",position:{referencePanel:i},params:{isDarkTheme:_}}),e.addPanel({id:"timeline",component:"timeline",title:"Timeline",position:{referencePanel:i},params:{isDarkTheme:_}}),setTimeout(()=>{var t;const n=null===(t=e.getPanel("results"))||void 0===t?void 0:t.group;n&&n.api.setSize({height:200});const i=e.getPanel("viewport");i&&i.api.setActive();const r=e.getPanel("results");r&&r.api.setActive();const o=e.getPanel("properties");o&&o.api.setActive(),window.dispatchEvent(new Event("resize")),e.panels.forEach(e=>{e.api.updateParameters({})})},100);C([{id:"viewport",title:"Viewport",isOpen:!0},{id:"nodeEditor",title:"Node Editor",isOpen:!0},{id:"hierarchy",title:"Hierarchy",isOpen:!0},{id:"properties",title:"Properties",isOpen:!0},{id:"hyperParameters",title:"Hyper Parameters",isOpen:!0},{id:"settings",title:"Settings",isOpen:!0},{id:"results",title:"Results",isOpen:!0},{id:"console",title:"Console",isOpen:!0},{id:"timeline",title:"Timeline",isOpen:!0}])},availablePanels:E}),(0,r.jsx)("div",{className:"app-content",children:(0,r.jsx)(YB,{isDarkTheme:_,onPanelsChange:C})}),(0,r.jsx)(qB,{isOpen:b,currentUrl:s,onConnect:async t=>{try{a&&(n(),await new Promise(e=>setTimeout(e,100))),await e(t),x(!1);const i=new URL(t),[r,o]=i.host.split(":"),s=new URL(window.location.href);s.searchParams.set("server",r),o&&"80"!==o&&"443"!==o&&s.searchParams.set("port",o),window.history.replaceState({},"",s.toString()),M(!0)}catch(Pb){}},onClose:()=>x(!1),onContinueWithoutServer:S?void 0:()=>{x(!1),M(!0)},isForced:!S}),(0,r.jsx)(KB,{isConnected:a,serverUrl:s})]})};i.createRoot(document.getElementById("root")).render((0,r.jsx)(t.StrictMode,{children:(0,r.jsx)(tV,{})}))})()})();
//# sourceMappingURL=main.a9e305df.js.map